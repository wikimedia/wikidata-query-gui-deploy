var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.App=function(e,t,r,i,a,n){"use strict";function o(e,t,r,i,a){this._$element=e,this._editor=t,this._queryHelper=r,this._sparqlApi=i,this._querySamplesApi=a,this._init()}return o.prototype._$element=null,o.prototype._resultView=null,o.prototype._sparqlApi=null,o.prototype._querySamplesApi=null,o.prototype._editor=null,o.prototype._queryHelper=null,o.prototype._isHistoryDisabled=!1,o.prototype._trackingApi=null,o.prototype._hasRunFirstQuery=!1,o.prototype._init=function(){this._sparqlApi||(this._sparqlApi=new wikibase.queryService.api.Sparql),this._resultView||(this._resultView=new wikibase.queryService.ui.ResultView(this._sparqlApi)),this._querySamplesApi||(this._querySamplesApi=new wikibase.queryService.api.QuerySamples),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._editor||(this._editor=new wikibase.queryService.ui.editor.Editor),this._track("init"),this._initApp(),this._initEditor(),this._initQueryHelper(),this._initExamples(),this._initDataUpdated(),this._initQuery(),this._initRdfNamespaces(),this._initHandlers(),e(r).scroll(function(){e("#query-box").offset().top+e("#query-box").height()-e(r).height()+100<e(this).scrollTop()&&e(this).scrollTop()>1?e("#query-box").hide({duration:500}):e("#query-box").show({duration:100})})},o.prototype._initApp=function(){e(r).keydown(function(t){t.ctrlKey&&13===t.keyCode&&e("#execute-button").click()}),e("#display-button").tooltip(),e("#download-button").tooltip(),e("#link-button").tooltip(),this._actionBar=new wikibase.queryService.ui.toolbar.Actionbar(e(".action-bar"))},o.prototype._initEditor=function(){var t=this;this._editor.fromTextArea(this._$element.find(".queryEditor")[0]),this._editor.registerCallback("change",function(r,i){if(":"===i.text[0]){var a=e('<a target="_blank" rel="noopener" href="https://www.wikidata.org/wiki/Wikidata:SPARQL_query_service/Wikidata_Query_Help/SPARQL_Editor#Code_Completion">').append(e.i18n("wdqs-app-footer-help"));t._toast(a,"wdqs-app-footer-help")}})},o.prototype._initQueryHelper=function(){var t=this;this._queryHelper||(this._queryHelper=new wikibase.queryService.ui.queryHelper.QueryHelper),this._queryHelper.setChangeListener(function(e){t._editor.setValue(e.getQuery())}),e(".query-helper").resizable({handleSelector:".splitter",resizeHeight:!1,onDrag:this._updateQueryHelperMinWidth.bind(this),onDragEnd:this._updateQueryEditorSize.bind(this)}),"true"!==a.get("query-helper-hide")&&e(".query-helper").removeClass("query-helper-hidden"),this._editor&&this._editor.registerCallback("change",i.debounce(function(){t._editor.getValue()!==t._queryHelper.getQuery()&&t._drawQueryHelper()},1500)),e(".query-helper .panel-heading .close").click(function(){return a.set("query-helper-hide",!0),e(".query-helper").addClass("query-helper-hidden"),t._updateQueryEditorSize(),t._track("buttonClick.queryHelperTrigger.close"),!1}),e(".query-helper-trigger").click(function(){var r=e(".query-helper").is(":visible");return e(".query-helper").toggleClass("query-helper-hidden",r),a.set("query-helper-hide",!r),t._updateQueryEditorSize(),t._track("buttonClick.queryHelperTrigger."+(r?"close":"open")),!1}),r.setTimeout(e.proxy(this._drawQueryHelper,this),500)},o.prototype._drawQueryHelper=function(){try{this._queryHelper.setQuery(this._editor.getValue()||"SELECT * WHERE {} LIMIT 20"),this._queryHelper.draw(e(".query-helper .panel-body")),e(".query-helper").css("min-width",""),this._updateQueryHelperMinWidth()}catch(e){this._editor.highlightError(e.message),r.console.error(e)}},o.prototype._updateQueryHelperMinWidth=function(){var t=e(".query-helper"),r=t.find("table"),a=i.max(i.map(r,function(t){return e(t).width()}));a>t.width()&&t.css("min-width",a+r.offset().left-t.offset().left)},o.prototype._updateQueryEditorSize=function(){this._editor&&(this._editor._editor.setSize(0,null),this._editor._editor.setSize(e(".query-editor-container").width(),null))},o.prototype._initExamples=function(){var t=this;new wikibase.queryService.ui.QueryExampleDialog(e("#QueryExamples"),this._querySamplesApi,function(e,r){e&&e.trim()&&t._editor.setValue("#"+r+"\n"+e)})},o.prototype._initRdfNamespaces=function(){var t,r,i,a=e(".namespace-shortcuts"),n=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS;a.click(function(e){e.stopPropagation()});for(t in n){r=e("<select>").attr("class","form-control").append(e("<option>").text(t)).appendTo(a);for(i in n[t])r.append(e("<option>").text(i).attr("value",n[t][i]))}},o.prototype._initQuery=function(){""!==r.location.hash&&(0===location.hash.indexOf("#result#")&&(location.hash=location.hash.replace("#result#","#")),this._isHistoryDisabled=!0,this._editor.setValue(decodeURIComponent(r.location.hash.substr(1))),this._editor.refresh(),this._isHistoryDisabled=!1)},o.prototype._initDataUpdated=function(){var t=this,i=e(".dataUpdated"),a=function(){t._sparqlApi.queryDataUpdatedTime().done(function(t,r){var a="list-group-item-danger";r<=120?a="list-group-item-success":r<=900&&(a="list-group-item-warning"),i.html(e("<a>").addClass("fa fa-refresh badge "+a).html(" "))})};a(),r.setInterval(a,6e5),i.hover(function(){a();var r=e(this);t._sparqlApi.queryDataUpdatedTime().done(function(t,a){var o=t,s='<span class="badge">'+n.duration(a,"seconds").humanize()+"</span>";i.attr("title",o),r.popover({html:!0,trigger:"hover",placement:"top",content:e.i18n("wdqs-app-footer-updated",s)})}).fail(function(){r.popover({content:"[unable to connect]"})})},function(){e(this).popover("destroy")})},o.prototype._initHandlers=function(){var t=this;e("#query-form").submit(e.proxy(this._handleQuerySubmit,this)),e(".namespace-shortcuts").on("change","select",e.proxy(this._handleNamespaceSelected,this)),e(".addPrefixes").click(function(){var e=wikibase.queryService.RdfNamespaces.STANDARD_PREFIXES,r=Object.keys(e).map(function(t){return e[t]}).join("\n");t._editor.prepandValue(r+"\n\n"),t._track("buttonClick.addPrefixes")}),e('[data-target="#QueryExamples"]').click(function(){t._track("buttonClick.examples")}),e("#clear-button").click(function(){t._editor.setValue(""),t._track("buttonClick.clear")}),e(".explorer-close").click(function(t){t.preventDefault(),e(".explorer-panel").hide()}),e(".restore").click(function(e){e.preventDefault(),t._editor.restoreValue()}),e(".fullscreen").click(function(r){r.preventDefault(),t._editor.toggleFullscreen(),t._editor.focus();var i=e('<a target="_blank" rel="noopener" href="https://www.wikidata.org/wiki/Wikidata:SPARQL_query_service/Wikidata_Query_Help/SPARQL_Editor#Editor_Toolbar">').append(e.i18n("wdqs-app-toast-leave-fullscreen"));t._toast(i,"wdqs-app-toast-leave-fullscreen")}),e(r).on("popstate",e.proxy(this._initQuery,this)),this._initPopovers(),this._initHandlersDownloads()},o.prototype._initPopovers=function(){var t=this;e(".shortUrlTrigger.query").clickover({placement:"right",global_close:!0,html:!0,content:function(){return t._updateQueryUrl(),'<iframe class="shortUrl" src="//tinyurl.com/api-create.php?url='+encodeURIComponent(r.location)+'" referrerpolicy="origin" sandbox="" ></iframe>'}}).click(function(){t._track("buttonClick.shortUrlQuery")}),e(".shortUrlTrigger.result").clickover({placement:"left",global_close:!0,html:!0,content:function(){t._updateQueryUrl();var i=e("<a>").attr("href","embed.html"+r.location.hash);return'<iframe class="shortUrl" src="//tinyurl.com/api-create.php?url='+encodeURIComponent(i[0].href)+'" referrerpolicy="origin" sandbox="" ></iframe>'}}).click(function(){t._track("buttonClick.shortUrlResult")}),e(".embed.result").clickover({placement:"left",global_close:!0,html:!0,content:function(){t._updateQueryUrl();var i="";t._selectedResultBrowser&&(i="#defaultView:"+t._selectedResultBrowser+"\n",i=encodeURIComponent(i));var a=e("<a>").attr("href","embed.html#"+i+r.location.hash.substring(1)),n=e("<textarea>").text('<iframe style="width: 80vw; height: 50vh; border: none;" src="'+a[0].href+'" referrerpolicy="origin" sandbox="allow-scripts allow-same-origin allow-popups" ></iframe>').click(function(){n.select()});return n}}).click(function(){t._track("buttonClick.embedResult")})},o.prototype._initHandlersDownloads=function(){var i=this._sparqlApi,a={CSV:{handler:e.proxy(i.getResultAsCsv,i),mimetype:"text/csv;charset=utf-8"},JSON:{handler:e.proxy(i.getResultAsJson,i),mimetype:"application/json;charset=utf-8"},TSV:{handler:e.proxy(i.getSparqlTsv,i),mimetype:"text/tab-separated-values;charset=utf-8"},"Simple TSV":{handler:e.proxy(i.getSimpleTsv,i),mimetype:"text/tab-separated-values;charset=utf-8",ext:"tsv"},"Full JSON":{handler:e.proxy(i.getResultAsAllJson,i),mimetype:"application/json;charset=utf-8",ext:"json"},SVG:{handler:function(){var t=e("#query-result svg");if(!t.length)return null;t.attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"});try{return'<?xml version="1.0" encoding="utf-8"?>\n'+r.unescape(encodeURIComponent(t[0].outerHTML))}catch(e){return null}},mimetype:"data:image/svg+xml;charset=utf-8",ext:"svg"}},n=this;for(var o in a){var s=a[o].ext||o.toLowerCase(),u=o.replace(/\s/g,"-");e("#download"+u).click(function(e,r,i){return function(a){a.preventDefault(),n._track("buttonClick.download."+e);var o=r();o&&t(o,e,i)}}("query."+s,a[o].handler,a[o].mimetype))}},o.prototype._handleQuerySubmit=function(t){var r=this;this._track("buttonClick.execute"),this._hasRunFirstQuery||(this._track("firstQuery"),this._hasRunFirstQuery=!0),t.preventDefault(),this._editor.save(),this._updateQueryUrl(),e("#execute-button").prop("disabled",!0),this._resultView.draw(this._editor.getValue()).fail(function(e){r._editor.highlightError(e)}).always(function(){e("#execute-button").prop("disabled",!1)}),e(".queryUri").attr("href",r._sparqlApi.getQueryUri()),e(".rawGraphsUri").attr("href","http://wikidata.rawgraphs.io/?url="+encodeURIComponent(r._sparqlApi.getQueryUri()))},o.prototype._handleNamespaceSelected=function(t){var r,i=t.target.value,a=this._editor.getValue();-1===a.indexOf("<"+i+">")&&(r=e(t.target).find(":selected").text(),this._editor.setValue("PREFIX "+r+": <"+i+">\n"+a)),t.target.selectedIndex=0},o.prototype._updateQueryUrl=function(){if(!this._isHistoryDisabled){var e=encodeURIComponent(this._editor.getValue());e=e.replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)}),r.location.hash!==e&&(r.history.pushState?r.history.pushState(null,null,"#"+e):r.location.hash=e)}},o.prototype._toast=function(t,r){var i="hide-toast-"+r;a.get(i)||e.toast({loader:!1,stack:1,text:t[0].outerHTML,afterShown:function(){e(".close-jq-toast-single").click(function(){a.set(i,!0)})}})},o.prototype._track=function(e,t,r){this._trackingApi.track("wikibase.queryService.ui.app."+e,t,r)},o}(jQuery,download,window,_,Cookies,moment),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.toolbar=wikibase.queryService.toolbar||{},wikibase.queryService.ui.toolbar.Actionbar=function(e){"use strict";function t(e){this._$element=e}return t.prototype._$element=null,t.prototype.show=function(t,r,i,a){var n=t;e.i18n&&(n=e.i18n(t)),""!==r&&(n=n+": "+r),this._$element.find(".message").html(""),i||(i="info"),void 0===a||!1===a?this._$element.find(".message").append(this._getBar(n,i)):this._$element.find(".message").append(this._getProgressbar(n,i,a)),this._$element.show()},t.prototype._getProgressbar=function(t,r,i){return e('<div class="progress"><div class="progress-bar progress-bar-'+r+' progress-bar-striped active" role="progressbar" style="width: '+i+'%">'+t+"</div></div>")},t.prototype._getBar=function(t,r){return e('<div class="label label-'+r+'"/>').text(t)},t.prototype.hide=function(){this._$element.hide()},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.i18n=wikibase.queryService.ui.i18n||{},wikibase.queryService.ui.i18n.LanguageSelector=function(e,t){"use strict";function r(e,r,i){this._$element=e,this._api=r||new t.queryService.api.Wikibase,this._defaultLanguage=i,this._create()}return r.prototype._api=null,r.prototype._$element=null,r.prototype._defaultLanguage=null,r.prototype._changeListener=null,r.prototype.setChangeListener=function(e){this._changeListener=e},r.prototype._create=function(t){var r=this;this._$element.text(e.uls.data.getAutonym(this._defaultLanguage)),this._getLanguages().done(function(t){r._$element.uls({onSelect:function(t){r._$element.text(e.uls.data.getAutonym(t)),r._changeListener&&r._changeListener(t)},languages:t}).click(function(){e(".uls-menu").addClass("uls-mobile").css("left","").css("right","2.5%")}).css("display","block")})},r.prototype._getLanguages=function(){var t=e.Deferred();return this._api.getLanguages().done(function(r){var i={};e.each(r.query.languages,function(e,t){i[t.code]=t["*"]}),t.resolve(i)}),t.promise()},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.hint=wikibase.queryService.ui.editor.hint||{},function(e,t){"use strict";var r=["SELECT","SELECT * WHERE {\n\n}","OPTIONAL","OPTIONAL {\n\n}","WHERE","WHERE {\n\n}","ORDER","ORDER BY","DISTINCT","SERVICE",'SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }',"BASE","PREFIX","REDUCED","FROM","LIMIT","OFFSET","HAVING","UNION","SAMPLE","(SAMPLE() AS )","COUNT","(COUNT() AS )","DESC","DESC()","ASC","ASC()","FILTER ()","FILTER NOT EXISTS","FILTER NOT EXISTS {\n\n}","UNION","UNION {\n\n}","BIND","BIND ()","GROUP_CONCAT","(GROUP_CONCAT() as )","ORDER BY","#defaultView:Map","#defaultView:ImageGrid","#defaultView:Map","#defaultView:BubbleChart","#defaultView:TreeMap","#defaultView:Tree","#defaultView:Timeline","#defaultView:Dimensions","#defaultView:Graph","#defaultView:LineChart","#defaultView:BarChart","#defaultView:ScatterChart","#defaultView:AreaChart","SERVICE wikibase:around {\n\t?place wdt:P625 ?location.\n\tbd:serviceParam wikibase:center ? .\n\tbd:serviceParam wikibase:radius ? .\n\tbd:serviceParam wikibase:distance ?dist.\n}","SERVICE wikibase:box {\n\t?place wdt:P625 ?location.\n\tbd:serviceParam wikibase:cornerWest ? .\n\tbd:serviceParam wikibase:cornerEast ? .\n}",'hint:Query hint:optimizer "None".','#TEMPLATE={ "template": "Textual description of template, referencing ?var", "variables": { "?var": { "query": "SELECT ?id WHERE { ?id wdt:P31 wd:Q146. }" } } }'],i=["wikibase:rank","wikibase:badge","wikibase:propertyType","wikibase:directClaim","wikibase:claim","wikibase:statementProperty","wikibase:statementValue","wikibase:qualifier","wikibase:qualifierValue","wikibase:reference","wikibase:referenceValue","wikibase:statementValueNormalized","wikibase:qualifierValueNormalized","wikibase:referenceValueNormalized","wikibase:novalue","wikibase:Property","wikibase:Reference","wikibase:Dump","wikibase:PreferredRank","wikibase:NormalRank","wikibase:DeprecatedRank","wikibase:BestRank","wikibase:TimeValue","wikibase:QuantityValue","wikibase:GlobecoordinateValue","wikibase:WikibaseItem","wikibase:CommonsMedia","wikibase:Globecoordinate","wikibase:Monolingualtext","wikibase:Quantity","wikibase:String","wikibase:Time","wikibase:Url","wikibase:ExternalId","wikibase:WikibaseProperty","wikibase:Math","wikibase:statements","wikibase:sitelinks","wikibase:timeValue","wikibase:timePrecision","wikibase:timeTimezone","wikibase:timeCalendarModel","wikibase:quantityAmount","wikibase:quantityUpperBound","wikibase:quantityLowerBound","wikibase:quantityUnit","wikibase:quantityNormalized","wikibase:geoLatitude","wikibase:geoLongitude","wikibase:geoPrecision","wikibase:geoGlobe","wikibase:wikiGroup","schema:about","schema:name","schema:description","schema:dateModified","schema:Article","schema:inLanguage","schema:isPartOf","rdfs:label","rdf:type","skos:altLabel","xsd:dateTime","xsd:integer","xsd:decimal","geo:wktLiteral","owl:sameAs","prov:wasDerivedFrom"],a=wikibase.queryService.ui.editor.hint.Sparql=function(){};a.prototype.getHint=function(t,r,i,a){var n=this._getCurrentWord(r,a),o=[],s=new e.Deferred;if(0===n.word.indexOf("?")&&(o=o.concat(this._getVariableHints(n.word,this._getDefinedVariables(t)))),(o=o.concat(this._getSPARQLHints(n.word))).length>0){var u=this._getHintCompletion(n,o,i);return s.resolve(u).promise()}return s.reject().promise()},a.prototype._getSPARQLHints=function(t){var a=[];return e.each(r,function(e,r){r.toLowerCase().indexOf(t.toLowerCase())>=0&&a.push(r)}),e.each(i,function(e,r){0===r.toLowerCase().indexOf(t.toLowerCase())&&a.push(r)}),a},a.prototype._getDefinedVariables=function(t){var r={};return e.each(t.match(/\?\w+/g),function(e,t){r[t]=!0}),Object.keys(r)},a.prototype._getVariableHints=function(t,r){var i=[];return t&&"?"!==t?(e.each(r,function(e,r){0===r.toLowerCase().indexOf(t.toLowerCase())&&i.push(r)}),i):r},a.prototype._getHintCompletion=function(e,t,r){var i={list:[]};return i.from={line:r,char:e.start},i.to={line:r,char:e.end},i.list=t,i},a.prototype._getCurrentWord=function(e,t){var r=t-1;for(r<0&&(r=0);/[\w?#:]/.test(e.charAt(r))&&!(--r<0););var i=r+1;for(r=t;/[\w:]/.test(e.charAt(r))&&!(++r>=e.length););var a=r;return{word:e.substring(i,a),start:i,end:a}}}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.hint=wikibase.queryService.ui.editor.hint||{},function(e,t){"use strict";var r=t.queryService.ui.editor.hint.Rdf=function(e,r){this._api=e,this._rdfNamespaces=r,this._api||(this._api=new t.queryService.api.Wikibase),this._rdfNamespaces||(this._rdfNamespaces=t.queryService.RdfNamespaces)};r.prototype._rdfNamespaces=null,r.prototype._api=null,r.prototype.getHint=function(t,r,i,a){var n,o,s,u,l=new e.Deferred,p=this._getCurrentWord(r,a),c=this;return p.word.match(/\S+:\S*/)?(o=this._getPrefixFromWord(p.word.trim()),s=this._getTermFromWord(p.word.trim()),(u=this._extractPrefixes(t))[o]?0===s.length?(n=[{text:s,displayText:"Type to search for an entity"}],l.resolve(this._getHintCompletion(i,p,o,n)).promise()):(u[o]&&this._searchEntities(s,u[o]).done(function(e){return l.resolve(c._getHintCompletion(i,p,o,e))}),l.promise()):this._rdfNamespaces.ALL_PREFIXES&&this._rdfNamespaces.ALL_PREFIXES[o]?l.reject().promise():(n=[{text:s,displayText:"Unknown prefix '"+o+":'"}],l.resolve(this._getHintCompletion(i,p,o,n)).promise())):l.reject().promise()},r.prototype._getPrefixFromWord=function(e){return e.split(":",1)[0]},r.prototype._getTermFromWord=function(e){return e.split(":").pop()},r.prototype._getHintCompletion=function(e,t,r,i){var a={list:[]};return a.from={line:e,char:t.start+r.length+1},a.to={line:e,char:t.end},a.list=i,a},r.prototype._searchEntities=function(t,r){var i=[],a=e.Deferred();return this._api.searchEntities(t,r).done(function(t){e.each(t.search,function(e,t){i.push({className:"wikibase-rdf-hint",text:t.id,displayText:t.label+" ("+t.id+") "+t.description+"\n"})}),a.resolve(i)}),a.promise()},r.prototype._getCurrentWord=function(e,t){var r=t-1,i=!1,a=["/","*","+"," ",";",".","\n","\t","(",")","{","}","[","]"];for(r<0&&(r=0);(-1===a.indexOf(e.charAt(r))||" "===e.charAt(r)&&!1===i||":"===e.charAt(r)&&!1===i)&&(":"===e.charAt(r)&&(i=!0),!(--r<0)););var n=r+1;for(r=t;-1===a.indexOf(e.charAt(r))&&!(++r>=e.length););var o=r;return{word:e.substring(n,o),start:n,end:o}},r.prototype._extractPrefixes=function(t){var r,i=this._rdfNamespaces.getPrefixMap(this._rdfNamespaces.ENTITY_TYPES),a=this._rdfNamespaces.ENTITY_TYPES,n=t.split("\n");return e.each(n,function(e,t){(r=t.match(/(PREFIX) (\S+): <([^>]+)>/))&&a[r[3]]&&(i[r[2]]=a[r[3]])}),i}}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.tooltip=wikibase.queryService.ui.editor.tooltip||{},wikibase.queryService.ui.editor.tooltip.Rdf=function(e,t,r){"use strict";function i(e,t){this._api=e,this._rdfNamespaces=t,this._api||(this._api=new wikibase.queryService.api.Wikibase),this._rdfNamespaces||(this._rdfNamespaces=wikibase.queryService.RdfNamespaces)}return i.prototype._rdfNamespaces=null,i.prototype._editor=null,i.prototype.setEditor=function(e){this._editor=e,this._registerHandler()},i.prototype._registerHandler=function(){var t=this;e.on(this._editor.getWrapperElement(),"mouseover",r.debounce(function(e){t._triggerTooltip(e)},300))},i.prototype._triggerTooltip=function(e){this._removeToolTip(),this._createTooltip(e)},i.prototype._createTooltip=function(e){var r=e.clientX,i=e.clientY+t(window).scrollTop(),a=this._editor.getTokenAt(this._editor.coordsChar({left:r,top:i})).string;if(a.match(/.+\:(Q|P)[0-9]*/)){var n=this._extractPrefixes(this._editor.doc.getValue()),o=a.split(":",1)[0],s=a.split(":").pop();if(n[o]){var u=this;this._searchEntities(s,n[o]).done(function(e){u._showToolTip(e.shift(),{x:r,y:i})})}}},i.prototype._removeToolTip=function(){t(".wikibaseRDFtoolTip").remove()},i.prototype._showToolTip=function(e,r){e&&r&&t('<div class="panel panel-info">').css("position","absolute").css("z-index","100").css("max-width","200px").css({top:r.y+2,left:r.x+2}).addClass("wikibaseRDFtoolTip").append(t('<div class="panel-body">').html(e).css("padding","10px")).appendTo("body").fadeIn("slow")},i.prototype._extractPrefixes=function(e){var r,i=this._rdfNamespaces.getPrefixMap(this._rdfNamespaces.ENTITY_TYPES),a=e.split("\n"),n=this;return t.each(a,function(e,t){(r=t.match(/(PREFIX) (\S+): <([^>]+)>/))&&n._rdfNamespaces.ENTITY_TYPES[r[3]]&&(i[r[2]]=n._rdfNamespaces.ENTITY_TYPES[r[3]])}),i},i.prototype._searchEntities=function(e,r){var i=[],a=t.Deferred();return this._api.searchEntities(e,r).done(function(e){t.each(e.search,function(e,t){i.push(t.label+" ("+t.id+")<br/><small>"+(t.description||"")+"</small>")}),a.resolve(i)}),a.promise()},i}(CodeMirror,jQuery,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.Editor=function(e,t,r,i){"use strict";function a(e,r,i){this._rdfHint=e,this._sparqlHint=r,this._rdfTooltip=i,this._sparqlHint||(this._sparqlHint=new t.queryService.ui.editor.hint.Sparql),this._rdfHint||(this._rdfHint=new t.queryService.ui.editor.hint.Rdf),this._rdfTooltip||(this._rdfTooltip=new t.queryService.ui.editor.tooltip.Rdf)}var n={lineNumbers:!0,matchBrackets:!0,mode:"sparql",extraKeys:{"Ctrl-Space":"autocomplete",Tab:function(e){var t=Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(t)},F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}},viewportMargin:1/0,hintOptions:{closeCharacters:/[]/,completeSingle:!1}},o=null,s=null;return a.prototype._editor=null,a.prototype._sparqlHint=null,a.prototype._rdfHint=null,a.prototype._rdfTooltip=null,a.prototype.fromTextArea=function(e){var t=this;this._editor=r.fromTextArea(e,n),this._editor.on("change",function(e,r){""!==t.getValue()&&t.storeValue(t.getValue()),t.clearError(),"?"!==r.text[0]&&"#"!==r.text[0]||e.showHint({closeCharacters:/[\s]/})}),this._editor.focus(),this._rdfTooltip.setEditor(this._editor),this._registerHints()},a.prototype._registerHints=function(){var e=this;r.registerHelper("hint","sparql",function(t,r,i){if(t===e._editor){var a=t.getLine(t.getCursor().line),n=t.doc.getValue(),o=t.getCursor().ch,s=t.getCursor().line;e._getHints(n,a,s,o).done(function(e){r(e)})}}),r.hint.sparql.async=!0},a.prototype._getHints=function(t,i,a,n){var o=new e.Deferred,s=this;return this._rdfHint.getHint(t,i,a,n).done(function(e){e.from=r.Pos(e.from.line,e.from.char),e.to=r.Pos(e.to.line,e.to.char),o.resolve(e)}).fail(function(){s._sparqlHint.getHint(t,i,a,n).done(function(e){e.from=r.Pos(e.from.line,e.from.char),e.to=r.Pos(e.to.line,e.to.char),o.resolve(e)})}),o.promise()},a.prototype.addKeyMap=function(e,t){this._editor.addKeyMap({keyMap:t})},a.prototype.setValue=function(e){this._editor.setValue(e)},a.prototype.getValue=function(){return this._editor.getValue()},a.prototype.save=function(){this._editor.save()},a.prototype.prepandValue=function(e){this._editor.setValue(e+this._editor.getValue())},a.prototype.refresh=function(){this._editor.refresh()},a.prototype.highlightError=function(e){var t,r,i=null;(i=e.match(/line ([0-9]*)\:/i))&&(t=i[1]),(i=e.match(/line (\d+), column (\d+)/))&&(t=i[1]-1,(r=i[2]-1)>=this._editor.doc.getLine(t).length-1&&(r=this._editor.doc.getLine(t).length-1),s=this._editor.doc.markText({line:t,ch:r},{line:t,ch:r+1},{className:"error-character"})),t&&(o=this._editor.doc.markText({line:t,ch:0},{line:t},{className:"error-line"}))},a.prototype.clearError=function(){o&&o.clear(),s&&s.clear()},a.prototype.storeValue=function(e){try{localStorage&&localStorage.setItem("wikibase.queryService.ui.Editor",e)}catch(e){}},a.prototype.restoreValue=function(){try{if(localStorage){var e=localStorage.getItem("wikibase.queryService.ui.Editor");e&&(this.setValue(e),this.refresh())}}catch(e){}},a.prototype.registerCallback=function(e,t){this._editor.on(e,t)},a.prototype.toggleFullscreen=function(e){this._editor.setOption("fullScreen",!this._editor.getOption("fullScreen"))},a.prototype.focus=function(){this._editor.focus()},a}(jQuery,wikibase,CodeMirror),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryHelper=function(e,t,r){"use strict";function i(e,r,i){this._api=e||new t.queryService.api.Wikibase,this._selectorBox=i||new t.queryService.ui.queryHelper.SelectorBox(this._api,r),this._query=new t.queryService.ui.queryHelper.SparqlQuery}var a={"http://www.w3.org/2000/01/rdf-schema#label":!0,"http://schema.org/description":!0,"http://www.bigdata.com/queryHints#optimizer":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},n={formatNoMatches:function(){}};return i.prototype._api=null,i.prototype._selectorBox=null,i.prototype._changeListener=null,i.prototype._query=null,i.prototype._triples=[],i.prototype._isSimpleMode=!1,i.prototype._labels={filter:"Filter",show:"Show",anything:"anything",with:"with",any:"any",or:"or",subtype:"subtype"},i.prototype.setQuery=function(e){var r=t.queryService.RdfNamespaces.ALL_PREFIXES;this._query.parse(e,r),this._selectorBox.setQuery(this._query)},i.prototype.getQuery=function(){try{var e=this._query.getQueryString();return(e=this._cleanQueryPrefixes(e).trim()).trim()}catch(e){return null}},i.prototype._cleanQueryPrefixes=function(e){for(var r,i=/PREFIX ([a-z]+): <(.*)>/gi,a={},n=e.replace(i,"").replace(/\n+/g,"\n");r=i.exec(e);){var o=r[1],s=r[2].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),u=n.replace(new RegExp("<"+s+"([^/>#]+?)>","gi"),o+":$1");n!==u&&(n=u,t.queryService.RdfNamespaces.STANDARD_PREFIXES[o]||(a[r[0]]=!0))}return n=Object.keys(a).join("\n")+"\n\n"+n.trim()},i.prototype.draw=function(e){var r=t.queryService.ui.queryHelper.QueryTemplate.parse(this._query),i=this,a=this._query.getBindings();if(null!==r)try{return e.html(r.getHtml(function(e){return i._getLabel(a[e].expression)},this._selectorBox,function(e,t,r){a[e].expression=a[e].expression.replace(new RegExp(t+"$"),"")+r,i._changeListener&&i._changeListener(i)}))}catch(e){window.console.error(e)}this._triples=this._query.getTriples();for(var n=this._query.getSubQueries();n.length>0;){var o=n.pop();this._triples=this._triples.concat(o.getTriples()),n.concat(o.getSubQueries())}this._isSimpleMode=this._isSimpleQuery(),e.html(this._getHtml())},i.prototype.setChangeListener=function(e){this._changeListener=e},i.prototype._i18n=function(t){return e.i18n?e.i18n("wdqs-ve-"+t):this._labels[t]},i.prototype._getHtml=function(){var t=this,r=e("<div>"),i=e("<table>").bootstrapTable(n),a=e("<table>").bootstrapTable(n);return e.each(this._triples,function(e,r){t._isNotRelevant(r.triple)||(t._isInShowSection(r.triple)?a.append(t._getTripleHtml(r)):i.append(t._getTripleHtml(r)))}),r.append(this._createSection(i,this._createFindButton(i)),this._createSection(a,this._createShowButton(a)),this._getLimitSection())},i.prototype._getLimitSection=function(){var t=e("<div>"),r=e('<a data-type="number">').attr("href","#").text("Limit").data("value",this._query.getLimit()),i=e("<span>").text(this._query.getLimit()||""),a=this;return this._selectorBox.add(r,null,function(e){"0"===e&&(e=null),i.text(e||""),a._query.setLimit(e),a._changeListener&&a._changeListener(a)},{trash:function(){return a._query.setLimit(null),r.data("value",""),i.text(""),a._changeListener&&a._changeListener(a),!0}}),t.append(r.append(" ",i))},i.prototype._createSection=function(t,r){return e("<table>").append(e("<tr>").append(e("<td>").append(r),e("<td>").append(t)))},i.prototype._createFindButton=function(t){var r=e('<a class="btn">').text(this._i18n("filter")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new item"}).attr("data-type","item").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(e,r,a){var n="http://www.wikidata.org/entity/"+e,o=i._query.getBoundVariables().shift();o||(o="?"+r.replace(/( |[^a-z0-9])/gi,"_"));var s="http://www.wikidata.org/prop/direct/"+(a&&a[e]&&a[e].propertyId||"P31"),u=i._query.addTriple(o,s,n,!1);i._query.hasVariable(o)||i._query.addVariable(o),t.append(i._getTripleHtml(u)),i._changeListener&&i._changeListener(i)}),r},i.prototype._createShowButton=function(t){var r=e('<a class="btn">').text(this._i18n("show")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new property"}).attr("data-type","property").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(e,r){var a="http://www.wikidata.org/prop/direct/"+e,n=i._query.getBoundVariables().shift();if(n){var o="?"+r.replace(/( |[^a-z0-9])/gi,"_"),s=i._query.addTriple(n,a,o,!0);i._query.addVariable(o),t.append(i._getTripleHtml(s)),i._changeListener&&i._changeListener(i)}}),r},i.prototype._isNotRelevant=function(e){return!!a[e.predicate]||!(!this._isSimpleMode||!this._isInShowSection(e)||!1!==this._query.hasVariable(e.object)||!1!==this._query.hasVariable(e.object+"Label")||!1!==this._query.isWildcardQuery())},i.prototype._isInShowSection=function(e){var t=this._query.getBindings();return!(!this._isVariable(e.subject)||!this._isVariable(e.object)||t[e.subject]||t[e.object])},i.prototype._getTripleHtml=function(t){var r=this,i=e("<tr>"),a=this._query.getBindings();return e.each(t.triple,function(n,o){if(r._isVariable(o)&&a[o]&&"string"==typeof a[o].expression&&(o=a[o].expression),r._isVariable(o)){if(r._isSimpleMode)return;o=o.replace("?","")}o.type&&"path"===o.type?i.append(e("<td>").append(r._getTripleEntityPathHtml(o,t,n))," "):i.append(e("<td>").append(r._getTripleEntityHtml(o,t,n))," ")}),i.append(this._getTripleHtmlToolbar(i,t))},i.prototype._getTripleHtmlToolbar=function(t,i){var a=this,n=e('<a href="#">').addClass("fa fa-trash-o").click(function(){var e=r.compact(i.triple).filter(function(e){return"string"==typeof e&&e.startsWith("?")}),n=e.map(function(e){return e+"Label"});return i.remove(),t.remove(),a._query.cleanupVariables(e.concat(n)),a._changeListener&&a._changeListener(a),!1});return e('<td class="toolbar">').append(n)},i.prototype._isVariable=function(e){return"string"==typeof e&&e.startsWith("?")},i.prototype._isSimpleQuery=function(){var t={},r=this;return e.each(this._triples,function(e,i){r._isVariable(i.triple.subject)&&!1===r._isVariable(i.triple.object)&&(t[i.triple.subject]=!0)}),Object.keys(t).length<=1},i.prototype._getTripleEntityPathHtml=function(t,r){var i=this,a=e("<span>");return e.each(t.items,function(n,o){if(o.type&&"path"===o.type)a.append(i._getTripleEntityPathHtml(o,r));else{n>0&&"/"===t.pathType&&a.append(" "+i._i18n("or")+" "+i._i18n("subtype")+" "),"*"===t.pathType&&a.append(" "+i._i18n("any")+" ");var s=t.items.reduce(function(e,t,r){return e[r]=t,e},{});s=e.extend(s,r.triple),(r=e.extend({},r)).triple=s,a.append(i._getTripleEntityHtml(o,r,n))}}),a},i.prototype._getTripleEntityHtml=function(t,r,i){var a=this,n=e("<span>");return this._getLabel(t).done(function(o,s,u,l){var p=e("<a>").text(o).attr({"data-id":s,"data-type":l,href:"#"}).appendTo(n);n.tooltip({title:"("+s+") "+u}),e(n).on("show.bs.tooltip",function(){e(".tooltip").is(":visible")&&e(".tooltip").not(this).hide()}),a._selectorBox.add(p,r.triple,function(e){var o=t.replace(new RegExp(s+"$"),"")+e;n.replaceWith(a._getTripleEntityHtml(o,r,i)),a._isVariable(r.triple[i])?a._query.getBindings()[r.triple[i]].expression=o:r.triple[i]=o,a._changeListener&&a._changeListener(a)},{tag:function(){return r.triple.object.startsWith("?")?a._query.addVariable(r.triple.object+"Label"):a._query.addVariable(r.triple.subject+"Label"),a._changeListener&&a._changeListener(a),!0}})}).fail(function(){n.text(t)}),n},i.prototype._getLabel=function(t){var r=e.Deferred(),i=t.match(/(Q|P)([0-9]+)/);if(!i)return r.reject().promise();var a={P:"property",Q:"item"};a=a[i[1]];var n=i[0];return this._api.searchEntities(n,a).done(function(t){e.each(t.search,function(e,t){return r.resolve(t.label,t.id,t.description,a),!1})}),r.promise()},i}(jQuery,wikibase,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SparqlQuery=function(e,t,r){"use strict";function i(e){this._query=e}return i.prototype._query=null,i.prototype._queryComments=null,i.prototype.parse=function(t,i){var a=new r.Parser(i),n=[];this._query=a.parse(t),e.each(t.split("\n"),function(e,t){0===t.indexOf("#")&&n.push(t)}),this._queryComments=n},i.prototype.getQueryString=function(){try{var e=(new r.Generator).stringify(this._query),t=this._queryComments.join("\n").trim();return""!==t?t+"\n"+e:e}catch(e){return null}},i.prototype.getLimit=function(){return this._query.limit||null},i.prototype.setLimit=function(e){return e?this._query.limit=e:delete this._query.limit,this},i.prototype.hasVariable=function(e){return 0!==this._query.variables.length&&this._query.variables.indexOf(e)>=0},i.prototype.isWildcardQuery=function(){return!(!this._query.variables||"*"!==this._query.variables[0])},i.prototype.addVariable=function(e){return e&&e.startsWith("?")?this._query.variables.indexOf(e)>=0?this:this.isWildcardQuery()?this:(this._query.variables.push(e),this):this},i.prototype.removeVariable=function(e){if(e.startsWith("?")&&!this.isWildcardQuery()){var t=this._query.variables.indexOf(e);t>=0&&this._query.variables.splice(t,1),0===this._query.variables.length&&this._query.variables.push("*")}},i.prototype.cleanupVariables=function(e){var t=this,r=this.getTripleVariables();this._query.variables.filter(function(t){return(!e||-1!==e.indexOf(t))&&-1===r.indexOf(t)}).map(function(e){t.removeVariable(e)})},i.prototype.getTriples=function(t,r){var i=[];t||(t=this._query.where),r||(r=!1);var a=this;return e.each(t,function(e,t){t.type&&"bgp"===t.type&&(i=i.concat(a._createTriples(t.triples,r))),t.type&&"optional"===t.type&&(i=i.concat(a.getTriples(t.patterns,!0))),t.type&&"union"===t.type&&(i=i.concat(a.getTriples(t.patterns,!1)))}),i},i.prototype.getBindings=function(){var t={};return e.each(this._query.where,function(e,r){r.type&&"bind"===r.type&&(t[r.variable]=r)}),t},i.prototype._createTriples=function(t,r){var i=this,a=[];return e.each(t,function(e,n){a.push({optional:r,query:i,triple:n,remove:function(){t.splice(e,1)}})}),a},i.prototype.getSubQueries=function(){var t=[];return e.each(this._query.where,function(e,r){r.queryType&&t.push(new i(r))}),t},i.prototype.addTriple=function(e,t,r,i){var a={type:"bgp",triples:[{subject:e,predicate:t,object:r}]};if(i){var n={type:"optional",patterns:[a]};this._query.where.push(n)}else this._query.where.push(a);return this._createTriples(a.triples,i)[0]},i.prototype.getTripleVariables=function(){var t={};return e.each(this.getTriples(),function(e,r){"string"==typeof r.triple.subject&&r.triple.subject.startsWith("?")&&(t[r.triple.subject]=!0),"string"==typeof r.triple.predicate&&r.triple.predicate.startsWith("?")&&(t[r.triple.predicate]=!0),"string"==typeof r.triple.object&&r.triple.object.startsWith("?")&&(t[r.triple.object]=!0)}),Object.keys(t)},i.prototype.getBoundVariables=function(){var t={};return e.each(this.getTriples(),function(e,r){r.triple.subject.startsWith("?")&&!r.triple.object.startsWith("?")&&(t[r.triple.subject]=!0),!r.triple.subject.startsWith("?")&&r.triple.object.startsWith("?")&&(t[r.triple.object]=!0)}),Object.keys(t)},i.prototype.getServices=function(){var t=[];return e.each(this._query.where,function(e,r){r&&"service"===r.type&&t.push(r)}),t},i.prototype.removeService=function(t){var r=this;return e.each(this._query.where,function(e,i){"service"===i.type&&i.name===t&&delete r._query.where[e]}),this},i.prototype.getCommentContent=function(e){var t,r;for(t=0;t<this._queryComments.length;t++)if((r=this._queryComments[t]).startsWith("#"+e))return r.substring(1+e.length);return null},i.prototype.clone=function(){var e=new i;return e.parse(this.getQueryString()),e},i}(jQuery,0,sparqljs),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SelectorBox=function(e,t){"use strict";function r(e,r){this._api=e||new t.queryService.api.Wikibase,this._sparqlApi=r||new t.queryService.api.Sparql}var i={item:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i <{PROPERTY_URI}> ?id. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t}\t\t\t\t\tLIMIT 100',genericSuggest:function(){var e=this._query.getBoundVariables().shift(),t=this._query.clone().setLimit(1e3).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\t\tSELECT ?id ?label ?description ?property WITH {\n\t\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\t\tSELECT ?value ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t\t?statement ?ps ?value.\n\t\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p; wikibase:statementProperty ?ps.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tGROUP BY ?value ?property\n\t\t\t\t\t\t\tHAVING(isIRI(?value) && STRSTARTS(STR(?value), STR(wd:Q)))\n\t\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t\t} AS %values WHERE {\n\t\t\t\t\t\t\tINCLUDE %values.\n\t\t\t\t\t\t\tBIND(?value AS ?id).\n\t\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,instanceOf:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t{\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t\t}\t\t\t\t\tLIMIT 100'},property:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t{\t\t\t\t\t\tSELECT DISTINCT ?id WHERE {\t\t\t\t\t\t?i ?prop <{ITEM_URI}>.\t\t\t\t\t\t?id ?x ?prop.\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100\t\t\t\t\t}\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}\t\t\t\tLIMIT 100',genericSuggest:function(){var e=this._query.getBoundVariables().shift(),t=this._query.clone().setLimit(500).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\tSELECT ?id ?label ?description WITH {\n\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t}\n\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\tSELECT ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p.\n\t\t\t\t\t\t}\n\t\t\t\t\t\tGROUP BY ?property\n\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t} AS %properties WHERE {\n\t\t\t\t\t\tINCLUDE %properties.\n\t\t\t\t\t\tBIND(?property AS ?id).\n\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,seeAlso:'SELECT ?id ?label ?description WHERE {\t\t\t\t\tBIND( <{PROPERTY_URI}> as ?prop).\t\t\t\t\t?props ?x  ?prop.\t\t\t\t\t?props rdf:type wikibase:Property.\t\t\t\t\t?props wdt:P1659 ?id.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}'},sparql:{search:'SELECT ?id ?label ?description WITH {\t\t\t\t\t{SPARQL}\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\tFILTER(STRSTARTS(LCASE(?label), LCASE("{TERM}")))\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100',suggest:'SELECT ?id ?label ?description WITH {\t\t\t\t{SPARQL}\t\t\t\t} AS %inner\t\t\tWHERE {\t\t\t\tINCLUDE %inner\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t} ORDER BY DESC(?count)\t\t\tLIMIT 100'}};return r.prototype._api=null,r.prototype._sparqlApi=null,r.prototype._query=null,r.prototype.setQuery=function(e){this._query=e},r.prototype.add=function(e,t,r,i){switch(e.data("type").toLowerCase()){case"number":this._createInput(e,r,i);break;default:this._createSelect(e,t,r,i)}},r.prototype._createInput=function(t,r,i){var a=e("<input>").attr("type",t.data("type")),n=this._getCloseButton(),o=this._getToolbar(i,t),s=e("<div>").append(n," ",a," ",o);t.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return s}}).click(function(e){a.val(t.data("value")||"")}),a.on("keyup mouseup",function(){r&&r(a.val())})},r.prototype._createSelect=function(t,r,i,a){var n=this,o=this._getSelectBox(t),s=this._getCloseButton(),u=this._getToolbar(a,t),l=e("<div>").append(s," ",o," ",u);t.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return l}}).click(function(i){return o.toggleClass("open"),o.data("select2")||e.proxy(n._renderSelect2(o,t,r),n),o.hasClass("open")&&t.data("auto_open")&&o.data("select2").open(),!1}),o.change(function(r){i&&i(o.val(),o.find("option:selected").text(),e(r.target).data("options")),t.click(),o.html("")})},r.prototype._getSelectBox=function(t){var r=t.data("id"),i=t.text(),a=e("<select>");return r&&a.append(e("<option>").attr("value",r).text(i)),a},r.prototype._getCloseButton=function(){return e('<a href="#" data-dismiss="clickover">').append('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>')},r.prototype._getToolbar=function(t,r){var i=e("<span>");return e.each(t,function(t,a){var n=e("<a>").attr("href","#");n.prepend('<span class="glyphicon glyphicon-'+t+'" aria-hidden="true"></span>'," "),n.click(function(){return a()&&r.click(),!1}),i.append(n," ")}),i},r.prototype._createLookupService=function(t,r){var i=this,a=t.data("type"),n=t.data("sparql");return function(t,o,s){e.when(i._searchEntitiesSparql(t.data.term,a,r,n),i._searchEntities(t.data.term,a)).done(function(e,t){e.length>0&&(e=[{text:i._i18n("suggestions","Suggestions"),children:e}]),t.length>0&&e.length>0&&(t=[{text:i._i18n("other","Other"),children:t}]),o({results:e.concat(t)})})}},r.prototype._getSparqlTemplate=function(e,t,r,i){var a=this._getSparqlTemplateDefinition(e,t,r,i),n="function"==typeof a?a.apply(this):a;return i&&(n=n.replace("{SPARQL}",i)),n},r.prototype._getSparqlTemplateDefinition=function(e,t,r,a){if(a)return e?i.sparql.search:i.sparql.suggest;var n=i[t];if(e&&""!==e.trim())return r?n.search:null;if("property"===t){if(!r)return n.genericSuggest;if(0===r.object.indexOf("?"))return n.seeAlso}else if(!r)return n.genericSuggest;return n.suggest},r.prototype._searchEntitiesSparqlCreateQuery=function(t,r,i,a){function n(e){return"string"==typeof e?e:n(e.items[0])}var o=this._getSparqlTemplate(t,r,i,a);return o&&(i&&(o=o.replace("{PROPERTY_URI}",n(i.predicate)).replace("{ITEM_URI}",i.object)),t&&(o=o.replace("{TERM}",t)),o=o.replace(/\{LANGUAGE\}/g,e.i18n&&e.i18n().locale||"en")),o},r.prototype._searchEntitiesSparql=function(t,r,i,a){var n=e.Deferred(),o=this._searchEntitiesSparqlCreateQuery(t,r,i,a);return o?(this._sparqlApi.query(o,4e3).done(function(e){var t=e.results.bindings.map(function(e){var t=e.id.value.split("/").pop(),r=e.property&&e.property.value.split("/").pop()||null;return{id:t,text:e.label.value,data:{id:t,propertyId:r,description:e.description&&e.description.value||""}}});n.resolve(t)}).always(function(){n.resolve([])}),n.promise()):n.resolve([]).promise()},r.prototype._searchEntities=function(t,r){var i=e.Deferred();return t&&""!==t.trim()?(this._api.searchEntities(t,r).done(function(e){var t=e.search.map(function(e){return{id:e.id,text:e.label,data:e}});i.resolve(t)}),i.promise()):i.resolve([]).promise()},r.prototype._renderSelect2=function(t,r,i){var a={},n=this._createLookupService(r,i);t.select2({width:"auto",templateResult:function(r,i){return r.data?(a[r.data.id]={text:r.text,propertyId:r.data.propertyId},t.attr("data-options",JSON.stringify(a)),e("<span><b>"+r.text+" ("+r.data.id+")</b></span><br/><small>"+r.data.description+"</small>")):r.text},ajax:{delay:250,transport:n},cache:!0})},r.prototype._i18n=function(t,r){return e.i18n?e.i18n("wdqs-ve-sb-"+t):r},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryTemplate=function(e,t){"use strict";function r(){}return r.prototype._definition={},r.prototype._template=null,r.prototype._variables=[],r.parse=function(e){var t,i,a=e.getCommentContent("TEMPLATE=");if(!a)return null;try{t=JSON.parse(a)}catch(e){return null}return i=new r,i._definition=t,i._fragments=r._getQueryTemplateFragments(t),i},r._getQueryTemplateFragments=function(e){if(e.template.match(/\0/))throw new Error("query template must not contain null bytes");var t,r,i=[e.template];for(t in e.variables){if(!t.match(/\?[a-z][a-z0-9]*/i))throw new Error("invalid variable name in query template");r=[],i.forEach(function(e){var i=e.replace(new RegExp("\\"+t,"g"),"\0").split("\0");r.push(i[0]);for(var a=1;a<i.length;a++)r.push(t),r.push(i[a])}),i=r}return i},r._buildTemplate=function(t,r){var i=e("<span>");i.append(document.createTextNode(t[0]));for(var a=1;a<t.length;a+=2){var n=t[a],o=e("<span>").text(n);n in r||(r[n]=[]),r[n].push(o),i.append(o),i.append(document.createTextNode(t[a+1]))}return i},r.prototype.getHtml=function(t,i,a){if(null!==this._template)return this._template;this._template=r._buildTemplate(this._fragments,this._variables);var n=this;return e.each(this._definition.variables,function(r,o){t(r).done(function(t,s,u,l){e.each(n._variables[r],function(u,p){p.text("");var c=e("<a>").text(t).attr({"data-id":s,"data-type":l,href:"#"}).appendTo(p);o.query&&c.attr("data-sparql",o.query),i.add(c,null,function(e,t){for(var i in n._variables[r])n._variables[r][i].find('a[data-id="'+s+'"]').attr("data-id",e).text(t),a(r,s,e),s=e})})})}),this._template},r}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.QueryExampleDialog=function(e){"use strict";function t(e,t,r,i){this._$element=e,this._querySamplesApi=t,this._callback=r,this._previewUrl=i,this._init()}return t.prototype._querySamplesApi=null,t.prototype._callback=null,t.prototype._previewUrl=null,t.prototype._examples=null,t.prototype._trackingApi=null,t.prototype._init=function(){this._querySamplesApi||(this._querySamplesApi=new wikibase.queryService.api.QuerySamples),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._initFilter(),this._initExamples();var e=this;this._$element.focus(function(){e._$element.find(".tableFilter").focus()})},t.prototype._initFilter=function(){var t=this;this._$element.find(".tableFilter").keyup(e.proxy(this._filterTable,this)),this._$element.find(".tagFilter").tags({afterAddingTag:e.proxy(this._filterTable,this),afterDeletingTag:function(){t._filterTable(),t._drawTagCloud(!0)}})},t.prototype._initExamples=function(){var t=this,r=null;this._querySamplesApi.getExamples().done(function(i){t._examples=i,t._initTagCloud(),t._updateExamplesCount(i.length),e.each(i,function(i,a){a.category!==r&&(r=a.category,t._$element.find(".searchable").append(e("<tr>").addClass("active").append(e('<td colspan="4">').text(r)))),t._addExample(a.title,a.query,a.href,a.tags,r)})})},t.prototype._initTagCloud=function(){var e=this,t=window.setInterval(function(){e._$element.is(":visible")&&(e._drawTagCloud(),clearInterval(t))},300)},t.prototype._drawTagCloud=function(t){var r=this,i=[];e.each(this._getCloudTags(),function(t,a){i.push({text:t,weight:a,link:"#",html:{title:a+" match(es)"},handlers:{click:function(t){return r._$element.find(".tagFilter").tags().addTag(e(this).text()),r._drawTagCloud(!0),!1}}})}),t?e(".tagCloud").jQCloud("update",i):e(".tagCloud").jQCloud(i,{delayedMode:!0,autoResize:!0})},t.prototype._getCloudTags=function(){var t=this,r=function(e){return t._$element.find(".tagFilter").tags().getTags().every(function(t){return-1!==e.indexOf(t)})},i=function(e){return-1!==t._$element.find(".tagFilter").tags().getTags().indexOf(e)},a={};return e.each(t._examples,function(t,n){r(n.tags)&&e.each(n.tags,function(e,t){i(t)||(a[t]?a[t]++:a[t]=1)})}),a},t.prototype._addExample=function(t,r,i,a,n){var o=this,s=e('<a title="Select" data-dismiss="modal">').text(t).attr("href","#").click(function(){o._callback(r,t),o._track("select"),o._track("select.category."+n.replace(/[^a-zA-Z0-9]/g,"_"))}),u=e("<a>").attr({title:"Edit",href:i,target:"_blank"}).append("<span>").addClass("glyphicon glyphicon-pencil").click(function(){o._track("edit")}),l=e("<span>").addClass("glyphicon glyphicon-eye-open").popover({placement:"bottom",trigger:"hover",container:"body",title:o._i18n("wdqs-dialog-examples-preview-query","Preview query"),content:e('<pre style="white-space:pre-line; word-break:break-word;"/>').text(r),html:!0}),p=e('<a href="#">').addClass("glyphicon glyphicon-camera").clickover({placement:"left",global_close:!0,esc_close:!0,trigger:"click",container:"body",title:o._i18n("wdqs-dialog-examples-preview-result","Preview result"),content:e('<iframe width="400" height="350" frameBorder="0" src="'+(o._previewUrl||"embed.html#")+encodeURIComponent(r)+'">'),html:!0}).click(function(){o._track("preview")});e(".exampleTable").scroll(function(){p.clickover&&p.clickover("hide").removeAttr("data-clickover-open")});var c=e("<tr>");c.append(e("<td>").append(s).append(" ",u)),c.append(e("<td>").addClass("exampleIcons").append(p)),c.append(e("<td>").addClass("exampleIcons").append(l)),c.append(e("<td>").text(a.join("|")).hide()),c.append(e("<td>").text(r).hide()),this._$element.find(".searchable").append(c)},t.prototype._filterTable=function(){var t=this._$element.find(".tableFilter"),r=new RegExp(t.val(),"i"),i=this._$element.find(".tagFilter").tags().getTags(),a=function(t){var r=!0;return t=t.toLowerCase(),e.each(i,function(e,i){-1===t.indexOf(i.toLowerCase())&&(r=!1)}),r};this._$element.find(".searchable tr").hide();var n=this._$element.find(".searchable tr").filter(function(){return r.test(e(this).text())&&a(e(this).text())});n.show(),n.each(function(t,r){e(r).prevAll("tr.active").first().show()}),this._updateExamplesCount(n.length)},t.prototype._updateExamplesCount=function(e){this._$element.find(".count").text(e)},t.prototype._track=function(e,t,r){this._trackingApi.track("wikibase.queryService.ui.examples."+e,t,r)},t.prototype._i18n=function(t,r){var i=null;return e.i18n&&(i=e.i18n(t))!==t?i:r},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.ResultView=function(e,t){"use strict";function r(e){this._sparqlApi=e,this._init()}return r.prototype._query=null,r.prototype._sparqlApi=null,r.prototype._selectedResultBrowser=null,r.prototype._actionBar=null,r.prototype._trackingApi=null,r.prototype._hasRunFirstQuery=!1,r.prototype._resultBrowsers={Table:{icon:"glyphicon-th-list",label:"Table",class:"TableResultBrowser",object:null,$element:null},ImageGrid:{icon:"glyphicon-picture",label:"Image Grid",class:"ImageResultBrowser",object:null,$element:null},Polestar:{icon:"fa-certificate",label:"Graph builder",class:"PolestarResultBrowser",object:null,$element:null},Map:{icon:"glyphicon-map-marker",label:"Map",class:"CoordinateResultBrowser",object:null,$element:null},LineChart:{icon:"fa-line-chart",label:"Line Chart",class:"LineChartResultBrowser",object:null,$element:null},BarChart:{icon:"fa-bar-chart",label:"Bar Chart",class:"BarChartResultBrowser",object:null,$element:null},ScatterChart:{icon:"fa-braille",label:"Scatter Chart",class:"ScatterChartResultBrowser",object:null,$element:null},AreaChart:{icon:"fa-area-chart",label:"Area Chart",class:"AreaChartResultBrowser",object:null,$element:null},BubbleChart:{icon:"glyphicon-tint",label:"Bubble Chart",class:"BubbleChartResultBrowser",object:null,$element:null},TreeMap:{icon:"glyphicon-th",label:"Tree Map",class:"TreeMapResultBrowser",object:null,$element:null},Tree:{icon:"fa-tree",label:"Tree",class:"TreeResultBrowser",object:null,$element:null},Timeline:{icon:"glyphicon-calendar",label:"Timeline",class:"TimelineResultBrowser",object:null,$element:null},Dimensions:{icon:"glyphicon-random",label:"Dimensions",class:"MultiDimensionResultBrowser",object:null,$element:null},Graph:{icon:"glyphicon-retweet",label:"Graph",class:"GraphResultBrowser",object:null,$element:null}},r.prototype._init=function(){this._sparqlApi||(this._sparqlApi=new wikibase.queryService.api.Sparql),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._actionBar=new wikibase.queryService.ui.toolbar.Actionbar(e(".action-bar")),this._initResultBrowserMenu()},r.prototype._initResultBrowserMenu=function(){e.each(this._resultBrowsers,function(t,r){var i=e('<li><a class="result-browser" href="#"><span class="'+r.icon.split("-",1)[0]+" "+r.icon+'"></span>'+r.label+"</a></li>");i.appendTo(e("#result-browser-menu")),r.$element=i})},r.prototype.draw=function(t){var r=this,i=e.Deferred();return this._query=t,this._actionBar.show("wdqs-action-query","","info",100),e("#query-result").empty().hide(),e(".result").hide(),e("#query-error").hide(),this._sparqlApi.query(t).done(function(){r._handleQueryResult(),i.resolve()}).fail(function(){var e=r._handleQueryError();i.reject(e)}),i.promise()},r.prototype._handleQueryError=function(){e("#execute-button").prop("disabled",!1);var t=this._sparqlApi.getError(),r=null,i=this._sparqlApi.ERROR_CODES;switch(t.code){case i.TIMEOUT:r="wdqs-action-timeout";break;case i.MALFORMED:r="wdqs-action-malformed-query";break;case i.SERVER:r="wdqs-action-server-error";break;default:r="wdqs-action-unknow-error"}return t.debug&&e("#query-error").html(e("<pre>").text(t.debug)).show(),this._actionBar.show(r||"",t.message||"","danger"),this._track("result.error."+(r||"unknown")),t.debug},r.prototype._handleQueryResult=function(){var t=this._sparqlApi;e("#total-results").text(t.getResultLength()),e("#query-time").text(t.getExecutionTime()),e(".result").show(),e("#execute-button").prop("disabled",!1);var r=this._createResultBrowsers(t.getResultRawData());return this._drawResult(r),this._selectedResultBrowser=null,this._track("result.resultLength",t.getResultLength()),this._track("result.executionTime",t.getExecutionTime(),"ms"),this._track("result.received.success"),!1},r.prototype._createResultBrowsers=function(t){var r=this,i=this._getDefaultResultBrowser();return this._track("result.browser."+(i||"default")),e.each(this._resultBrowsers,function(e,t){var a=new wikibase.queryService.ui.resultBrowser[t.class];a.setSparqlApi(r._sparqlApi),null!==i&&i!==e||(r._setSelectedDisplayType(t),i=a),t.object=a}),i.resetVisitors(),e.each(this._resultBrowsers,function(e,r){i.addVisitor(r.object),r.object.setResult(t)}),i},r.prototype._getDefaultResultBrowser=function(){var e=this._query.match(/#defaultView:(\w+)/);return e&&this._resultBrowsers[e[1]]?e[1]:null},r.prototype._handleQueryResultBrowsers=function(){var t=this;e.each(this._resultBrowsers,function(r,i){i.$element.off("click"),i.object.isDrawable()?(i.$element.css("opacity",1).attr("href","#"),i.$element.click(function(){return e(this).closest(".open").removeClass("open"),t._setSelectedDisplayType(i),e("#query-result").html(""),t._drawResult(i.object),t._selectedResultBrowser=r,t._track("buttonClick.display."+r),!1})):i.$element.css("opacity",.5).removeAttr("href")})},r.prototype._drawResult=function(r){var i=this;this._actionBar.show("wdqs-action-render","","success",100),t.setTimeout(function(){try{e("#query-result").show(),r.draw(e("#query-result")),i._actionBar.hide()}catch(e){i._actionBar.show("wdqs-action-error-display","","warning"),t.console.error(e)}i._handleQueryResultBrowsers()},20)},r.prototype._setSelectedDisplayType=function(t){e("#display-button-icon").attr("class",t.icon.split("-",1)[0]+" "+t.icon),e("#display-button-label").text(t.label)},r.prototype._track=function(e,t,r){this._trackingApi.track("wikibase.queryService.ui.app."+e,t,r)},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.FormatterHelper=function(e,t){"use strict";function r(){}var i=["http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#positiveInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger"];return r.prototype.formatRow=function(t,r){var i=this,a=e("<div/>");return e.each(t,function(n,o){i._isLabelField(n,t)||(o=e.extend({label:i._getLabel(t,n)},o),a.prepend(e("<div>").append(i.formatValue(o,n,r))))}),a},r.prototype._isLabelField=function(e,t){return e.endsWith("Label")&&void 0!==t[e.slice(0,-5)]},r.prototype._getLabel=function(e,t){var r=e[t+"Label"];return r&&r.value||null},r.prototype.formatValue=function(t,r,i){var a=t.value,n=e("<span>");if(r||(r=t.dataType||""),!t.type)return e("<span>").text(a).attr("title",r);switch(t.datatype||t.type){case"uri":var o=e("<a>").attr({title:r,href:a,target:"_blank",rel:"noopener"});n.append(o),this.isCommonsResource(a)?i?(o.click(this.handleCommonResourceItem),o.append(e("<img>").attr("src",this.getCommonsResourceFileNameThumbnail(a,"120"))).width("120")):(o.attr({href:"https://commons.wikimedia.org/wiki/File:{FILENAME}".replace(/{FILENAME}/g,this.getCommonsResourceFileName(a))}),o.text("commons:"+decodeURIComponent(this.getCommonsResourceFileName(a))),n.prepend(this.createGalleryButton(a,r)," ")):(o.text(t.label||this.abbreviateUri(a)),this.isEntityUri(a)&&n.prepend(this.createExploreButton(a)," "));break;case"http://www.w3.org/2001/XMLSchema#dateTime":r||(r=this._i18n("wdqs-app-result-formatter-title-datetime","Raw ISO timestamp"));var s=e("<span>").text(this._formatDate(a));s.attr("title",r+": "+a),n.append(s);break;case"http://www.w3.org/1998/Math/MathML":n.append(e(t.value));break;default:var u=e("<span>").text(a);t["xml:lang"]?u.attr("title",r+": "+a+"@"+t["xml:lang"]):u.attr("title",r),n.append(u)}return n},r.prototype._formatDate=function(e){var t,r=!1,i=e.replace(/^(?:-\d+|\+?0+\b)/,function(e){return r=!0,Math.abs(e)+1}),a=this.parseDate(i);if(a.isValid())t=a.format("ll");else{var n=i.replace(/^\+?(\d+).*/,"$1");t="0000".slice(n.length)+n}return r&&(t+=" BCE"),t},r.prototype.parseDate=function(e){return e=e.replace(/^(?![+-])/,"+"),e=e.replace(/^([+-]?)(\d{1,5}\b)/,function(e,t,r){return t+("00000"+r).slice(-6)}),e=e.replace(/Z$/,""),t(e,t.ISO_8601)},r.prototype.isEntityUri=function(e){return"string"==typeof e&&/^https?:\/\/www\.wikidata\.org\/entity\/./.test(e)},r.prototype.createExploreButton=function(t){var r=e('<a href="'+t+'" title="Explore item" class="explore glyphicon glyphicon-search" aria-hidden="true">');return r.click(e.proxy(this.handleExploreItem,this)),r},r.prototype.isCommonsResource=function(e){return e.toLowerCase().startsWith("http://commons.wikimedia.org/wiki/special:filepath/".toLowerCase())},r.prototype.getCommonsResourceFileName=function(e){var t=new RegExp("http://commons.wikimedia.org/wiki/special:filepath/","ig");return decodeURIComponent(e.replace(t,""))},r.prototype.getCommonsResourceFileNameThumbnail=function(e,t){return this.isCommonsResource(e)?e.replace(/^http(?=:\/\/)/,"https")+"?width="+(t||400):e},r.prototype.createGalleryButton=function(t,r){var i=this.getCommonsResourceFileName(t),a=this.getCommonsResourceFileNameThumbnail(t,900),n=e("<a>").attr({title:"Show Gallery",href:a,"aria-hidden":"true",class:"gallery glyphicon glyphicon-picture","data-gallery":"G_"+r,"data-title":decodeURIComponent(i)});return n.click(this.handleCommonResourceItem),n},r.prototype.abbreviateUri=function(e){var t,r,i,a=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS,n=0;for(t in a)for(r in a[t])0===e.indexOf(a[t][r])&&a[t][r].length>n&&(n=a[t][r].length,i=r);return i?i+":"+e.substr(n):"<"+e+">"},r.prototype.handleExploreItem=function(t){var r=e(t.target).attr("href");t.preventDefault();var i="SELECT ?item ?itemLabel WHERE { BIND( <"+r+'> as ?item ).\tSERVICE wikibase:label { bd:serviceParam wikibase:language "'+(e.i18n&&e.i18n().locale||"en")+'" } }',a="embed.html#"+encodeURIComponent("#defaultView:Graph\n"+i);return e(".explorer-panel .panel-body").html(e('<iframe frameBorder="0" scrolling="no"></iframe>').attr("src",a)),e(".explorer-panel").show(),!1},r.prototype.handleCommonResourceItem=function(t){t.preventDefault(),e(this).ekkoLightbox({scale_height:!0})},r.prototype.isLabel=function(e){return!!e&&("xml:lang"in e||"literal"===e.type&&!e.datatype)},r.prototype.isNumber=function(e){return e&&e.datatype&&-1!==i.indexOf(e.datatype)},r.prototype.isDateTime=function(e){return e&&"http://www.w3.org/2001/XMLSchema#dateTime"===e.datatype},r.prototype.isEntity=function(e){return e&&e.value&&this.isEntityUri(e.value)},r.prototype.isColor=function(e){return e&&"literal"===e.type&&e.value&&/^([\dA-F]{1,2}){3}$/i.test(e.value)},r.prototype.getColorForHtml=function(e){return"#"+e.value},r.prototype.calculateLuminance=function(e){var t=parseInt(e.substr(1,2),16)/255,r=parseInt(e.substr(3,2),16)/255,i=parseInt(e.substr(5,2),16)/255;return isFinite(t)&&isFinite(r)&&isFinite(i)?.2126*(t=t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(r=r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(i=i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)):NaN},r.prototype._i18n=function(t,r){var i;return e.i18n&&(i=e.i18n(t))!==t?i:r},r}(jQuery,moment),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractResultBrowser=function(e,t){"use strict";function r(){this._visitors=[]}return r.prototype._formatter=null,r.prototype._result=null,r.prototype._visitors=null,r.prototype._drawable=!1,r.prototype._sparqlApi=null,r.prototype.setResult=function(e){this._result=e},r.prototype.setSparqlApi=function(e){this._sparqlApi=e},r.prototype.getSparqlApi=function(){return this._sparqlApi},r.prototype._iterateResult=function(t){var r=this;e.each(this._result.results.bindings,function(i,a){e.each(r._result.head.vars,function(e,n){var o=a[n]||null;r.processVisitors(o,n),t(o,n,a,i)})})},r.prototype.isDrawable=function(){return this._drawable},r.prototype.draw=function(e){jQuery.error("Method draw() needs to be implemented!")},r.prototype.addVisitor=function(e){this._visitors.push(e)},r.prototype.resetVisitors=function(){this._visitors=[]},r.prototype.processVisitors=function(t,r){var i=this,a={};0!==this._visitors.length&&(e.each(this._visitors,function(e,i){i.visit&&"function"==typeof i.visit&&!1===i.visit(t,r)&&(a[e]=!0)}),i._visitors=i._visitors.filter(function(e,t){return!a[t]}))},r.prototype.visit=function(e){return!1},r.prototype.setFormatter=function(e){this._formatter=e},r.prototype._getFormatter=function(){return null===this._formatter&&(this._formatter=new t.queryService.ui.resultBrowser.helper.FormatterHelper),this._formatter},r.prototype._i18n=function(t,r){var i=null;return e.i18n&&(i=e.i18n(t))!==t?i:r},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser=function(e,t){"use strict";function r(){}return r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,r.prototype._getLabelColumns=function(){var e=this,t=e._getRows()[0];return e._getColumns().filter(function(r){return e._getFormatter().isLabel(t[r])})},r.prototype._getNumberColumns=function(){var e=this,t=e._getRows()[0];return e._getColumns().filter(function(r){return e._getFormatter().isNumber(t[r])})},r.prototype._getColumns=function(){return this._result.head.vars},r.prototype._getRows=function(){return this._result.results.bindings},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser=function(e,t,r,i,a){"use strict";function n(){}return n.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,n.prototype._dataColumns=null,n.prototype._data=null,n.prototype._$element=null,n.prototype._svg=null,n.prototype._chart=null,n.prototype._chartLegend=null,n.prototype._chartSeriesKey=null,n.prototype._chartStoryKey=null,n.prototype._isStoryPaused=!1,n.prototype.draw=function(t){var r=this;this._$element=e("<div>").css({width:"100%",height:"98vh"}),t.html(this._$element),this._createData(),this._drawSvg(),this._createChart(),this._drawChart(),this._createLegendFilter(),i.onresize=function(){r._drawChart(250,!0)}},n.prototype._createData=function(){var e=[],t={},r=null;this._iterateResult(function(i,a,n){null===r&&(r=n),n!==r&&(r=n,e.push(t),t={}),i&&i.value&&(t[a]=i.value)}),e.push(t),this._data=e},n.prototype._drawSvg=function(){this._svg=a.newSvg(this._$element[0],"100%","100%")},n.prototype._createChart=function(){this._chart=new a.chart(this._svg,this._data),this._chart.setBounds(0,0,"100%","100%"),this._chart.setMargins("5%","5%","2%","25%"),this._createChartAxis();var e=this._chart.addSeries(this._chartSeriesKey,this._getPlotType());e.addOrderRule(this._chartSeriesKey),e.lineMarkers=!0,this._chartStoryKey&&this._createChartStory(),this._chartLegend=this._chart.addLegend("1%","85%","100%","15%")},n.prototype._getPlotType=function(){jQuery.error("Method _getPlotType() needs to be implemented!")},n.prototype._createChartAxis=function(){var t=this,r=this._getRows()[0],i=this._getFormatter(),a=this._chart,n=["y","x"],o=!1;e.each(this._getColumns(),function(e,s){if(0!==n.length)i.isLabel(r[s])&&(a.addCategoryAxis(n.pop(),s),o=!0),i.isNumber(r[s])&&a.addMeasureAxis(n.pop(),s),i.isDateTime(r[s])&&(a.addTimeAxis(n.pop(),s,"%Y-%m-%dT%H:%M:%SZ","%m-%d-%Y"),o=!0);else if(i.isLabel(r[s])){if(!t._chartSeriesKey)return void(t._chartSeriesKey=s);if(!t._chartStoryKey)return t._chartStoryKey=s,!1}}),o||this._chartSeriesKey||!a.axes[0]||(this._chartSeriesKey=a.axes[0].measure)},n.prototype._createChartStory=function(){var e=this,t=this._chart.setStoryboard(this._chartStoryKey);t.frameDuration=5e3,this._$element.click(function(){if(e._isStoryPaused)return t.startAnimation(),void(e._isStoryPaused=!1);t.pauseAnimation(),e._isStoryPaused=!0})},n.prototype._createLegendFilter=function(){var e=this,t=a.getUniqueValues(this._data,this._chartSeriesKey);this._chart.legends=[],this._chartLegend.shapes.selectAll("rect").on("click",function(i){var n=!1,o=[];t.forEach(function(e){e===i.aggField.slice(-1)[0]?n=!0:o.push(e)}),r.select(this).style("opacity",n?.2:.8),n||o.push(i.aggField.slice(-1)[0]),t=o,e._chart.data=a.filterData(e._data,e._chartSeriesKey,t),e._drawChart(800)})},n.prototype._drawChart=function(e,r){var i=this;this._chart.draw(e,r),t.delay(function(){i._svg.selectAll(".dimple-marker,.dimple-marker-back").attr("r",2)},1.2*e)},n.prototype.isDrawable=function(){return Object.keys(this._dataColumns).length>=2},n.prototype.visit=function(e,t){return this._checkColumn(e,t)},n.prototype._checkColumn=function(e,t){return this._getFormatter().isLabel(e)&&(this._dataColumns[t]=!0),this._getFormatter().isNumber(e)&&(this._dataColumns[t]=!0),this._getFormatter().isDateTime(e)&&(this._dataColumns[t]=!0),!this.isDrawable()},n}(jQuery,_,d3,window,dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.ImageResultBrowser=function(e){"use strict";function t(){}return t.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,t.prototype._grid=null,t.prototype.draw=function(t){var r=this;this._grid=e('<div class="masonry">'),this._iterateResult(function(e,t,i){if(e&&r._isCommonsResource(e.value)){var a=e.value,n=r._getFormatter().getCommonsResourceFileName(a);r._grid.append(r._getItem(r._getThumbnail(a),r._getThumbnail(a,1e3),n,i))}}),t.html(this._grid)},t.prototype._getItem=function(t,r,i,a){var n=e("<a>").click(this._getFormatter().handleCommonResourceItem).attr({href:r,"data-gallery":"g","data-title":i}).append(e("<img>").attr("src",t)),o=this._getFormatter().formatRow(a);return e('<div class="item">').append(n,o)},t.prototype._isCommonsResource=function(e){return this._getFormatter().isCommonsResource(e)},t.prototype._getThumbnail=function(e,t){return this._getFormatter().getCommonsResourceFileNameThumbnail(e,t)},t.prototype.visit=function(e){return this._checkImage(e)},t.prototype._checkImage=function(e){return!(e&&e.value&&this._isCommonsResource(e.value))||(this._drawable=!0,!1)},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TableResultBrowser=function(e,t){"use strict";function r(){}var i=[10,50,100,200,500,1e3];return r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,r.prototype._columns=null,r.prototype._rows=null,r.prototype._sorter={string:function(e,t){return e.localeCompare(t)},number:function(e,t){return e>=t?-1:1},generic:function(e,t){if(!t)return 1;if(!e)return-1;var r=this._getFormatter();return r.isNumber(e)&&r.isNumber(t)?this._sorter.number(Number(e.value),Number(t.value)):r.isEntityUri(e.value)&&r.isEntityUri(t.value)?this._sorter.number(Number(e.value.replace(/[^0-9]/gi,"")),Number(t.value.replace(/[^0-9]/gi,""))):this._sorter.string(e.value,t.value)}},r.prototype.draw=function(r){var i=this._result;if(void 0!==i.boolean){var a=e("<table>").attr("class","table");return a.append("<tr><td>"+i.boolean+"</td></tr>").addClass("boolean"),void r.html(a)}this.columns=i.head.vars,this.rows=i.results.bindings;var n=e("<table/>");r.html(n),this.drawBootstrapTable(n),n.children().width()>e(t).width()&&n.bootstrapTable("toggleView")},r.prototype.drawBootstrapTable=function(t){var r=this,a=this.rows.length>200;jQuery.fn.bootstrapTable.columnDefaults.formatter=function(e,t,i){return e?(r.processVisitors(e,this.field),r._getFormatter().formatValue(e).html()):""};var n={"click .explore":e.proxy(this._getFormatter().handleExploreItem,this),"click .gallery":this._getFormatter().handleCommonResourceItem};t.bootstrapTable({columns:this.columns.map(function(t){return{title:t,field:t,events:n,sortable:!0,sorter:e.proxy(r._sorter.generic,r)}}),data:this.rows,mobileResponsive:!0,search:a,pagination:a,showPaginationSwitch:a,pageSize:200,pageList:i,keyEvents:!0,cookie:!0,cookieIdTable:"1",cookieExpire:"1y",cookiesEnabled:["bs.table.pageList"]})},r.prototype.isDrawable=function(){return!0},r.prototype.visit=function(e){return!1},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.CoordinateResultBrowser=function(e,t,r,i,a,n){"use strict";function o(){this._getMarkerGroupColor=r.scale.category10(),d=t.Control.extend({options:{position:"topright"},onAdd:function(r){var i=t.DomUtil.create("button");return e(i).addClass("btn btn-default"),e(i).append(e(' <span class="glyphicon glyphicon-chevron-up"/> ')),i.onclick=function(){r.isFullscreen()&&r.toggleFullscreen(),e(n).scrollTop(0,0)},i}})}var s=["http://www.opengis.net/ont/geosparql#wktLiteral","http://www.openlinksw.com/schemas/virtrdf#Geometry"],u="http://www.opengis.net/def/crs/OGC/1.3/CRS84",l=["http://www.wikidata.org/entity/Q2",u],p=["layerLabel","layer"],c={wikimedia:{url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",options:{id:"wikipedia-map-01",attribution:' <a href="http://maps.wikimedia.org/">Wikimedia</a> | &copy; <a href="http://openstreetmap.org/copyright">Open Street Map</a> contributors'}},osm:{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}}},d=null;return o.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,o.prototype._map=null,o.prototype._markerGroups=null,o.prototype._getMarkerGroupColor=null,o.prototype.draw=function(r){var a=e("<div>").attr("id","map").height("100vh");r.html(a),this._createMarkerGroups(),this._map=t.map("map",{center:[0,0],maxZoom:18,minZoom:2,fullscreenControl:!0,preferCanvas:!0,layers:i.compact(this._markerGroups)}).fitBounds(this._markerGroups._LAYER_DEFAULT_GROUP.getBounds()),this._setTileLayer(),this._createControls(),this._createMarkerZoomResize(),r.html(a)},o.prototype._createControls=function(){var r=this;if(this._map.addControl(t.control.zoomBox({modal:!1,className:"glyphicon glyphicon-zoom-in"})),this._map.addControl(new d),Object.keys(this._markerGroups).length>1){var i=this._getLayerControl(this._markerGroups).addTo(this._map);this._map.on("overlayadd overlayremove",function(t){t.layer===r._markerGroups._LAYER_DEFAULT_GROUP&&(e.each(r._markerGroups,function(e,i){"overlayadd"===t.type?r._map.addLayer(i):r._map.removeLayer(i)}),i._update())})}},o.prototype._createMarkerZoomResize=function(){var e=this;if(!(this._markerGroups._LAYER_DEFAULT_GROUP.getLayers().length>1e3)){this._map.on("zoomend",function(){e._markerGroups._LAYER_DEFAULT_GROUP.setStyle({radius:e._getMarkerRadius()})})}},o.prototype._getMarkerRadius=function(){return this._map?.5*this._map.getZoom():3},o.prototype._getLayerControl=function(){var r=this,i={},a="";return e.each(this._markerGroups,function(e,t){if("_LAYER_DEFAULT_GROUP"===e)a=r._i18n("wdqs-result-map-layers-all","All layers");else{var n=r._getMarkerGroupColor(e);a='<span style="color:'+n+'">&#x2b24;</span> '+e}i[a]=t}),t.control.layers(null,i)},o.prototype._createMarkerGroups=function(){var r=this,i={};if(i._LAYER_DEFAULT_GROUP=[],this._iterateResult(function(e,a,n){if(e&&-1!==s.indexOf(e.datatype)){var o=r._extractGeoJson(e.value);if(!o)return;var u=r._getMarkerGroupsLayer(n);i[u]||(i[u]=[]);var l=t.geoJson(o,{style:r._getMarkerStyle(u),pointToLayer:function(e,i){return t.circleMarker(i,r._getMarkerStyle(u))},onEachFeature:function(e,i){var a=t.popup();i.bindPopup(a),i.on("click",function(){var e=r._getItemDescription(n);a.setContent(e[0])})}});i[u].push(l),i._LAYER_DEFAULT_GROUP.push(l)}}),0===Object.keys(i).length){var a=t.marker([0,0]).bindPopup("Nothing found!").openPopup();return{null:t.featureGroup([a])}}e.each(i,function(e){i[e]=t.featureGroup(i[e])}),this._markerGroups=i},o.prototype._getMarkerGroupsLayer=function(e){var t=p.find(function(t){return e[t]});return t?e[t].value:"_LAYER_DEFAULT_GROUP"},o.prototype._getMarkerStyle=function(e){var t="#e04545";return"_LAYER_DEFAULT_GROUP"!==e&&(t=this._getMarkerGroupColor(e)),{color:t,opacity:.8,fillColor:t,fillOpacity:.9,radius:this._getMarkerRadius()}},o.prototype._splitWktLiteral=function(e){var t=e.match(/(<([^>]*)> +)?(.*)/);return t?{crs:t[2]||u,wkt:t[3]}:null},o.prototype._extractGeoJson=function(e){var t=this._splitWktLiteral(e);return t?-1===l.indexOf(t.crs)?null:a.parse(t.wkt):null},o.prototype._getItemDescription=function(t){return e("<div/>").append(this._getFormatter().formatRow(t,!0))},o.prototype._setTileLayer=function(){var e=c.osm;("query.wikidata.org"===n.location.host||"localhost"===n.location.host||n.location.host.endsWith(".wmflabs.org"))&&(e=c.wikimedia),t.tileLayer(e.url,e.options).addTo(this._map)},o.prototype.visit=function(e){return this._checkCoordinate(e)},o.prototype._checkCoordinate=function(e){return!e||-1===s.indexOf(e.datatype)||null===this._extractGeoJson(e.value)||(this._drawable=!0,!1)},o}(jQuery,L,d3,_,wellknown,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeMapResultBrowser=function(e,t,r){"use strict";function i(){this._labelColumns={}}return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._labelColumns=null,i.prototype.draw=function(e){var t=this,r={},i=r,a=null,n=null,o=null;this._iterateResult(function(e,s,u){u!==o&&(null!==o&&(i.data={size:a,url:n},a=null,n=null,i=r),o=u),t._getFormatter().isLabel(e)&&(i[e.value]||(i[e.value]={}),i=i[e.value]),t._getFormatter().isNumber(e)&&(a=e.value),e&&e.value&&t._getFormatter().isEntityUri(e.value)&&(n=e.value)}),i.data={size:a,url:n};var s={name:"treeMap",children:this._createTreeData(r)};this._draw(e,s)},i.prototype._createTreeData=function(t){var r,i=this,a=[];return t.data?a:(e.each(t,function(e,t){var n=i._createTreeData(t);if(0!==n.length)r={id:e,name:e,children:n};else{var o=1;t.data.size&&t.data.size>0&&(o=t.data.size);var s=e,u=t.data.url;u&&(s=u),r={id:s+Math.random(),name:e,size:o,url:u}}a.push(r)}),a)},i.prototype._draw=function(i,a){function n(e){return e.size}function o(e){return 1}function s(e){var t=e.substring(1,3),r=e.substring(3,5),i=e.substring(5,7);return{R:parseInt(t,16),G:parseInt(r,16),B:parseInt(i,16)}}function u(e){var t=s(e);return 255-(.299*t.R+.587*t.G+.114*t.B)<105?"#000000":"#ffffff"}function l(e){v.padding([_/(y/e.dy),0,0,0]).nodes(e);var r=h/e.dx,i=y/e.dy,a=e;w.domain([e.x,e.x+e.dx]),f.domain([e.y,e.y+e.dy]),k.selectAll(".labelbody .label").style("display","block");var n=k.selectAll("g.cell").transition().duration(m).attr("transform",function(e){return"translate("+w(e.x)+","+f(e.y)+")"}).each("end",function(e,t){t||a===self.root||(k.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("color",function(e){return u(g(e.parent.name))}),d?k.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject").style("display",""):k.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("display",""))});n.select(".foreignObject").attr("width",function(e){return Math.max(.01,r*e.dx)}).attr("height",function(e){return e.children?_:Math.max(.01,i*e.dy)}).select(".labelbody .label").text(function(e){return e.name}),n.select("rect").attr("width",function(e){return Math.max(.01,r*e.dx)}).attr("height",function(e){return e.children?_:Math.max(.01,i*e.dy)}).style("fill",function(e){return e.children?b:g(e.parent.name)}),c=e,t.event&&t.event.stopPropagation()}var p,c,d=!1,h=e(r).width(),y=e(r).height(),w=t.scale.linear().range([0,h]),f=t.scale.linear().range([0,y]),g=t.scale.category10(),_=20,b="#555555",m=500,v=t.layout.treemap().round(!1).size([h,y]).sticky(!0).value(function(e){return e.size}),k=t.select(i[0]).append("svg:svg").attr("width",h).attr("height",y).append("svg:g");c=p=a;var S=v.nodes(p),q=S.filter(function(e){return!e.children}),E=S.filter(function(e){return e.children}),T=k.selectAll("g.cell.parent").data(E,function(e){return"p-"+e.id}),R=T.enter().append("g").attr("class","cell parent").on("click",function(e){l(e)});R.append("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",_).style("fill",b),R.append("foreignObject").attr("class","foreignObject").append("xhtml:body").attr("class","labelbody").append("div").attr("class","label");var x=T.transition().duration(m);x.select(".cell").attr("transform",function(e){return"translate("+e.dx+","+e.y+")"}),x.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",_).style("fill",b),x.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",_).select(".labelbody .label").text(function(e){return e.name}),T.exit().remove();var L=k.selectAll("g.cell.child").data(q,function(e){return"c-"+e.id}),C=L.enter().append("g").attr("class","cell child").on("click",function(e){l(c===e.parent?p:e.parent)});C.append("rect").classed("background",!0).style("fill",function(e){return g(e.parent.name)}),C.append("foreignObject").attr({class:"foreignObject",width:function(e){return Math.max(.01,e.dx)},height:function(e){return Math.max(.01,e.dy)}}).append("xhtml:body").attr("class","labelbody").append("div").attr("class","label").text(function(e){return e.name}).on("click",function(e){e.url&&(r.open(e.url,"_blank"),t.event.stopPropagation())});var A=L.transition().duration(m);A.select(".cell").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),A.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return e.dy}).style("fill",function(e){return g(e.parent.name)}),A.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return Math.max(.01,e.dy)}).select(".labelbody .label").text(function(e){return e.name}),L.exit().remove(),t.select("select").on("change",function(){console.log("select zoom(node)"),v.value("size"==value?n:o).nodes(p),l(c)}),l(c)},i.prototype.isDrawable=function(){return Object.keys(this._labelColumns).length>1},i.prototype.visit=function(e,t){return this._checkColumn(e,t)},i.prototype._checkColumn=function(e,t){return!this._getFormatter().isLabel(e,t)||(this._labelColumns[t]=!0,!this.isDrawable())},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeResultBrowser=function(e,t,r){"use strict";function i(){this._labelColumns={}}var a='SELECT ?property ?propertyLabel ?value ?valueItemLabel ?valueImage WHERE {       {         SELECT ?property ?value ?valueImage ?valueItem WHERE {           BIND(<{ENTITY_URI}> AS ?item)           ?item ?prop ?value.           ?property wikibase:directClaim ?prop.           ?property rdf:type wikibase:Property.           OPTIONAL { ?value wdt:P18 ?valueImage. }           OPTIONAL { BIND(?value AS ?valueItem).  FILTER(STRSTARTS(STR(?value), STR(wd:))) }         }       }       SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }    }  ';return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._isDrawable=!1,i.prototype._jsTree=null,i.prototype._nodes=null,i.prototype.draw=function(i){var a=this;this._nodes=this._extractNodes(e.proxy(this._iterateResult,this));var n=e("<div>").jstree({core:{data:t.compact(a._nodes),check_callback:!0},plugins:["types","wholerow","contextmenu","unique"],types:{default:{icon:"glyphicon glyphicon-barcode"}},contextmenu:{items:function(e){return{Open:{label:a._nodes[e.id].url,icon:"glyphicon glyphicon-link",action:function(){r.open(a._nodes[e.id].url,"_blank")}},explore:{label:a._nodes[e.id].url,icon:"glyphicon glyphicon-download-alt",action:function(){a._expandTree(a._nodes[e.id])}}}}}});this._jsTree=n.jstree(),i.empty().append(n)},i.prototype._extractNodes=function(e,t){var r=null,i={},a=null,n={},o=this._getFormatter();return e(function(e,s,u){u!==r&&(a=null,r=u),e&&e.value&&(a&&(o.isLabel(e)||o.isNumber(e))&&(n[a].text=(n[a].text||"")+" "+e.value),a&&o.isCommonsResource(e.value)&&(n[a].icon=o.getCommonsResourceFileNameThumbnail(e.value,24)),o.isEntity(e)&&((i={}).parent=a||t||"#",i.id=i.parent+e.value,i.url=e.value,i.state={opened:!1},n[i.id]=i,a=i.id))}),n},i.prototype._expandTree=function(t){var r=this;this.getSparqlApi().query(a.replace("{ENTITY_URI}",t.url)).done(function(){var i=r.getSparqlApi().getResultRawData(),a=r._extractNodes(function(t){e.each(i.results.bindings,function(r,a){e.each(i.head.vars,function(e,i){var n=a[i]||null;t(n,i,a,r)})})},t.id);e.extend(r._nodes,a),e.each(a,function(e,t){r._jsTree.create_node(t.parent,t)})})},i.prototype.isDrawable=function(){return this._isDrawable},i.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||(this._isDrawable=!0,!1)},i}(jQuery,_,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.BubbleChartResultBrowser=function(e,t,r){"use strict";function i(){}return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._hasLabel=!1,i.prototype._hasNumber=!1,i.prototype.draw=function(t){var r=this,i={name:"bubblechart",children:[]},a=this._getLabelColumns()[0],n=this._getNumberColumns()[0],o=null;this._iterateResult(function(e,t,s){if(s!==o){var u={url:null};o=s,s.rgb&&r._getFormatter().isColor(s.rgb)&&(u.color=r._getFormatter().getColorForHtml(s.rgb)),s[a]&&s[n]&&(u.name=s[a].value,u.size=s[n].value,i.children.push(u))}if(e&&e.value&&r._getFormatter().isEntityUri(e.value)){var l=i.children[i.children.length-1];null===l.url&&(l.url=e.value)}});var s=e("<center>");t.html(s),this._drawBubbleChart(s,i)},i.prototype._drawBubbleChart=function(i,a){var n=this,o=Math.min(.98*e(r).height(),e(r).width()),s=t.scale.category20c(),u=t.layout.pack().sort(null).size([o,o]).padding(1.5),l=t.select(i[0]).append("svg").attr({class:"bubble",width:o,height:o}).selectAll(".node").data(u.nodes(function(e){function t(e,i){i.children?i.children.forEach(function(e){t(i.name,e)}):r.push({packageName:e,className:i.name,value:i.size,url:i.url,color:i.color})}var r=[];return t(null,e),{children:r}}(a)).filter(function(e){return!e.children})).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});l.append("title").text(function(e){return e.className+": "+e.value}),l.append("circle").attr("r",function(e){return e.r}).style("fill",function(e){return e.color||s(e.className)}),l.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(e){return e.className.substring(0,e.r/4)}).on("click",function(e){e.url&&r.open(e.url,"_blank")}).style("fill",function(e){if(e.color)return n._getFormatter().calculateLuminance(e.color)<=.5?"#FFF":"#000"}).style("cursor","pointer")},i.prototype.isDrawable=function(){return this._hasLabel&&this._hasNumber},i.prototype.visit=function(e){return this._checkColumn(e)},i.prototype._checkColumn=function(e){return this._getFormatter().isNumber(e)&&(this._hasNumber=!0),this._getFormatter().isLabel(e)&&(this._hasLabel=!0),!this.isDrawable()},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.LineChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.line},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.BarChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.bar},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.ScatterChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.scatter},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AreaChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.area},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TimelineResultBrowser=function(e,t,r,i){"use strict";function a(){}var n={minHeight:"400px",orientation:{axis:"both",item:"top"},align:"auto",zoomKey:"ctrlKey"};return a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,a.prototype.draw=function(r){var i=e("<div>"),a=new t.Timeline(i[0],this._getItems(),n);a.on("changed",function(){e(a.dom.root).find(".vis-item.vis-range").each(function(){var t=e(this);t.css("min-width","unset"),t.css("min-width",t.css("width"))})}),r.append(i.prepend(this._createToolbar(a)))},a.prototype._getItems=function(){var e=this,r=[];return this._iterateResult(function(t,i,a,n){if(e._getFormatter().isDateTime(t))if(r[n]){var o=[];o.push(e._getFormatter().parseDate(t.value)),r[n].start&&o.push(r[n].start),r[n].end&&o.push(r[n].end),r[n].start=o.reduce(function(e,t){return e<t?e:t}),r[n].end=o.reduce(function(e,t){return e>t?e:t})}else r[n]={id:n,content:e._getHtml(a).html(),start:e._getFormatter().parseDate(t.value)}}),new t.DataSet(i.compact(r))},a.prototype._getHtml=function(t){return e("<div/>").append(this._getFormatter().formatRow(t,!0))},a.prototype._createToolbar=function(t){function r(e){var r=t.getWindow(),i=r.end-r.start;t.setWindow({start:r.start.valueOf()-i*e,end:r.end.valueOf()+i*e})}var i=e('<div style="margin-top: -35px; text-align: center;">');return e('<a class="btn btn-default">').click(e.proxy(t.redraw,t)).append('<span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>').appendTo(i),e('<a class="btn btn-default">').click(e.proxy(t.fit,t)).append('<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r(.2)}).append('<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r(-.2)}).append('<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>').appendTo(i),i},a.prototype.visit=function(e){return!this._getFormatter().isDateTime(e)||(this._drawable=!0,!1)},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.MultiDimensionResultBrowser=function(e,t,r){"use strict";function i(){}var a="http://www.w3.org/2001/XMLSchema#dateTime";return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype.draw=function(e){var t={},r=[],i=this._getFormatter();this._iterateResult(function(e,n,o,s){if(r[s]||(r[s]={}),r[s][n]=e&&e.value||"undefined",e&&e.type===a&&(r[s][n]=new Date(e.value).toLocaleDateString()),!t[n]){var u={key:n,description:n,type:"STRING"};i.isNumber(e)&&(u.type="NUMBER"),e&&e.type===a&&(u.type="DATE"),t[n]=u}}),this._draw(e,r,_.values(t))},i.prototype._draw=function(i,a,n){function o(){t.event.sourceEvent.stopPropagation()}function s(){var e=n.filter(function(e){return!e.brush.empty()}),r=e.map(function(e){return e.brush.extent()});t.selectAll(".foreground path").style("display",function(t){return e.every(function(e,i){return e.type.within(t[e.key],r[i],e)})?null:"none"})}var u={top:50,right:80,bottom:10,left:100},l=e(r).width()-(u.left+u.right),p=e(r).height()-(u.top+u.bottom),c={NUMBER:{key:"Number",coerce:function(e){return+e},extent:t.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:t.scale.linear().range([p,0])},STRING:{key:"String",coerce:String,extent:function(e){return e.sort()},within:function(e,t,r){return t[0]<=r.scale(e)&&r.scale(e)<=t[1]},defaultScale:t.scale.ordinal().rangePoints([0,p])},DATE:{key:"Date",coerce:function(e){return new Date(e)},extent:t.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:t.time.scale().range([0,p])}};e.each(n,function(){this.type=c[this.type]});var d=t.scale.ordinal().domain(n.map(function(e){return e.key})).rangePoints([0,l]),h=t.svg.line().defined(function(e){return!isNaN(e[1])}),y=t.svg.axis().orient("left"),w=t.select(i[0]).append("svg").attr({width:l+u.left+u.right,height:p+u.top+u.bottom}).append("g").attr("transform","translate("+u.left+","+u.top+")"),f=w.append("g").attr("class","foreground"),g=w.selectAll(".axis").data(n).enter().append("g").attr("class","axis").attr("transform",function(e){return"translate("+d(e.key)+")"});a.forEach(function(e){n.forEach(function(t){e[t.key]=t.type.coerce(e[t.key])})}),n.forEach(function(e){"domain"in e||(e.domain=t.functor(e.type.extent)(a.map(function(t){return t[e.key]})),e.domain.sort(function(e,t){return e-t})),"scale"in e||(e.scale=e.type.defaultScale.copy()),e.scale.domain(e.domain)}),f.selectAll("path").data(a).enter().append("path").attr("d",function(e){return h(n.map(function(t){return[d(t.key),t.scale(e[t.key])]}))}).style("stroke",function(e){return"#6ac"}),g.append("g").attr("class","axis").each(function(e){var r=e.axis&&e.axis.scale(e.scale)||y.scale(e.scale);t.select(this).call(r)}).append("text").attr("class","title").attr("text-anchor","start").text(function(e){return e.description||e.key}),g.append("g").attr("class","brush").each(function(e){t.select(this).call(e.brush=t.svg.brush().y(e.scale).on("brushstart",o).on("brush",s))}).selectAll("rect").attr("x",-8).attr("width",16)},i.prototype.isDrawable=function(){return this._drawable},i.prototype.visit=function(e){return this._drawable=!0,!1},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowser=function(e,t,r,i){"use strict";function a(){}var n={autoResize:!0,physics:{stabilization:{enabled:!0,iterations:10,fit:!0}},nodes:{shadow:!0,color:"#fff"},edges:{arrows:{to:!0}}};return a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,a.prototype.draw=function(i){var a=e("<div>").height("100vh"),o=this._getData(),s=new t.Network(a[0],o,n);s.on("doubleClick",function(e){1===e.nodes.length&&r.open(e.nodes[0],"_blank")});var u=new wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser(o.nodes,o.edges,this.getSparqlApi());s.on("click",function(e){var t=e.nodes[0]||null;u.browse(t)}),a.prepend(this._createToolbar(s)),i.append(a)},a.prototype._createToolbar=function(t){function r(e){t.setOptions({layout:{hierarchical:{direction:e,sortMethod:"directed"}}})}var i=e('<div style="margin-top: -35px; text-align: center;">');return e('<a class="btn btn-default">').click(function(){t.stabilize(100)}).append('<span class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-stabilize")+'"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r("LR")}).append('<span class="glyphicon glyphicon-indent-left" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-lr")+'"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r("UD")}).append('<span class="glyphicon glyphicon-align-center" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-ud")+'"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r("RL")}).append('<span class="glyphicon glyphicon-indent-right" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-rl")+'"></span>').appendTo(i),i},a.prototype._getData=function(){var e={},r={},a=[],n=this._getFormatter(),o={},s={};return this._iterateResult(function(t,i,u,l){if(t&&t.value){if(n.isEntity(t)){var p=u[i+"Label"]&&u[i+"Label"].value||t.value,c=t.value;o={id:c,label:p,title:p},a[l]?(s={from:a[l],to:c},r[s.from+s.to]=s,e[c]||(e[c]=o)):(e[c]=o,a[l]=o.id)}if(n.isCommonsResource(t.value)&&(o.image=n.getCommonsResourceFileNameThumbnail(t.value,150),o.shape="image",o.font={color:"black"}),n.isNumber(t)&&(o.value=t.value,o.title+=" value:"+t.value,o.shape="dot",o.font={color:"black"}),"rgb"===i&&n.isColor(t)&&(o.color=n.getColorForHtml(t),"dot"!==o.shape&&"image"!==o.shape)){var d=n.calculateLuminance(t.value)<=.5?"#FFF":"#000";o.font={color:d}}"edgeLabel"===i&&(s.label=t.value)}}),{nodes:new t.DataSet(i.compact(e)),edges:new t.DataSet(i.compact(r))}},a.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||(this._drawable=!0,!1)},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser=function(e,t,r,i){"use strict";function a(e,t,r){this._nodes=e,this._edges=t,this._sparql=r}var n='SELECT ?p (SAMPLE(?pl) AS ?pl) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol)  WHERE {<{entityUri}> ?p ?o .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p',o='SELECT ?o ?ol WHERE {<{entityUri}> <{propertyUri}> ?o .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50';return a.prototype._nodes=null,a.prototype._nodes=null,a.prototype._sparql=null,a.prototype._selectedNodeId=null,a.prototype._temporaryNodes={},a.prototype._temporaryEdges={},a.prototype._getEntites=function(t,r){var i=this,a=e.Deferred();return this._sparql.query(o.replace("{entityUri}",t).replace("{propertyUri}",r)).done(function(){var t=i._sparql.getResultRawData(),r=[];e.each(t.results.bindings,function(e,t){r.push({id:t.o.value,label:t.ol.value})}),a.resolve(r)}),a},a.prototype._getProperties=function(t){var r=this,i=e.Deferred();return this._sparql.query(n.replace("{entityUri}",t)).done(function(){var t=r._sparql.getResultRawData(),a=[];e.each(t.results.bindings,function(e,t){a.push({id:t.p.value,label:t.pl.value,count:t.count.value,items:t.ol.value})}),i.resolve(a)}),i},a.prototype._removeTemporaryNodes=function(t){var r=this;e.each(this._temporaryNodes,function(e,t){r._nodes.remove(t.id)}),e.each(this._temporaryEdges,function(e,t){r._edges.remove(t.id)}),this._temporaryNodes={},this._temporaryEdges={}},a.prototype._expandPropertyNode=function(t){var r=this,i=this._temporaryNodes[t];this._getEntites(i.entityId,i.id).done(function(t){e.each(t,function(e,t){null===r._nodes.get(t.id)&&r._nodes.add({id:t.id,label:t.label}),r._edges.add({dashes:!0,from:i.entityId,to:t.id,label:i.propertyLabel,linkType:i.id})})})},a.prototype._expandEntityNode=function(t){var r=this;this._getProperties(t).done(function(i){e.each(i,function(e,i){if(!(r._edges.get({filter:function(e){return e.linkType===i.id&&e.from===t}}).length>0)){var a={id:i.id,label:"1"===i.count?i.items:i.count,title:i.items,entityId:t,propertyLabel:i.label,color:"#abc9f2"},n={id:i.id,dashes:!0,label:i.label,from:t,to:i.id};r._temporaryNodes[a.id]=a,r._nodes.add(a),r._temporaryEdges[n.id]=n,r._edges.add(n)}})})},a.prototype.browse=function(e){if(null!==e){if(this._temporaryNodes[e])return this._expandPropertyNode(e),void this._removeTemporaryNodes();null!==this._selectedNodeId&&e!==this._selectedNodeId&&this._removeTemporaryNodes(),this._expandEntityNode(e),this._selectedNodeId=e}else this._removeTemporaryNodes()},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.PolestarResultBrowser=function(e,t,r){"use strict";function i(){}return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,i.prototype.draw=function(r){var i={url:"wikidatasparql://query.wikidata.org/?query="+location.hash.substr(1),name:"Imported from Wikidata Query Service",_directEmbed:!0},a=e("<iframe>").attr({src:"polestar/embed.html#"+encodeURIComponent(JSON.stringify(i)),class:"graph-iframe"}).height("98vh");r.append(a),t.setTimeout(function(){a.scrollIntoView()},50)},i.prototype.visit=function(e){return this._drawable=!0,!1},i}(jQuery,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Sparql=function(e){"use strict";function t(e,t){this._serviceUri=e||r,this._language=t||n}var r="https://query.wikidata.org/bigdata/namespace/wdq/sparql",i={TIMEOUT:10,MALFORMED:20,SERVER:30,UNKNOWN:100},a={"QueryTimeoutException: Query deadline is expired":i.TIMEOUT,"MalformedQueryException: ":i.MALFORMED},n="en";return t.prototype.ERROR_CODES=i,t.prototype._serviceUri=null,t.prototype._executionTime=null,t.prototype._error=null,t.prototype._resultLength=null,t.prototype._rawData=null,t.prototype._queryUri=null,t.prototype._language=null,t.prototype.queryDataUpdatedTime=function(){var t=e.Deferred(),r=encodeURI("prefix schema: <http://schema.org/> SELECT * WHERE {<http://www.wikidata.org> schema:dateModified ?y}"),i=this._serviceUri+"?query="+r+"&nocache="+Math.floor(Date.now()/6e4),a={headers:{Accept:"application/sparql-results+json"}};return e.ajax(i,a).done(function(e,r,i){if(e.results.bindings[0]){var a=new Date(e.results.bindings[0][e.head.vars[0]].value),n=a.toLocaleTimeString(navigator.language,{timeZoneName:"short"})+", "+a.toLocaleDateString(navigator.language,{month:"short",day:"numeric",year:"numeric"}),o=Math.round((new Date-a)/1e3);t.resolve(n,o)}else t.reject()}).fail(function(){t.reject()}),t},t.prototype.query=function(t,r){function i(e,t,r){o._executionTime=Date.now()-o._executionTime,"boolean"==typeof e.boolean?o._resultLength=1:o._resultLength=e.results.bindings.length||0,o._rawData=e,s.resolve(e)}function a(e,t,r){o._executionTime=null,o._rawData=null,o._resultLength=null,o._generateErrorMessage(e,t,r),s.reject()}t=this._replaceAutoLanguage(t);var n="query="+encodeURIComponent(t);r&&(n+="&maxQueryTimeMillis="+r);var o=this,s=e.Deferred(),u={headers:{Accept:"application/sparql-results+json"},data:n};return this._queryUri=this._serviceUri+"?"+u.data,this._executionTime=Date.now(),e.ajax(this._serviceUri,u).done(i).fail(function(t,r,n){""===t.getAllResponseHeaders()?(u.method="POST",e.ajax(o._serviceUri,u).done(i).fail(a)):a.apply(this,arguments)}),s},t.prototype._generateErrorMessage=function(e,t,r){var n={code:i.UNKNOWN,message:null,debug:e.responseText};(0===e.status||r)&&(n.code=i.SERVER,n.message=r.message);try{var o=n.debug.substring(n.debug.indexOf("java.util.concurrent.ExecutionException:"));for(var s in a)-1!==o.indexOf(s)&&(n.code=a[s],n.message=null);n.code!==i.UNKNOWN&&n.code!==i.MALFORMED||(n.message=n.debug.match(/(java\.util\.concurrent\.ExecutionException\:)+(.*)(Exception\:)+(.*)/).pop().trim())}catch(e){}this._error=n},t.prototype.getExecutionTime=function(){return this._executionTime},t.prototype.getError=function(){return this._error},t.prototype.getResultLength=function(){return this._resultLength},t.prototype.getQueryUri=function(){return this._queryUri},t.prototype._processData=function(e,t,r){for(var i=e.results.bindings.length,a=0;a<i;a++){for(var n={},o=0;o<e.head.vars.length;o++)e.head.vars[o]in e.results.bindings[a]?n[e.head.vars[o]]=e.results.bindings[a][e.head.vars[o]]:n[e.head.vars[o]]=void 0;r=t(n,r)}return r},t.prototype._encodeCsv=function(e){var t=e.replace(/"/g,'""');return/[",\n]/.test(t)&&(t='"'+t+'"'),t},t.prototype.getResultRawData=function(){return this._rawData},t.prototype.getResultAsCsv=function(){var e=this,t=e._rawData,r=t.head.vars.map(this._encodeCsv).join(",")+"\n";return r=this._processData(t,function(t,r){var i,a="",n=!0;for(var o in t)i=void 0===t[o]?"":e._encodeCsv(t[o].value),n?n=!1:a+=",",a+=i;return a+="\n",r+a},r)},t.prototype.getResultAsJson=function(){var e=[],t=this._rawData;return e=this._processData(t,function(e,t){var r={};for(var i in e)r[i]=(e[i]||{}).value;return t.push(r),t},e),JSON.stringify(e)},t.prototype.getResultAsAllJson=function(){return JSON.stringify(this._rawData)},t.prototype._renderValueTSV=function(e){var t=e.value.replace(/\t/g,"");switch(e.type){case"uri":return"<"+t+">";case"bnode":return"_:"+t;case"literal":var r=JSON.stringify(t);return e["xml:lang"]?r+"@"+e["xml:lang"]:e.datatype?"http://www.w3.org/2001/XMLSchema#integer"===e.datatype||"http://www.w3.org/2001/XMLSchema#decimal"===e.datatype||"http://www.w3.org/2001/XMLSchema#double"===e.datatype?t:r+"^^<"+e.datatype+">":r}return t},t.prototype.getSparqlTsv=function(){var e=this,t=this._rawData,r=t.head.vars.map(function(e){return"?"+e}).join("\t")+"\n";return r=this._processData(t,function(t,r){var i,a="",n=!0;for(var o in t)i=void 0===t[o]?"":e._renderValueTSV(t[o]),n?n=!1:a+="\t",a+=i;return a+="\n",r+a},r)},t.prototype.getSimpleTsv=function(){var e=this._rawData,t=e.head.vars.join("\t")+"\n";return t=this._processData(e,function(e,t){var r,i="",a=!0;for(var n in e)r=void 0===e[n]?"":e[n].value.replace(/\t/g,""),a?a=!1:i+="\t",i+=r;return i+="\n",t+i},t)},t.prototype._replaceAutoLanguage=function(e){return e.replace(/\[AUTO_LANGUAGE\]/g,this._language)},t.prototype.setLanguage=function(e){this._language=e},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.QuerySamples=function(e){"use strict";function t(e){this._language=e}var r="https://www.wikidata.org/api/rest_v1/page/html/",i="Wikidata:SPARQL_query_service/queries/examples";return t.prototype._language=null,t.prototype.getExamples=function(){var t=e.Deferred(),a=this;return e.ajax({url:r+encodeURIComponent(i+"/"+a._language)+"?redirect=false",dataType:"html"}).done(function(e){t.resolve(a._parseHTML(e))}).fail(function(){e.ajax({url:r+encodeURIComponent(i)+"?redirect=false",dataType:"html"}).done(function(e){t.resolve(a._parseHTML(e))})}),t},t.prototype._findPrevHeader=function(e){var t=e.prop("tagName");return"H"!==t[0]&&"h"!==t[0]?null:this._findPrev(e,"h"+(t.substr(1)-1))},t.prototype._findPrev=function(e,t){var r=e.prev().filter(t);return r.length>0?r:(r=e.prevUntil(t).last().prev()).length>0?r:r=e.parent().prev().filter(t)},t.prototype._extractTagsFromUL=function(t){return t.find('a[rel="mw:WikiLink"]').map(function(){return e(this).text().trim()}).get()},t.prototype._parseHTML=function(t){var r=document.createElement("div"),i=this;r.innerHTML=t;var a=e(r).find("[data-mw]").map(function(){var t=e(this),r=t.attr("data-mw");if(r){var a,n=JSON.parse(r);if(n.parts&&n.parts[0].template&&"./Template:SPARQL"===n.parts[0].template.target.href)a=n.parts[0].template.params.query.wt;else{if(!n.body)return null;a=n.body.extsrc}a=a.replace(/\{\{!}}/g,"|");var o=i._findPrev(t,"h2,h3,h4,h5,h6,h7");if(!o||!o.length)return null;var s=o.text().trim(),u=t.prevUntil(o).filter("ul");return{title:s,query:a,href:"https://www.wikidata.org/wiki/Wikidata:SPARQL_query_service/queries/examples#"+encodeURIComponent(s.replace(/ /g,"_")).replace(/%/g,"."),tags:i._extractTagsFromUL(u),category:i._findPrevHeader(o).text().trim()}}}).get();return _.flatten(_.toArray(_.groupBy(a,"category")))},t.prototype.setLanguage=function(e){this._language=e},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Wikibase=function(e){"use strict";function t(e,t){this._endpoint=r,e&&(this._endpoint=e),t&&(this._language=t)}var r="https://www.wikidata.org/w/api.php",i={action:"wbsearchentities",format:"json",continue:0,language:"en",uselang:"en"},a={action:"query",meta:"siteinfo",format:"json",siprop:"languages"};return t.prototype._endpoint=null,t.prototype._language=null,t.prototype.searchEntities=function(e,t,r){var a=i;return a.search=e,t&&(a.type=t),(this._language||r)&&(a.language=r||this._language,a.uselang=r||this._language),this._query(a)},t.prototype.getLanguages=function(){return this._query(a)},t.prototype._query=function(t){return e.ajax({url:this._endpoint+"?"+jQuery.param(t),dataType:"jsonp"})},t.prototype.setLanguage=function(e){this._language=e},t}(jQuery);var tracking=tracking||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Tracking=function(e){"use strict";function t(e){this._endpoint=r,e&&(this._endpoint=e)}var r="https://www.wikidata.org/beacon/statsv";return t.prototype._endpoint=null,t.prototype.track=function(e,t,r){if(t||(t=1),r||(r="c"),"query.wikidata.org"===location.hostname)return this._track(e+"="+t+r)},t.prototype._track=function(t){return e.ajax({url:this._endpoint+"?"+t,dataType:"jsonp"})},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.RdfNamespaces={},function(e,t){"use strict";t.NAMESPACE_SHORTCUTS={Wikidata:{wikibase:"http://wikiba.se/ontology#",wd:"http://www.wikidata.org/entity/",wdt:"http://www.wikidata.org/prop/direct/",wds:"http://www.wikidata.org/entity/statement/",p:"http://www.wikidata.org/prop/",wdref:"http://www.wikidata.org/reference/",wdv:"http://www.wikidata.org/value/",ps:"http://www.wikidata.org/prop/statement/",psv:"http://www.wikidata.org/prop/statement/value/",psn:"http://www.wikidata.org/prop/statement/value-normalized/",pq:"http://www.wikidata.org/prop/qualifier/",pqv:"http://www.wikidata.org/prop/qualifier/value/",pqn:"http://www.wikidata.org/prop/qualifier/value-normalized/",pr:"http://www.wikidata.org/prop/reference/",prv:"http://www.wikidata.org/prop/reference/value/",prn:"http://www.wikidata.org/prop/reference/value-normalized/",wdno:"http://www.wikidata.org/prop/novalue/",wdata:"http://www.wikidata.org/wiki/Special:EntityData/"},W3C:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",owl:"http://www.w3.org/2002/07/owl#",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",prov:"http://www.w3.org/ns/prov#"},"Social/Other":{schema:"http://schema.org/",geo:"http://www.opengis.net/ont/geosparql#",geof:"http://www.opengis.net/def/geosparql/function/"},Blazegraph:{bd:"http://www.bigdata.com/rdf#",bds:"http://www.bigdata.com/rdf/search#",gas:"http://www.bigdata.com/rdf/gas#",hint:"http://www.bigdata.com/queryHints#"}},t.ENTITY_TYPES={"http://www.wikidata.org/prop/direct/":"property","http://www.wikidata.org/prop/":"property","http://www.wikidata.org/prop/novalue/":"property","http://www.wikidata.org/prop/statement/":"property","http://www.wikidata.org/prop/statement/value/":"property","http://www.wikidata.org/prop/statement/value-normalized/":"property","http://www.wikidata.org/prop/qualifier/":"property","http://www.wikidata.org/prop/qualifier/value/":"property","http://www.wikidata.org/prop/qualifier/value-normalized/":"property","http://www.wikidata.org/prop/reference/":"property","http://www.wikidata.org/prop/reference/value/":"property","http://www.wikidata.org/prop/reference/value-normalized/":"property","http://www.wikidata.org/wiki/Special:EntityData/":"item","http://www.wikidata.org/entity/":"item"},t.ALL_PREFIXES=e.map(t.NAMESPACE_SHORTCUTS,function(e){return e}).reduce(function(t,r,i){return e.extend(t,r)},{}),t.STANDARD_PREFIXES={wd:"PREFIX wd: <http://www.wikidata.org/entity/>",wdt:"PREFIX wdt: <http://www.wikidata.org/prop/direct/>",wikibase:"PREFIX wikibase: <http://wikiba.se/ontology#>",p:"PREFIX p: <http://www.wikidata.org/prop/>",ps:"PREFIX ps: <http://www.wikidata.org/prop/statement/>",pq:"PREFIX pq: <http://www.wikidata.org/prop/qualifier/>",rdfs:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>",bd:"PREFIX bd: <http://www.bigdata.com/rdf#>"},t.getPrefixMap=function(r){var i={};return e.each(t.ALL_PREFIXES,function(e,t){r[t]&&(i[e]=r[t])}),i}}(jQuery,wikibase.queryService.RdfNamespaces);var CONFIG=function(e,t){"use strict";var r={language:function(){var e=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage;return e&&"string"==typeof e?e.split("-").shift():null}()||"en",api:{sparql:{uri:"/bigdata/namespace/wdq/sparql"},wikibase:{uri:"https://www.wikidata.org/w/api.php"}},i18nLoad:function(e){var r=null;return e!==this.language&&(r=t.i18n().load("i18n/"+this.language+".json",this.language)),t.when(r,t.i18n().load("i18n/"+e+".json",e))},brand:{logo:"logo.svg",title:"Wikidata Query"}},i=t.extend(!0,{},r,{api:{sparql:{uri:"https://query.wikidata.org/bigdata/namespace/wdq/sparql"}},i18nLoad:function(e){return t.when(t.i18n().load("i18n/"+e+".json",e),t.i18n().load("node_modules/jquery.uls/i18n/"+e+".json",e))},brand:{title:"Localhost"}}),a=e.location.hostname.toLowerCase();return""===a||"localhost"===a||"127.0.0.1"===a?i:r}(window,jQuery);!function(e,t,r){"use strict";function i(){e(".navbar-brand img").attr("src",t.brand.logo),e(".navbar-brand a > span").text(t.brand.title)}function a(i,a){a&&Cookies.set("lang",i),e.i18n.debug=!0,e.i18n().locale=i,r.locale(i),e.when(t.i18nLoad(i)).done(function(){e(".wikibase-queryservice").i18n(),e("html").attr({lang:i,dir:e.uls.data.getDir(i)})})}var n=wikibase.queryService;e(document).ready(function(){i();var r=Cookies.get("lang")?Cookies.get("lang"):t.language;a(r,!1);var o=new n.api.Wikibase(t.api.wikibase.uri,r),s=new n.api.Sparql(t.api.sparql.uri,r),u=new n.api.QuerySamples(r);new n.ui.i18n.LanguageSelector(e(".uls-trigger"),o,r).setChangeListener(function(e){o.setLanguage(e),s.setLanguage(e),u.setLanguage(e),a(e,!0)});var l=new n.ui.editor.hint.Rdf(o),p=new n.ui.editor.tooltip.Rdf(o);new n.ui.App(e(".wikibase-queryservice "),new n.ui.editor.Editor(l,null,p),new n.ui.queryHelper.QueryHelper(o,s),s,u)})}(jQuery,CONFIG,moment);