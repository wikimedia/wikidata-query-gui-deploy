var CONFIG=function(e,t){"use strict";var r,i="https://query.wikidata.org/",a={language:(r=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage,(r&&"string"==typeof r?r.split("-").shift():null)||"en"),api:{sparql:{uri:"/sparql"},wikibase:{uri:"https://www.wikidata.org/w/api.php"}},i18nLoad:function(e){var r=null;return e!==this.language&&(r=t.i18n().load("i18n",this.language)),t.when(r,t.i18n().load("i18n",e))},brand:{logo:"logo.svg",title:"Wikidata Query"},location:{root:i,index:i},showBirthdayPresents:(new Date).getTime()>=Date.UTC(2017,9,29)},n=e.location.hostname.toLowerCase();return""===n||"localhost"===n||"127.0.0.1"===n?t.extend(!0,{},a,{api:{sparql:{uri:"https://query.wikidata.org/sparql"}},i18nLoad:function(e){return t.when(t.i18n().load("i18n",e),t.i18n().load("node_modules/jquery.uls/i18n",e))},brand:{title:"Localhost"},location:{root:"./",index:"./index.html"},showBirthdayPresents:!0}):a}(window,jQuery);(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.ResultView=function(e,t){"use strict";function r(e){this._sparqlApi=e,this._init()}return r.prototype._query=null,r.prototype._sparqlQuery=null,r.prototype._sparqlApi=null,r.prototype._selectedResultBrowser=null,r.prototype._actionBar=null,r.prototype._trackingApi=null,r.prototype._hasRunFirstQuery=!1,r.prototype._resultBrowsers={Table:{icon:"glyphicon-th-list",label:["wdqs-app-resultbrowser-table","Table"],class:"TableResultBrowser",object:null,$element:null},ImageGrid:{icon:"glyphicon-picture",label:["wdqs-app-resultbrowser-image-grid","Image grid"],class:"ImageResultBrowser",object:null,$element:null},Polestar:{icon:"fa-certificate",label:["wdqs-app-resultbrowser-graph-builder","Graph builder"],class:"PolestarResultBrowser",object:null,$element:null},Map:{icon:"glyphicon-map-marker",label:["wdqs-app-resultbrowser-map","Map"],class:"CoordinateResultBrowser",object:null,$element:null},LineChart:{icon:"fa-line-chart",label:["wdqs-app-resultbrowser-line-chart","Line chart"],class:"LineChartResultBrowser",object:null,$element:null},BarChart:{icon:"fa-bar-chart",label:["wdqs-app-resultbrowser-bar-chart","Bar chart"],class:"BarChartResultBrowser",object:null,$element:null},ScatterChart:{icon:"fa-braille",label:["wdqs-app-resultbrowser-scatter-chart","Scatter chart"],class:"ScatterChartResultBrowser",object:null,$element:null},AreaChart:{icon:"fa-area-chart",label:["wdqs-app-resultbrowser-area-chart","Area chart"],class:"AreaChartResultBrowser",object:null,$element:null},BubbleChart:{icon:"glyphicon-tint",label:["wdqs-app-resultbrowser-bubble-chart","Bubble chart"],class:"BubbleChartResultBrowser",object:null,$element:null},TreeMap:{icon:"glyphicon-th",label:["wdqs-app-resultbrowser-tree-map","Tree map"],class:"TreeMapResultBrowser",object:null,$element:null},Tree:{icon:"fa-tree",label:["wdqs-app-resultbrowser-tree","Tree"],class:"TreeResultBrowser",object:null,$element:null},Timeline:{icon:"glyphicon-calendar",label:["wdqs-app-resultbrowser-timeline","Timeline"],class:"TimelineResultBrowser",object:null,$element:null},Dimensions:{icon:"glyphicon-random",label:["wdqs-app-resultbrowser-dimensions","Dimensions"],class:"MultiDimensionResultBrowser",object:null,$element:null},Graph:{icon:"glyphicon-retweet",label:["wdqs-app-resultbrowser-graph","Graph"],class:"GraphResultBrowser",object:null,$element:null}},r.prototype.trackingNamespace="wikibase.queryService.ui.app.",r.prototype._init=function(){this._sparqlApi||(this._sparqlApi=new wikibase.queryService.api.Sparql),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._actionBar=new wikibase.queryService.ui.toolbar.Actionbar(e(".action-bar")),this._sparqlQuery=this._query=new wikibase.queryService.ui.queryHelper.SparqlQuery,this._internationalizeCharts(),this._initResultBrowserMenu()},r.prototype._internationalizeCharts=function(){var t=this;e.each(this._resultBrowsers,function(e,r){var i=r.label[0],a=r.label[1];r.label=t._i18n(i,a)})},r.prototype._initResultBrowserMenu=function(){e.each(this._resultBrowsers,function(t,r){var i=e('<li><a class="result-browser" href="#"><span class="'+r.icon.split("-",1)[0]+" "+r.icon+'"></span>'+r.label+"</a></li>");i.appendTo(e("#result-browser-menu")),r.$element=i})},r.prototype.draw=function(t){var r=this,i=e.Deferred();return this._query=t,this._actionBar.show("wdqs-action-query","","info",100),e("#query-result").empty().hide(),e(".result").hide(),e("#query-error").hide(),this._sparqlApi.query(t).done(function(){r._handleQueryResult(),i.resolve()}).fail(function(){var e=r._handleQueryError();i.reject(e)}),i.promise()},r.prototype.drawPreview=function(r){var i=this,a=e.Deferred(),n=wikibase.queryService.RdfNamespaces.ALL_PREFIXES,o=this._sparqlQuery.getQueryString();return this._query=r,this._sparqlQuery.parse(r,n),this._sparqlQuery.setLimit(20),o===this._sparqlQuery.getQueryString()?a.reject().promise():(e("#query-result").empty().hide(),e(".result").hide(),e("#query-error").hide(),this._actionBar.hide(),this._sparqlApi.query(this._sparqlQuery.getQueryString(),1e3).done(function(){i._handleQueryResult(),a.resolve(),t.setTimeout(function(){i._actionBar.show("wdqs-action-preview","","default")},200)}).fail(function(){a.reject()}),a.promise())},r.prototype._handleQueryError=function(){e("#execute-button").prop("disabled",!1);var t=this._sparqlApi.getError(),r=null,i=this._sparqlApi.ERROR_CODES;switch(t.code){case i.TIMEOUT:r="wdqs-action-timeout";break;case i.MALFORMED:r="wdqs-action-malformed-query";break;case i.SERVER:r="wdqs-action-server-error";break;default:r="wdqs-action-unknow-error"}return t.debug&&e("#query-error").html(e("<pre>").text(t.debug)).show(),this._actionBar.show(r||"",t.message||"","danger"),this._track("result.error."+(r||"unknown")),void 0===t.debug?"":t.debug},r.prototype._handleQueryResult=function(){var t=this._sparqlApi;e("#response-summary").html(this._i18n("wdqs-app-resultbrowser-response-summary","$1 results in $2&nbsp;ms",[t.getResultLength(),t.getExecutionTime()])),e(".result").show(),e("#execute-button").prop("disabled",!1);var r=this._createResultBrowsers(t.getResultRawData());return this._drawResult(r),this._selectedResultBrowser=null,this._track("result.resultLength",t.getResultLength()),this._track("result.executionTime",t.getExecutionTime(),"ms"),this._track("result.received.success"),!1},r.prototype._createResultBrowsers=function(t){var r=this,i=this._getBrowserOptions(),a=null;return null!==i.defaultName?this._track("result.browser."+i.defaultName):this._track("result.browser.default"),e.each(this._resultBrowsers,function(e,t){var n=new wikibase.queryService.ui.resultBrowser[t.class];if(n.setSparqlApi(r._sparqlApi),i.defaultName===e&&(r._setSelectedDisplayType(t),a=n),i.optionsMap.has(e)){var o=new wikibase.queryService.ui.resultBrowser.helper.Options(i.optionsMap.get(e));n.setOptions(o)}t.object=n}),null===a&&(a=this._resultBrowsers.Table.object),a.resetVisitors(),e.each(this._resultBrowsers,function(e,r){a.addVisitor(r.object),r.object.setResult(t)}),a},r.prototype._getBrowserOptions=function(){for(var r,i=null,a=new Map,n=/#(defaultView|view):(\w+)(\{.*\})?/g;null!==(r=n.exec(this._query));){var o=r[2];if(this._resultBrowsers.hasOwnProperty(o)&&("defaultView"===r[1]&&(i=o),r[3])){var s=a.has(o)?a.get(o):{};try{a.set(o,e.extend(s,JSON.parse(r[3])))}catch(e){t.console.error(e)}}}return{defaultName:i,optionsMap:a}},r.prototype._handleQueryResultBrowsers=function(){var t=this;e.each(this._resultBrowsers,function(r,i){i.$element.off("click"),i.object.isDrawable()?(i.$element.css("opacity",1).attr("href","#"),i.$element.click(function(){return e(this).closest(".open").removeClass("open"),t._setSelectedDisplayType(i),e("#query-result").html(""),t._drawResult(i.object),t._selectedResultBrowser=r,t._track("buttonClick.display."+r),!1})):i.$element.css("opacity",.5).removeAttr("href")})},r.prototype._drawResult=function(r){var i=this;e(t).off("scroll.resultBrowser"),e(t).off("resize.resultBrowser"),this._actionBar.show("wdqs-action-render","","success",100),t.setTimeout(function(){try{e("#query-result").show(),r.draw(e("#query-result")),i._actionBar.hide()}catch(e){i._actionBar.show("wdqs-action-error-display","","warning"),t.console.error(e)}i._handleQueryResultBrowsers()},20)},r.prototype._setSelectedDisplayType=function(t){e("#display-button-icon").attr("class",t.icon.split("-",1)[0]+" "+t.icon),e("#display-button-label").text(t.label)},r.prototype._track=function(e,t,r){this._trackingApi.track(this.trackingNamespace+e,t,r)},r.prototype._i18n=function(t,r,i){var a=null;return e.i18n&&(a=e.i18n.apply(e,[t].concat(i||[])))!==t?a:(a=r,i&&e.each(i,function(e,t){a=a.replace(new RegExp("\\$"+(e+1),"g"),t)}),a)},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.FormatterHelper=function(e,t){"use strict";var r="http://commons.wikimedia.org/wiki/special:filepath/",i="http://www.w3.org/2001/XMLSchema#dateTime",a=["http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#positiveInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger"];function n(e,t){this._i18n=e,this._options=t||new wikibase.queryService.ui.resultBrowser.helper.Options({})}return n.initMoment=function(){t.updateLocale("en",{longDateFormat:{LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"}})},n.prototype.getOptions=function(){return this._options},n.prototype.setOptions=function(e){this._options=e},n.prototype.formatRow=function(t,r){var i=this,a=e("<div/>");return e.each(t,function(n,o){i._isLabelField(n,t)||i._isHiddenField(n)||(o=e.extend({label:i._getLabel(t,n)},o),a.prepend(e("<div>").append(i.formatValue(o,n,r))))}),a},n.prototype._isLabelField=function(e,t){return e.endsWith("Label")&&void 0!==t[e.slice(0,-5)]},n.prototype._isHiddenField=function(e){return-1!==this.getOptions().getColumnNames("hide",[]).indexOf(e)},n.prototype._getLabel=function(e,t){var r=e[t+"Label"];return r&&r.value||null},n.prototype.formatValue=function(t,r,a){var n=t.value,o=e("<span>");if(r||(r=t.dataType||""),!t.type)return e("<span>").text(n).attr("title",r);switch(t.datatype||t.type){case"uri":var s=e("<a>").attr({title:r,href:n,target:"_blank",class:"item-link",rel:"noopener"});o.append(s),this.isCommonsResource(n)?(s.attr("title",r+": commons:"+this.getCommonsResourceFileName(n)),a?(s.click(this.handleCommonResourceItem),s.append(e("<img>").attr("src",this.getCommonsResourceFileNameThumbnail(n,"120"))).width("120")):(s.attr({href:"https://commons.wikimedia.org/wiki/File:{FILENAME}".replace(/{FILENAME}/g,this.getCommonsResourceFileName(n))}),s.text("commons:"+decodeURIComponent(this.getCommonsResourceFileName(n))),o.prepend(this.createGalleryButton(n,r)," "))):(s.text(t.label||this.abbreviateUri(n)),this.isEntityUri(n)&&o.prepend(this.createExploreButton(n)," "));break;case i:r||(r=this._i18n("wdqs-app-result-formatter-title-datetime","Raw ISO timestamp"));var l=e("<span>").text(this._formatDate(n));l.attr("title",r+": "+n),o.append(l);break;case"http://www.w3.org/1998/Math/MathML":o.append(e(t.value));break;default:var u=e("<span>").text(n);t["xml:lang"]?u.attr("title",r+": "+n+"@"+t["xml:lang"]):u.attr("title",r+": "+n),o.append(u)}return o},n.prototype._formatDate=function(e){var t,r=!1,i=e.replace(/^(?:-\d+|\+?0+\b)/,function(e){return r=!0,Math.abs(e)+1}),a=this.parseDate(i);if(a.isValid())t=a.format("LL");else{var n=i.replace(/^\+?(\d+).*/,"$1");t="0000".slice(n.length)+n}return r&&(t+=" BCE"),t},n.prototype.parseDate=function(e){return e=(e=(e=e.replace(/^(?![+-])/,"+")).replace(/^([+-]?)(\d{1,5}\b)/,function(e,t,r){return t+("00000"+r).slice(-6)})).replace(/Z$/,""),t(e,t.ISO_8601)},n.prototype.isEntityUri=function(e){return"string"==typeof e&&/\/entity\/(Q|P|L|M)[0-9]+$/.test(e)},n.prototype.createExploreButton=function(t){var r=e('<a href="'+t+'" title="Explore item" class="explore glyphicon glyphicon-search" tabindex="-1" aria-hidden="true">');return r.click(e.proxy(this.handleExploreItem,this)),r},n.prototype.isCommonsResource=function(e){return e.toLowerCase().startsWith(r.toLowerCase())},n.prototype.getCommonsResourceFileName=function(e){var t=new RegExp(r,"ig");return decodeURIComponent(e.replace(t,""))},n.prototype.getCommonsResourceFileNameThumbnail=function(e,t){return this.isCommonsResource(e)?e.replace(/^http(?=:\/\/)/,"https")+"?width="+(t||400):e},n.prototype.createGalleryButton=function(t,r){var i=this.getCommonsResourceFileName(t),a=this.getCommonsResourceFileNameThumbnail(t,900),n=e("<a>").attr({title:"Show Gallery",href:a,"aria-hidden":"true",class:"gallery glyphicon glyphicon-picture","data-gallery":"G_"+r,"data-title":decodeURIComponent(i)});return n.click(this.handleCommonResourceItem),n},n.prototype.abbreviateUri=function(e){var t,r,i,a=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS,n=0;for(t in a)for(r in a[t])0===e.indexOf(a[t][r])&&a[t][r].length>n&&(n=a[t][r].length,i=r);return i?i+":"+e.substr(n):"<"+e+">"},n.prototype.handleExploreItem=function(t){var r=e(t.target).attr("href");t.preventDefault();var i=e.i18n&&e.i18n().locale||"en",a="embed.html#"+encodeURIComponent("#defaultView:Graph\n"+("SELECT ?item ?itemLabel WHERE { BIND( <"+r+'> as ?item ).\tSERVICE wikibase:label { bd:serviceParam wikibase:language "'+i+'" } }'));return e(".explorer-panel .panel-body").html(e('<iframe frameBorder="0" scrolling="no"></iframe>').attr("src",a)),e(".explorer-panel").show(),!1},n.prototype.handleCommonResourceItem=function(t){t.preventDefault(),e(this).ekkoLightbox({scale_height:!0})},n.prototype.isLabel=function(e){return!!e&&("xml:lang"in e||"literal"===e.type&&!e.datatype)},n.prototype.isNumber=function(e){return e&&e.datatype&&-1!==a.indexOf(e.datatype)},n.prototype.isDateTime=function(e){return e&&e.datatype===i},n.prototype.isEntity=function(e){return e&&e.value&&this.isEntityUri(e.value)},n.prototype.isColor=function(e){return e&&"literal"===e.type&&e.value&&/^([\dA-F]{1,2}){3}$/i.test(e.value)},n.prototype.getColorForHtml=function(e){return"#"+e.value},n.prototype.calculateLuminance=function(e){var t=parseInt(e.substr(1,2),16)/255,r=parseInt(e.substr(3,2),16)/255,i=parseInt(e.substr(5,2),16)/255;return isFinite(t)&&isFinite(r)&&isFinite(i)?.2126*(t=t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(r=r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(i=i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)):NaN},n.prototype._i18n=null,n.prototype._options=null,n}(jQuery,moment),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.Options=function(e){"use strict";function t(e){if("object"!=typeof e)throw new Error("options must be an object");this._options=e}return t.prototype._options=null,t.prototype._requireTwoArguments=function(e){if(2!==e.length)throw new Error("must be called with exactly two arguments")},t.prototype.get=function(e,t){return this._requireTwoArguments(arguments),e in this._options?this._options[e]:t},t.prototype.getArray=function(e,t){this._requireTwoArguments(arguments);var r=this.get(e,t);return Array.isArray(r)?r:[r]},t.prototype.getColumnNames=function(e,t){return this._requireTwoArguments(arguments),this.getArray(e,t).filter(function(e){return!("string"!=typeof e||!e.startsWith("?"))||(window.console.warn("column name "+e+" is not a variable name, ignoring"),!1)}).map(function(e){return e.substring(1)})},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractResultBrowser=function(e,t){"use strict";function r(){this._visitors=[]}return r.prototype._formatter=null,r.prototype._result=null,r.prototype._options=null,r.prototype._visitors=null,r.prototype._drawable=!1,r.prototype._sparqlApi=null,r.prototype.setResult=function(e){this._result=e},r.prototype.setOptions=function(e){this._options=e,this._getFormatter().setOptions(e)},r.prototype.getOptions=function(){return this._options||new t.queryService.ui.resultBrowser.helper.Options({})},r.prototype.setSparqlApi=function(e){this._sparqlApi=e},r.prototype.getSparqlApi=function(){return this._sparqlApi},r.prototype._iterateResult=function(t){var r=this;e.each(this._result.results.bindings,function(i,a){e.each(r._result.head.vars,function(e,n){var o=a[n]||null;r.processVisitors(o,n),t(o,n,a,i)})})},r.prototype.isDrawable=function(){return this._drawable},r.prototype.draw=function(e){jQuery.error("Method draw() needs to be implemented!")},r.prototype.addVisitor=function(e){this._visitors.push(e)},r.prototype.resetVisitors=function(){this._visitors=[]},r.prototype.processVisitors=function(t,r){var i={};0!==this._visitors.length&&(e.each(this._visitors,function(e,a){a.visit&&"function"==typeof a.visit&&!1===a.visit(t,r)&&(i[e]=!0)}),this._visitors=this._visitors.filter(function(e,t){return!i[t]}))},r.prototype.visit=function(e){return!1},r.prototype.setFormatter=function(e){this._formatter=e},r.prototype._getFormatter=function(){return null===this._formatter&&(this._formatter=new t.queryService.ui.resultBrowser.helper.FormatterHelper(this._i18n)),this._formatter},r.prototype._i18n=function(t,r,i){var a=null;return e.i18n&&(a=e.i18n.apply(e,[t].concat(i||[])))!==t?a:(a=r,i&&e.each(i,function(e,t){a=a.replace(new RegExp("\\$"+(e+1),"g"),t)}),a)},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser=function(e,t){"use strict";function r(){}return(r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._getLabelColumns=function(){var e=this,t=e._getRows()[0];return e._getColumns().filter(function(r){return e._getFormatter().isLabel(t[r])})},r.prototype._getNumberColumns=function(){var e=this,t=e._getRows();return e._getColumns().filter(function(r){return t.some(function(t){return t[r]&&e._getFormatter().isNumber(t[r])})})},r.prototype._getColumns=function(){return this._result.head.vars},r.prototype._getRows=function(){return this._result.results.bindings},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser=function(e,t,r,i,a){"use strict";function n(){}return(n.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._dataColumns=null,n.prototype._data=null,n.prototype._$element=null,n.prototype._svg=null,n.prototype._chart=null,n.prototype._chartLegend=null,n.prototype._chartSeriesKey=null,n.prototype._chartStoryKey=null,n.prototype._isStoryPaused=!1,n.prototype.draw=function(t){var r=this;this._$element=e("<div>").css({width:"100%",height:"98vh"}),t.html(this._$element),this._createData(),this._drawSvg(),this._createChart(),this._drawChart(),this._createLegendFilter(),i.onresize=function(){r._drawChart(250,!0)}},n.prototype._createData=function(){var e=[],t={},r=null;this._iterateResult(function(i,a,n){null===r&&(r=n),n!==r&&(r=n,e.push(t),t={}),i&&i.value&&(t[a]=i.value)}),e.push(t),this._data=e},n.prototype._drawSvg=function(){this._svg=a.newSvg(this._$element[0],"100%","100%")},n.prototype._createChart=function(){this._chart=new a.chart(this._svg,this._data),this._chart.setBounds(0,0,"100%","100%"),this._chart.setMargins("5%","5%","2%","25%"),this._createChartAxis();var e=this._chart.addSeries(this._chartSeriesKey,this._getPlotType());e.addOrderRule(this._chartSeriesKey),e.lineMarkers=!0,this._chartStoryKey&&this._createChartStory(),this._chartLegend=this._chart.addLegend("1%","85%","100%","15%")},n.prototype._getPlotType=function(){jQuery.error("Method _getPlotType() needs to be implemented!")},n.prototype._createChartAxis=function(){var t=this,r=this._getRows()[0],i=this._getFormatter(),a=this._chart,n=["y","x"],o=!1;e.each(this._getColumns(),function(e,s){if(0!==n.length)i.isLabel(r[s])&&(a.addCategoryAxis(n.pop(),s),o=!0),i.isNumber(r[s])&&a.addMeasureAxis(n.pop(),s),i.isDateTime(r[s])&&(a.addTimeAxis(n.pop(),s,"%Y-%m-%dT%H:%M:%SZ","%m-%d-%Y"),o=!0);else if(i.isLabel(r[s])){if(!t._chartSeriesKey)return void(t._chartSeriesKey=s);if(!t._chartStoryKey)return t._chartStoryKey=s,!1}}),o||this._chartSeriesKey||!a.axes[0]||(this._chartSeriesKey=a.axes[0].measure)},n.prototype._createChartStory=function(){var e=this,t=this._chart.setStoryboard(this._chartStoryKey);t.frameDuration=5e3,this._$element.click(function(){if(e._isStoryPaused)return t.startAnimation(),void(e._isStoryPaused=!1);t.pauseAnimation(),e._isStoryPaused=!0})},n.prototype._createLegendFilter=function(){var e=this,t=a.getUniqueValues(this._data,this._chartSeriesKey);this._chart.legends=[],this._chartLegend.shapes.selectAll("rect").on("click",function(i){var n=!1,o=[];t.forEach(function(e){e===i.aggField.slice(-1)[0]?n=!0:o.push(e)}),r.select(this).style("opacity",n?.2:.8),n||o.push(i.aggField.slice(-1)[0]),t=o,e._chart.data=a.filterData(e._data,e._chartSeriesKey,t),e._drawChart(800)})},n.prototype._drawChart=function(e,r){var i=this;this._chart.draw(e,r),t.delay(function(){i._svg.selectAll(".dimple-marker,.dimple-marker-back").attr("r",2)},1.2*e)},n.prototype.isDrawable=function(){return Object.keys(this._dataColumns).length>=2},n.prototype.visit=function(e,t){return this._checkColumn(e,t)},n.prototype._checkColumn=function(e,t){return this._getFormatter().isLabel(e)&&(this._dataColumns[t]=!0),this._getFormatter().isNumber(e)&&(this._dataColumns[t]=!0),this._getFormatter().isDateTime(e)&&(this._dataColumns[t]=!0),!this.isDrawable()},n}(jQuery,_,d3,window,dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.ImageResultBrowser=function(e,t){"use strict";function r(){this._queue=[]}return(r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._grid=null,r.prototype._loading=e("#loading-spinner"),r.prototype._heightThreshold=400,r.prototype._widthThreshold=70,r.prototype._fixedItemWidth=0,r.prototype._totalWidth=0,r.prototype._lineHeight=0,r.prototype._queue=null,r.prototype.draw=function(t){var r=this;this._queue.splice(0,this._queue.length),this._grid=e('<div class="img-grid">').html('<div class="item-row hidden-row">'),t.html(this._grid),this._lineHeight=1.5*parseFloat(this._grid.css("font-size")),this._iterateResult(function(e,t,i){e&&r._isCommonsResource(e.value)&&(i.url=e.value,r._queue.push(i))}),this._fixedItemWidth=this._calculateBaseWidth(),this._gridWidth=this._grid.width(),this._lazyLoad()},r.prototype._calculateBaseWidth=function(){var t=0,r=e('<div class="item hidden">');return this._grid.append(r),["margin-left","margin-right","padding-left","padding-right"].forEach(function(e){t+=parseFloat(r.css(e))}),r.remove(),t},r.prototype._lazyLoad=function(){var r=this;e(window).off("scroll.resultBrowser"),e(window).off("resize.resultBrowser"),this._queue.length?this._getPosFromTop()<3*window.innerHeight?(this._loading.show(),this._loadNextChunk().done(function(){r._lazyLoad.call(r)})):(e(window).on("scroll.resultBrowser",e.proxy(t.debounce(r._lazyLoad,100),r)),this._loading.hide()):(this._showFinalRow(),this._loading.hide()),e(window).on("resize.resultBrowser",e.proxy(t.debounce(this._layoutPage,100),r))},r.prototype._showFinalRow=function(t){var r=e(".item-row").last(),i=r.find(".item"),a={height:0,widths:[]};r.children().length?(a.height=this._heightThreshold,a.widths=i.map(function(){return e(this).data("aspectRatio")*(a.height-e(this).data("fixedHeight"))}).toArray(),this._setDimensions(r,a,t)):r.remove()},r.prototype._loadNextChunk=function(){var t=this,r=this._queue.splice(0,8),i=[e.when()];return r.forEach(function(r,a){var n=i[a],o=e.when(t._preloadItem(r),n);i.push(o),o.done(function(e){t._appendItem(e)})}),i[r.length]},r.prototype._getPosFromTop=function(){return e(".item-row").last().offset().top-e(window).scrollTop()},r.prototype._calculateDimensions=function(t){var r=t.find(".item"),i=this._fixedItemWidth*r.length,a=this._gridWidth-i,n=0,o=0,s={height:0,widths:[]};return r.each(function(){var t=e(this).data("aspectRatio"),r=e(this).data("fixedHeight");n+=t,o+=t*r}),s.height=(a+o)/n,s.widths=r.map(function(){var t=e(this).data("aspectRatio")*(s.height-e(this).data("fixedHeight"));return Math.trunc(100*t)/100}).toArray(),s},r.prototype._layoutPage=function(){var t=e(".item");this._gridWidth=this._grid.width(),e(".item").unwrap(),this._grid.append(e('<div class="item-row hidden-row">')),t.each(e.proxy(function(e,t){this._appendItem(t,!0)},this)),this._queue.length?e(".hidden-row").not(".hidden-row:last").removeClass("hidden-row"):(this._showFinalRow(!0),e(".hidden-row").removeClass("hidden-row"))},r.prototype._appendItem=function(t,r){var i=e(".item-row").last();i.append(t),this._layOutRow(i,r)},r.prototype._preloadItem=function(t){var r=this,i=e.Deferred(),a=this._getThumbnail(t.url,1e3),n=this._getFormatter().getCommonsResourceFileName(a),o=this._getItem(this._getThumbnail(a),this._getThumbnail(a,1e3),n,t),s=this._lineHeight*o.find(".summary")[0].childElementCount,l=o.find(".item-img");return l[0].onerror=function(){l.attr("src","https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg")},l[0].onload=function(){var e=this.naturalWidth/this.naturalHeight;i.resolveWith(r,o.data("aspectRatio",e))},o.data("fixedHeight",s),l.attr("src",a),i.promise()},r.prototype._layOutRow=function(t,r){var i=this._calculateDimensions(t);(i.height<this._heightThreshold||Math.min(i.widths)<this._widthThreshold)&&(this._setDimensions(t,i,r),this._grid.append(e('<div class="item-row hidden-row">')))},r.prototype._setDimensions=function(e,t,r){e.find(".item").width(function(e){return t.widths[e]}),r||e.removeClass("hidden-row")},r.prototype._getItem=function(t,r,i,a){var n=e("<a>").click(this._getFormatter().handleCommonResourceItem).attr({href:r,"data-gallery":"g","data-title":i}).append(e('<img class="item-img" >')),o=this._getFormatter().formatRow(a).addClass("summary");return e('<div class="item">').append(n,o)},r.prototype._isCommonsResource=function(e){return this._getFormatter().isCommonsResource(e)},r.prototype._getThumbnail=function(e,t){return this._getFormatter().getCommonsResourceFileNameThumbnail(e,t)},r.prototype.visit=function(e){return this._checkImage(e)},r.prototype._checkImage=function(e){return!(e&&e.value&&this._isCommonsResource(e.value))||(this._drawable=!0,!1)},r}(jQuery,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TableResultBrowser=function(e,t){"use strict";function r(){}var i=[10,50,100,200,500,1e3];return(r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._columns=null,r.prototype._rows=null,r.prototype._$selectedCell={},r.prototype._selectedCellHighlighted=!1,r.prototype._tableNumber=!1,r.prototype._pageLoading=!0,r.prototype._sorter={string:function(e,t){return e.localeCompare(t)},number:function(e,t){return e>=t?-1:1},generic:function(e,t){if(!t)return 1;if(!e)return-1;var r=this._getFormatter();return r.isNumber(e)&&r.isNumber(t)?this._sorter.number(Number(e.value),Number(t.value)):r.isEntityUri(e.value)&&r.isEntityUri(t.value)?this._sorter.number(Number(e.value.replace(/[^0-9]/gi,"")),Number(t.value.replace(/[^0-9]/gi,""))):this._sorter.string(e.value,t.value)}},r.prototype.draw=function(r){var i=this._result;if(void 0!==i.boolean){var a=e("<table>").attr("class","table");return a.append("<tr><td>"+i.boolean+"</td></tr>").addClass("boolean"),void r.html(a)}this.columns=i.head.vars,this.rows=i.results.bindings;var n=e("<table/>");r.html(n),this.drawBootstrapTable(n),n.children().width()>e(t).width()&&n.bootstrapTable("toggleView")},r.prototype.drawBootstrapTable=function(r){var a=this,n=this.rows.length>200;jQuery.fn.bootstrapTable.columnDefaults.formatter=function(e,t,r){return e?(a.processVisitors(e,this.field),a._getFormatter().formatValue(e).html()):""};var o={"click .explore":e.proxy(this._getFormatter().handleExploreItem,this),"click .gallery":this._getFormatter().handleCommonResourceItem};r.bootstrapTable({columns:this.columns.map(function(t){return{title:t,field:t,events:o,sortable:!0,sorter:e.proxy(a._sorter.generic,a)}}),data:this.rows,mobileResponsive:!0,search:n,pagination:n,showPaginationSwitch:n,pageSize:200,pageList:i,keyEvents:!1,cookie:!0,cookieIdTable:"1",cookieExpire:"1y",cookiesEnabled:["bs.table.pageList"],onResetView:function(i,n){void 0===t._currentTableNumber&&(t._currentTableNumber=0),t._currentTableNumber++,a._tableNumber=t._currentTableNumber,a._selectedCellHighlighted=!1,a._pageLoading=!1,a.selectFirstCell(r),e("button:focus").blur()},onClickCell:function(e,t,r,i){a._selectedCellHighlighted=!0,a.selectCell(i)}}),e(document).keydown(function(e){a.keyPressed(e)}),e("#result-browser-menu a").on("click",function(){void 0===t._currentTableNumber&&(t._currentTableNumber=0),t._currentTableNumber++})},r.prototype.selectFirstCell=function(e){var t=e.find("td").first();this.selectCell(t)},r.prototype.selectCell=function(t){!0===this._selectedCellHighlighted?t.length&&(e(".table-cell-selected").removeClass("table-cell-selected"),this._$selectedCell=t,this._$selectedCell.parent().hasClass("no-records-found")||this._$selectedCell.addClass("table-cell-selected")):this._$selectedCell=t},r.prototype.scrollToCell=function(r){var i=r.offset().top;e("html, body").scrollTop(i-t.innerHeight/3)},r.prototype.keyPressed=function(r){if(t._currentTableNumber===this._tableNumber&&!e(document.activeElement).is("textarea, input, button")&&0!==this._$selectedCell.length){if(!0!==this._selectedCellHighlighted)return"ArrowLeft"!==r.key&&"ArrowUp"!==r.key&&"ArrowRight"!==r.key&&"ArrowDown"!==r.key||(this._selectedCellHighlighted=!0,this.selectCell(this._$selectedCell),this.scrollToCell(this._$selectedCell)),void r.stopImmediatePropagation();if((r.ctrlKey||r.metaKey)&&("c"===r.key||"C"===r.key))return""!==t.getSelection().toString()?void 0:(this.copyToClipboard(this._$selectedCell),void r.stopImmediatePropagation());if(!(r.ctrlKey||r.metaKey||r.altKey)){switch(r.key){case"Enter":this._$selectedCell.find("a").each(function(){return!e(this).text().trim().length||(t.open(e(this).prop("href")),!1)});break;case"ArrowLeft":0===this._$selectedCell.prev().length?!1===this._pageLoading&&(this._pageLoading=!0,e(".page-pre a").click()):this.selectCell(this._$selectedCell.prev());break;case"ArrowUp":this._$selectedCell.parent().prev().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")").length&&(this.selectCell(this._$selectedCell.parent().prev().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")")),this.scrollToCell(this._$selectedCell));break;case"ArrowRight":0===this._$selectedCell.next().length?!1===this._pageLoading&&(this._pageLoading=!0,e(".page-next a").click()):this.selectCell(this._$selectedCell.next());break;case"ArrowDown":this._$selectedCell.parent().next().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")").length&&(this.selectCell(this._$selectedCell.parent().next().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")")),this.scrollToCell(this._$selectedCell))}r.stopImmediatePropagation()}}},r.prototype.copyToClipboard=function(t){var r=e("<input>");e("body").append(r),r.val(t.text().trim()).select(),document.execCommand("copy"),r.remove()},r.prototype.isDrawable=function(){return!0},r.prototype.visit=function(e){return!1},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.CoordinateResultBrowser=function(e,t,r,i,a,n){"use strict";var o=["http://www.opengis.net/ont/geosparql#wktLiteral","http://www.openlinksw.com/schemas/virtrdf#Geometry"],s="http://www.opengis.net/def/crs/OGC/1.3/CRS84",l=["http://www.wikidata.org/entity/Q2",s],u=["?layerLabel","?layer"],p="_LAYER_DEFAULT_GROUP",c={url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",options:{id:"wikipedia-map-01",attribution:' <a href="https://maps.wikimedia.org/">Wikimedia</a> | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},h={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},d=null;function y(){this._markerGroupColors={};var i=r.scale.category10();this._getMarkerGroupColor=function(e){return e in this._markerGroupColors?this._markerGroupColors[e]:i(e)},d=t.Control.extend({options:{position:"topright"},onAdd:function(r){var i=t.DomUtil.create("button");return e(i).addClass("btn btn-default"),e(i).append(e(' <span class="glyphicon glyphicon-chevron-up"/> ')),i.onclick=function(){r.isFullscreen()&&r.toggleFullscreen(),e(n).scrollTop(0,0)},i}})}return(y.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._map=null,y.prototype._markerGroups=null,y.prototype._markerGroupsProgress=null,y.prototype._markerGroupColors=null,y.prototype._getMarkerGroupColor=null,y.prototype.draw=function(r){var a,n=this,o=e("<div>").attr("id","map").height("100vh");function s(){clearInterval(a),e("#map-progress").remove()}function l(){s();var e=i.compact(n._markerGroups),a=n._getMarkerClusterOptions(e.length);if(a){var l=t.markerClusterGroup(a);l.addLayers(e),e=[l]}n._map=t.map("map",{center:[0,0],maxZoom:18,minZoom:2,fullscreenControl:!0,preferCanvas:!0,layers:e}).fitBounds(n._markerGroups[p].getBounds()),n._setTileLayer(),n._createControls(),n._createMarkerZoomResize(),r.html(o)}r.html(o),a=setInterval(function(){if(n._markerGroupsProgress>0&&n._markerGroupsProgress<1){var t=(100*n._markerGroupsProgress).toFixed(2),r=n._i18n("wdqs-result-map-progress","Loading map data: $1%",[t]);o.html(e("<div>").attr("id","map-progress").css({position:"relative",top:"20%",width:"100%",textAlign:"center"}).text(r))}else n._markerGroupsProgress>=1&&s()},200),this._createMarkerGroups().done(l).fail(l)},y.prototype._createControls=function(){var r=this;if(this._map.addControl(t.control.zoomBox({modal:!1,className:"glyphicon glyphicon-zoom-in"})),this._map.addControl(new d),Object.keys(this._markerGroups).length>1){var i=this._getLayerControl(this._markerGroups).addTo(this._map);this._map.on("overlayadd overlayremove",function(t){t.layer===r._markerGroups[p]&&(e.each(r._markerGroups,function(e,i){"overlayadd"===t.type?r._map.addLayer(i):r._map.removeLayer(i)}),i._update())})}},y.prototype._createMarkerZoomResize=function(){var e=this;if(!(this._markerGroups[p].getLayers().length>1e3)){this._map.on("zoomend",function(){e._markerGroups[p].setStyle({radius:e._getMarkerRadius()})})}},y.prototype._getMarkerRadius=function(){return this._map?.5*this._map.getZoom():3},y.prototype._getLayerControl=function(){var r=this,i={},a="";return e.each(this._markerGroups,function(e,t){if(e===p)a=r._i18n("wdqs-result-map-layers-all","All layers");else{var n=r._getMarkerGroupColor(e);a='<span style="color:'+n+'">&#x2b24;</span> '+e}i[a]=t}),t.control.layers(null,i)},y.prototype._createMarkerGroups=function(){var r=this,i=[],a=0,n={};function o(){if(0===Object.keys(n).length){var i=t.marker([0,0]).bindPopup("Nothing found!").openPopup();return{null:t.featureGroup([i])}}r._markerGroups={},e.each(n,function(e){r._markerGroups[e]=t.featureGroup(n[e])})}return n[p]=[],this._iterateResult(function(t,a,n){var o=r._extractGeoJson(t);null!==o&&i.push(e.when(o,n))}),e.each(i,function(e,o){o.done(function(e,o){a++,r._markerGroupsProgress=a/i.length;var s=r._getMarkerGroupsLayer(o);n[s]||(n[s]=[]);var l=t.geoJson(e,{style:r._getMarkerStyle(s,o),pointToLayer:function(e,i){return t.circleMarker(i,r._getMarkerStyle(s,o))},onEachFeature:function(e,i){var a=t.popup();i.bindPopup(a),i.on("click",function(){var e=r._getItemDescription(o);a.setContent(e[0])})}});n[s].push(l),n[p].push(l)})}),e.when.apply(e,i).done(o).fail(o)},y.prototype._getMarkerGroupsLayer=function(e){var t=this.getOptions().getColumnNames("layer",u).find(function(t){return e[t]});return t?e[t].value:p},y.prototype._getMarkerStyle=function(e,t){var r,i=this._getFormatter();return"rgb"in t&&i.isColor(t.rgb)?(r=i.getColorForHtml(t.rgb),this._markerGroupColors[e]=r):r=e!==p?this._getMarkerGroupColor(e):"#e04545",{color:r,opacity:.8,fillColor:r,fillOpacity:.9,radius:this._getMarkerRadius()}},y.prototype._getMarkerIcon=function(e){var r=e.getAllChildMarkers()[0].options,i=2*(1+r.radius),a='<div style="background-color: '+r.color+"; border-radius: 100%; width: "+i+"px; height: "+i+'px"></div>';return new t.DivIcon({html:a,className:"",iconSize:new t.Point(i,i)})},y.prototype._getMarkerClusterOptions=function(t){var r=this.getOptions().get("markercluster",1===t);return!!r&&(!0===r?{maxClusterRadius:0,iconCreateFunction:this._getMarkerIcon}:e.extend({},r))},y.prototype._splitWktLiteral=function(e){var t=e.match(/(<([^>]*)> +)?(.*)/);return t?{crs:t[2]||s,wkt:t[3]}:null},y.prototype._isWktLiteral=function(e){return e&&"literal"===e.type&&-1!==o.indexOf(e.datatype)},y.prototype._isCommonsMap=function(e){return e&&"uri"===e.type&&e.value.startsWith("http://commons.wikimedia.org/data/main/")&&e.value.endsWith(".map")},y.prototype._extractGeoJson=function(e){return this._isWktLiteral(e)?this._extractGeoJsonWktLiteral(e.value):this._isCommonsMap(e)?this._extractGeoJsonCommonsMap(e.value):null},y.prototype._extractGeoJsonWktLiteral=function(t){var r=this._splitWktLiteral(t);return r?-1===l.indexOf(r.crs)?null:e.when(a.parse(r.wkt)):null},y.prototype._extractGeoJsonCommonsMap=function(t){if(!CONFIG.showBirthdayPresents)return null;var r=t.match(/^http:\/\/commons.wikimedia.org\/data\/main\/(.*)$/)[1],i=decodeURIComponent(r);return i=i.replace(/\+/g," "),e.getJSON("https://commons.wikimedia.org/w/api.php",{format:"json",action:"query",titles:i,prop:"revisions",rvprop:"content",origin:"*",maxage:3600}).then(function(e){var t,r;for(t in e.query.pages)return r=e.query.pages[t].revisions[0]["*"],JSON.parse(r).data}).promise()},y.prototype._getItemDescription=function(t){return e("<div/>").append(this._getFormatter().formatRow(t,!0))},y.prototype._setTileLayer=function(){var e=h;("query.wikidata.org"===n.location.host||"localhost"===n.location.host||n.location.host.endsWith(".wmflabs.org"))&&(e=c),t.tileLayer(e.url,e.options).addTo(this._map)},y.prototype.visit=function(e){return this._checkCoordinate(e)},y.prototype._checkCoordinate=function(e){return!this._isWktLiteral(e)&&!this._isCommonsMap(e)||(this._drawable=!0,!1)},y}(jQuery,L,d3,_,wellknown,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeMapResultBrowser=function(e,t,r){"use strict";function i(){this._labelColumns={}}return(i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._labelColumns=null,i.prototype.draw=function(e){var t=this,r={},i=r,a=null,n=null,o=null;this._iterateResult(function(e,s,l){l!==o&&(null!==o&&(i.data={size:a,url:n},a=null,n=null,i=r),o=l),t._getFormatter().isLabel(e)&&(i[e.value]||(i[e.value]={}),i=i[e.value]),t._getFormatter().isNumber(e)&&(a=e.value),e&&e.value&&t._getFormatter().isEntityUri(e.value)&&(n=e.value)}),i.data={size:a,url:n};var s={name:"treeMap",children:this._createTreeData(r)};this._draw(e,s)},i.prototype._createTreeData=function(t){var r,i=this,a=[];return t.data?a:(e.each(t,function(e,t){var n=i._createTreeData(t);if(0!==n.length)r={id:e,name:e,children:n};else{var o=1;t.data.size&&t.data.size>0&&(o=t.data.size);var s=e,l=t.data.url;l&&(s=l),r={id:s+Math.random(),name:e,size:o,url:l}}a.push(r)}),a)},i.prototype._draw=function(i,a){var n,o,s=!1,l=e(r).width(),u=e(r).height(),p=t.scale.linear().range([0,l]),c=t.scale.linear().range([0,u]),h=t.scale.category10(),d=20,y="#555555",w=500,g=t.layout.treemap().round(!1).size([l,u]).sticky(!0).value(function(e){return e.size}),f=t.select(i[0]).append("svg:svg").attr("width",l).attr("height",u).append("svg:g");o=n=a;var m=g.nodes(n),b=m.filter(function(e){return!e.children}),_=m.filter(function(e){return e.children}),v=f.selectAll("g.cell.parent").data(_,function(e){return"p-"+e.id}),k=v.enter().append("g").attr("class","cell parent").on("click",function(e){x(e)});k.append("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",d).style("fill",y),k.append("foreignObject").attr("class","foreignObject").append("xhtml:body").attr("class","labelbody").append("div").attr("class","label");var S=v.transition().duration(w);S.select(".cell").attr("transform",function(e){return"translate("+e.dx+","+e.y+")"}),S.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",d).style("fill",y),S.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",d).select(".labelbody .label").text(function(e){return e.name}),v.exit().remove();var q=f.selectAll("g.cell.child").data(b,function(e){return"c-"+e.id}),E=q.enter().append("g").attr("class","cell child").on("click",function(e){x(o===e.parent?n:e.parent)});E.append("rect").classed("background",!0).style("fill",function(e){return h(e.parent.name)}),E.append("foreignObject").attr({class:"foreignObject",width:function(e){return Math.max(.01,e.dx)},height:function(e){return Math.max(.01,e.dy)}}).append("xhtml:body").attr("class","labelbody").append("div").attr("class","label").text(function(e){return e.name}).on("click",function(e){e.url&&(r.open(e.url,"_blank"),t.event.stopPropagation())});var T=q.transition().duration(w);function R(e){return e.size}function L(e){return 1}function C(e){var t,r,i,a,n=(r=(t=e).substring(1,3),i=t.substring(3,5),a=t.substring(5,7),{R:parseInt(r,16),G:parseInt(i,16),B:parseInt(a,16)});return 255-(.299*n.R+.587*n.G+.114*n.B)<105?"#000000":"#ffffff"}function x(e){g.padding([d/(u/e.dy),0,0,0]).nodes(e);var r=l/e.dx,i=u/e.dy,a=e;p.domain([e.x,e.x+e.dx]),c.domain([e.y,e.y+e.dy]),f.selectAll(".labelbody .label").style("display","block");var n=f.selectAll("g.cell").transition().duration(w).attr("transform",function(e){return"translate("+p(e.x)+","+c(e.y)+")"}).each("end",function(e,t){t||a===self.root||(f.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("color",function(e){return C(h(e.parent.name))}),s?f.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject").style("display",""):f.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("display",""))});n.select(".foreignObject").attr("width",function(e){return Math.max(.01,r*e.dx)}).attr("height",function(e){return e.children?d:Math.max(.01,i*e.dy)}).select(".labelbody .label").text(function(e){return e.name}),n.select("rect").attr("width",function(e){return Math.max(.01,r*e.dx)}).attr("height",function(e){return e.children?d:Math.max(.01,i*e.dy)}).style("fill",function(e){return e.children?y:h(e.parent.name)}),o=e,t.event&&t.event.stopPropagation()}T.select(".cell").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),T.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return e.dy}).style("fill",function(e){return h(e.parent.name)}),T.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return Math.max(.01,e.dy)}).select(".labelbody .label").text(function(e){return e.name}),q.exit().remove(),t.select("select").on("change",function(){console.log("select zoom(node)"),g.value("size"==value?R:L).nodes(n),x(o)}),x(o)},i.prototype.isDrawable=function(){return Object.keys(this._labelColumns).length>1},i.prototype.visit=function(e,t){return this._checkColumn(e,t)},i.prototype._checkColumn=function(e,t){return!this._getFormatter().isLabel(e,t)||(this._labelColumns[t]=!0,!this.isDrawable())},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeResultBrowser=function(e,t,r){"use strict";var i='SELECT ?property ?propertyLabel ?value ?valueItemLabel ?valueImage WHERE {       {         SELECT ?property ?value ?valueImage ?valueItem WHERE {           BIND(<{ENTITY_URI}> AS ?item)           ?item ?prop ?value.           ?property wikibase:directClaim ?prop.           ?property rdf:type wikibase:Property.           OPTIONAL { ?value wdt:P18 ?valueImage. }           OPTIONAL { BIND(?value AS ?valueItem).  FILTER(STRSTARTS(STR(?value), STR(wd:))) }         }       }       SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }    }  ';function a(){this._labelColumns={}}return(a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._isDrawable=!1,a.prototype._jsTree=null,a.prototype._nodes=null,a.prototype.draw=function(i){var a=this;this._nodes=this._extractNodes(e.proxy(this._iterateResult,this));var n=e("<div>").jstree({core:{data:t.compact(a._nodes),check_callback:!0},plugins:["types","wholerow","contextmenu","unique"],types:{default:{icon:"glyphicon glyphicon-barcode"}},contextmenu:{items:function(e){return{Open:{label:a._nodes[e.id].url,icon:"glyphicon glyphicon-link",action:function(){r.open(a._nodes[e.id].url,"_blank")}},explore:{label:a._nodes[e.id].url,icon:"glyphicon glyphicon-download-alt",action:function(){a._expandTree(a._nodes[e.id])}}}}}});this._jsTree=n.jstree(),i.empty().append(n)},a.prototype._extractNodes=function(e,t){var r=null,i={},a=null,n={},o=this._getFormatter();return e(function(e,s,l){l!==r&&(a=null,r=l),e&&e.value&&(a&&(o.isLabel(e)||o.isNumber(e))&&(n[a].text=(n[a].text||"")+" "+e.value),a&&o.isCommonsResource(e.value)&&(n[a].icon=o.getCommonsResourceFileNameThumbnail(e.value,24)),o.isEntity(e)&&((i={}).parent=a||t||"#",i.id=i.parent+e.value,i.url=e.value,i.state={opened:!1},n[i.id]=i,a=i.id))}),n},a.prototype._expandTree=function(t){var r=this;this.getSparqlApi().query(i.replace("{ENTITY_URI}",t.url)).done(function(){var i=r.getSparqlApi().getResultRawData(),a=r._extractNodes(function(t){e.each(i.results.bindings,function(r,a){e.each(i.head.vars,function(e,i){var n=a[i]||null;t(n,i,a,r)})})},t.id);e.extend(r._nodes,a),e.each(a,function(e,t){r._jsTree.create_node(t.parent,t)})})},a.prototype.isDrawable=function(){return this._isDrawable},a.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||(this._isDrawable=!0,!1)},a}(jQuery,_,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.BubbleChartResultBrowser=function(e,t,r){"use strict";function i(){}return(i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._hasLabel=!1,i.prototype._hasNumber=!1,i.prototype.draw=function(t){var r=this,i={name:"bubblechart",children:[]},a=this._getLabelColumns()[0],n=this._getNumberColumns()[0],o=null;this._iterateResult(function(e,t,s){if(s!==o){var l={url:null};o=s,s.rgb&&r._getFormatter().isColor(s.rgb)&&(l.color=r._getFormatter().getColorForHtml(s.rgb)),s[a]&&s[n]&&(l.name=s[a].value,l.size=s[n].value,i.children.push(l))}if(e&&e.value&&r._getFormatter().isEntityUri(e.value)){var u=i.children[i.children.length-1];u&&null===u.url&&(u.url=e.value)}});var s=e("<center>");t.html(s),this._drawBubbleChart(s,i)},i.prototype._drawBubbleChart=function(i,a){var n=this;var o,s,l=Math.min(.98*e(r).height(),e(r).width()),u=t.scale.category20c(),p=t.layout.pack().sort(null).size([l,l]).padding(1.5),c=t.select(i[0]).append("svg").attr({class:"bubble",width:l,height:l}).selectAll(".node").data(p.nodes((o=a,s=[],function e(t,r){r.children?r.children.forEach(function(t){e(r.name,t)}):s.push({packageName:t,className:r.name,value:r.size,url:r.url,color:r.color})}(null,o),{children:s})).filter(function(e){return!e.children})).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});c.append("title").text(function(e){return e.className+": "+e.value}),c.append("circle").attr("r",function(e){return e.r}).style("fill",function(e){return e.color||u(e.className)}),c.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(e){return e.className.substring(0,e.r/4)}).on("click",function(e){e.url&&r.open(e.url,"_blank")}).style("fill",function(e){if(e.color)return n._getFormatter().calculateLuminance(e.color)<=.5?"#FFF":"#000"}).style("cursor","pointer")},i.prototype.isDrawable=function(){return this._hasLabel&&this._hasNumber},i.prototype.visit=function(e){return this._checkColumn(e)},i.prototype._checkColumn=function(e){return this._getFormatter().isNumber(e)&&(this._hasNumber=!0),this._getFormatter().isLabel(e)&&(this._hasLabel=!0),!this.isDrawable()},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.LineChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.line},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.BarChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.bar},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.ScatterChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.scatter},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AreaChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.area},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TimelineResultBrowser=function(e,t,r,i){"use strict";var a={minHeight:"400px",orientation:{axis:"both",item:"top"},align:"auto",zoomKey:"ctrlKey"};function n(){}return(n.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(r){var i=e("<div>"),n=new t.Timeline(i[0],this._getItems(),a);n.on("changed",function(){e(n.dom.root).find(".vis-item.vis-range").each(function(){var t=e(this);t.css("min-width","unset"),t.css("min-width",t.css("width"))})}),r.append(i.prepend(this._createToolbar(n)))},n.prototype._getItems=function(){var e=this,r=[];return this._iterateResult(function(t,i,a,n){if(e._getFormatter().isDateTime(t))if(r[n]){var o=[];o.push(e._getFormatter().parseDate(t.value)),r[n].start&&o.push(r[n].start),r[n].end&&o.push(r[n].end),r[n].start=o.reduce(function(e,t){return e<t?e:t}),r[n].end=o.reduce(function(e,t){return e>t?e:t})}else r[n]={id:n,content:e._getHtml(a).html(),start:e._getFormatter().parseDate(t.value)}}),new t.DataSet(i.compact(r))},n.prototype._getHtml=function(t){return e("<div/>").append(this._getFormatter().formatRow(t,!0))},n.prototype._createToolbar=function(t){var r=e('<div style="margin-top: -35px; text-align: center;">');function i(e){var r=t.getWindow(),i=r.end-r.start;t.setWindow({start:r.start.valueOf()-i*e,end:r.end.valueOf()+i*e})}return e('<a class="btn btn-default">').click(e.proxy(t.redraw,t)).append('<span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>').appendTo(r),e('<a class="btn btn-default">').click(e.proxy(t.fit,t)).append('<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>').appendTo(r),e('<a class="btn btn-default">').click(function(){i(.2)}).append('<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>').appendTo(r),e('<a class="btn btn-default">').click(function(){i(-.2)}).append('<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>').appendTo(r),r},n.prototype.visit=function(e){return!this._getFormatter().isDateTime(e)||(this._drawable=!0,!1)},n}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.MultiDimensionResultBrowser=function(e,t,r){"use strict";var i="http://www.w3.org/2001/XMLSchema#dateTime";function a(){}return(a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser).draw=function(e){var t={},r=[],a=this._getFormatter();this._iterateResult(function(e,n,o,s){if(r[s]||(r[s]={}),r[s][n]=e&&e.value||"undefined",e&&e.type===i&&(r[s][n]=new Date(e.value).toLocaleDateString()),!t[n]){var l={key:n,description:n,type:"STRING"};a.isNumber(e)&&(l.type="NUMBER"),e&&e.type===i&&(l.type="DATE"),t[n]=l}}),this._draw(e,r,_.values(t)),e.children("svg").css({display:"block"})},a.prototype._draw=function(i,a,n){var o=50,s=80,l=10,u=100,p=e(r).width()-(u+s),c=e(r).height()-(o+l),h={NUMBER:{key:"Number",coerce:function(e){return+e},extent:t.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:t.scale.linear().range([c,0])},STRING:{key:"String",coerce:String,extent:function(e){return e.sort()},within:function(e,t,r){return t[0]<=r.scale(e)&&r.scale(e)<=t[1]},defaultScale:t.scale.ordinal().rangePoints([0,c])},DATE:{key:"Date",coerce:function(e){return new Date(e)},extent:t.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:t.time.scale().range([0,c])}};e.each(n,function(){this.type=h[this.type]});var d=t.scale.ordinal().domain(n.map(function(e){return e.key})).rangePoints([0,p]),y=t.svg.line().defined(function(e){return!isNaN(e[1])}),w=t.svg.axis().orient("left"),g=t.select(i[0]).append("svg").attr({width:p+u+s,height:c+o+l}).append("g").attr("transform","translate("+u+","+o+")"),f=g.append("g").attr("class","foreground"),m=g.selectAll(".axis").data(n).enter().append("g").attr("class","axis").attr("transform",function(e){return"translate("+d(e.key)+")"});function b(){t.event.sourceEvent.stopPropagation()}function _(){var e=n.filter(function(e){return!e.brush.empty()}),r=e.map(function(e){return e.brush.extent()});t.selectAll(".foreground path").style("display",function(t){return e.every(function(e,i){return e.type.within(t[e.key],r[i],e)})?null:"none"})}a.forEach(function(e){n.forEach(function(t){e[t.key]=t.type.coerce(e[t.key])})}),n.forEach(function(e){"domain"in e||(e.domain=t.functor(e.type.extent)(a.map(function(t){return t[e.key]})),e.domain.sort(function(e,t){return e-t})),"scale"in e||(e.scale=e.type.defaultScale.copy()),e.scale.domain(e.domain)}),f.selectAll("path").data(a).enter().append("path").attr("d",function(e){return y(n.map(function(t){return[d(t.key),t.scale(e[t.key])]}))}).style("stroke",function(e){return"#6ac"}),m.append("g").attr("class","axis").each(function(e){var r=e.axis&&e.axis.scale(e.scale)||w.scale(e.scale);t.select(this).call(r)}).append("text").attr("class","title").attr("text-anchor","start").text(function(e){return e.description||e.key}),m.append("g").attr("class","brush").each(function(e){t.select(this).call(e.brush=t.svg.brush().y(e.scale).on("brushstart",b).on("brush",_))}).selectAll("rect").attr("x",-8).attr("width",16)},a.prototype.isDrawable=function(){return this._drawable},a.prototype.visit=function(e){return this._drawable=!0,!1},a}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowser=function(e,t,r,i){"use strict";var a={autoResize:!0,physics:{stabilization:{enabled:!0,iterations:10,fit:!0},barnesHut:{springLength:150,centralGravity:.5,damping:.2,avoidOverlap:.1}},nodes:{shadow:!0,color:"#fff"},edges:{arrows:{to:!0}}};function n(){}return(n.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(i){var n=e("<div>").height("100vh"),o=this._getData(),s=new t.Network(n[0],o,a);s.on("doubleClick",function(e){1===e.nodes.length&&r.open(e.nodes[0],"_blank")});var l=new wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser(o.nodes,o.edges,this.getSparqlApi());s.on("click",function(e){var t=e.nodes[0]||null;l.browse(t)}),n.prepend(this._createToolbar(s)),i.append(n)},n.prototype._createToolbar=function(t){var r=e('<div style="margin-top: -35px; text-align: center;">');function i(e){t.setOptions({layout:{hierarchical:{direction:e,sortMethod:"directed"}}})}return e('<a class="btn btn-default">').click(function(){t.stabilize(100)}).append('<span class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-stabilize")+'"></span>').appendTo(r),e('<a class="btn btn-default">').click(function(){i("LR")}).append('<span class="glyphicon glyphicon-indent-left" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-lr")+'"></span>').appendTo(r),e('<a class="btn btn-default">').click(function(){i("UD")}).append('<span class="glyphicon glyphicon-align-center" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-ud")+'"></span>').appendTo(r),e('<a class="btn btn-default">').click(function(){i("RL")}).append('<span class="glyphicon glyphicon-indent-right" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-rl")+'"></span>').appendTo(r),r},n.prototype._getData=function(){var e={},r={},a=[],n=this._getFormatter(),o={},s={};return this._iterateResult(function(t,i,l,u){if(t&&t.value){if(n.isEntity(t)){var p=l[i+"Label"]&&l[i+"Label"].value||t.value,c=t.value;o={id:c,label:p,title:p},a[u]?(s={from:a[u],to:c},r[s.from+s.to]=s,e[c]||(e[c]=o)):(e[c]=o,a[u]=o.id)}if(n.isCommonsResource(t.value)&&(o.image=n.getCommonsResourceFileNameThumbnail(t.value,150),o.shape="image",o.font={color:"black"}),n.isNumber(t)&&(o.value=t.value,o.title+=" value:"+t.value,o.shape="dot",o.font={color:"black"}),"rgb"===i&&n.isColor(t)&&(o.color=n.getColorForHtml(t),"dot"!==o.shape&&"image"!==o.shape)){var h=n.calculateLuminance(t.value)<=.5?"#FFF":"#000";o.font={color:h}}"edgeLabel"===i&&(s.label=t.value)}}),{nodes:new t.DataSet(i.compact(e)),edges:new t.DataSet(i.compact(r))}},n.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||(this._drawable=!0,!1)},n}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser=function(e,t,r,i){"use strict";var a='SELECT ?p (SAMPLE(?pl) AS ?pl) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol)  WHERE {<{entityUri}> ?p ?o .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p',n='SELECT ?o ?ol WHERE {<{entityUri}> <{propertyUri}> ?o .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50';function o(e,t,r){this._nodes=e,this._edges=t,this._sparql=r}return o.prototype._nodes=null,o.prototype._nodes=null,o.prototype._sparql=null,o.prototype._selectedNodeId=null,o.prototype._temporaryNodes={},o.prototype._temporaryEdges={},o.prototype._getEntites=function(t,r){var i=this,a=e.Deferred();return this._sparql.query(n.replace("{entityUri}",t).replace("{propertyUri}",r)).done(function(){var t=i._sparql.getResultRawData(),r=[];e.each(t.results.bindings,function(e,t){r.push({id:t.o.value,label:t.ol.value})}),a.resolve(r)}),a},o.prototype._getProperties=function(t){var r=this,i=e.Deferred();return this._sparql.query(a.replace("{entityUri}",t)).done(function(){var t=r._sparql.getResultRawData(),a=[];e.each(t.results.bindings,function(e,t){a.push({id:t.p.value,label:t.pl.value,count:t.count.value,items:t.ol.value})}),i.resolve(a)}),i},o.prototype._removeTemporaryNodes=function(t){var r=this;e.each(this._temporaryNodes,function(e,t){r._nodes.remove(t.id)}),e.each(this._temporaryEdges,function(e,t){r._edges.remove(t.id)}),this._temporaryNodes={},this._temporaryEdges={}},o.prototype._expandPropertyNode=function(t){var r=this,i=this._temporaryNodes[t];this._getEntites(i.entityId,i.id).done(function(t){e.each(t,function(e,t){null===r._nodes.get(t.id)&&r._nodes.add({id:t.id,label:t.label}),r._edges.add({dashes:!0,from:i.entityId,to:t.id,label:i.propertyLabel,linkType:i.id})})})},o.prototype._expandEntityNode=function(t){var r=this;this._getProperties(t).done(function(i){e.each(i,function(e,i){if(!(r._edges.get({filter:function(e){return e.linkType===i.id&&e.from===t}}).length>0)){var a={id:i.id,label:"1"===i.count?i.items:i.count,title:i.items,entityId:t,propertyLabel:i.label,color:"#abc9f2"},n={id:i.id,dashes:!0,label:i.label,from:t,to:i.id};r._temporaryNodes[a.id]=a,r._nodes.add(a),r._temporaryEdges[n.id]=n,r._edges.add(n)}})})},o.prototype.browse=function(e){if(null!==e){if(this._temporaryNodes[e])return this._expandPropertyNode(e),void this._removeTemporaryNodes();null!==this._selectedNodeId&&e!==this._selectedNodeId&&this._removeTemporaryNodes(),this._expandEntityNode(e),this._selectedNodeId=e}else this._removeTemporaryNodes()},o}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.PolestarResultBrowser=function(e,t,r){"use strict";function i(){}return(i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(r){var i={url:"wikidatasparql://query.wikidata.org/?query="+location.hash.substr(1),name:"Imported from Wikidata Query Service",_directEmbed:!0},a=e("<iframe>").attr({src:"polestar/embed.html#"+encodeURIComponent(JSON.stringify(i)),class:"graph-iframe"}).height("98vh");r.append(a),t.setTimeout(function(){a.scrollIntoView()},50)},i.prototype.visit=function(e){return this._drawable=!0,!1},i}(jQuery,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Sparql=function(e){"use strict";var t="https://query.wikidata.org/bigdata/namespace/wdq/sparql",r={TIMEOUT:10,MALFORMED:20,SERVER:30,UNKNOWN:100},i={"QueryTimeoutException: Query deadline is expired":r.TIMEOUT,"java.util.concurrent.TimeoutException":r.TIMEOUT,"MalformedQueryException: ":r.MALFORMED},a="en";function n(e,r){this._serviceUri=e||t,this._language=r||a}return n.prototype.ERROR_CODES=r,n.prototype._serviceUri=null,n.prototype._executionTime=null,n.prototype._error=null,n.prototype._resultLength=null,n.prototype._rawData=null,n.prototype._queryUri=null,n.prototype._language=null,n.prototype.queryDataUpdatedTime=function(){var t=e.Deferred(),r=encodeURI("prefix schema: <http://schema.org/> SELECT * WHERE {<http://www.wikidata.org> schema:dateModified ?y}"),i=this._serviceUri+"?query="+r+"&nocache="+Math.floor(Date.now()/6e4);return e.ajax(i,{headers:{Accept:"application/sparql-results+json"}}).done(function(e,r,i){if(e.results.bindings[0]){var a=new Date(e.results.bindings[0][e.head.vars[0]].value),n=a.toLocaleTimeString(navigator.language,{timeZoneName:"short"})+", "+a.toLocaleDateString(navigator.language,{month:"short",day:"numeric",year:"numeric"}),o=Math.round((new Date-a)/1e3);t.resolve(n,o)}else t.reject()}).fail(function(){t.reject()}),t},n.prototype.query=function(t,r){t=this._replaceAutoLanguage(t);var i="query="+encodeURIComponent(t);r&&(i+="&maxQueryTimeMillis="+r);var a=this,n=e.Deferred(),o={headers:{Accept:"application/sparql-results+json"},data:i};function s(e,t,r){a._executionTime=Date.now()-a._executionTime,"boolean"==typeof e.boolean?a._resultLength=1:a._resultLength=e.results.bindings.length||0,a._rawData=e,n.resolve(e)}function l(e,t,r){a._executionTime=null,a._rawData=null,a._resultLength=null,a._generateErrorMessage(e,t,r),n.reject()}return this._queryUri=this._serviceUri+"?"+o.data,this._executionTime=Date.now(),e.ajax(this._serviceUri,o).done(s).fail(function(t,r,i){""===t.getAllResponseHeaders()?(o.method="POST",e.ajax(a._serviceUri,o).done(s).fail(l)):l.apply(this,arguments)}),n},n.prototype._generateErrorMessage=function(e,t,a){var n={code:r.UNKNOWN,message:null,debug:e.responseText};(0===e.status||a)&&(n.code=r.SERVER,n.message=a.message);try{var o=n.debug.substring(n.debug.indexOf("java.util.concurrent.ExecutionException:"));for(var s in i)-1!==o.indexOf(s)&&(n.code=i[s],n.message=null);n.code!==r.UNKNOWN&&n.code!==r.MALFORMED||(n.message=n.debug.match(/(java\.util\.concurrent\.ExecutionException\:)+(.*)(Exception\:)+(.*)/).pop().trim())}catch(e){}this._error=n},n.prototype.getExecutionTime=function(){return this._executionTime},n.prototype.getError=function(){return this._error},n.prototype.getResultLength=function(){return this._resultLength},n.prototype.getQueryUri=function(){return this._queryUri},n.prototype._processData=function(e,t,r){for(var i=e.results.bindings.length,a=0;a<i;a++){for(var n={},o=0;o<e.head.vars.length;o++)e.head.vars[o]in e.results.bindings[a]?n[e.head.vars[o]]=e.results.bindings[a][e.head.vars[o]]:n[e.head.vars[o]]=void 0;r=t(n,r)}return r},n.prototype._encodeCsv=function(e){var t=e.replace(/"/g,'""');return/[",\n]/.test(t)&&(t='"'+t+'"'),t},n.prototype.getResultRawData=function(){return this._rawData},n.prototype.getResultAsCsv=function(){var e=this,t=e._rawData,r=t.head.vars.map(this._encodeCsv).join(",")+"\n";return r=this._processData(t,function(t,r){var i="",a=!0;for(var n in t)a?a=!1:i+=",",i+=void 0===t[n]?"":e._encodeCsv(t[n].value);return r+(i+="\n")},r)},n.prototype.getResultHTML=function(){var t=this._rawData,r=e("<html>"),i=e("<head>").append(e("<meta>").attr("charset","utf-8"));r.append(i);var a=[],n=e("<table>"),o=e("<tr>");t.head.vars.forEach(function(e){o.append("<th>"+e+"</th>"),a.push(e)}),n.append(o),t.results.bindings.forEach(function(t){for(var r in o=e("<tr>"),a)if(t[a[r]]){var i=t[a[r]].value.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;");o.append("<td>"+i+"</td>")}n.append(o)});var s=e("<body>").append(n);return r.append(s),r.prop("outerHTML")},n.prototype.getResultAsJson=function(){var e=[],t=this._rawData;return e=this._processData(t,function(e,t){var r={};for(var i in e)r[i]=(e[i]||{}).value;return t.push(r),t},e),JSON.stringify(e)},n.prototype.getResultAsAllJson=function(){return JSON.stringify(this._rawData)},n.prototype._renderValueTSV=function(e){var t=e.value.replace(/\t/g,"");switch(e.type){case"uri":return"<"+t+">";case"bnode":return"_:"+t;case"literal":var r=JSON.stringify(t);return e["xml:lang"]?r+"@"+e["xml:lang"]:e.datatype?"http://www.w3.org/2001/XMLSchema#integer"===e.datatype||"http://www.w3.org/2001/XMLSchema#decimal"===e.datatype||"http://www.w3.org/2001/XMLSchema#double"===e.datatype?t:r+"^^<"+e.datatype+">":r}return t},n.prototype.getSparqlTsv=function(){var e=this,t=this._rawData,r=t.head.vars.map(function(e){return"?"+e}).join("\t")+"\n";return r=this._processData(t,function(t,r){var i="",a=!0;for(var n in t)a?a=!1:i+="\t",i+=void 0===t[n]?"":e._renderValueTSV(t[n]);return r+(i+="\n")},r)},n.prototype.getSimpleTsv=function(){var e=this._rawData,t=e.head.vars.join("\t")+"\n";return t=this._processData(e,function(e,t){var r="",i=!0;for(var a in e)i?i=!1:r+="\t",r+=void 0===e[a]?"":e[a].value.replace(/\t/g,"");return t+(r+="\n")},t)},n.prototype._replaceAutoLanguage=function(e){return e.replace(/\[AUTO_LANGUAGE\]/g,this._language)},n.prototype.setLanguage=function(e){this._language=e},n}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Wikibase=function(e){"use strict";var t="https://www.wikidata.org/w/api.php",r="en",i={action:"wbsearchentities",format:"json",limit:50,continue:0,language:r,uselang:r},a={action:"query",meta:"siteinfo",format:"json",siprop:"languages"},n={action:"wbgetentities",props:"labels",format:"json",languages:r,languagefallback:"1"},o={action:"wbgetentities",props:"datatype",format:"json"};function s(e,r){this._endpoint=t,e&&(this._endpoint=e),r&&(this._language=r)}return s.prototype._endpoint=null,s.prototype._language=null,s.prototype.searchEntities=function(e,t,a){var n=i;return n.search=e,t&&(n.type=t),this._language||a?(n.language=a||this._language,n.uselang=a||this._language):(n.language=r,n.uselang=r),this._query(n)},s.prototype.getLanguages=function(){return this._query(a)},s.prototype.getLabels=function(e){"string"==typeof e&&(e=[e]);var t=n;return t.ids=e.join("|"),this._language&&(t.languages=this._language),this._query(t)},s.prototype.getDataType=function(t){var r=o,i=e.Deferred();return r.ids=t,this._query(r).done(function(e){e.entities&&e.entities[t]&&e.entities[t].datatype&&i.resolve(e.entities[t].datatype),i.reject()}).fail(i.reject),i.promise()},s.prototype._query=function(t){return e.ajax({url:this._endpoint+"?"+jQuery.param(t),dataType:"jsonp"})},s.prototype.setLanguage=function(e){this._language=e},s}(jQuery);var wikibase,tracking=tracking||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Tracking=function(e){"use strict";var t="https://www.wikidata.org/beacon/statsv";function r(e){this._endpoint=t,e&&(this._endpoint=e)}return r.prototype._endpoint=null,r.prototype.track=function(t,r,i){return r||(r=1),i||(i="c"),"query.wikidata.org"!==location.hostname||/^1|yes/.test(navigator.doNotTrack||window.doNotTrack)?e.when():this._track(t+"="+r+i)},r.prototype._track=function(t){return e.ajax({url:this._endpoint+"?"+t,dataType:"jsonp"})},r}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.RdfNamespaces={},function(e,t){"use strict";t.NAMESPACE_SHORTCUTS={Wikidata:{wikibase:"http://wikiba.se/ontology#",wd:"http://www.wikidata.org/entity/",wdt:"http://www.wikidata.org/prop/direct/",wds:"http://www.wikidata.org/entity/statement/",p:"http://www.wikidata.org/prop/",wdref:"http://www.wikidata.org/reference/",wdv:"http://www.wikidata.org/value/",ps:"http://www.wikidata.org/prop/statement/",psv:"http://www.wikidata.org/prop/statement/value/",psn:"http://www.wikidata.org/prop/statement/value-normalized/",pq:"http://www.wikidata.org/prop/qualifier/",pqv:"http://www.wikidata.org/prop/qualifier/value/",pqn:"http://www.wikidata.org/prop/qualifier/value-normalized/",pr:"http://www.wikidata.org/prop/reference/",prv:"http://www.wikidata.org/prop/reference/value/",prn:"http://www.wikidata.org/prop/reference/value-normalized/",wdno:"http://www.wikidata.org/prop/novalue/",wdata:"http://www.wikidata.org/wiki/Special:EntityData/"},W3C:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",owl:"http://www.w3.org/2002/07/owl#",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",prov:"http://www.w3.org/ns/prov#"},"Social/Other":{schema:"http://schema.org/",geo:"http://www.opengis.net/ont/geosparql#",geof:"http://www.opengis.net/def/geosparql/function/"},Blazegraph:{bd:"http://www.bigdata.com/rdf#",bds:"http://www.bigdata.com/rdf/search#",gas:"http://www.bigdata.com/rdf/gas#",hint:"http://www.bigdata.com/queryHints#"}},t.ENTITY_TYPES={"http://www.wikidata.org/prop/direct/":"property","http://www.wikidata.org/prop/":"property","http://www.wikidata.org/prop/novalue/":"property","http://www.wikidata.org/prop/statement/":"property","http://www.wikidata.org/prop/statement/value/":"property","http://www.wikidata.org/prop/statement/value-normalized/":"property","http://www.wikidata.org/prop/qualifier/":"property","http://www.wikidata.org/prop/qualifier/value/":"property","http://www.wikidata.org/prop/qualifier/value-normalized/":"property","http://www.wikidata.org/prop/reference/":"property","http://www.wikidata.org/prop/reference/value/":"property","http://www.wikidata.org/prop/reference/value-normalized/":"property","http://www.wikidata.org/wiki/Special:EntityData/":"item","http://www.wikidata.org/entity/":"item"},t.ALL_PREFIXES=e.map(t.NAMESPACE_SHORTCUTS,function(e){return e}).reduce(function(t,r,i){return e.extend(t,r)},{}),t.STANDARD_PREFIXES={wd:"PREFIX wd: <http://www.wikidata.org/entity/>",wdt:"PREFIX wdt: <http://www.wikidata.org/prop/direct/>",wikibase:"PREFIX wikibase: <http://wikiba.se/ontology#>",p:"PREFIX p: <http://www.wikidata.org/prop/>",ps:"PREFIX ps: <http://www.wikidata.org/prop/statement/>",pq:"PREFIX pq: <http://www.wikidata.org/prop/qualifier/>",rdfs:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>",bd:"PREFIX bd: <http://www.bigdata.com/rdf#>"},t.getPrefixMap=function(r){var i={};return e.each(t.ALL_PREFIXES,function(e,t){r[t]&&(i[e]=r[t])}),i}}(jQuery,wikibase.queryService.RdfNamespaces),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryHelper=function(e,t,r){"use strict";var i={"http://www.w3.org/2000/01/rdf-schema#label":!0,"http://schema.org/description":!0,"http://www.bigdata.com/queryHints#optimizer":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},a="wdqs-ve-",n={formatNoMatches:function(){}};function o(e,r,i){this._api=e||new t.queryService.api.Wikibase,this._selectorBox=i||new t.queryService.ui.queryHelper.SelectorBox(this._api,r),this._query=new t.queryService.ui.queryHelper.SparqlQuery}return o.prototype._api=null,o.prototype._selectorBox=null,o.prototype._changeListener=null,o.prototype._query=null,o.prototype._triples=[],o.prototype._isSimpleMode=!1,o.prototype._labels={filter:"Filter",show:"Show",anything:"anything",with:"with",any:"any",or:"or",subtype:"subtype",limit:"Limit"},o.prototype.setQuery=function(e){var r=t.queryService.RdfNamespaces.ALL_PREFIXES;this._query.parse(e,r),this._selectorBox.setQuery(this._query)},o.prototype.getQuery=function(){try{var e=this._query.getQueryString();return(e=this._cleanQueryPrefixes(e).trim()).trim()}catch(e){return null}},o.prototype._cleanQueryPrefixes=function(e){for(var r,i=/PREFIX ([a-z]+): <(.*)>/gi,a={},n=e.replace(i,"").replace(/\n+/g,"\n");r=i.exec(e);){var o=r[1],s=r[2].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),l=n.replace(new RegExp("<"+s+"([^/>#]+?)>","gi"),o+":$1");n!==l&&(n=l,t.queryService.RdfNamespaces.STANDARD_PREFIXES[o]||(a[r[0]]=!0))}return n=Object.keys(a).join("\n")+"\n\n"+n.trim()},o.prototype.draw=function(e){var r=t.queryService.ui.queryHelper.QueryTemplate.parse(this._query),i=this,a=this._query.getBindings();if(null!==r)try{return e.html(r.getHtml(function(e){return i._getLabel(a[e].expression)},this._selectorBox,function(e,t,r){a[e].expression=a[e].expression.replace(new RegExp(t+"$"),"")+r,i._changeListener&&i._changeListener(i)}))}catch(e){window.console.error(e)}this._triples=this._query.getTriples();for(var n=this._query.getSubQueries();n.length>0;){var o=n.pop();this._triples=this._triples.concat(o.getTriples()),n.concat(o.getSubQueries())}this._isSimpleMode=this._isSimpleQuery(),e.html(this._getHtml())},o.prototype.setChangeListener=function(e){this._changeListener=e},o.prototype._i18n=function(t){return e.i18n?e.i18n(a+t):this._labels[t]},o.prototype._i18nSpan=function(t){return e("<span>").attr("data-i18n",a+t).text(this._i18n(t))},o.prototype._getHtml=function(){var t=this,r=e("<div>"),i=e("<table>").bootstrapTable(n),a=e("<table>").bootstrapTable(n);return e.each(this._triples,function(e,r){t._isNotRelevant(r.triple)||(t._isInShowSection(r.triple)?a.append(t._getTripleHtml(r)):i.append(t._getTripleHtml(r)))}),r.append(this._createSection(i,this._createFindButton(i)),this._createSection(a,this._createShowButton(a)),this._getLimitSection())},o.prototype._getLimitSection=function(){var t=e("<div>"),r=e('<a data-type="number">').attr("href","#").attr("id","query-helper-limit").data("value",this._query.getLimit()).append(this._i18nSpan("limit")),i=e("<span>").text(this._query.getLimit()||""),a=this;return this._selectorBox.add(r,null,function(e){"0"===e&&(e=null),i.text(e||""),a._query.setLimit(e),a._changeListener&&a._changeListener(a)},{trash:function(){return a._query.setLimit(null),r.data("value",""),i.text(""),a._changeListener&&a._changeListener(a),!0}}),t.append(r.append(" ",i))},o.prototype._createSection=function(t,r){return e("<table>").append(e("<tr>").append(e("<td>").append(r),e("<td>").append(t)))},o.prototype._createFindButton=function(t){var r=e('<a class="btn">').append(this._i18nSpan("filter")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new item"}).attr("id","query-helper-filter").attr("data-type","item").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(e,r,a){var n="http://www.wikidata.org/entity/"+e,o=i._query.getBoundVariables().shift();o||(o="?"+r.replace(/( |[^a-z0-9])/gi,"_"));var s="http://www.wikidata.org/prop/direct/"+(a||"P31"),l=i._query.addTriple(o,s,n,!1);i._query.hasVariable(o)||i._query.addVariable(o),i._addLabelVariableAfterItemColumn(s.split("/").pop(),l),t.append(i._getTripleHtml(l)),i._changeListener&&i._changeListener(i)}),r},o.prototype._createShowButton=function(t){var r=e('<a class="btn">').append(this._i18nSpan("show")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new property"}).attr("id","query-helper-show").attr("data-type","property").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(e,r){var a="http://www.wikidata.org/prop/direct/"+e,n=i._query.getBoundVariables().shift()||"?item",o="?"+r.replace(/( |[^a-z0-9])/gi,"_"),s=i._query.addTriple(n,a,o,!0);i._query.addVariable(o),i._addLabelVariableAfterItemColumn(a.split("/").pop(),s),t.append(i._getTripleHtml(s)),i._changeListener&&i._changeListener(i)}),r},o.prototype._addLabelVariableAfterItemColumn=function(e,t){var r=this;this._api.getDataType(e).done(function(e){"wikibase-item"===e&&r._addLabelVariable(t)})},o.prototype._isNotRelevant=function(e){return!!i[e.predicate]||!(!this._isSimpleMode||!this._isInShowSection(e)||!1!==this._query.hasVariable(e.object)||!1!==this._query.hasVariable(e.object+"Label")||!1!==this._query.isWildcardQuery())},o.prototype._isInShowSection=function(e){var t=this._query.getBindings();return!(!this._isVariable(e.subject)||!this._isVariable(e.object)||t[e.subject]||t[e.object])},o.prototype._getTripleHtml=function(t){var r=this,i=e("<tr>"),a=this._query.getBindings();return e.each(t.triple,function(n,o){if(r._isVariable(o)&&a[o]&&"string"==typeof a[o].expression&&(o=a[o].expression),r._isVariable(o)){if(r._isSimpleMode)return;return o=o.replace("?","").replace(/_/g,"_<wbr>"),void i.append(e("<td>").append(o))}o.type&&"path"===o.type?i.append(e("<td>").append(r._getTripleEntityPathHtml(o,t,n))," "):i.append(e("<td>").append(r._getTripleEntityHtml(o,t,n))," ")}),i.append(this._getTripleHtmlToolbar(i,t))},o.prototype._getTripleHtmlToolbar=function(t,i){var a=this,n=e('<a href="#">').addClass("fa fa-trash-o").click(function(){var e=r.compact(i.triple).filter(function(e){return"string"==typeof e&&e.startsWith("?")}),n=e.map(function(e){return e+"Label"});return i.remove(),t.remove(),a._query.cleanupVariables(e.concat(n)),a._changeListener&&a._changeListener(a),!1}).tooltip({title:a._i18n("remove-row-title")}),o=e('<a href="#">').addClass("fa fa-tag").click(function(){return a._addLabelVariable(i),a._changeListener&&a._changeListener(a),!1}).tooltip({title:a._i18n("add-label-title")});return e('<td class="toolbar">').append(o,n)},o.prototype._addLabelVariable=function(e){this._query.convertWildcardQueryToUseVariables(),e.triple.object.startsWith("?")?this._query.addVariable(e.triple.object+"Label"):this._query.addVariable(e.triple.subject+"Label"),this._changeListener&&this._changeListener(this)},o.prototype._isVariable=function(e){return"string"==typeof e&&e.startsWith("?")},o.prototype._isSimpleQuery=function(){var t={},r=this;return e.each(this._triples,function(e,i){r._isVariable(i.triple.subject)&&!1===r._isVariable(i.triple.object)&&(t[i.triple.subject]=!0)}),Object.keys(t).length<=1},o.prototype._getTripleEntityPathHtml=function(t,r){var i=this,a=e("<span>");return e.each(t.items,function(n,o){if(o.type&&"path"===o.type)a.append(i._getTripleEntityPathHtml(o,r));else{n>0&&"/"===t.pathType&&a.append(" "+i._i18n("or")+" "+i._i18n("subtype")+" "),"*"===t.pathType&&a.append(" "+i._i18n("any")+" ");var s=t.items.reduce(function(e,t,r){return e[r]=t,e},{});s=e.extend(s,r.triple),(r=e.extend({},r)).triple=s,a.append(i._getTripleEntityHtml(o,r,n))}}),a},o.prototype._getTripleEntityHtml=function(t,r,i){var a=this,n=e("<span>");return this._getLabel(t).done(function(o,s,l,u){var p=e("<a>").text(o).attr({"data-id":s,"data-type":u,href:"#"}).appendTo(n);n.tooltip({title:"("+s+") "+l}),e(n).on("show.bs.tooltip",function(){e(".tooltip").is(":visible")&&e(".tooltip").not(this).hide()}),a._selectorBox.add(p,r.triple,function(e){var o=t.replace(new RegExp(s+"$"),"")+e;n.replaceWith(a._getTripleEntityHtml(o,r,i)),a._isVariable(r.triple[i])?a._query.getBindings()[r.triple[i]].expression=o:r.triple[i]=o,a._changeListener&&a._changeListener(a)})}).fail(function(){n.text(t)}),n},o.prototype._getLabel=function(t){var r=e.Deferred(),i=t.match(/(Q|P)([0-9]+)/);if(!i)return r.reject().promise();var a={P:"property",Q:"item"};a=a[i[1]];var n=i[0];return this._api.searchEntities(n,a).done(function(t){e.each(t.search,function(e,t){return r.resolve(t.label,t.id,t.description,a),!1})}),r.promise()},o}(jQuery,wikibase,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SparqlQuery=function(e,t,r){"use strict";function i(e){this._query=e}return i.prototype._query=null,i.prototype._queryComments=null,i.prototype.parse=function(t,i){var a=new r.Parser(i),n=[];this._query=a.parse(t),e.each(t.split("\n"),function(e,t){0===t.indexOf("#")&&n.push(t)}),this._queryComments=n},i.prototype.getQueryString=function(){try{var e=(new r.Generator).stringify(this._query),t=this._queryComments.join("\n").trim();return""!==t?t+"\n"+e:e}catch(e){return null}},i.prototype.getLimit=function(){return this._query.limit||null},i.prototype.setLimit=function(e){return e?this._query.limit=e:delete this._query.limit,this},i.prototype.hasVariable=function(e){return 0!==this._query.variables.length&&this._query.variables.indexOf(e)>=0},i.prototype.isWildcardQuery=function(){return!(!this._query.variables||"*"!==this._query.variables[0])},i.prototype.convertWildcardQueryToUseVariables=function(){if(this.isWildcardQuery()){var t=this.getQueryString().match(/(\?\w+)/g);this._query.variables=e.unique(t)||"*"}},i.prototype.addVariable=function(e){return e&&e.startsWith("?")?this._query.variables.indexOf(e)>=0?this:this.isWildcardQuery()?this:(this._query.variables.push(e),this):this},i.prototype.removeVariable=function(e){if(e.startsWith("?")&&!this.isWildcardQuery()){var t=this._query.variables.indexOf(e);t>=0&&this._query.variables.splice(t,1),0===this._query.variables.length&&this._query.variables.push("*")}},i.prototype.cleanupVariables=function(e){var t=this,r=this.getTripleVariables();this._query.variables.filter(function(t){return(!e||-1!==e.indexOf(t))&&-1===r.indexOf(t)}).map(function(e){t.removeVariable(e)})},i.prototype.getTriples=function(t,r){var i=[];t||(t=this._query.where),r||(r=!1);var a=this;return e.each(t,function(e,t){t.type&&"bgp"===t.type&&(i=i.concat(a._createTriples(t.triples,r))),t.type&&"optional"===t.type&&(i=i.concat(a.getTriples(t.patterns,!0))),t.type&&"union"===t.type&&(i=i.concat(a.getTriples(t.patterns,!1)))}),i},i.prototype.getBindings=function(){var t={};return e.each(this._query.where,function(e,r){r.type&&"bind"===r.type&&(t[r.variable]=r)}),t},i.prototype._createTriples=function(t,r){var i=this,a=[];return e.each(t,function(e,n){a.push({optional:r,query:i,triple:n,remove:function(){t.splice(e,1)}})}),a},i.prototype.getSubQueries=function(){var t=[];return e.each(this._query.where,function(e,r){r.queryType&&t.push(new i(r))}),t},i.prototype.addTriple=function(e,t,r,i){var a={type:"bgp",triples:[{subject:e,predicate:t,object:r}]};if(i){var n={type:"optional",patterns:[a]};this._query.where.push(n)}else this._query.where.push(a);return this._createTriples(a.triples,i)[0]},i.prototype.getTripleVariables=function(){var t={};return e.each(this.getTriples(),function(e,r){"string"==typeof r.triple.subject&&r.triple.subject.startsWith("?")&&(t[r.triple.subject]=!0),"string"==typeof r.triple.predicate&&r.triple.predicate.startsWith("?")&&(t[r.triple.predicate]=!0),"string"==typeof r.triple.object&&r.triple.object.startsWith("?")&&(t[r.triple.object]=!0)}),Object.keys(t)},i.prototype.getBoundVariables=function(){var t={};return e.each(this.getTriples(),function(e,r){r.triple.subject.startsWith("?")&&!r.triple.object.startsWith("?")&&(t[r.triple.subject]=!0),!r.triple.subject.startsWith("?")&&r.triple.object.startsWith("?")&&(t[r.triple.object]=!0)}),Object.keys(t)},i.prototype.getServices=function(){var t=[];return e.each(this._query.where,function(e,r){r&&"service"===r.type&&t.push(r)}),t},i.prototype.removeService=function(t){var r=this;return e.each(this._query.where,function(e,i){"service"===i.type&&i.name===t&&delete r._query.where[e]}),this},i.prototype.getCommentContent=function(e){var t,r;for(t=0;t<this._queryComments.length;t++)if((r=this._queryComments[t]).startsWith("#"+e))return r.substring(1+e.length);return null},i.prototype.clone=function(){var e=new i;return e.parse(this.getQueryString()),e},i}(jQuery,0,sparqljs),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SelectorBox=function(e,t){"use strict";var r={item:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i <{PROPERTY_URI}> ?id. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t}\t\t\t\t\tLIMIT 100',genericSuggest:function(){if(0===this._query.getTriples().length)return'SELECT ?id ?label ?description WHERE {\t\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?id wdt:P1424 ?p. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100';var e=this._query.getBoundVariables().shift(),t=this._query.clone().setLimit(1e3).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\t\tSELECT ?id ?label ?description ?property WITH {\n\t\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\t\tSELECT ?value ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t\t?statement ?ps ?value.\n\t\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p; wikibase:statementProperty ?ps.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tGROUP BY ?value ?property\n\t\t\t\t\t\t\tHAVING(isIRI(?value) && STRSTARTS(STR(?value), STR(wd:Q)))\n\t\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t\t} AS %values WHERE {\n\t\t\t\t\t\t\tINCLUDE %values.\n\t\t\t\t\t\t\tBIND(?value AS ?id).\n\t\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,instanceOf:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t{\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t\t}\t\t\t\t\tLIMIT 100'},property:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t{\t\t\t\t\t\tSELECT DISTINCT ?id WHERE {\t\t\t\t\t\t?i ?prop <{ITEM_URI}>.\t\t\t\t\t\t?id ?x ?prop.\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100\t\t\t\t\t}\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}\t\t\t\tLIMIT 100',genericSuggest:function(){if(0===this._query.getTriples().length)return'SELECT ?id ?label ?description WITH {\t\t\t\t\tSELECT ?pred (COUNT(?value) AS ?count) WHERE\t\t\t\t\t{\t\t\t\t\t?subj ?pred ?value .\t\t\t\t\t} GROUP BY ?pred ORDER BY DESC(?count) LIMIT 1000\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id wikibase:claim ?pred.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100';var e=this._query.getBoundVariables().shift(),t=this._query.clone().setLimit(500).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\tSELECT ?id ?label ?description WITH {\n\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t}\n\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\tSELECT ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p.\n\t\t\t\t\t\t}\n\t\t\t\t\t\tGROUP BY ?property\n\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t} AS %properties WHERE {\n\t\t\t\t\t\tINCLUDE %properties.\n\t\t\t\t\t\tBIND(?property AS ?id).\n\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,seeAlso:'SELECT ?id ?label ?description WHERE {\t\t\t\t\tBIND( <{PROPERTY_URI}> as ?prop).\t\t\t\t\t?props ?x  ?prop.\t\t\t\t\t?props rdf:type wikibase:Property.\t\t\t\t\t?props wdt:P1659 ?id.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}'},sparql:{search:'SELECT ?id ?label ?description WITH {\t\t\t\t\t{SPARQL}\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\tFILTER(STRSTARTS(LCASE(?label), LCASE("{TERM}")))\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100',suggest:'SELECT ?id ?label ?description WITH {\t\t\t\t{SPARQL}\t\t\t\t} AS %inner\t\t\tWHERE {\t\t\t\tINCLUDE %inner\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t} ORDER BY DESC(?count)\t\t\tLIMIT 100'}};function i(e,r){this._api=e||new t.queryService.api.Wikibase,this._sparqlApi=r||new t.queryService.api.Sparql}return i.prototype._api=null,i.prototype._sparqlApi=null,i.prototype._query=null,i.prototype.setQuery=function(e){this._query=e},i.prototype.add=function(e,t,r,i){switch(e.data("type").toLowerCase()){case"number":this._createInput(e,r,i);break;default:this._createSelect(e,t,r,i)}},i.prototype._createInput=function(t,r,i){var a=e("<input>").attr("type",t.data("type")),n=this._getCloseButton(),o=this._getToolbar(i,t),s=e("<div>").append(n," ",a," ",o);t.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return s}}).click(function(e){a.val(t.data("value")||"")}),a.on("keyup mouseup",function(){r&&r(a.val())})},i.prototype._createSelect=function(t,r,i,a){var n=this,o=this._getSelectBox(t),s=this._getCloseButton(),l=this._getToolbar(a,t),u=e("<div>").append(s," ",o," ",l);0!==t.children().length?(t.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return u}}).click(function(i){return o.toggleClass("open"),o.data("select2")||e.proxy(n._renderSelect2(o,t,r),n),o.hasClass("open")&&t.data("auto_open")&&o.data("select2").open(),!1}),o.change(function(e){if(i){var r=o.val(),a=o.find("option:selected").text(),s=t.data("items"),l=s&&s[r]&&s[r].propertyId||null;l?i(r,a,l):n._suggestPropertyId(r).always(function(e){i(r,a,e)})}t.click(),o.html("")})):this._createSelectInline(t,r,i)},i.prototype._suggestPropertyId=function(t){var r=e.Deferred(),i="SELECT ?id (COUNT(?id) AS ?count) WHERE { { SELECT ?id WHERE {\t\t\t\t\t\t\t?i ?prop wd:{ITEM_ID}.\t\t\t\t\t\t\t?id wikibase:directClaim ?prop.\t\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t\t}\t\t\t\t\t\t\tLIMIT 10000 } } GROUP BY ?id ORDER BY DESC(?count) LIMIT 1".replace("{ITEM_ID}",t);return this._sparqlApi.query(i,2e3).done(function(e){try{r.resolve(e.results.bindings[0].id.value.split("/").pop())}catch(e){r.reject()}}).fail(function(){r.reject()}),r.promise()},i.prototype._createSelectInline=function(e,t,r){var i=this._getSelectBox(e);e.replaceWith(i),this._renderSelect2(i,e,t),i.change(function(t){if(r){var a=i.val(),n=e.data("items"),o=n&&n[a]&&n[a].propertyId||null;r(a,i.find("option:selected").text(),o)}})},i.prototype._getSelectBox=function(t){var r=t.data("id"),i=t.text(),a=e("<select>");return r&&a.append(e("<option>").attr("value",r).text(i)),a},i.prototype._getCloseButton=function(){return e('<a href="#" data-dismiss="clickover">').append('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>')},i.prototype._getToolbar=function(t,r){var i=e("<span>");return e.each(t,function(t,a){var n=e("<a>").attr("href","#");n.prepend('<span class="glyphicon glyphicon-'+t+'" aria-hidden="true"></span>'," "),n.click(function(){return a()&&r.click(),!1}),i.append(n," ")}),i},i.prototype._createLookupService=function(t,r){var i=this,a=t.data("type"),n=t.data("sparql");return function(o,s,l){e.when(i._searchEntitiesSparql(o.data.term,a,r,n),i._searchEntities(o.data.term,a)).done(function(e,r){i._addItemMetaData(t,e.concat(r)),e.length>0&&(e=[{text:i._i18n("suggestions","Suggestions"),children:e}]),r.length>0&&e.length>0&&(r=[{text:i._i18n("other","Other"),children:r}]),s({results:e.concat(r)})})}},i.prototype._addItemMetaData=function(e,t){var r={};t.forEach(function(e){r[e.data.id]||(r[e.data.id]={}),r[e.data.id].text=e.text,e.data.propertyId&&(r[e.data.id].propertyId=e.data.propertyId)}),e.data("items",r)},i.prototype._getSparqlTemplate=function(e,t,r,i){var a=this._getSparqlTemplateDefinition(e,t,r,i),n="function"==typeof a?a.apply(this):a;return i&&(n=n.replace("{SPARQL}",i)),n},i.prototype._getSparqlTemplateDefinition=function(e,t,i,a){if(a)return e?r.sparql.search:r.sparql.suggest;var n=r[t];if(e&&""!==e.trim())return i?n.search:null;if("property"===t){if(!i)return n.genericSuggest;if(0===i.object.indexOf("?"))return n.seeAlso}else if(!i)return n.genericSuggest;return n.suggest},i.prototype._searchEntitiesSparqlCreateQuery=function(t,r,i,a){var n=this._getSparqlTemplate(t,r,i,a);return n&&(i&&(n=n.replace("{PROPERTY_URI}",function e(t){return"string"==typeof t?t:e(t.items[0])}(i.predicate)).replace("{ITEM_URI}",i.object)),t&&(n=n.replace("{TERM}",t)),n=n.replace(/\{LANGUAGE\}/g,e.i18n&&e.i18n().locale||"en")),n},i.prototype._searchEntitiesSparql=function(t,r,i,a){var n=e.Deferred(),o=this._searchEntitiesSparqlCreateQuery(t,r,i,a);return o?(this._sparqlApi.query(o,4e3).done(function(e){var t=e.results.bindings.map(function(e){var t=e.id.value.split("/").pop(),r=e.property&&e.property.value.split("/").pop()||null;return{id:t,text:e.label.value,data:{id:t,propertyId:r,description:e.description&&e.description.value||""}}});n.resolve(t)}).always(function(){n.resolve([])}),n.promise()):n.resolve([]).promise()},i.prototype._searchEntities=function(t,r){var i=e.Deferred();return t&&""!==t.trim()?(this._api.searchEntities(t,r).done(function(e){var t=e.search.map(function(e){return{id:e.id,text:e.label,data:e}});i.resolve(t)}),i.promise()):i.resolve([]).promise()},i.prototype._renderSelect2=function(t,r,i){var a=this._createLookupService(r,i);t.select2({width:"auto",templateResult:function(t,r){return t.data?e("<span><b>"+t.text+" ("+t.data.id+")</b></span><br/><small>"+t.data.description+"</small>"):t.text},ajax:{delay:250,transport:a},cache:!0})},i.prototype._i18n=function(t,r){return e.i18n?e.i18n("wdqs-ve-sb-"+t):r},i}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryTemplate=function(e,t){"use strict";function r(){}return r.prototype._definition={},r.prototype._template=null,r.prototype._variables=[],r.parse=function(e){var t,i,a=e.getCommentContent("TEMPLATE=");if(!a)return null;try{t=JSON.parse(a)}catch(e){return null}return(i=new r)._definition=t,i._fragments=r._getQueryTemplateFragments(t),i},r._getQueryTemplateText=function(e,t,r,i){var a,n,o,s;if(-1===["string","object"].indexOf(typeof e.template))throw new Error("unsupported template type, should be single string or map from language code to string");if("string"==typeof e.template)return e.template;if(t in(a=e.template))return a[t];for(o in n=r&&r[t]||{})if((s=n[o])in a)return a[s];if((s=i||"en")in a)return a[s];for(o in a)return a[o];return""},r._getQueryTemplateFragments=function(t){var r,i,a=e.i18n&&e.i18n().locale||"en",n=e.i18n&&e.i18n.fallbacks,o=e.i18n&&e.i18n().options.fallbackLocale,s=this._getQueryTemplateText(t,a,n,o),l=[s];if(s.match(/\0/))throw new Error("query template must not contain null bytes");function u(e){var t=e.replace(new RegExp("\\"+r,"g"),"\0").split("\0");i.push(t[0]);for(var a=1;a<t.length;a++)i.push(r),i.push(t[a])}for(r in t.variables){if(!r.match(/\?[a-z][a-z0-9]*/i))throw new Error("invalid variable name in query template");i=[],l.forEach(u),l=i}return l},r._buildTemplate=function(t,r){var i=e("<span>");i.append(document.createTextNode(t[0]));for(var a=1;a<t.length;a+=2){var n=t[a],o=e("<span>").text(n);n in r||(r[n]=[]),r[n].push(o),i.append(o),i.append(document.createTextNode(t[a+1]))}return i},r.prototype.getHtml=function(t,i,a){if(null!==this._template)return this._template;this._template=r._buildTemplate(this._fragments,this._variables);var n=this;return e.each(this._definition.variables,function(r,o){t(r).done(function(t,s,l,u){e.each(n._variables[r],function(l,p){p.text("");var c=e("<a>").text(t).attr({"data-id":s,"data-type":u,href:"#"}).appendTo(p);o.query&&c.attr("data-sparql",o.query),i.add(c,null,function(e,t){for(var i in n._variables[r]){n._variables[r][i].find('a[data-id="'+s+'"]').attr("data-id",e).text(t),a(r,s,e),s=e}})})})}),this._template},r}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.toolbar=wikibase.queryService.toolbar||{},wikibase.queryService.ui.toolbar.Actionbar=function(e){"use strict";function t(e){this._$element=e}return t.prototype._$element=null,t.prototype.show=function(t,r,i,a){var n=t;e.i18n&&(n=e.i18n(t)),""!==r&&(n=n+": "+r),this._$element.find(".message").html(""),i||(i="info"),void 0===a||!1===a?this._$element.find(".message").append(this._getBar(n,i)):this._$element.find(".message").append(this._getProgressbar(n,i,a)),this._$element.show()},t.prototype._getProgressbar=function(t,r,i){return e('<div class="progress"><div class="progress-bar progress-bar-'+r+' progress-bar-striped active" role="progressbar" style="width: '+i+'%">'+t+"</div></div>")},t.prototype._getBar=function(t,r){return e('<div class="label label-'+r+'"/>').text(t)},t.prototype.hide=function(){this._$element.hide()},t}(jQuery);