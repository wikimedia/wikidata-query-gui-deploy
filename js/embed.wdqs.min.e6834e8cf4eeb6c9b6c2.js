var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.FormatterHelper=function(e,t){"use strict";function r(){}var i=["http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#positiveInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger"];return r.prototype.formatRow=function(t,r){var i=this,a=e("<div/>");return e.each(t,function(n,o){i._isLabelField(n,t)||(o=e.extend({label:i._getLabel(t,n)},o),a.prepend(e("<div>").append(i.formatValue(o,n,r))))}),a},r.prototype._isLabelField=function(e,t){return e.endsWith("Label")&&void 0!==t[e.slice(0,-5)]},r.prototype._getLabel=function(e,t){var r=e[t+"Label"];return r&&r.value||null},r.prototype.formatValue=function(t,r,i){var a=t.value,n=e("<span>");if(r||(r=t.dataType||""),!t.type)return e("<span>").text(a).attr("title",r);switch(t.datatype||t.type){case"uri":var o=e("<a>").attr({title:r,href:a,target:"_blank",rel:"noopener"});n.append(o),this.isCommonsResource(a)?i?(o.click(this.handleCommonResourceItem),o.append(e("<img>").attr("src",this.getCommonsResourceFileNameThumbnail(a,"120"))).width("120")):(o.attr({href:"https://commons.wikimedia.org/wiki/File:{FILENAME}".replace(/{FILENAME}/g,this.getCommonsResourceFileName(a))}),o.text("commons:"+decodeURIComponent(this.getCommonsResourceFileName(a))),n.prepend(this.createGalleryButton(a,r)," ")):(o.text(t.label||this.abbreviateUri(a)),this.isEntityUri(a)&&n.prepend(this.createExploreButton(a)," "));break;case"http://www.w3.org/2001/XMLSchema#dateTime":r||(r=this._i18n("wdqs-app-result-formatter-title-datetime","Raw ISO timestamp"));var s=e("<span>").text(this._formatDate(a));s.attr("title",r+": "+a),n.append(s);break;case"http://www.w3.org/1998/Math/MathML":n.append(e(t.value));break;default:var u=e("<span>").text(a);t["xml:lang"]?u.attr("title",r+": "+a+"@"+t["xml:lang"]):u.attr("title",r),n.append(u)}return n},r.prototype._formatDate=function(e){var t,r=!1,i=e.replace(/^(?:-\d+|\+?0+\b)/,function(e){return r=!0,Math.abs(e)+1}),a=this.parseDate(i);if(a.isValid())t=a.format("ll");else{var n=i.replace(/^\+?(\d+).*/,"$1");t="0000".slice(n.length)+n}return r&&(t+=" BCE"),t},r.prototype.parseDate=function(e){return e=e.replace(/^(?![+-])/,"+"),e=e.replace(/^([+-]?)(\d{1,5}\b)/,function(e,t,r){return t+("00000"+r).slice(-6)}),e=e.replace(/Z$/,""),t(e,t.ISO_8601)},r.prototype.isEntityUri=function(e){return"string"==typeof e&&/^https?:\/\/www\.wikidata\.org\/entity\/./.test(e)},r.prototype.createExploreButton=function(t){var r=e('<a href="'+t+'" title="Explore item" class="explore glyphicon glyphicon-search" aria-hidden="true">');return r.click(e.proxy(this.handleExploreItem,this)),r},r.prototype.isCommonsResource=function(e){return e.toLowerCase().startsWith("http://commons.wikimedia.org/wiki/special:filepath/".toLowerCase())},r.prototype.getCommonsResourceFileName=function(e){var t=new RegExp("http://commons.wikimedia.org/wiki/special:filepath/","ig");return decodeURIComponent(e.replace(t,""))},r.prototype.getCommonsResourceFileNameThumbnail=function(e,t){return this.isCommonsResource(e)?e.replace(/^http(?=:\/\/)/,"https")+"?width="+(t||400):e},r.prototype.createGalleryButton=function(t,r){var i=this.getCommonsResourceFileName(t),a=this.getCommonsResourceFileNameThumbnail(t,900),n=e("<a>").attr({title:"Show Gallery",href:a,"aria-hidden":"true",class:"gallery glyphicon glyphicon-picture","data-gallery":"G_"+r,"data-title":decodeURIComponent(i)});return n.click(this.handleCommonResourceItem),n},r.prototype.abbreviateUri=function(e){var t,r,i,a=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS,n=0;for(t in a)for(r in a[t])0===e.indexOf(a[t][r])&&a[t][r].length>n&&(n=a[t][r].length,i=r);return i?i+":"+e.substr(n):"<"+e+">"},r.prototype.handleExploreItem=function(t){var r=e(t.target).attr("href");t.preventDefault();var i="SELECT ?item ?itemLabel WHERE { BIND( <"+r+'> as ?item ).\tSERVICE wikibase:label { bd:serviceParam wikibase:language "'+(e.i18n&&e.i18n().locale||"en")+'" } }',a="embed.html#"+encodeURIComponent("#defaultView:Graph\n"+i);return e(".explorer-panel .panel-body").html(e('<iframe frameBorder="0" scrolling="no"></iframe>').attr("src",a)),e(".explorer-panel").show(),!1},r.prototype.handleCommonResourceItem=function(t){t.preventDefault(),e(this).ekkoLightbox({scale_height:!0})},r.prototype.isLabel=function(e){return!!e&&("xml:lang"in e||"literal"===e.type&&!e.datatype)},r.prototype.isNumber=function(e){return e&&e.datatype&&-1!==i.indexOf(e.datatype)},r.prototype.isDateTime=function(e){return e&&"http://www.w3.org/2001/XMLSchema#dateTime"===e.datatype},r.prototype.isEntity=function(e){return e&&e.value&&this.isEntityUri(e.value)},r.prototype.isColor=function(e){return e&&"literal"===e.type&&e.value&&/^([\dA-F]{1,2}){3}$/i.test(e.value)},r.prototype.getColorForHtml=function(e){return"#"+e.value},r.prototype.calculateLuminance=function(e){var t=parseInt(e.substr(1,2),16)/255,r=parseInt(e.substr(3,2),16)/255,i=parseInt(e.substr(5,2),16)/255;return isFinite(t)&&isFinite(r)&&isFinite(i)?.2126*(t=t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(r=r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(i=i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)):NaN},r.prototype._i18n=function(t,r){var i;return e.i18n&&(i=e.i18n(t))!==t?i:r},r}(jQuery,moment),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractResultBrowser=function(e,t){"use strict";function r(){this._visitors=[]}return r.prototype._formatter=null,r.prototype._result=null,r.prototype._visitors=null,r.prototype._drawable=!1,r.prototype._sparqlApi=null,r.prototype.setResult=function(e){this._result=e},r.prototype.setSparqlApi=function(e){this._sparqlApi=e},r.prototype.getSparqlApi=function(){return this._sparqlApi},r.prototype._iterateResult=function(t){var r=this;e.each(this._result.results.bindings,function(i,a){e.each(r._result.head.vars,function(e,n){var o=a[n]||null;r.processVisitors(o,n),t(o,n,a,i)})})},r.prototype.isDrawable=function(){return this._drawable},r.prototype.draw=function(e){jQuery.error("Method draw() needs to be implemented!")},r.prototype.addVisitor=function(e){this._visitors.push(e)},r.prototype.resetVisitors=function(){this._visitors=[]},r.prototype.processVisitors=function(t,r){var i=this,a={};0!==this._visitors.length&&(e.each(this._visitors,function(e,i){i.visit&&"function"==typeof i.visit&&!1===i.visit(t,r)&&(a[e]=!0)}),i._visitors=i._visitors.filter(function(e,t){return!a[t]}))},r.prototype.visit=function(e){return!1},r.prototype.setFormatter=function(e){this._formatter=e},r.prototype._getFormatter=function(){return null===this._formatter&&(this._formatter=new t.queryService.ui.resultBrowser.helper.FormatterHelper),this._formatter},r.prototype._i18n=function(t,r){var i=null;return e.i18n&&(i=e.i18n(t))!==t?i:r},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser=function(e,t){"use strict";function r(){}return r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,r.prototype._getLabelColumns=function(){var e=this,t=e._getRows()[0];return e._getColumns().filter(function(r){return e._getFormatter().isLabel(t[r])})},r.prototype._getNumberColumns=function(){var e=this,t=e._getRows()[0];return e._getColumns().filter(function(r){return e._getFormatter().isNumber(t[r])})},r.prototype._getColumns=function(){return this._result.head.vars},r.prototype._getRows=function(){return this._result.results.bindings},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser=function(e,t,r,i,a){"use strict";function n(){}return n.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,n.prototype._dataColumns=null,n.prototype._data=null,n.prototype._$element=null,n.prototype._svg=null,n.prototype._chart=null,n.prototype._chartLegend=null,n.prototype._chartSeriesKey=null,n.prototype._chartStoryKey=null,n.prototype._isStoryPaused=!1,n.prototype.draw=function(t){var r=this;this._$element=e("<div>").css({width:"100%",height:"98vh"}),t.html(this._$element),this._createData(),this._drawSvg(),this._createChart(),this._drawChart(),this._createLegendFilter(),i.onresize=function(){r._drawChart(250,!0)}},n.prototype._createData=function(){var e=[],t={},r=null;this._iterateResult(function(i,a,n){null===r&&(r=n),n!==r&&(r=n,e.push(t),t={}),i&&i.value&&(t[a]=i.value)}),e.push(t),this._data=e},n.prototype._drawSvg=function(){this._svg=a.newSvg(this._$element[0],"100%","100%")},n.prototype._createChart=function(){this._chart=new a.chart(this._svg,this._data),this._chart.setBounds(0,0,"100%","100%"),this._chart.setMargins("5%","5%","2%","25%"),this._createChartAxis();var e=this._chart.addSeries(this._chartSeriesKey,this._getPlotType());e.addOrderRule(this._chartSeriesKey),e.lineMarkers=!0,this._chartStoryKey&&this._createChartStory(),this._chartLegend=this._chart.addLegend("1%","85%","100%","15%")},n.prototype._getPlotType=function(){jQuery.error("Method _getPlotType() needs to be implemented!")},n.prototype._createChartAxis=function(){var t=this,r=this._getRows()[0],i=this._getFormatter(),a=this._chart,n=["y","x"],o=!1;e.each(this._getColumns(),function(e,s){if(0!==n.length)i.isLabel(r[s])&&(a.addCategoryAxis(n.pop(),s),o=!0),i.isNumber(r[s])&&a.addMeasureAxis(n.pop(),s),i.isDateTime(r[s])&&(a.addTimeAxis(n.pop(),s,"%Y-%m-%dT%H:%M:%SZ","%m-%d-%Y"),o=!0);else if(i.isLabel(r[s])){if(!t._chartSeriesKey)return void(t._chartSeriesKey=s);if(!t._chartStoryKey)return t._chartStoryKey=s,!1}}),o||this._chartSeriesKey||!a.axes[0]||(this._chartSeriesKey=a.axes[0].measure)},n.prototype._createChartStory=function(){var e=this,t=this._chart.setStoryboard(this._chartStoryKey);t.frameDuration=5e3,this._$element.click(function(){if(e._isStoryPaused)return t.startAnimation(),void(e._isStoryPaused=!1);t.pauseAnimation(),e._isStoryPaused=!0})},n.prototype._createLegendFilter=function(){var e=this,t=a.getUniqueValues(this._data,this._chartSeriesKey);this._chart.legends=[],this._chartLegend.shapes.selectAll("rect").on("click",function(i){var n=!1,o=[];t.forEach(function(e){e===i.aggField.slice(-1)[0]?n=!0:o.push(e)}),r.select(this).style("opacity",n?.2:.8),n||o.push(i.aggField.slice(-1)[0]),t=o,e._chart.data=a.filterData(e._data,e._chartSeriesKey,t),e._drawChart(800)})},n.prototype._drawChart=function(e,r){var i=this;this._chart.draw(e,r),t.delay(function(){i._svg.selectAll(".dimple-marker,.dimple-marker-back").attr("r",2)},1.2*e)},n.prototype.isDrawable=function(){return Object.keys(this._dataColumns).length>=2},n.prototype.visit=function(e,t){return this._checkColumn(e,t)},n.prototype._checkColumn=function(e,t){return this._getFormatter().isLabel(e)&&(this._dataColumns[t]=!0),this._getFormatter().isNumber(e)&&(this._dataColumns[t]=!0),this._getFormatter().isDateTime(e)&&(this._dataColumns[t]=!0),!this.isDrawable()},n}(jQuery,_,d3,window,dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.ImageResultBrowser=function(e){"use strict";function t(){}return t.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,t.prototype._grid=null,t.prototype.draw=function(t){var r=this;this._grid=e('<div class="masonry">'),this._iterateResult(function(e,t,i){if(e&&r._isCommonsResource(e.value)){var a=e.value,n=r._getFormatter().getCommonsResourceFileName(a);r._grid.append(r._getItem(r._getThumbnail(a),r._getThumbnail(a,1e3),n,i))}}),t.html(this._grid)},t.prototype._getItem=function(t,r,i,a){var n=e("<a>").click(this._getFormatter().handleCommonResourceItem).attr({href:r,"data-gallery":"g","data-title":i}).append(e("<img>").attr("src",t)),o=this._getFormatter().formatRow(a);return e('<div class="item">').append(n,o)},t.prototype._isCommonsResource=function(e){return this._getFormatter().isCommonsResource(e)},t.prototype._getThumbnail=function(e,t){return this._getFormatter().getCommonsResourceFileNameThumbnail(e,t)},t.prototype.visit=function(e){return this._checkImage(e)},t.prototype._checkImage=function(e){return!(e&&e.value&&this._isCommonsResource(e.value))||(this._drawable=!0,!1)},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TableResultBrowser=function(e,t){"use strict";function r(){}var i=[10,50,100,200,500,1e3];return r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,r.prototype._columns=null,r.prototype._rows=null,r.prototype._sorter={string:function(e,t){return e.localeCompare(t)},number:function(e,t){return e>=t?-1:1},generic:function(e,t){if(!t)return 1;if(!e)return-1;var r=this._getFormatter();return r.isNumber(e)&&r.isNumber(t)?this._sorter.number(Number(e.value),Number(t.value)):r.isEntityUri(e.value)&&r.isEntityUri(t.value)?this._sorter.number(Number(e.value.replace(/[^0-9]/gi,"")),Number(t.value.replace(/[^0-9]/gi,""))):this._sorter.string(e.value,t.value)}},r.prototype.draw=function(r){var i=this._result;if(void 0!==i.boolean){var a=e("<table>").attr("class","table");return a.append("<tr><td>"+i.boolean+"</td></tr>").addClass("boolean"),void r.html(a)}this.columns=i.head.vars,this.rows=i.results.bindings;var n=e("<table/>");r.html(n),this.drawBootstrapTable(n),n.children().width()>e(t).width()&&n.bootstrapTable("toggleView")},r.prototype.drawBootstrapTable=function(t){var r=this,a=this.rows.length>200;jQuery.fn.bootstrapTable.columnDefaults.formatter=function(e,t,i){return e?(r.processVisitors(e,this.field),r._getFormatter().formatValue(e).html()):""};var n={"click .explore":e.proxy(this._getFormatter().handleExploreItem,this),"click .gallery":this._getFormatter().handleCommonResourceItem};t.bootstrapTable({columns:this.columns.map(function(t){return{title:t,field:t,events:n,sortable:!0,sorter:e.proxy(r._sorter.generic,r)}}),data:this.rows,mobileResponsive:!0,search:a,pagination:a,showPaginationSwitch:a,pageSize:200,pageList:i,keyEvents:!0,cookie:!0,cookieIdTable:"1",cookieExpire:"1y",cookiesEnabled:["bs.table.pageList"]})},r.prototype.isDrawable=function(){return!0},r.prototype.visit=function(e){return!1},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.CoordinateResultBrowser=function(e,t,r,i,a,n){"use strict";function o(){this._getMarkerGroupColor=r.scale.category10(),h=t.Control.extend({options:{position:"topright"},onAdd:function(r){var i=t.DomUtil.create("button");return e(i).addClass("btn btn-default"),e(i).append(e(' <span class="glyphicon glyphicon-chevron-up"/> ')),i.onclick=function(){r.isFullscreen()&&r.toggleFullscreen(),e(n).scrollTop(0,0)},i}})}var s=["http://www.opengis.net/ont/geosparql#wktLiteral","http://www.openlinksw.com/schemas/virtrdf#Geometry"],u="http://www.opengis.net/def/crs/OGC/1.3/CRS84",l=["http://www.wikidata.org/entity/Q2",u],p=["layerLabel","layer"],c={wikimedia:{url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",options:{id:"wikipedia-map-01",attribution:' <a href="http://maps.wikimedia.org/">Wikimedia</a> | &copy; <a href="http://openstreetmap.org/copyright">Open Street Map</a> contributors'}},osm:{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}}},h=null;return o.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,o.prototype._map=null,o.prototype._markerGroups=null,o.prototype._getMarkerGroupColor=null,o.prototype.draw=function(r){var a=e("<div>").attr("id","map").height("100vh");r.html(a),this._createMarkerGroups(),this._map=t.map("map",{center:[0,0],maxZoom:18,minZoom:2,fullscreenControl:!0,preferCanvas:!0,layers:i.compact(this._markerGroups)}).fitBounds(this._markerGroups._LAYER_DEFAULT_GROUP.getBounds()),this._setTileLayer(),this._createControls(),this._createMarkerZoomResize(),r.html(a)},o.prototype._createControls=function(){var r=this;if(this._map.addControl(t.control.zoomBox({modal:!1,className:"glyphicon glyphicon-zoom-in"})),this._map.addControl(new h),Object.keys(this._markerGroups).length>1){var i=this._getLayerControl(this._markerGroups).addTo(this._map);this._map.on("overlayadd overlayremove",function(t){t.layer===r._markerGroups._LAYER_DEFAULT_GROUP&&(e.each(r._markerGroups,function(e,i){"overlayadd"===t.type?r._map.addLayer(i):r._map.removeLayer(i)}),i._update())})}},o.prototype._createMarkerZoomResize=function(){var e=this;if(!(this._markerGroups._LAYER_DEFAULT_GROUP.getLayers().length>1e3)){this._map.on("zoomend",function(){e._markerGroups._LAYER_DEFAULT_GROUP.setStyle({radius:e._getMarkerRadius()})})}},o.prototype._getMarkerRadius=function(){return this._map?.5*this._map.getZoom():3},o.prototype._getLayerControl=function(){var r=this,i={},a="";return e.each(this._markerGroups,function(e,t){if("_LAYER_DEFAULT_GROUP"===e)a=r._i18n("wdqs-result-map-layers-all","All layers");else{var n=r._getMarkerGroupColor(e);a='<span style="color:'+n+'">&#x2b24;</span> '+e}i[a]=t}),t.control.layers(null,i)},o.prototype._createMarkerGroups=function(){var r=this,i={};if(i._LAYER_DEFAULT_GROUP=[],this._iterateResult(function(e,a,n){if(e&&-1!==s.indexOf(e.datatype)){var o=r._extractGeoJson(e.value);if(!o)return;var u=r._getMarkerGroupsLayer(n);i[u]||(i[u]=[]);var l=t.geoJson(o,{style:r._getMarkerStyle(u),pointToLayer:function(e,i){return t.circleMarker(i,r._getMarkerStyle(u))},onEachFeature:function(e,i){var a=t.popup();i.bindPopup(a),i.on("click",function(){var e=r._getItemDescription(n);a.setContent(e[0])})}});i[u].push(l),i._LAYER_DEFAULT_GROUP.push(l)}}),0===Object.keys(i).length){var a=t.marker([0,0]).bindPopup("Nothing found!").openPopup();return{null:t.featureGroup([a])}}e.each(i,function(e){i[e]=t.featureGroup(i[e])}),this._markerGroups=i},o.prototype._getMarkerGroupsLayer=function(e){var t=p.find(function(t){return e[t]});return t?e[t].value:"_LAYER_DEFAULT_GROUP"},o.prototype._getMarkerStyle=function(e){var t="#e04545";return"_LAYER_DEFAULT_GROUP"!==e&&(t=this._getMarkerGroupColor(e)),{color:t,opacity:.8,fillColor:t,fillOpacity:.9,radius:this._getMarkerRadius()}},o.prototype._splitWktLiteral=function(e){var t=e.match(/(<([^>]*)> +)?(.*)/);return t?{crs:t[2]||u,wkt:t[3]}:null},o.prototype._extractGeoJson=function(e){var t=this._splitWktLiteral(e);return t?-1===l.indexOf(t.crs)?null:a.parse(t.wkt):null},o.prototype._getItemDescription=function(t){return e("<div/>").append(this._getFormatter().formatRow(t,!0))},o.prototype._setTileLayer=function(){var e=c.osm;("query.wikidata.org"===n.location.host||"localhost"===n.location.host||n.location.host.endsWith(".wmflabs.org"))&&(e=c.wikimedia),t.tileLayer(e.url,e.options).addTo(this._map)},o.prototype.visit=function(e){return this._checkCoordinate(e)},o.prototype._checkCoordinate=function(e){return!e||-1===s.indexOf(e.datatype)||null===this._extractGeoJson(e.value)||(this._drawable=!0,!1)},o}(jQuery,L,d3,_,wellknown,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeMapResultBrowser=function(e,t,r){"use strict";function i(){this._labelColumns={}}return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._labelColumns=null,i.prototype.draw=function(e){var t=this,r={},i=r,a=null,n=null,o=null;this._iterateResult(function(e,s,u){u!==o&&(null!==o&&(i.data={size:a,url:n},a=null,n=null,i=r),o=u),t._getFormatter().isLabel(e)&&(i[e.value]||(i[e.value]={}),i=i[e.value]),t._getFormatter().isNumber(e)&&(a=e.value),e&&e.value&&t._getFormatter().isEntityUri(e.value)&&(n=e.value)}),i.data={size:a,url:n};var s={name:"treeMap",children:this._createTreeData(r)};this._draw(e,s)},i.prototype._createTreeData=function(t){var r,i=this,a=[];return t.data?a:(e.each(t,function(e,t){var n=i._createTreeData(t);if(0!==n.length)r={id:e,name:e,children:n};else{var o=1;t.data.size&&t.data.size>0&&(o=t.data.size);var s=e,u=t.data.url;u&&(s=u),r={id:s+Math.random(),name:e,size:o,url:u}}a.push(r)}),a)},i.prototype._draw=function(i,a){function n(e){return e.size}function o(e){return 1}function s(e){var t=e.substring(1,3),r=e.substring(3,5),i=e.substring(5,7);return{R:parseInt(t,16),G:parseInt(r,16),B:parseInt(i,16)}}function u(e){var t=s(e);return 255-(.299*t.R+.587*t.G+.114*t.B)<105?"#000000":"#ffffff"}function l(e){_.padding([m/(y/e.dy),0,0,0]).nodes(e);var r=d/e.dx,i=y/e.dy,a=e;w.domain([e.x,e.x+e.dx]),f.domain([e.y,e.y+e.dy]),k.selectAll(".labelbody .label").style("display","block");var n=k.selectAll("g.cell").transition().duration(v).attr("transform",function(e){return"translate("+w(e.x)+","+f(e.y)+")"}).each("end",function(e,t){t||a===self.root||(k.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("color",function(e){return u(g(e.parent.name))}),h?k.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject").style("display",""):k.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("display",""))});n.select(".foreignObject").attr("width",function(e){return Math.max(.01,r*e.dx)}).attr("height",function(e){return e.children?m:Math.max(.01,i*e.dy)}).select(".labelbody .label").text(function(e){return e.name}),n.select("rect").attr("width",function(e){return Math.max(.01,r*e.dx)}).attr("height",function(e){return e.children?m:Math.max(.01,i*e.dy)}).style("fill",function(e){return e.children?b:g(e.parent.name)}),c=e,t.event&&t.event.stopPropagation()}var p,c,h=!1,d=e(r).width(),y=e(r).height(),w=t.scale.linear().range([0,d]),f=t.scale.linear().range([0,y]),g=t.scale.category10(),m=20,b="#555555",v=500,_=t.layout.treemap().round(!1).size([d,y]).sticky(!0).value(function(e){return e.size}),k=t.select(i[0]).append("svg:svg").attr("width",d).attr("height",y).append("svg:g");c=p=a;var S=_.nodes(p),q=S.filter(function(e){return!e.children}),E=S.filter(function(e){return e.children}),R=k.selectAll("g.cell.parent").data(E,function(e){return"p-"+e.id}),T=R.enter().append("g").attr("class","cell parent").on("click",function(e){l(e)});T.append("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",m).style("fill",b),T.append("foreignObject").attr("class","foreignObject").append("xhtml:body").attr("class","labelbody").append("div").attr("class","label");var L=R.transition().duration(v);L.select(".cell").attr("transform",function(e){return"translate("+e.dx+","+e.y+")"}),L.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",m).style("fill",b),L.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",m).select(".labelbody .label").text(function(e){return e.name}),R.exit().remove();var x=k.selectAll("g.cell.child").data(q,function(e){return"c-"+e.id}),C=x.enter().append("g").attr("class","cell child").on("click",function(e){l(c===e.parent?p:e.parent)});C.append("rect").classed("background",!0).style("fill",function(e){return g(e.parent.name)}),C.append("foreignObject").attr({class:"foreignObject",width:function(e){return Math.max(.01,e.dx)},height:function(e){return Math.max(.01,e.dy)}}).append("xhtml:body").attr("class","labelbody").append("div").attr("class","label").text(function(e){return e.name}).on("click",function(e){e.url&&(r.open(e.url,"_blank"),t.event.stopPropagation())});var A=x.transition().duration(v);A.select(".cell").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),A.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return e.dy}).style("fill",function(e){return g(e.parent.name)}),A.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return Math.max(.01,e.dy)}).select(".labelbody .label").text(function(e){return e.name}),x.exit().remove(),t.select("select").on("change",function(){console.log("select zoom(node)"),_.value("size"==value?n:o).nodes(p),l(c)}),l(c)},i.prototype.isDrawable=function(){return Object.keys(this._labelColumns).length>1},i.prototype.visit=function(e,t){return this._checkColumn(e,t)},i.prototype._checkColumn=function(e,t){return!this._getFormatter().isLabel(e,t)||(this._labelColumns[t]=!0,!this.isDrawable())},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeResultBrowser=function(e,t,r){"use strict";function i(){this._labelColumns={}}var a='SELECT ?property ?propertyLabel ?value ?valueItemLabel ?valueImage WHERE {       {         SELECT ?property ?value ?valueImage ?valueItem WHERE {           BIND(<{ENTITY_URI}> AS ?item)           ?item ?prop ?value.           ?property wikibase:directClaim ?prop.           ?property rdf:type wikibase:Property.           OPTIONAL { ?value wdt:P18 ?valueImage. }           OPTIONAL { BIND(?value AS ?valueItem).  FILTER(STRSTARTS(STR(?value), STR(wd:))) }         }       }       SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }    }  ';return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._isDrawable=!1,i.prototype._jsTree=null,i.prototype._nodes=null,i.prototype.draw=function(i){var a=this;this._nodes=this._extractNodes(e.proxy(this._iterateResult,this));var n=e("<div>").jstree({core:{data:t.compact(a._nodes),check_callback:!0},plugins:["types","wholerow","contextmenu","unique"],types:{default:{icon:"glyphicon glyphicon-barcode"}},contextmenu:{items:function(e){return{Open:{label:a._nodes[e.id].url,icon:"glyphicon glyphicon-link",action:function(){r.open(a._nodes[e.id].url,"_blank")}},explore:{label:a._nodes[e.id].url,icon:"glyphicon glyphicon-download-alt",action:function(){a._expandTree(a._nodes[e.id])}}}}}});this._jsTree=n.jstree(),i.empty().append(n)},i.prototype._extractNodes=function(e,t){var r=null,i={},a=null,n={},o=this._getFormatter();return e(function(e,s,u){u!==r&&(a=null,r=u),e&&e.value&&(a&&(o.isLabel(e)||o.isNumber(e))&&(n[a].text=(n[a].text||"")+" "+e.value),a&&o.isCommonsResource(e.value)&&(n[a].icon=o.getCommonsResourceFileNameThumbnail(e.value,24)),o.isEntity(e)&&((i={}).parent=a||t||"#",i.id=i.parent+e.value,i.url=e.value,i.state={opened:!1},n[i.id]=i,a=i.id))}),n},i.prototype._expandTree=function(t){var r=this;this.getSparqlApi().query(a.replace("{ENTITY_URI}",t.url)).done(function(){var i=r.getSparqlApi().getResultRawData(),a=r._extractNodes(function(t){e.each(i.results.bindings,function(r,a){e.each(i.head.vars,function(e,i){var n=a[i]||null;t(n,i,a,r)})})},t.id);e.extend(r._nodes,a),e.each(a,function(e,t){r._jsTree.create_node(t.parent,t)})})},i.prototype.isDrawable=function(){return this._isDrawable},i.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||(this._isDrawable=!0,!1)},i}(jQuery,_,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.BubbleChartResultBrowser=function(e,t,r){"use strict";function i(){}return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._hasLabel=!1,i.prototype._hasNumber=!1,i.prototype.draw=function(t){var r=this,i={name:"bubblechart",children:[]},a=this._getLabelColumns()[0],n=this._getNumberColumns()[0],o=null;this._iterateResult(function(e,t,s){if(s!==o){var u={url:null};o=s,s.rgb&&r._getFormatter().isColor(s.rgb)&&(u.color=r._getFormatter().getColorForHtml(s.rgb)),s[a]&&s[n]&&(u.name=s[a].value,u.size=s[n].value,i.children.push(u))}if(e&&e.value&&r._getFormatter().isEntityUri(e.value)){var l=i.children[i.children.length-1];null===l.url&&(l.url=e.value)}});var s=e("<center>");t.html(s),this._drawBubbleChart(s,i)},i.prototype._drawBubbleChart=function(i,a){var n=this,o=Math.min(.98*e(r).height(),e(r).width()),s=t.scale.category20c(),u=t.layout.pack().sort(null).size([o,o]).padding(1.5),l=t.select(i[0]).append("svg").attr({class:"bubble",width:o,height:o}).selectAll(".node").data(u.nodes(function(e){function t(e,i){i.children?i.children.forEach(function(e){t(i.name,e)}):r.push({packageName:e,className:i.name,value:i.size,url:i.url,color:i.color})}var r=[];return t(null,e),{children:r}}(a)).filter(function(e){return!e.children})).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});l.append("title").text(function(e){return e.className+": "+e.value}),l.append("circle").attr("r",function(e){return e.r}).style("fill",function(e){return e.color||s(e.className)}),l.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(e){return e.className.substring(0,e.r/4)}).on("click",function(e){e.url&&r.open(e.url,"_blank")}).style("fill",function(e){if(e.color)return n._getFormatter().calculateLuminance(e.color)<=.5?"#FFF":"#000"}).style("cursor","pointer")},i.prototype.isDrawable=function(){return this._hasLabel&&this._hasNumber},i.prototype.visit=function(e){return this._checkColumn(e)},i.prototype._checkColumn=function(e){return this._getFormatter().isNumber(e)&&(this._hasNumber=!0),this._getFormatter().isLabel(e)&&(this._hasLabel=!0),!this.isDrawable()},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.LineChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.line},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.BarChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.bar},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.ScatterChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.scatter},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AreaChartResultBrowser=function(e){"use strict";function t(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return t.prototype=new r,t.prototype._getPlotType=function(){return e.plot.area},t}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TimelineResultBrowser=function(e,t,r,i){"use strict";function a(){}var n={minHeight:"400px",orientation:{axis:"both",item:"top"},align:"auto",zoomKey:"ctrlKey"};return a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,a.prototype.draw=function(r){var i=e("<div>"),a=new t.Timeline(i[0],this._getItems(),n);a.on("changed",function(){e(a.dom.root).find(".vis-item.vis-range").each(function(){var t=e(this);t.css("min-width","unset"),t.css("min-width",t.css("width"))})}),r.append(i.prepend(this._createToolbar(a)))},a.prototype._getItems=function(){var e=this,r=[];return this._iterateResult(function(t,i,a,n){if(e._getFormatter().isDateTime(t))if(r[n]){var o=[];o.push(e._getFormatter().parseDate(t.value)),r[n].start&&o.push(r[n].start),r[n].end&&o.push(r[n].end),r[n].start=o.reduce(function(e,t){return e<t?e:t}),r[n].end=o.reduce(function(e,t){return e>t?e:t})}else r[n]={id:n,content:e._getHtml(a).html(),start:e._getFormatter().parseDate(t.value)}}),new t.DataSet(i.compact(r))},a.prototype._getHtml=function(t){return e("<div/>").append(this._getFormatter().formatRow(t,!0))},a.prototype._createToolbar=function(t){function r(e){var r=t.getWindow(),i=r.end-r.start;t.setWindow({start:r.start.valueOf()-i*e,end:r.end.valueOf()+i*e})}var i=e('<div style="margin-top: -35px; text-align: center;">');return e('<a class="btn btn-default">').click(e.proxy(t.redraw,t)).append('<span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>').appendTo(i),e('<a class="btn btn-default">').click(e.proxy(t.fit,t)).append('<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r(.2)}).append('<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r(-.2)}).append('<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>').appendTo(i),i},a.prototype.visit=function(e){return!this._getFormatter().isDateTime(e)||(this._drawable=!0,!1)},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.MultiDimensionResultBrowser=function(e,t,r){"use strict";function i(){}var a="http://www.w3.org/2001/XMLSchema#dateTime";return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype.draw=function(e){var t={},r=[],i=this._getFormatter();this._iterateResult(function(e,n,o,s){if(r[s]||(r[s]={}),r[s][n]=e&&e.value||"undefined",e&&e.type===a&&(r[s][n]=new Date(e.value).toLocaleDateString()),!t[n]){var u={key:n,description:n,type:"STRING"};i.isNumber(e)&&(u.type="NUMBER"),e&&e.type===a&&(u.type="DATE"),t[n]=u}}),this._draw(e,r,_.values(t))},i.prototype._draw=function(i,a,n){function o(){t.event.sourceEvent.stopPropagation()}function s(){var e=n.filter(function(e){return!e.brush.empty()}),r=e.map(function(e){return e.brush.extent()});t.selectAll(".foreground path").style("display",function(t){return e.every(function(e,i){return e.type.within(t[e.key],r[i],e)})?null:"none"})}var u={top:50,right:80,bottom:10,left:100},l=e(r).width()-(u.left+u.right),p=e(r).height()-(u.top+u.bottom),c={NUMBER:{key:"Number",coerce:function(e){return+e},extent:t.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:t.scale.linear().range([p,0])},STRING:{key:"String",coerce:String,extent:function(e){return e.sort()},within:function(e,t,r){return t[0]<=r.scale(e)&&r.scale(e)<=t[1]},defaultScale:t.scale.ordinal().rangePoints([0,p])},DATE:{key:"Date",coerce:function(e){return new Date(e)},extent:t.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:t.time.scale().range([0,p])}};e.each(n,function(){this.type=c[this.type]});var h=t.scale.ordinal().domain(n.map(function(e){return e.key})).rangePoints([0,l]),d=t.svg.line().defined(function(e){return!isNaN(e[1])}),y=t.svg.axis().orient("left"),w=t.select(i[0]).append("svg").attr({width:l+u.left+u.right,height:p+u.top+u.bottom}).append("g").attr("transform","translate("+u.left+","+u.top+")"),f=w.append("g").attr("class","foreground"),g=w.selectAll(".axis").data(n).enter().append("g").attr("class","axis").attr("transform",function(e){return"translate("+h(e.key)+")"});a.forEach(function(e){n.forEach(function(t){e[t.key]=t.type.coerce(e[t.key])})}),n.forEach(function(e){"domain"in e||(e.domain=t.functor(e.type.extent)(a.map(function(t){return t[e.key]})),e.domain.sort(function(e,t){return e-t})),"scale"in e||(e.scale=e.type.defaultScale.copy()),e.scale.domain(e.domain)}),f.selectAll("path").data(a).enter().append("path").attr("d",function(e){return d(n.map(function(t){return[h(t.key),t.scale(e[t.key])]}))}).style("stroke",function(e){return"#6ac"}),g.append("g").attr("class","axis").each(function(e){var r=e.axis&&e.axis.scale(e.scale)||y.scale(e.scale);t.select(this).call(r)}).append("text").attr("class","title").attr("text-anchor","start").text(function(e){return e.description||e.key}),g.append("g").attr("class","brush").each(function(e){t.select(this).call(e.brush=t.svg.brush().y(e.scale).on("brushstart",o).on("brush",s))}).selectAll("rect").attr("x",-8).attr("width",16)},i.prototype.isDrawable=function(){return this._drawable},i.prototype.visit=function(e){return this._drawable=!0,!1},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowser=function(e,t,r,i){"use strict";function a(){}var n={autoResize:!0,physics:{stabilization:{enabled:!0,iterations:10,fit:!0}},nodes:{shadow:!0,color:"#fff"},edges:{arrows:{to:!0}}};return a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,a.prototype.draw=function(i){var a=e("<div>").height("100vh"),o=this._getData(),s=new t.Network(a[0],o,n);s.on("doubleClick",function(e){1===e.nodes.length&&r.open(e.nodes[0],"_blank")});var u=new wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser(o.nodes,o.edges,this.getSparqlApi());s.on("click",function(e){var t=e.nodes[0]||null;u.browse(t)}),a.prepend(this._createToolbar(s)),i.append(a)},a.prototype._createToolbar=function(t){function r(e){t.setOptions({layout:{hierarchical:{direction:e,sortMethod:"directed"}}})}var i=e('<div style="margin-top: -35px; text-align: center;">');return e('<a class="btn btn-default">').click(function(){t.stabilize(100)}).append('<span class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-stabilize")+'"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r("LR")}).append('<span class="glyphicon glyphicon-indent-left" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-lr")+'"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r("UD")}).append('<span class="glyphicon glyphicon-align-center" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-ud")+'"></span>').appendTo(i),e('<a class="btn btn-default">').click(function(){r("RL")}).append('<span class="glyphicon glyphicon-indent-right" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-rl")+'"></span>').appendTo(i),i},a.prototype._getData=function(){var e={},r={},a=[],n=this._getFormatter(),o={},s={};return this._iterateResult(function(t,i,u,l){if(t&&t.value){if(n.isEntity(t)){var p=u[i+"Label"]&&u[i+"Label"].value||t.value,c=t.value;o={id:c,label:p,title:p},a[l]?(s={from:a[l],to:c},r[s.from+s.to]=s,e[c]||(e[c]=o)):(e[c]=o,a[l]=o.id)}if(n.isCommonsResource(t.value)&&(o.image=n.getCommonsResourceFileNameThumbnail(t.value,150),o.shape="image",o.font={color:"black"}),n.isNumber(t)&&(o.value=t.value,o.title+=" value:"+t.value,o.shape="dot",o.font={color:"black"}),"rgb"===i&&n.isColor(t)&&(o.color=n.getColorForHtml(t),"dot"!==o.shape&&"image"!==o.shape)){var h=n.calculateLuminance(t.value)<=.5?"#FFF":"#000";o.font={color:h}}"edgeLabel"===i&&(s.label=t.value)}}),{nodes:new t.DataSet(i.compact(e)),edges:new t.DataSet(i.compact(r))}},a.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||(this._drawable=!0,!1)},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser=function(e,t,r,i){"use strict";function a(e,t,r){this._nodes=e,this._edges=t,this._sparql=r}var n='SELECT ?p (SAMPLE(?pl) AS ?pl) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol)  WHERE {<{entityUri}> ?p ?o .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p',o='SELECT ?o ?ol WHERE {<{entityUri}> <{propertyUri}> ?o .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50';return a.prototype._nodes=null,a.prototype._nodes=null,a.prototype._sparql=null,a.prototype._selectedNodeId=null,a.prototype._temporaryNodes={},a.prototype._temporaryEdges={},a.prototype._getEntites=function(t,r){var i=this,a=e.Deferred();return this._sparql.query(o.replace("{entityUri}",t).replace("{propertyUri}",r)).done(function(){var t=i._sparql.getResultRawData(),r=[];e.each(t.results.bindings,function(e,t){r.push({id:t.o.value,label:t.ol.value})}),a.resolve(r)}),a},a.prototype._getProperties=function(t){var r=this,i=e.Deferred();return this._sparql.query(n.replace("{entityUri}",t)).done(function(){var t=r._sparql.getResultRawData(),a=[];e.each(t.results.bindings,function(e,t){a.push({id:t.p.value,label:t.pl.value,count:t.count.value,items:t.ol.value})}),i.resolve(a)}),i},a.prototype._removeTemporaryNodes=function(t){var r=this;e.each(this._temporaryNodes,function(e,t){r._nodes.remove(t.id)}),e.each(this._temporaryEdges,function(e,t){r._edges.remove(t.id)}),this._temporaryNodes={},this._temporaryEdges={}},a.prototype._expandPropertyNode=function(t){var r=this,i=this._temporaryNodes[t];this._getEntites(i.entityId,i.id).done(function(t){e.each(t,function(e,t){null===r._nodes.get(t.id)&&r._nodes.add({id:t.id,label:t.label}),r._edges.add({dashes:!0,from:i.entityId,to:t.id,label:i.propertyLabel,linkType:i.id})})})},a.prototype._expandEntityNode=function(t){var r=this;this._getProperties(t).done(function(i){e.each(i,function(e,i){if(!(r._edges.get({filter:function(e){return e.linkType===i.id&&e.from===t}}).length>0)){var a={id:i.id,label:"1"===i.count?i.items:i.count,title:i.items,entityId:t,propertyLabel:i.label,color:"#abc9f2"},n={id:i.id,dashes:!0,label:i.label,from:t,to:i.id};r._temporaryNodes[a.id]=a,r._nodes.add(a),r._temporaryEdges[n.id]=n,r._edges.add(n)}})})},a.prototype.browse=function(e){if(null!==e){if(this._temporaryNodes[e])return this._expandPropertyNode(e),void this._removeTemporaryNodes();null!==this._selectedNodeId&&e!==this._selectedNodeId&&this._removeTemporaryNodes(),this._expandEntityNode(e),this._selectedNodeId=e}else this._removeTemporaryNodes()},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Sparql=function(e){"use strict";function t(e,t){this._serviceUri=e||r,this._language=t||n}var r="https://query.wikidata.org/bigdata/namespace/wdq/sparql",i={TIMEOUT:10,MALFORMED:20,SERVER:30,UNKNOWN:100},a={"QueryTimeoutException: Query deadline is expired":i.TIMEOUT,"MalformedQueryException: ":i.MALFORMED},n="en";return t.prototype.ERROR_CODES=i,t.prototype._serviceUri=null,t.prototype._executionTime=null,t.prototype._error=null,t.prototype._resultLength=null,t.prototype._rawData=null,t.prototype._queryUri=null,t.prototype._language=null,t.prototype.queryDataUpdatedTime=function(){var t=e.Deferred(),r=encodeURI("prefix schema: <http://schema.org/> SELECT * WHERE {<http://www.wikidata.org> schema:dateModified ?y}"),i=this._serviceUri+"?query="+r+"&nocache="+Math.floor(Date.now()/6e4),a={headers:{Accept:"application/sparql-results+json"}};return e.ajax(i,a).done(function(e,r,i){if(e.results.bindings[0]){var a=new Date(e.results.bindings[0][e.head.vars[0]].value),n=a.toLocaleTimeString(navigator.language,{timeZoneName:"short"})+", "+a.toLocaleDateString(navigator.language,{month:"short",day:"numeric",year:"numeric"}),o=Math.round((new Date-a)/1e3);t.resolve(n,o)}else t.reject()}).fail(function(){t.reject()}),t},t.prototype.query=function(t,r){function i(e,t,r){o._executionTime=Date.now()-o._executionTime,"boolean"==typeof e.boolean?o._resultLength=1:o._resultLength=e.results.bindings.length||0,o._rawData=e,s.resolve(e)}function a(e,t,r){o._executionTime=null,o._rawData=null,o._resultLength=null,o._generateErrorMessage(e,t,r),s.reject()}t=this._replaceAutoLanguage(t);var n="query="+encodeURIComponent(t);r&&(n+="&maxQueryTimeMillis="+r);var o=this,s=e.Deferred(),u={headers:{Accept:"application/sparql-results+json"},data:n};return this._queryUri=this._serviceUri+"?"+u.data,this._executionTime=Date.now(),e.ajax(this._serviceUri,u).done(i).fail(function(t,r,n){""===t.getAllResponseHeaders()?(u.method="POST",e.ajax(o._serviceUri,u).done(i).fail(a)):a.apply(this,arguments)}),s},t.prototype._generateErrorMessage=function(e,t,r){var n={code:i.UNKNOWN,message:null,debug:e.responseText};(0===e.status||r)&&(n.code=i.SERVER,n.message=r.message);try{var o=n.debug.substring(n.debug.indexOf("java.util.concurrent.ExecutionException:"));for(var s in a)-1!==o.indexOf(s)&&(n.code=a[s],n.message=null);n.code!==i.UNKNOWN&&n.code!==i.MALFORMED||(n.message=n.debug.match(/(java\.util\.concurrent\.ExecutionException\:)+(.*)(Exception\:)+(.*)/).pop().trim())}catch(e){}this._error=n},t.prototype.getExecutionTime=function(){return this._executionTime},t.prototype.getError=function(){return this._error},t.prototype.getResultLength=function(){return this._resultLength},t.prototype.getQueryUri=function(){return this._queryUri},t.prototype._processData=function(e,t,r){for(var i=e.results.bindings.length,a=0;a<i;a++){for(var n={},o=0;o<e.head.vars.length;o++)e.head.vars[o]in e.results.bindings[a]?n[e.head.vars[o]]=e.results.bindings[a][e.head.vars[o]]:n[e.head.vars[o]]=void 0;r=t(n,r)}return r},t.prototype._encodeCsv=function(e){var t=e.replace(/"/g,'""');return/[",\n]/.test(t)&&(t='"'+t+'"'),t},t.prototype.getResultRawData=function(){return this._rawData},t.prototype.getResultAsCsv=function(){var e=this,t=e._rawData,r=t.head.vars.map(this._encodeCsv).join(",")+"\n";return r=this._processData(t,function(t,r){var i,a="",n=!0;for(var o in t)i=void 0===t[o]?"":e._encodeCsv(t[o].value),n?n=!1:a+=",",a+=i;return a+="\n",r+a},r)},t.prototype.getResultAsJson=function(){var e=[],t=this._rawData;return e=this._processData(t,function(e,t){var r={};for(var i in e)r[i]=(e[i]||{}).value;return t.push(r),t},e),JSON.stringify(e)},t.prototype.getResultAsAllJson=function(){return JSON.stringify(this._rawData)},t.prototype._renderValueTSV=function(e){var t=e.value.replace(/\t/g,"");switch(e.type){case"uri":return"<"+t+">";case"bnode":return"_:"+t;case"literal":var r=JSON.stringify(t);return e["xml:lang"]?r+"@"+e["xml:lang"]:e.datatype?"http://www.w3.org/2001/XMLSchema#integer"===e.datatype||"http://www.w3.org/2001/XMLSchema#decimal"===e.datatype||"http://www.w3.org/2001/XMLSchema#double"===e.datatype?t:r+"^^<"+e.datatype+">":r}return t},t.prototype.getSparqlTsv=function(){var e=this,t=this._rawData,r=t.head.vars.map(function(e){return"?"+e}).join("\t")+"\n";return r=this._processData(t,function(t,r){var i,a="",n=!0;for(var o in t)i=void 0===t[o]?"":e._renderValueTSV(t[o]),n?n=!1:a+="\t",a+=i;return a+="\n",r+a},r)},t.prototype.getSimpleTsv=function(){var e=this._rawData,t=e.head.vars.join("\t")+"\n";return t=this._processData(e,function(e,t){var r,i="",a=!0;for(var n in e)r=void 0===e[n]?"":e[n].value.replace(/\t/g,""),a?a=!1:i+="\t",i+=r;return i+="\n",t+i},t)},t.prototype._replaceAutoLanguage=function(e){return e.replace(/\[AUTO_LANGUAGE\]/g,this._language)},t.prototype.setLanguage=function(e){this._language=e},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Wikibase=function(e){"use strict";function t(e,t){this._endpoint=r,e&&(this._endpoint=e),t&&(this._language=t)}var r="https://www.wikidata.org/w/api.php",i={action:"wbsearchentities",format:"json",continue:0,language:"en",uselang:"en"},a={action:"query",meta:"siteinfo",format:"json",siprop:"languages"};return t.prototype._endpoint=null,t.prototype._language=null,t.prototype.searchEntities=function(e,t,r){var a=i;return a.search=e,t&&(a.type=t),(this._language||r)&&(a.language=r||this._language,a.uselang=r||this._language),this._query(a)},t.prototype.getLanguages=function(){return this._query(a)},t.prototype._query=function(t){return e.ajax({url:this._endpoint+"?"+jQuery.param(t),dataType:"jsonp"})},t.prototype.setLanguage=function(e){this._language=e},t}(jQuery);var tracking=tracking||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Tracking=function(e){"use strict";function t(e){this._endpoint=r,e&&(this._endpoint=e)}var r="https://www.wikidata.org/beacon/statsv";return t.prototype._endpoint=null,t.prototype.track=function(e,t,r){if(t||(t=1),r||(r="c"),"query.wikidata.org"===location.hostname)return this._track(e+"="+t+r)},t.prototype._track=function(t){return e.ajax({url:this._endpoint+"?"+t,dataType:"jsonp"})},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.RdfNamespaces={},function(e,t){"use strict";t.NAMESPACE_SHORTCUTS={Wikidata:{wikibase:"http://wikiba.se/ontology#",wd:"http://www.wikidata.org/entity/",wdt:"http://www.wikidata.org/prop/direct/",wds:"http://www.wikidata.org/entity/statement/",p:"http://www.wikidata.org/prop/",wdref:"http://www.wikidata.org/reference/",wdv:"http://www.wikidata.org/value/",ps:"http://www.wikidata.org/prop/statement/",psv:"http://www.wikidata.org/prop/statement/value/",psn:"http://www.wikidata.org/prop/statement/value-normalized/",pq:"http://www.wikidata.org/prop/qualifier/",pqv:"http://www.wikidata.org/prop/qualifier/value/",pqn:"http://www.wikidata.org/prop/qualifier/value-normalized/",pr:"http://www.wikidata.org/prop/reference/",prv:"http://www.wikidata.org/prop/reference/value/",prn:"http://www.wikidata.org/prop/reference/value-normalized/",wdno:"http://www.wikidata.org/prop/novalue/",wdata:"http://www.wikidata.org/wiki/Special:EntityData/"},W3C:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",owl:"http://www.w3.org/2002/07/owl#",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",prov:"http://www.w3.org/ns/prov#"},"Social/Other":{schema:"http://schema.org/",geo:"http://www.opengis.net/ont/geosparql#",geof:"http://www.opengis.net/def/geosparql/function/"},Blazegraph:{bd:"http://www.bigdata.com/rdf#",bds:"http://www.bigdata.com/rdf/search#",gas:"http://www.bigdata.com/rdf/gas#",hint:"http://www.bigdata.com/queryHints#"}},t.ENTITY_TYPES={"http://www.wikidata.org/prop/direct/":"property","http://www.wikidata.org/prop/":"property","http://www.wikidata.org/prop/novalue/":"property","http://www.wikidata.org/prop/statement/":"property","http://www.wikidata.org/prop/statement/value/":"property","http://www.wikidata.org/prop/statement/value-normalized/":"property","http://www.wikidata.org/prop/qualifier/":"property","http://www.wikidata.org/prop/qualifier/value/":"property","http://www.wikidata.org/prop/qualifier/value-normalized/":"property","http://www.wikidata.org/prop/reference/":"property","http://www.wikidata.org/prop/reference/value/":"property","http://www.wikidata.org/prop/reference/value-normalized/":"property","http://www.wikidata.org/wiki/Special:EntityData/":"item","http://www.wikidata.org/entity/":"item"},t.ALL_PREFIXES=e.map(t.NAMESPACE_SHORTCUTS,function(e){return e}).reduce(function(t,r,i){return e.extend(t,r)},{}),t.STANDARD_PREFIXES={wd:"PREFIX wd: <http://www.wikidata.org/entity/>",wdt:"PREFIX wdt: <http://www.wikidata.org/prop/direct/>",wikibase:"PREFIX wikibase: <http://wikiba.se/ontology#>",p:"PREFIX p: <http://www.wikidata.org/prop/>",ps:"PREFIX ps: <http://www.wikidata.org/prop/statement/>",pq:"PREFIX pq: <http://www.wikidata.org/prop/qualifier/>",rdfs:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>",bd:"PREFIX bd: <http://www.bigdata.com/rdf#>"},t.getPrefixMap=function(r){var i={};return e.each(t.ALL_PREFIXES,function(e,t){r[t]&&(i[e]=r[t])}),i}}(jQuery,wikibase.queryService.RdfNamespaces),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryHelper=function(e,t,r){"use strict";function i(e,r,i){this._api=e||new t.queryService.api.Wikibase,this._selectorBox=i||new t.queryService.ui.queryHelper.SelectorBox(this._api,r),this._query=new t.queryService.ui.queryHelper.SparqlQuery}var a={"http://www.w3.org/2000/01/rdf-schema#label":!0,"http://schema.org/description":!0,"http://www.bigdata.com/queryHints#optimizer":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},n={formatNoMatches:function(){}};return i.prototype._api=null,i.prototype._selectorBox=null,i.prototype._changeListener=null,i.prototype._query=null,i.prototype._triples=[],i.prototype._isSimpleMode=!1,i.prototype._labels={filter:"Filter",show:"Show",anything:"anything",with:"with",any:"any",or:"or",subtype:"subtype"},i.prototype.setQuery=function(e){var r=t.queryService.RdfNamespaces.ALL_PREFIXES;this._query.parse(e,r),this._selectorBox.setQuery(this._query)},i.prototype.getQuery=function(){try{var e=this._query.getQueryString();return(e=this._cleanQueryPrefixes(e).trim()).trim()}catch(e){return null}},i.prototype._cleanQueryPrefixes=function(e){for(var r,i=/PREFIX ([a-z]+): <(.*)>/gi,a={},n=e.replace(i,"").replace(/\n+/g,"\n");r=i.exec(e);){var o=r[1],s=r[2].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),u=n.replace(new RegExp("<"+s+"([^/>#]+?)>","gi"),o+":$1");n!==u&&(n=u,t.queryService.RdfNamespaces.STANDARD_PREFIXES[o]||(a[r[0]]=!0))}return n=Object.keys(a).join("\n")+"\n\n"+n.trim()},i.prototype.draw=function(e){var r=t.queryService.ui.queryHelper.QueryTemplate.parse(this._query),i=this,a=this._query.getBindings();if(null!==r)try{return e.html(r.getHtml(function(e){return i._getLabel(a[e].expression)},this._selectorBox,function(e,t,r){a[e].expression=a[e].expression.replace(new RegExp(t+"$"),"")+r,i._changeListener&&i._changeListener(i)}))}catch(e){window.console.error(e)}this._triples=this._query.getTriples();for(var n=this._query.getSubQueries();n.length>0;){var o=n.pop();this._triples=this._triples.concat(o.getTriples()),n.concat(o.getSubQueries())}this._isSimpleMode=this._isSimpleQuery(),e.html(this._getHtml())},i.prototype.setChangeListener=function(e){this._changeListener=e},i.prototype._i18n=function(t){return e.i18n?e.i18n("wdqs-ve-"+t):this._labels[t]},i.prototype._getHtml=function(){var t=this,r=e("<div>"),i=e("<table>").bootstrapTable(n),a=e("<table>").bootstrapTable(n);return e.each(this._triples,function(e,r){t._isNotRelevant(r.triple)||(t._isInShowSection(r.triple)?a.append(t._getTripleHtml(r)):i.append(t._getTripleHtml(r)))}),r.append(this._createSection(i,this._createFindButton(i)),this._createSection(a,this._createShowButton(a)),this._getLimitSection())},i.prototype._getLimitSection=function(){var t=e("<div>"),r=e('<a data-type="number">').attr("href","#").text("Limit").data("value",this._query.getLimit()),i=e("<span>").text(this._query.getLimit()||""),a=this;return this._selectorBox.add(r,null,function(e){"0"===e&&(e=null),i.text(e||""),a._query.setLimit(e),a._changeListener&&a._changeListener(a)},{trash:function(){return a._query.setLimit(null),r.data("value",""),i.text(""),a._changeListener&&a._changeListener(a),!0}}),t.append(r.append(" ",i))},i.prototype._createSection=function(t,r){return e("<table>").append(e("<tr>").append(e("<td>").append(r),e("<td>").append(t)))},i.prototype._createFindButton=function(t){var r=e('<a class="btn">').text(this._i18n("filter")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new item"}).attr("data-type","item").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(e,r,a){var n="http://www.wikidata.org/entity/"+e,o=i._query.getBoundVariables().shift();o||(o="?"+r.replace(/( |[^a-z0-9])/gi,"_"));var s="http://www.wikidata.org/prop/direct/"+(a&&a[e]&&a[e].propertyId||"P31"),u=i._query.addTriple(o,s,n,!1);i._query.hasVariable(o)||i._query.addVariable(o),t.append(i._getTripleHtml(u)),i._changeListener&&i._changeListener(i)}),r},i.prototype._createShowButton=function(t){var r=e('<a class="btn">').text(this._i18n("show")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new property"}).attr("data-type","property").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(e,r){var a="http://www.wikidata.org/prop/direct/"+e,n=i._query.getBoundVariables().shift();if(n){var o="?"+r.replace(/( |[^a-z0-9])/gi,"_"),s=i._query.addTriple(n,a,o,!0);i._query.addVariable(o),t.append(i._getTripleHtml(s)),i._changeListener&&i._changeListener(i)}}),r},i.prototype._isNotRelevant=function(e){return!!a[e.predicate]||!(!this._isSimpleMode||!this._isInShowSection(e)||!1!==this._query.hasVariable(e.object)||!1!==this._query.hasVariable(e.object+"Label")||!1!==this._query.isWildcardQuery())},i.prototype._isInShowSection=function(e){var t=this._query.getBindings();return!(!this._isVariable(e.subject)||!this._isVariable(e.object)||t[e.subject]||t[e.object])},i.prototype._getTripleHtml=function(t){var r=this,i=e("<tr>"),a=this._query.getBindings();return e.each(t.triple,function(n,o){if(r._isVariable(o)&&a[o]&&"string"==typeof a[o].expression&&(o=a[o].expression),r._isVariable(o)){if(r._isSimpleMode)return;o=o.replace("?","")}o.type&&"path"===o.type?i.append(e("<td>").append(r._getTripleEntityPathHtml(o,t,n))," "):i.append(e("<td>").append(r._getTripleEntityHtml(o,t,n))," ")}),i.append(this._getTripleHtmlToolbar(i,t))},i.prototype._getTripleHtmlToolbar=function(t,i){var a=this,n=e('<a href="#">').addClass("fa fa-trash-o").click(function(){var e=r.compact(i.triple).filter(function(e){return"string"==typeof e&&e.startsWith("?")}),n=e.map(function(e){return e+"Label"});return i.remove(),t.remove(),a._query.cleanupVariables(e.concat(n)),a._changeListener&&a._changeListener(a),!1});return e('<td class="toolbar">').append(n)},i.prototype._isVariable=function(e){return"string"==typeof e&&e.startsWith("?")},i.prototype._isSimpleQuery=function(){var t={},r=this;return e.each(this._triples,function(e,i){r._isVariable(i.triple.subject)&&!1===r._isVariable(i.triple.object)&&(t[i.triple.subject]=!0)}),Object.keys(t).length<=1},i.prototype._getTripleEntityPathHtml=function(t,r){var i=this,a=e("<span>");return e.each(t.items,function(n,o){if(o.type&&"path"===o.type)a.append(i._getTripleEntityPathHtml(o,r));else{n>0&&"/"===t.pathType&&a.append(" "+i._i18n("or")+" "+i._i18n("subtype")+" "),"*"===t.pathType&&a.append(" "+i._i18n("any")+" ");var s=t.items.reduce(function(e,t,r){return e[r]=t,e},{});s=e.extend(s,r.triple),(r=e.extend({},r)).triple=s,a.append(i._getTripleEntityHtml(o,r,n))}}),a},i.prototype._getTripleEntityHtml=function(t,r,i){var a=this,n=e("<span>");return this._getLabel(t).done(function(o,s,u,l){var p=e("<a>").text(o).attr({"data-id":s,"data-type":l,href:"#"}).appendTo(n);n.tooltip({title:"("+s+") "+u}),e(n).on("show.bs.tooltip",function(){e(".tooltip").is(":visible")&&e(".tooltip").not(this).hide()}),a._selectorBox.add(p,r.triple,function(e){var o=t.replace(new RegExp(s+"$"),"")+e;n.replaceWith(a._getTripleEntityHtml(o,r,i)),a._isVariable(r.triple[i])?a._query.getBindings()[r.triple[i]].expression=o:r.triple[i]=o,a._changeListener&&a._changeListener(a)},{tag:function(){return r.triple.object.startsWith("?")?a._query.addVariable(r.triple.object+"Label"):a._query.addVariable(r.triple.subject+"Label"),a._changeListener&&a._changeListener(a),!0}})}).fail(function(){n.text(t)}),n},i.prototype._getLabel=function(t){var r=e.Deferred(),i=t.match(/(Q|P)([0-9]+)/);if(!i)return r.reject().promise();var a={P:"property",Q:"item"};a=a[i[1]];var n=i[0];return this._api.searchEntities(n,a).done(function(t){e.each(t.search,function(e,t){return r.resolve(t.label,t.id,t.description,a),!1})}),r.promise()},i}(jQuery,wikibase,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SparqlQuery=function(e,t,r){"use strict";function i(e){this._query=e}return i.prototype._query=null,i.prototype._queryComments=null,i.prototype.parse=function(t,i){var a=new r.Parser(i),n=[];this._query=a.parse(t),e.each(t.split("\n"),function(e,t){0===t.indexOf("#")&&n.push(t)}),this._queryComments=n},i.prototype.getQueryString=function(){try{var e=(new r.Generator).stringify(this._query),t=this._queryComments.join("\n").trim();return""!==t?t+"\n"+e:e}catch(e){return null}},i.prototype.getLimit=function(){return this._query.limit||null},i.prototype.setLimit=function(e){return e?this._query.limit=e:delete this._query.limit,this},i.prototype.hasVariable=function(e){return 0!==this._query.variables.length&&this._query.variables.indexOf(e)>=0},i.prototype.isWildcardQuery=function(){return!(!this._query.variables||"*"!==this._query.variables[0])},i.prototype.addVariable=function(e){return e&&e.startsWith("?")?this._query.variables.indexOf(e)>=0?this:this.isWildcardQuery()?this:(this._query.variables.push(e),this):this},i.prototype.removeVariable=function(e){if(e.startsWith("?")&&!this.isWildcardQuery()){var t=this._query.variables.indexOf(e);t>=0&&this._query.variables.splice(t,1),0===this._query.variables.length&&this._query.variables.push("*")}},i.prototype.cleanupVariables=function(e){var t=this,r=this.getTripleVariables();this._query.variables.filter(function(t){return(!e||-1!==e.indexOf(t))&&-1===r.indexOf(t)}).map(function(e){t.removeVariable(e)})},i.prototype.getTriples=function(t,r){var i=[];t||(t=this._query.where),r||(r=!1);var a=this;return e.each(t,function(e,t){t.type&&"bgp"===t.type&&(i=i.concat(a._createTriples(t.triples,r))),t.type&&"optional"===t.type&&(i=i.concat(a.getTriples(t.patterns,!0))),t.type&&"union"===t.type&&(i=i.concat(a.getTriples(t.patterns,!1)))}),i},i.prototype.getBindings=function(){var t={};return e.each(this._query.where,function(e,r){r.type&&"bind"===r.type&&(t[r.variable]=r)}),t},i.prototype._createTriples=function(t,r){var i=this,a=[];return e.each(t,function(e,n){a.push({optional:r,query:i,triple:n,remove:function(){t.splice(e,1)}})}),a},i.prototype.getSubQueries=function(){var t=[];return e.each(this._query.where,function(e,r){r.queryType&&t.push(new i(r))}),t},i.prototype.addTriple=function(e,t,r,i){var a={type:"bgp",triples:[{subject:e,predicate:t,object:r}]};if(i){var n={type:"optional",patterns:[a]};this._query.where.push(n)}else this._query.where.push(a);return this._createTriples(a.triples,i)[0]},i.prototype.getTripleVariables=function(){var t={};return e.each(this.getTriples(),function(e,r){"string"==typeof r.triple.subject&&r.triple.subject.startsWith("?")&&(t[r.triple.subject]=!0),"string"==typeof r.triple.predicate&&r.triple.predicate.startsWith("?")&&(t[r.triple.predicate]=!0),"string"==typeof r.triple.object&&r.triple.object.startsWith("?")&&(t[r.triple.object]=!0)}),Object.keys(t)},i.prototype.getBoundVariables=function(){var t={};return e.each(this.getTriples(),function(e,r){r.triple.subject.startsWith("?")&&!r.triple.object.startsWith("?")&&(t[r.triple.subject]=!0),!r.triple.subject.startsWith("?")&&r.triple.object.startsWith("?")&&(t[r.triple.object]=!0)}),Object.keys(t)},i.prototype.getServices=function(){var t=[];return e.each(this._query.where,function(e,r){r&&"service"===r.type&&t.push(r)}),t},i.prototype.removeService=function(t){var r=this;return e.each(this._query.where,function(e,i){"service"===i.type&&i.name===t&&delete r._query.where[e]}),this},i.prototype.getCommentContent=function(e){var t,r;for(t=0;t<this._queryComments.length;t++)if((r=this._queryComments[t]).startsWith("#"+e))return r.substring(1+e.length);return null},i.prototype.clone=function(){var e=new i;return e.parse(this.getQueryString()),e},i}(jQuery,0,sparqljs),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SelectorBox=function(e,t){"use strict";function r(e,r){this._api=e||new t.queryService.api.Wikibase,this._sparqlApi=r||new t.queryService.api.Sparql}var i={item:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i <{PROPERTY_URI}> ?id. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t}\t\t\t\t\tLIMIT 100',genericSuggest:function(){var e=this._query.getBoundVariables().shift(),t=this._query.clone().setLimit(1e3).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\t\tSELECT ?id ?label ?description ?property WITH {\n\t\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\t\tSELECT ?value ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t\t?statement ?ps ?value.\n\t\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p; wikibase:statementProperty ?ps.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tGROUP BY ?value ?property\n\t\t\t\t\t\t\tHAVING(isIRI(?value) && STRSTARTS(STR(?value), STR(wd:Q)))\n\t\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t\t} AS %values WHERE {\n\t\t\t\t\t\t\tINCLUDE %values.\n\t\t\t\t\t\t\tBIND(?value AS ?id).\n\t\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,instanceOf:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t{\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t\t}\t\t\t\t\tLIMIT 100'},property:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t{\t\t\t\t\t\tSELECT DISTINCT ?id WHERE {\t\t\t\t\t\t?i ?prop <{ITEM_URI}>.\t\t\t\t\t\t?id ?x ?prop.\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100\t\t\t\t\t}\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}\t\t\t\tLIMIT 100',genericSuggest:function(){var e=this._query.getBoundVariables().shift(),t=this._query.clone().setLimit(500).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\tSELECT ?id ?label ?description WITH {\n\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t}\n\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\tSELECT ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p.\n\t\t\t\t\t\t}\n\t\t\t\t\t\tGROUP BY ?property\n\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t} AS %properties WHERE {\n\t\t\t\t\t\tINCLUDE %properties.\n\t\t\t\t\t\tBIND(?property AS ?id).\n\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,seeAlso:'SELECT ?id ?label ?description WHERE {\t\t\t\t\tBIND( <{PROPERTY_URI}> as ?prop).\t\t\t\t\t?props ?x  ?prop.\t\t\t\t\t?props rdf:type wikibase:Property.\t\t\t\t\t?props wdt:P1659 ?id.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}'},sparql:{search:'SELECT ?id ?label ?description WITH {\t\t\t\t\t{SPARQL}\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\tFILTER(STRSTARTS(LCASE(?label), LCASE("{TERM}")))\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100',suggest:'SELECT ?id ?label ?description WITH {\t\t\t\t{SPARQL}\t\t\t\t} AS %inner\t\t\tWHERE {\t\t\t\tINCLUDE %inner\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t} ORDER BY DESC(?count)\t\t\tLIMIT 100'}};return r.prototype._api=null,r.prototype._sparqlApi=null,r.prototype._query=null,r.prototype.setQuery=function(e){this._query=e},r.prototype.add=function(e,t,r,i){switch(e.data("type").toLowerCase()){case"number":this._createInput(e,r,i);break;default:this._createSelect(e,t,r,i)}},r.prototype._createInput=function(t,r,i){var a=e("<input>").attr("type",t.data("type")),n=this._getCloseButton(),o=this._getToolbar(i,t),s=e("<div>").append(n," ",a," ",o);t.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return s}}).click(function(e){a.val(t.data("value")||"")}),a.on("keyup mouseup",function(){r&&r(a.val())})},r.prototype._createSelect=function(t,r,i,a){var n=this,o=this._getSelectBox(t),s=this._getCloseButton(),u=this._getToolbar(a,t),l=e("<div>").append(s," ",o," ",u);t.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return l}}).click(function(i){return o.toggleClass("open"),o.data("select2")||e.proxy(n._renderSelect2(o,t,r),n),o.hasClass("open")&&t.data("auto_open")&&o.data("select2").open(),!1}),o.change(function(r){i&&i(o.val(),o.find("option:selected").text(),e(r.target).data("options")),t.click(),o.html("")})},r.prototype._getSelectBox=function(t){var r=t.data("id"),i=t.text(),a=e("<select>");return r&&a.append(e("<option>").attr("value",r).text(i)),a},r.prototype._getCloseButton=function(){return e('<a href="#" data-dismiss="clickover">').append('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>')},r.prototype._getToolbar=function(t,r){var i=e("<span>");return e.each(t,function(t,a){var n=e("<a>").attr("href","#");n.prepend('<span class="glyphicon glyphicon-'+t+'" aria-hidden="true"></span>'," "),n.click(function(){return a()&&r.click(),!1}),i.append(n," ")}),i},r.prototype._createLookupService=function(t,r){var i=this,a=t.data("type"),n=t.data("sparql");return function(t,o,s){e.when(i._searchEntitiesSparql(t.data.term,a,r,n),i._searchEntities(t.data.term,a)).done(function(e,t){e.length>0&&(e=[{text:i._i18n("suggestions","Suggestions"),children:e}]),t.length>0&&e.length>0&&(t=[{text:i._i18n("other","Other"),children:t}]),o({results:e.concat(t)})})}},r.prototype._getSparqlTemplate=function(e,t,r,i){var a=this._getSparqlTemplateDefinition(e,t,r,i),n="function"==typeof a?a.apply(this):a;return i&&(n=n.replace("{SPARQL}",i)),n},r.prototype._getSparqlTemplateDefinition=function(e,t,r,a){if(a)return e?i.sparql.search:i.sparql.suggest;var n=i[t];if(e&&""!==e.trim())return r?n.search:null;if("property"===t){if(!r)return n.genericSuggest;if(0===r.object.indexOf("?"))return n.seeAlso}else if(!r)return n.genericSuggest;return n.suggest},r.prototype._searchEntitiesSparqlCreateQuery=function(t,r,i,a){function n(e){return"string"==typeof e?e:n(e.items[0])}var o=this._getSparqlTemplate(t,r,i,a);return o&&(i&&(o=o.replace("{PROPERTY_URI}",n(i.predicate)).replace("{ITEM_URI}",i.object)),t&&(o=o.replace("{TERM}",t)),o=o.replace(/\{LANGUAGE\}/g,e.i18n&&e.i18n().locale||"en")),o},r.prototype._searchEntitiesSparql=function(t,r,i,a){var n=e.Deferred(),o=this._searchEntitiesSparqlCreateQuery(t,r,i,a);return o?(this._sparqlApi.query(o,4e3).done(function(e){var t=e.results.bindings.map(function(e){var t=e.id.value.split("/").pop(),r=e.property&&e.property.value.split("/").pop()||null;return{id:t,text:e.label.value,data:{id:t,propertyId:r,description:e.description&&e.description.value||""}}});n.resolve(t)}).always(function(){n.resolve([])}),n.promise()):n.resolve([]).promise()},r.prototype._searchEntities=function(t,r){var i=e.Deferred();return t&&""!==t.trim()?(this._api.searchEntities(t,r).done(function(e){var t=e.search.map(function(e){return{id:e.id,text:e.label,data:e}});i.resolve(t)}),i.promise()):i.resolve([]).promise()},r.prototype._renderSelect2=function(t,r,i){var a={},n=this._createLookupService(r,i);t.select2({width:"auto",templateResult:function(r,i){return r.data?(a[r.data.id]={text:r.text,propertyId:r.data.propertyId},t.attr("data-options",JSON.stringify(a)),e("<span><b>"+r.text+" ("+r.data.id+")</b></span><br/><small>"+r.data.description+"</small>")):r.text},ajax:{delay:250,transport:n},cache:!0})},r.prototype._i18n=function(t,r){return e.i18n?e.i18n("wdqs-ve-sb-"+t):r},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryTemplate=function(e,t){"use strict";function r(){}return r.prototype._definition={},r.prototype._template=null,r.prototype._variables=[],r.parse=function(e){var t,i,a=e.getCommentContent("TEMPLATE=");if(!a)return null;try{t=JSON.parse(a)}catch(e){return null}return i=new r,i._definition=t,i._fragments=r._getQueryTemplateFragments(t),i},r._getQueryTemplateFragments=function(e){if(e.template.match(/\0/))throw new Error("query template must not contain null bytes");var t,r,i=[e.template];for(t in e.variables){if(!t.match(/\?[a-z][a-z0-9]*/i))throw new Error("invalid variable name in query template");r=[],i.forEach(function(e){var i=e.replace(new RegExp("\\"+t,"g"),"\0").split("\0");r.push(i[0]);for(var a=1;a<i.length;a++)r.push(t),r.push(i[a])}),i=r}return i},r._buildTemplate=function(t,r){var i=e("<span>");i.append(document.createTextNode(t[0]));for(var a=1;a<t.length;a+=2){var n=t[a],o=e("<span>").text(n);n in r||(r[n]=[]),r[n].push(o),i.append(o),i.append(document.createTextNode(t[a+1]))}return i},r.prototype.getHtml=function(t,i,a){if(null!==this._template)return this._template;this._template=r._buildTemplate(this._fragments,this._variables);var n=this;return e.each(this._definition.variables,function(r,o){t(r).done(function(t,s,u,l){e.each(n._variables[r],function(u,p){p.text("");var c=e("<a>").text(t).attr({"data-id":s,"data-type":l,href:"#"}).appendTo(p);o.query&&c.attr("data-sparql",o.query),i.add(c,null,function(e,t){for(var i in n._variables[r])n._variables[r][i].find('a[data-id="'+s+'"]').attr("data-id",e).text(t),a(r,s,e),s=e})})})}),this._template},r}(jQuery);