var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.App=function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e){this._$element=a,this._editor=b,this._queryHelper=c,this._sparqlApi=d,this._querySamplesApi=e,this._init()}var h="//tinyurl.com/api-create.php?url=",i="http://wikidata.rawgraphs.io/?url=",j="wikibase.queryService.ui.app.";return g.prototype._$element=null,g.prototype._resultView=null,g.prototype._sparqlApi=null,g.prototype._querySamplesApi=null,g.prototype._editor=null,g.prototype._queryHelper=null,g.prototype._isHistoryDisabled=!1,g.prototype._trackingApi=null,g.prototype._hasRunFirstQuery=!1,g.prototype._init=function(){this._sparqlApi||(this._sparqlApi=new wikibase.queryService.api.Sparql),this._resultView||(this._resultView=new wikibase.queryService.ui.ResultView(this._sparqlApi)),this._querySamplesApi||(this._querySamplesApi=new wikibase.queryService.api.QuerySamples),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._editor||(this._editor=new wikibase.queryService.ui.editor.Editor),this._track("init"),this._initApp(),this._initEditor(),this._initQueryHelper(),this._initExamples(),this._initDataUpdated(),this._initQuery(),this._initRdfNamespaces(),this._initHandlers()},g.prototype._initApp=function(){a(c).keydown(function(b){b.ctrlKey&&13===b.keyCode&&a("#execute-button").click()}),a("#display-button").tooltip(),a("#download-button").tooltip(),a("#link-button").tooltip(),this._actionBar=new wikibase.queryService.ui.toolbar.Actionbar(a(".action-bar"))},g.prototype._initEditor=function(){this._editor.fromTextArea(this._$element.find(".queryEditor")[0])},g.prototype._initQueryHelper=function(){var b=this,c="query-helper-hide";this._queryHelper||(this._queryHelper=new wikibase.queryService.ui.queryHelper.QueryHelper),this._queryHelper.setChangeListener(function(a){b._editor.setValue(a.getQuery())}),"true"===e.get(c)&&a(".query-helper-trigger").show(),this._editor&&this._editor.registerCallback("change",d.debounce(function(){a(".query-helper-trigger").is(":visible")||b._editor.getValue()===b._queryHelper.getQuery()||(a(".query-helper").hide(),b._drawQueryHelper())},1500)),a(".query-helper .panel-heading .close").click(function(){return e.set(c,!0),a(".query-helper").hide(),a(".query-helper-trigger").show(),!1}),a(".query-helper-trigger").click(function(){return a(".query-helper-trigger").hide(),e.set(c,!1),b._drawQueryHelper(),!1})},g.prototype._drawQueryHelper=function(){try{this._queryHelper.setQuery(this._editor.getValue()),this._queryHelper.draw(a(".query-helper .panel-body")),a(".query-helper").delay(500).fadeIn()}catch(b){c.console.error(b)}},g.prototype._initExamples=function(){var b=this;new wikibase.queryService.ui.QueryExampleDialog(a("#QueryExamples"),this._querySamplesApi,function(a,c){a&&a.trim()&&b._editor.setValue("#"+c+"\n"+a)})},g.prototype._initRdfNamespaces=function(){var b,c,d,e=a(".namespace-shortcuts"),f=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS;e.click(function(a){a.stopPropagation()});for(b in f){c=a("<select>").attr("class","form-control").append(a("<option>").text(b)).appendTo(e);for(d in f[b])c.append(a("<option>").text(d).attr("value",f[b][d]))}},g.prototype._initQuery=function(){""!==c.location.hash&&(0===location.hash.indexOf("#result#")&&(location.hash=location.hash.replace("#result#","#")),this._isHistoryDisabled=!0,this._editor.setValue(decodeURIComponent(c.location.hash.substr(1))),this._editor.refresh(),this._isHistoryDisabled=!1)},g.prototype._initDataUpdated=function(){var b=this,d=a(".dataUpdated"),e=function(){b._sparqlApi.queryDataUpdatedTime().done(function(b,c){var e,g,h=f.duration(c,"seconds").humanize();e=120>=c?"list-group-item-success":900>=c?"list-group-item-warning":"list-group-item-danger",g='<span class="badge '+e+'">'+h+"</span>",d.html(a.i18n("wdqs-app-footer-updated",g))})};e(),c.setInterval(e,6e5),d.hover(function(){e();var c=a(this);b._sparqlApi.queryDataUpdatedTime().done(function(b,d){c.popover({html:!0,placement:"top",content:a.i18n("wdqs-app-footer-updated-seconds",d)+".</br>"+b}).popover("show")}).fail(function(){c.popover({content:"[unable to connect]"}).popover("show")})},function(){var b=a(this);b.popover("destroy")})},g.prototype._initHandlers=function(){var b=this;a("#query-form").submit(a.proxy(this._handleQuerySubmit,this)),a(".namespace-shortcuts").on("change","select",a.proxy(this._handleNamespaceSelected,this)),a(".addPrefixes").click(function(){var a=wikibase.queryService.RdfNamespaces.STANDARD_PREFIXES,c=Object.keys(a).map(function(b){return a[b]}).join("\n");b._editor.prepandValue(c+"\n\n"),b._track("buttonClick.addPrefixes")}),a('[data-target="#QueryExamples"]').click(function(){b._track("buttonClick.examples")}),a("#clear-button").click(function(){b._editor.setValue(""),b._track("buttonClick.clear")}),a(".explorer-close").click(function(b){b.preventDefault(),a(".explorer-panel").hide()}),a(c).on("popstate",a.proxy(this._initQuery,this)),this._initPopovers(),this._initHandlersDownloads()},g.prototype._initPopovers=function(){var b=this;a(".shortUrlTrigger.query").clickover({placement:"left",global_close:!0,html:!0,content:function(){return b._updateQueryUrl(),'<iframe class="shortUrl" src="'+h+encodeURIComponent(c.location)+'" referrerpolicy="origin" sandbox="" ></iframe>'}}).click(function(){b._track("buttonClick.shortUrlQuery")}),a(".shortUrlTrigger.result").clickover({placement:"left",global_close:!0,html:!0,content:function(){b._updateQueryUrl();var d=a("<a>").attr("href","embed.html"+c.location.hash);return'<iframe class="shortUrl" src="'+h+encodeURIComponent(d[0].href)+'" referrerpolicy="origin" sandbox="" ></iframe>'}}).click(function(){b._track("buttonClick.shortUrlResult")}),a(".embed.result").clickover({placement:"left",global_close:!0,html:!0,content:function(){b._updateQueryUrl();var d="";b._selectedResultBrowser&&(d="#defaultView:"+b._selectedResultBrowser+"\n",d=encodeURIComponent(d));var e=a("<a>").attr("href","embed.html#"+d+c.location.hash.substring(1)),f=a("<textarea>").text('<iframe style="width: 80vw; height: 50vh; border: none;" src="'+e[0].href+'" referrerpolicy="origin" sandbox="allow-scripts allow-same-origin allow-popups" ></iframe>').click(function(){f.select()});return f}}).click(function(){b._track("buttonClick.embedResult")})},g.prototype._initHandlersDownloads=function(){var d=this._sparqlApi,e={CSV:{handler:a.proxy(d.getResultAsCsv,d),mimetype:"text/csv;charset=utf-8"},JSON:{handler:a.proxy(d.getResultAsJson,d),mimetype:"application/json;charset=utf-8"},TSV:{handler:a.proxy(d.getSparqlTsv,d),mimetype:"text/tab-separated-values;charset=utf-8"},"Simple TSV":{handler:a.proxy(d.getSimpleTsv,d),mimetype:"text/tab-separated-values;charset=utf-8",ext:"tsv"},"Full JSON":{handler:a.proxy(d.getResultAsAllJson,d),mimetype:"application/json;charset=utf-8",ext:"json"},SVG:{handler:function(){var b=a("#query-result svg");if(!b.length)return null;b.attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"});try{return'<?xml version="1.0" encoding="utf-8"?>\n'+c.unescape(encodeURIComponent(b[0].outerHTML))}catch(d){return null}},mimetype:"data:image/svg+xml;charset=utf-8",ext:"svg"}},f=this,g=function(a,c,d){return function(e){e.preventDefault(),f._track("buttonClick.download."+a);var g=c();g&&b(g,a,d)}};for(var h in e){var i=e[h].ext||h.toLowerCase(),j=h.replace(/\s/g,"-");a("#download"+j).click(g("query."+i,e[h].handler,e[h].mimetype))}},g.prototype._handleQuerySubmit=function(b){var c=this;this._hasRunFirstQuery||(this._track("firstQuery"),this._hasRunFirstQuery=!0),b.preventDefault(),this._editor.save(),this._updateQueryUrl(),a("#execute-button").prop("disabled",!0),this._resultView.draw(this._editor.getValue()).fail(function(a){c._editor.highlightError(a)}).always(function(){a("#execute-button").prop("disabled",!1)}),a(".queryUri").attr("href",c._sparqlApi.getQueryUri()),a(".rawGraphsUri").attr("href",i+encodeURIComponent(c._sparqlApi.getQueryUri()))},g.prototype._handleNamespaceSelected=function(b){var c,d=b.target.value,e=this._editor.getValue();-1===e.indexOf("<"+d+">")&&(c=a(b.target).find(":selected").text(),this._editor.setValue("PREFIX "+c+": <"+d+">\n"+e)),b.target.selectedIndex=0},g.prototype._updateQueryUrl=function(){if(!this._isHistoryDisabled){var a=encodeURIComponent(this._editor.getValue());a=a.replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16)}),c.location.hash!==a&&(c.history.pushState?c.history.pushState(null,null,"#"+a):c.location.hash=a)}},g.prototype._track=function(a,b,c){this._trackingApi.track(j+a,b,c)},g}(jQuery,download,window,_,Cookies,moment);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.toolbar=wikibase.queryService.toolbar||{},wikibase.queryService.ui.toolbar.Actionbar=function(a){"use strict";function b(a){this._$element=a}return b.prototype._$element=null,b.prototype.show=function(b,c,d,e){var f=b;a.i18n&&(f=a.i18n(b)),""!==c&&(f=f+": "+c),this._$element.find(".message").html(""),d||(d="info"),void 0===e||e===!1?this._$element.find(".message").append(this._getBar(f,d)):this._$element.find(".message").append(this._getProgressbar(f,d,e)),this._$element.show()},b.prototype._getProgressbar=function(b,c,d){return a('<div class="progress"><div class="progress-bar progress-bar-'+c+' progress-bar-striped active" role="progressbar" style="width: '+d+'%">'+b+"</div></div>")},b.prototype._getBar=function(b,c){return a('<div class="label label-'+c+'"/>').text(b)},b.prototype.hide=function(){this._$element.hide()},b}(jQuery);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.i18n=wikibase.queryService.ui.i18n||{},wikibase.queryService.ui.i18n.LanguageSelector=function(a,b){"use strict";function c(a,c,d){this._$element=a,c?this._api=c:this._api=new b.queryService.api.Wikibase,this._defaultLanguage=d,this._create()}return c.prototype._api=null,c.prototype._$element=null,c.prototype._defaultLanguage=null,c.prototype._changeListener=null,c.prototype.setChangeListener=function(a){this._changeListener=a},c.prototype._create=function(b){var c=this;this._$element.text(a.uls.data.getAutonym(this._defaultLanguage)),this._getLanguages().done(function(b){c._$element.uls({onSelect:function(b){c._$element.text(a.uls.data.getAutonym(b)),c._changeListener&&c._changeListener(b)},languages:b}).click(function(){a(".uls-menu").addClass("uls-mobile").css("left","").css("right","2.5%")}).css("display","block")})},c.prototype._getLanguages=function(){var b=a.Deferred();return this._api.getLanguages().done(function(c){var d={};a.each(c.query.languages,function(a,b){d[b.code]=b["*"]}),b.resolve(d)}),b.promise()},c}(jQuery,wikibase);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.hint=wikibase.queryService.ui.editor.hint||{},function(a,b){"use strict";var c=b.queryService.ui.editor.hint,d=["SELECT","SELECT * WHERE {\n\n}","OPTIONAL","OPTIONAL {\n\n}","WHERE","WHERE {\n\n}","ORDER","ORDER BY","DISTINCT","SERVICE",'SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }',"BASE","PREFIX","REDUCED","FROM","LIMIT","OFFSET","HAVING","UNION","SAMPLE","(SAMPLE() AS )","COUNT","(COUNT() AS )","DESC","DESC()","ASC","ASC()","FILTER ()","FILTER NOT EXISTS","FILTER NOT EXISTS {\n\n}","UNION","UNION {\n\n}","BIND","BIND ()","GROUP_CONCAT","(GROUP_CONCAT() as )","ORDER BY","#defaultView:Map","#defaultView:ImageGrid","#defaultView:Map","#defaultView:BubbleChart","#defaultView:TreeMap","#defaultView:Tree","#defaultView:Timeline","#defaultView:Dimensions","#defaultView:Graph","#defaultView:LineChart","#defaultView:BarChart","#defaultView:ScatterChart","#defaultView:AreaChart","SERVICE wikibase:around {\n	?place wdt:P625 ?location.\n	bd:serviceParam wikibase:center ? .\n	bd:serviceParam wikibase:radius ? .\n	bd:serviceParam wikibase:distance ?dist.\n}","SERVICE wikibase:box {\n	?place wdt:P625 ?location.\n	bd:serviceParam wikibase:cornerWest ? .\n	bd:serviceParam wikibase:cornerEast ? .\n}",'hint:Query hint:optimizer "None".','#TEMPLATE={ "template": "Textual description of template, referencing ?var", "variables": { "?var": { "query": "SELECT ?id WHERE { ?id wdt:P31 wd:Q146. }" } } }'],e=["wikibase:rank","wikibase:badge","wikibase:propertyType","wikibase:directClaim","wikibase:claim","wikibase:statementProperty","wikibase:statementValue","wikibase:qualifier","wikibase:qualifierValue","wikibase:reference","wikibase:referenceValue","wikibase:statementValueNormalized","wikibase:qualifierValueNormalized","wikibase:referenceValueNormalized","wikibase:novalue","wikibase:Property","wikibase:Reference","wikibase:Dump","wikibase:PreferredRank","wikibase:NormalRank","wikibase:DeprecatedRank","wikibase:BestRank","wikibase:TimeValue","wikibase:QuantityValue","wikibase:GlobecoordinateValue","wikibase:WikibaseItem","wikibase:CommonsMedia","wikibase:Globecoordinate","wikibase:Monolingualtext","wikibase:Quantity","wikibase:String","wikibase:Time","wikibase:Url","wikibase:ExternalId","wikibase:WikibaseProperty","wikibase:Math","wikibase:statements","wikibase:sitelinks","wikibase:timeValue","wikibase:timePrecision","wikibase:timeTimezone","wikibase:timeCalendarModel","wikibase:quantityAmount","wikibase:quantityUpperBound","wikibase:quantityLowerBound","wikibase:quantityUnit","wikibase:quantityNormalized","wikibase:geoLatitude","wikibase:geoLongitude","wikibase:geoPrecision","wikibase:geoGlobe","wikibase:wikiGroup","schema:about","schema:name","schema:description","schema:dateModified","schema:Article","schema:inLanguage","schema:isPartOf","rdfs:label","rdf:type","skos:altLabel","xsd:dateTime","xsd:integer","xsd:decimal","geo:wktLiteral","owl:sameAs","prov:wasDerivedFrom"],f=c.Sparql=function(){};f.prototype.getHint=function(b,c,d,e){var f=this._getCurrentWord(c,e),g=[],h=new a.Deferred;if(0===f.word.indexOf("?")&&(g=g.concat(this._getVariableHints(f.word,this._getDefinedVariables(b)))),g=g.concat(this._getSPARQLHints(f.word)),g.length>0){var i=this._getHintCompletion(f,g,d);return h.resolve(i).promise()}return h.reject().promise()},f.prototype._getSPARQLHints=function(b){var c=[];return a.each(d,function(a,d){d.toLowerCase().indexOf(b.toLowerCase())>=0&&c.push(d)}),a.each(e,function(a,d){0===d.toLowerCase().indexOf(b.toLowerCase())&&c.push(d)}),c},f.prototype._getDefinedVariables=function(b){var c={};return a.each(b.match(/\?\w+/g),function(a,b){c[b]=!0}),Object.keys(c)},f.prototype._getVariableHints=function(b,c){var d=[];return b&&"?"!==b?(a.each(c,function(a,c){0===c.toLowerCase().indexOf(b.toLowerCase())&&d.push(c)}),d):c},f.prototype._getHintCompletion=function(a,b,c){var d={list:[]};return d.from={line:c,"char":a.start},d.to={line:c,"char":a.end},d.list=b,d},f.prototype._getCurrentWord=function(a,b){var c=b-1;for(0>c&&(c=0);/[\w?#:]/.test(a.charAt(c))&&(c--,!(0>c)););var d=c+1;for(c=b;/[\w:]/.test(a.charAt(c))&&(c++,!(c>=a.length)););var e=c,f=a.substring(d,e);return{word:f,start:d,end:e}}}(jQuery,wikibase);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.hint=wikibase.queryService.ui.editor.hint||{},function(a,b){"use strict";var c=b.queryService.ui.editor.hint,d=c.Rdf=function(a,c){this._api=a,this._rdfNamespaces=c,this._api||(this._api=new b.queryService.api.Wikibase),this._rdfNamespaces||(this._rdfNamespaces=b.queryService.RdfNamespaces)};d.prototype._rdfNamespaces=null,d.prototype._api=null,d.prototype.getHint=function(b,c,d,e){var f,g,h,i,j=new a.Deferred,k=this._getCurrentWord(c,e),l=this;return k.word.match(/\S+:\S*/)?(g=this._getPrefixFromWord(k.word.trim()),h=this._getTermFromWord(k.word.trim()),i=this._extractPrefixes(b),i[g]?0===h.length?(f=[{text:h,displayText:"Type to search for an entity"}],j.resolve(this._getHintCompletion(d,k,g,f)).promise()):(i[g]&&this._searchEntities(h,i[g]).done(function(a){return j.resolve(l._getHintCompletion(d,k,g,a))}),j.promise()):this._rdfNamespaces.ALL_PREFIXES&&this._rdfNamespaces.ALL_PREFIXES[g]?j.reject().promise():(f=[{text:h,displayText:"Unknown prefix '"+g+":'"}],j.resolve(this._getHintCompletion(d,k,g,f)).promise())):j.reject().promise()},d.prototype._getPrefixFromWord=function(a){return a.split(":",1)[0]},d.prototype._getTermFromWord=function(a){return a.split(":").pop()},d.prototype._getHintCompletion=function(a,b,c,d){var e={list:[]};return e.from={line:a,"char":b.start+c.length+1},e.to={line:a,"char":b.end},e.list=d,e},d.prototype._searchEntities=function(b,c){var d=[],e=a.Deferred();return this._api.searchEntities(b,c).done(function(b){a.each(b.search,function(a,b){d.push({className:"wikibase-rdf-hint",text:b.id,displayText:b.label+" ("+b.id+") "+b.description+"\n"})}),e.resolve(d)}),e.promise()},d.prototype._getCurrentWord=function(a,b){var c=b-1,d=!1,e=["/","*","+"," ",";",".","\n","	","(",")","{","}","[","]"];for(0>c&&(c=0);(-1===e.indexOf(a.charAt(c))||" "===a.charAt(c)&&d===!1||":"===a.charAt(c)&&d===!1)&&(":"===a.charAt(c)&&(d=!0),c--,!(0>c)););var f=c+1;for(c=b;-1===e.indexOf(a.charAt(c))&&(c++,!(c>=a.length)););var g=c,h=a.substring(f,g);return{word:h,start:f,end:g}},d.prototype._extractPrefixes=function(b){var c,d=this._rdfNamespaces.getPrefixMap(this._rdfNamespaces.ENTITY_TYPES),e=this._rdfNamespaces.ENTITY_TYPES,f=b.split("\n");return a.each(f,function(a,b){(c=b.match(/(PREFIX) (\S+): <([^>]+)>/))&&e[c[3]]&&(d[c[2]]=e[c[3]])}),d}}(jQuery,wikibase);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.tooltip=wikibase.queryService.ui.editor.tooltip||{},wikibase.queryService.ui.editor.tooltip.Rdf=function(a,b,c){"use strict";function d(a,b){this._api=a,this._rdfNamespaces=b,this._api||(this._api=new wikibase.queryService.api.Wikibase),this._rdfNamespaces||(this._rdfNamespaces=wikibase.queryService.RdfNamespaces)}return d.prototype._rdfNamespaces=null,d.prototype._editor=null,d.prototype.setEditor=function(a){this._editor=a,this._registerHandler()},d.prototype._registerHandler=function(){var b=this;a.on(this._editor.getWrapperElement(),"mouseover",c.debounce(function(a){b._triggerTooltip(a)},300))},d.prototype._triggerTooltip=function(a){this._removeToolTip(),this._createTooltip(a)},d.prototype._createTooltip=function(a){var c=a.clientX,d=a.clientY+b(window).scrollTop(),e=this._editor.getTokenAt(this._editor.coordsChar({left:c,top:d})).string;if(e.match(/.+\:(Q|P)[0-9]*/)){var f=this._extractPrefixes(this._editor.doc.getValue()),g=e.split(":",1)[0],h=e.split(":").pop();if(f[g]){var i=this;this._searchEntities(h,f[g]).done(function(a){i._showToolTip(a.shift(),{x:c,y:d})})}}},d.prototype._removeToolTip=function(){b(".wikibaseRDFtoolTip").remove()},d.prototype._showToolTip=function(a,c){a&&c&&b('<div class="panel panel-info">').css("position","absolute").css("z-index","100").css("max-width","200px").css({top:c.y+2,left:c.x+2}).addClass("wikibaseRDFtoolTip").append(b('<div class="panel-body">').html(a).css("padding","10px")).appendTo("body").fadeIn("slow")},d.prototype._extractPrefixes=function(a){var c,d=this._rdfNamespaces.getPrefixMap(this._rdfNamespaces.ENTITY_TYPES),e=a.split("\n"),f=this;return b.each(e,function(a,b){(c=b.match(/(PREFIX) (\S+): <([^>]+)>/))&&f._rdfNamespaces.ENTITY_TYPES[c[3]]&&(d[c[2]]=f._rdfNamespaces.ENTITY_TYPES[c[3]])}),d},d.prototype._searchEntities=function(a,c){var d=[],e=b.Deferred();return this._api.searchEntities(a,c).done(function(a){b.each(a.search,function(a,b){d.push(b.label+" ("+b.id+")<br/><small>"+(b.description||"")+"</small>")}),e.resolve(d)}),e.promise()},d}(CodeMirror,jQuery,_);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.editor=wikibase.queryService.ui.editor||{},wikibase.queryService.ui.editor.Editor=function(a,b,c,d){"use strict";function e(a,c,d){this._rdfHint=a,this._sparqlHint=c,this._rdfTooltip=d,this._sparqlHint||(this._sparqlHint=new b.queryService.ui.editor.hint.Sparql),this._rdfHint||(this._rdfHint=new b.queryService.ui.editor.hint.Rdf),this._rdfTooltip||(this._rdfTooltip=new b.queryService.ui.editor.tooltip.Rdf)}var f={lineNumbers:!0,matchBrackets:!0,mode:"sparql",extraKeys:{"Ctrl-Space":"autocomplete",Tab:function(a){var b=Array(a.getOption("indentUnit")+1).join(" ");a.replaceSelection(b)}},viewportMargin:1/0,hintOptions:{closeCharacters:/[]/,completeSingle:!1}},g=null,h=null,i="wikibase.queryService.ui.Editor";return e.prototype._editor=null,e.prototype._sparqlHint=null,e.prototype._rdfHint=null,e.prototype._rdfTooltip=null,e.prototype.fromTextArea=function(a){var b=this;this._editor=c.fromTextArea(a,f),this._editor.on("change",function(a,c){b.storeValue(b.getValue()),b.clearError(),"?"!==c.text[0]&&"#"!==c.text[0]||a.showHint({closeCharacters:/[\s]/})}),this._editor.focus(),this._rdfTooltip.setEditor(this._editor),this._registerHints()},e.prototype._registerHints=function(){var a=this;c.registerHelper("hint","sparql",function(b,c,d){if(b===a._editor){var e=b.getLine(b.getCursor().line),f=b.doc.getValue(),g=b.getCursor().ch,h=b.getCursor().line;a._getHints(f,e,h,g).done(function(a){c(a)})}}),c.hint.sparql.async=!0},e.prototype._getHints=function(b,d,e,f){var g=new a.Deferred,h=this;return this._rdfHint.getHint(b,d,e,f).done(function(a){a.from=c.Pos(a.from.line,a.from["char"]),a.to=c.Pos(a.to.line,a.to["char"]),g.resolve(a)}).fail(function(){h._sparqlHint.getHint(b,d,e,f).done(function(a){a.from=c.Pos(a.from.line,a.from["char"]),a.to=c.Pos(a.to.line,a.to["char"]),g.resolve(a)})}),g.promise()},e.prototype.addKeyMap=function(a,b){this._editor.addKeyMap({keyMap:b})},e.prototype.setValue=function(a){this._editor.setValue(a)},e.prototype.getValue=function(){return this._editor.getValue()},e.prototype.save=function(){this._editor.save()},e.prototype.prepandValue=function(a){this._editor.setValue(a+this._editor.getValue())},e.prototype.refresh=function(){this._editor.refresh()},e.prototype.highlightError=function(a){var b,c,d=a.match(/line (\d+), column (\d+)/);d&&(b=d[1]-1,c=d[2]-1,c>=this._editor.doc.getLine(b).length-1&&(c=this._editor.doc.getLine(b).length-1),g=this._editor.doc.markText({line:b,ch:0},{line:b},{className:"error-line"}),h=this._editor.doc.markText({line:b,ch:c},{line:b,ch:c+1},{className:"error-character"}))},e.prototype.clearError=function(){g&&(g.clear(),h.clear())},e.prototype.storeValue=function(a){try{localStorage&&localStorage.setItem(i,a)}catch(b){}},e.prototype.restoreValue=function(){try{if(localStorage){var a=localStorage.getItem(i);a&&(this.setValue(a),this.refresh())}}catch(b){}},e.prototype.registerCallback=function(a,b){this._editor.on(a,b)},e}(jQuery,wikibase,CodeMirror);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryHelper=function(a,b){"use strict";function c(a,c,d){this._api=a||new b.queryService.api.Wikibase,this._selectorBox=d||new b.queryService.ui.queryHelper.SelectorBox(this._api,c),this._query=new b.queryService.ui.queryHelper.SparqlQuery}var d={"http://www.w3.org/2000/01/rdf-schema#label":!0,"http://schema.org/description":!0,"http://www.bigdata.com/queryHints#optimizer":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},e="wdqs-ve-",f={formatNoMatches:function(){}};return c.prototype._api=null,c.prototype._selectorBox=null,c.prototype._changeListener=null,c.prototype._query=null,c.prototype._triples=[],c.prototype._isSimpleMode=!1,c.prototype._labels={filter:"Filter",show:"Show",anything:"anything","with":"with",any:"any",or:"or",subtype:"subtype"},c.prototype.setQuery=function(a){var c=b.queryService.RdfNamespaces.ALL_PREFIXES;this._query.parse(a,c),this._selectorBox.setQuery(this._query)},c.prototype.getQuery=function(){try{var a=this._query.getQueryString();return a=this._cleanQueryPrefixes(a).trim(),a.trim()}catch(b){return null}},c.prototype._cleanQueryPrefixes=function(a){for(var c,d=/PREFIX ([a-z]+): <(.*)>/gi,e={},f=a.replace(d,"").replace(/\n+/g,"\n");c=d.exec(a);){var g=c[1],h=c[2].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i=f.replace(new RegExp("<"+h+"([^/>#]+?)>","gi"),g+":$1");f!==i&&(f=i,b.queryService.RdfNamespaces.STANDARD_PREFIXES[g]||(e[c[0]]=!0))}return f=Object.keys(e).join("\n")+"\n\n"+f.trim()},c.prototype.draw=function(a){var c=b.queryService.ui.queryHelper.QueryTemplate.parse(this._query),d=this,e=this._query.getBindings();if(null!==c)try{return a.html(c.getHtml(function(a){return d._getLabel(e[a].expression)},this._selectorBox,function(a,b,c){e[a].expression=e[a].expression.replace(new RegExp(b+"$"),"")+c,d._changeListener&&d._changeListener(d)}))}catch(f){window.console.error(f)}this._triples=this._query.getTriples();for(var g=this._query.getSubQueries();g.length>0;){var h=g.pop();this._triples=this._triples.concat(h.getTriples()),g.concat(h.getSubQueries())}this._isSimpleMode=this._isSimpleQuery(),a.html(this._getHtml())},c.prototype.setChangeListener=function(a){this._changeListener=a},c.prototype._i18n=function(b){return a.i18n?a.i18n(e+b):this._labels[b]},c.prototype._getHtml=function(){var b=this,c=a("<div>"),d=a("<table>").bootstrapTable(f),e=a("<table>").bootstrapTable(f);return a.each(this._triples,function(a,c){return b._isNotRelevant(c.triple)?void 0:b._isInShowSection(c.triple)?void e.append(b._getTripleHtml(c)):void d.append(b._getTripleHtml(c))}),c.append(this._createSection(d,this._createFindButton(d)),this._createSection(e,this._createShowButton(e)),this._getLimitSection())},c.prototype._getLimitSection=function(){var b=a("<div>"),c=a('<a data-type="number">').attr("href","#").text("Limit").data("value",this._query.getLimit()),d=a("<span>").text(this._query.getLimit()||""),e=this;return this._selectorBox.add(c,null,function(a){"0"===a&&(a=null),d.text(a||""),e._query.setLimit(a),e._changeListener&&e._changeListener(e)},{trash:function(){return e._query.setLimit(null),c.data("value",""),d.text(""),e._changeListener&&e._changeListener(e),!0}}),b.append(c.append(" ",d))},c.prototype._createSection=function(b,c){return a("<table>").append(a("<tr>").append(a("<td>").append(c),a("<td>").append(b)))},c.prototype._createFindButton=function(b){var c=a('<a class="btn">').text(this._i18n("filter")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new item"}).attr("data-type","item").attr("data-auto_open",!0),d=this;return this._selectorBox.add(c,null,function(a,c,e){var f="http://www.wikidata.org/entity/"+a,g=d._query.getBoundVariables().shift();g||(g="?_"+c.replace(/( |[^a-z0-9])/gi,"_"));var h="http://www.wikidata.org/prop/direct/"+(e&&e[a]&&e[a].propertyId||"P31"),i=d._query.addTriple(g,h,f,!1);d._query.hasVariable(g)||d._query.addVariable(g),b.append(d._getTripleHtml(i)),d._changeListener&&d._changeListener(d)}),c},c.prototype._createShowButton=function(b){var c=a('<a class="btn">').text(this._i18n("show")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new property"}).attr("data-type","property").attr("data-auto_open",!0),d=this;return this._selectorBox.add(c,null,function(a,c){var e="http://www.wikidata.org/prop/direct/"+a,f=d._query.getBoundVariables().shift();if(f){var g="?"+c.replace(/( |[^a-z0-9])/gi,"_"),h=d._query.addTriple(f,e,g,!0);d._query.addVariable(g),b.append(d._getTripleHtml(h)),d._changeListener&&d._changeListener(d)}}),c},c.prototype._isNotRelevant=function(a){return d[a.predicate]?!0:!(!this._isSimpleMode||!this._isInShowSection(a)||this._query.hasVariable(a.object)!==!1||this._query.hasVariable(a.object+"Label")!==!1)},c.prototype._isInShowSection=function(a){var b=this._query.getBindings();return!(!this._isVariable(a.subject)||!this._isVariable(a.object)||b[a.subject]||b[a.object])},c.prototype._getTripleHtml=function(b){var c=this,d=a("<tr>"),e=this._query.getBindings();return a.each(b.triple,function(f,g){if(c._isVariable(g)&&e[g]&&"string"==typeof e[g].expression&&(g=e[g].expression),c._isVariable(g)){if(c._isSimpleMode)return;g=g.replace("?","")}g.type&&"path"===g.type?d.append(a("<td>").append(c._getTripleEntityPathHtml(g,b,f))," "):d.append(a("<td>").append(c._getTripleEntityHtml(g,b,f))," ")}),d},c.prototype._isVariable=function(a){return"string"==typeof a&&a.startsWith("?")},c.prototype._isSimpleQuery=function(){var b={},c=this;return a.each(this._triples,function(a,d){c._isVariable(d.triple.subject)&&c._isVariable(d.triple.object)===!1&&(b[d.triple.subject]=!0)}),Object.keys(b).length<=1},c.prototype._getTripleEntityPathHtml=function(b,c){var d=this,e=a("<span>");return a.each(b.items,function(f,g){if(g.type&&"path"===g.type)return void e.append(d._getTripleEntityPathHtml(g,c));f>0&&"/"===b.pathType&&e.append(" "+d._i18n("or")+" "+d._i18n("subtype")+" "),"*"===b.pathType&&e.append(" "+d._i18n("any")+" ");var h=b.items.reduce(function(a,b,c){return a[c]=b,a},{});h=a.extend(h,c.triple),c=a.extend({},c),c.triple=h,e.append(d._getTripleEntityHtml(g,c,f))}),e},c.prototype._getTripleEntityHtml=function(b,c,d){var e=this,f=a("<span>");return this._getLabel(b).done(function(g,h,i,j){var k=a("<a>").text(g).attr({"data-id":h,"data-type":j,href:"#"}).appendTo(f);f.tooltip({title:"("+h+") "+i}),a(f).on("show.bs.tooltip",function(){a(".tooltip").is(":visible")&&a(".tooltip").not(this).hide()}),e._selectorBox.add(k,c.triple,function(a){var g=b.replace(new RegExp(h+"$"),"")+a;f.replaceWith(e._getTripleEntityHtml(g,c,d)),e._isVariable(c.triple[d])?e._query.getBindings()[c.triple[d]].expression=g:c.triple[d]=g,e._changeListener&&e._changeListener(e)},{trash:function(){c.remove();var d=c.triple.object;return(c.triple.object===b||c.triple.object.startsWith("?")===!1&&c.triple.predicate===b)&&(d=c.triple.subject),f.closest("tr").remove(),-1===e._query.getBoundVariables().indexOf(d)&&(e._query.removeVariable(d),e._query.removeVariable(d+"Label")),e._changeListener&&e._changeListener(e),a(".tooltip").hide(),!0},tag:function(){return c.triple.object.startsWith("?")?e._query.addVariable(c.triple.object+"Label"):e._query.addVariable(c.triple.subject+"Label"),e._changeListener&&e._changeListener(e),!0}})}).fail(function(){f.text(b)}),f},c.prototype._getLabel=function(b){var c=a.Deferred(),d=b.match(/(Q|P)([0-9]+)/);if(!d)return c.reject().promise();var e={P:"property",Q:"item"};e=e[d[1]];var f=d[0];return this._api.searchEntities(f,e).done(function(b){a.each(b.search,function(a,b){return c.resolve(b.label,b.id,b.description,e),!1})}),c.promise()},c}(jQuery,wikibase);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SparqlQuery=function(a,b,c){"use strict";function d(a){this._query=a}return d.prototype._query=null,d.prototype._queryComments=null,d.prototype.parse=function(b,d){var e=new c.Parser(d),f=[];this._query=e.parse(b),a.each(b.split("\n"),function(a,b){0===b.indexOf("#")&&f.push(b)}),this._queryComments=f},d.prototype.getQueryString=function(){try{var a=(new c.Generator).stringify(this._query),b=this._queryComments.join("\n").trim();return""!==b?b+"\n"+a:a}catch(d){return null}
},d.prototype.getLimit=function(){return this._query.limit||null},d.prototype.setLimit=function(a){return a?this._query.limit=a:delete this._query.limit,this},d.prototype.hasVariable=function(a){return 0===this._query.variables.length?!1:"*"===this._query.variables[0]&&a.startsWith("?")?!0:this._query.variables.indexOf(a)>=0},d.prototype.addVariable=function(a){a.startsWith("?")&&(1===this._query.variables.length&&"*"===this._query.variables[0]||this._query.variables.indexOf(a)>=0||this._query.variables.push(a))},d.prototype.removeVariable=function(a){if(a.startsWith("?")&&(1!==this._query.variables.length||"*"!==this._query.variables[0])){var b=this._query.variables.indexOf(a);b>=0&&this._query.variables.splice(b,1)}},d.prototype.getTriples=function(b,c){var d=[];b||(b=this._query.where),c||(c=!1);var e=this;return a.each(b,function(a,b){b.type&&"bgp"===b.type&&(d=d.concat(e._createTriples(b.triples,c))),b.type&&"optional"===b.type&&(d=d.concat(e.getTriples(b.patterns,!0))),b.type&&"union"===b.type&&(d=d.concat(e.getTriples(b.patterns,!1)))}),d},d.prototype.getBindings=function(){var b={};return a.each(this._query.where,function(a,c){c.type&&"bind"===c.type&&(b[c.variable]=c)}),b},d.prototype._createTriples=function(b,c){var d=this,e=[];return a.each(b,function(a,f){e.push({optional:c,query:d,triple:f,remove:function(){b.splice(a,1)}})}),e},d.prototype.getSubQueries=function(){var b=[];return a.each(this._query.where,function(a,c){c.queryType&&b.push(new d(c))}),b},d.prototype.addTriple=function(a,b,c,d){var e={type:"bgp",triples:[{subject:a,predicate:b,object:c}]};if(d){var f={type:"optional",patterns:[e]};this._query.where.push(f)}else this._query.where.push(e);return this._createTriples(e.triples,d)[0]},d.prototype.getBoundVariables=function(){var b={};return a.each(this.getTriples(),function(a,c){c.triple.subject.startsWith("?")&&!c.triple.object.startsWith("?")&&(b[c.triple.subject]=!0),!c.triple.subject.startsWith("?")&&c.triple.object.startsWith("?")&&(b[c.triple.object]=!0)}),Object.keys(b)},d.prototype.getCommentContent=function(a){var b,c;for(b=0;b<this._queryComments.length;b++)if(c=this._queryComments[b],c.startsWith("#"+a))return c.substring(1+a.length);return null},d.prototype.clone=function(){var a=new d;return a.parse(this.getQueryString()),a},d}(jQuery,wikibase,sparqljs);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SelectorBox=function(a,b){"use strict";function c(a,c){this._api=a||new b.queryService.api.Wikibase,this._sparqlApi=c||new b.queryService.api.Sparql}var d="wdqs-ve-sb",e=4e3,f={item:{suggest:'SELECT ?id ?label ?description WHERE {					hint:Query hint:optimizer "None".							{								SELECT DISTINCT ?id WHERE { ?i <{PROPERTY_URI}> ?id. }								LIMIT 100							}						?id rdfs:label ?label.						?id schema:description ?description.						FILTER((LANG(?label)) = "{LANGUAGE}")						FILTER((LANG(?description)) = "{LANGUAGE}")					}					LIMIT 100',genericSuggest:function(){var a='{PREFIXES}\n						SELECT ?id ?label ?description ?property WITH {\n							{QUERY}\n						} AS %query WITH {\n							SELECT ({VARIABLE} AS ?item) WHERE {\n								INCLUDE %query.\n							}\n						} AS %item WITH {\n							SELECT ?value ?property (COUNT(?statement) AS ?count) WHERE {\n								INCLUDE %item.\n								?item ?p ?statement.\n								?statement ?ps ?value.\n								?property a wikibase:Property; wikibase:claim ?p; wikibase:statementProperty ?ps.\n							}\n							GROUP BY ?value ?property\n							HAVING(isIRI(?value) && STRSTARTS(STR(?value), STR(wd:Q)))\n							ORDER BY DESC(?count)\n							LIMIT 100\n						} AS %values WHERE {\n							INCLUDE %values.\n							BIND(?value AS ?id).\n							SERVICE wikibase:label {\n								bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n								?id rdfs:label ?label; schema:description ?description.\n							}\n						}\n						ORDER BY DESC(?count)',b=this._query.clone().setLimit(1e3).getQueryString(),c=this._query.getBoundVariables().shift(),d=b.match(/.*\bPREFIX\b(.*)/gi).join("\n");return b=b.replace(/.*\bPREFIX\b.*/gi,""),a.replace("{QUERY}",b).replace("{VARIABLE}",c).replace("{PREFIXES}",d)},search:null,instanceOf:'SELECT ?id ?label ?description WHERE {					hint:Query hint:optimizer "None".						{							SELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }							LIMIT 100						}						?id rdfs:label ?label.						?id schema:description ?description.						FILTER((LANG(?label)) = "en")						FILTER((LANG(?description)) = "en")					}					LIMIT 100'},property:{suggest:'SELECT ?id ?label ?description WHERE {				hint:Query hint:optimizer "None".					{						SELECT DISTINCT ?id WHERE {						?i ?prop <{ITEM_URI}>.						?id ?x ?prop.						?id rdf:type wikibase:Property.						}						LIMIT 100					}				?id rdfs:label ?label.				?id schema:description ?description.				FILTER((LANG(?label)) = "{LANGUAGE}")				FILTER((LANG(?description)) = "{LANGUAGE}")				}				LIMIT 100',genericSuggest:function(){var a='{PREFIXES}\n					SELECT ?id ?label ?description WITH {\n						{QUERY}\n					} AS %query WITH {\n						SELECT ({VARIABLE} AS ?item) WHERE {\n							INCLUDE %query.\n						}\n					} AS %item WITH {\n						SELECT ?property (COUNT(?statement) AS ?count) WHERE {\n							INCLUDE %item.\n							?item ?p ?statement.\n							?property a wikibase:Property; wikibase:claim ?p.\n						}\n						GROUP BY ?property\n						ORDER BY DESC(?count)\n						LIMIT 100\n					} AS %properties WHERE {\n						INCLUDE %properties.\n						BIND(?property AS ?id).\n						SERVICE wikibase:label {\n							bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n							?id rdfs:label ?label; schema:description ?description.\n						}\n					}\n					ORDER BY DESC(?count)',b=this._query.clone().setLimit(500).getQueryString(),c=this._query.getBoundVariables().shift(),d=b.match(/.*\bPREFIX\b(.*)/gi).join("\n");return b=b.replace(/.*\bPREFIX\b.*/gi,""),a.replace("{QUERY}",b).replace("{VARIABLE}",c).replace("{PREFIXES}",d)},search:null,seeAlso:'SELECT ?id ?label ?description WHERE {					BIND( <{PROPERTY_URI}> as ?prop).					?props ?x  ?prop.					?props rdf:type wikibase:Property.					?props wdt:P1659 ?id.					?id rdfs:label ?label.					?id schema:description ?description.					FILTER((LANG(?label)) = "{LANGUAGE}")					FILTER((LANG(?description)) = "{LANGUAGE}")				}'},sparql:{search:'SELECT ?id ?label ?description WITH {					{SPARQL}					} AS %inner				WHERE {					INCLUDE %inner					?id rdfs:label ?label.					?id schema:description ?description.					FILTER((LANG(?label)) = "{LANGUAGE}")					FILTER((LANG(?description)) = "{LANGUAGE}")					FILTER(STRSTARTS(LCASE(?label), LCASE("{TERM}")))				} ORDER BY DESC(?count)				LIMIT 100',suggest:'SELECT ?id ?label ?description WITH {				{SPARQL}				} AS %inner			WHERE {				INCLUDE %inner				?id rdfs:label ?label.				?id schema:description ?description.				FILTER((LANG(?label)) = "{LANGUAGE}")				FILTER((LANG(?description)) = "{LANGUAGE}")			} ORDER BY DESC(?count)			LIMIT 100'}};return c.prototype._api=null,c.prototype._sparqlApi=null,c.prototype._query=null,c.prototype.setQuery=function(a){this._query=a},c.prototype.add=function(a,b,c,d){switch(a.data("type").toLowerCase()){case"number":this._createInput(a,c,d);break;default:this._createSelect(a,b,c,d)}},c.prototype._createInput=function(b,c,d){var e=a("<input>").attr("type",b.data("type")),f=this._getCloseButton(),g=this._getToolbar(d,b),h=a("<div>").append(f," ",e," ",g);b.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return h}}).click(function(a){e.val(b.data("value")||"")}),e.on("keyup mouseup",function(){c&&c(e.val())})},c.prototype._createSelect=function(b,c,d,e){var f=this,g=this._getSelectBox(b),h=this._getCloseButton(),i=this._getToolbar(e,b),j=a("<div>").append(h," ",g," ",i);b.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return j}}).click(function(d){return g.toggleClass("open"),g.data("select2")||a.proxy(f._renderSelect2(g,b,c),f),g.hasClass("open")&&b.data("auto_open")&&g.data("select2").open(),!1}),g.change(function(c){d&&d(g.val(),g.find("option:selected").text(),a(c.target).data("options")),b.click(),g.html("")})},c.prototype._getSelectBox=function(b){var c=b.data("id"),d=b.text(),e=a("<select>");return c&&e.append(a("<option>").attr("value",c).text(d)),e},c.prototype._getCloseButton=function(){return a('<a href="#" data-dismiss="clickover">').append('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>')},c.prototype._getToolbar=function(b,c){var d=a("<span>");return a.each(b,function(b,e){var f=a("<a>").attr("href","#");f.prepend('<span class="glyphicon glyphicon-'+b+'" aria-hidden="true"></span>'," "),f.click(function(){return e()&&c.click(),!1}),d.append(f," ")}),d},c.prototype._createLookupService=function(b,c){var d=this,e=b.data("type"),f=b.data("sparql");return function(b,g,h){a.when(d._searchEntitiesSparql(b.data.term,e,c,f),d._searchEntities(b.data.term,e)).done(function(a,b){a.length>0&&(a=[{text:d._i18n("suggestions","Suggestions"),children:a}]),b.length>0&&a.length>0&&(b=[{text:d._i18n("other","Other"),children:b}]),g({results:a.concat(b)})})}},c.prototype._getSparqlTemplate=function(a,b,c,d){var e=this._getSparqlTemplateDefinition(a,b,c,d),f="function"==typeof e?e.apply(this):e;return d&&(f=f.replace("{SPARQL}",d)),f},c.prototype._getSparqlTemplateDefinition=function(a,b,c,d){if(d)return a?f.sparql.search:f.sparql.suggest;var e=f[b];if(a&&""!==a.trim())return c?e.search:null;if("property"===b){if(!c)return e.genericSuggest;if(0===c.object.indexOf("?"))return e.seeAlso}else if(!c)return e.genericSuggest;return e.suggest},c.prototype._searchEntitiesSparqlCreateQuery=function(b,c,d,e){function f(a){return"string"==typeof a?a:f(a.items[0])}var g=this._getSparqlTemplate(b,c,d,e);return g&&(d&&(g=g.replace("{PROPERTY_URI}",f(d.predicate)).replace("{ITEM_URI}",d.object)),b&&(g=g.replace("{TERM}",b)),g=g.replace(/\{LANGUAGE\}/g,a.i18n&&a.i18n().locale||"en")),g},c.prototype._searchEntitiesSparql=function(b,c,d,f){var g=a.Deferred(),h=this._searchEntitiesSparqlCreateQuery(b,c,d,f);return h?(this._sparqlApi.query(h,e).done(function(a){var b=a.results.bindings.map(function(a){var b=a.id.value.split("/").pop(),c=a.property&&a.property.value.split("/").pop()||null;return{id:b,text:a.label.value,data:{id:b,propertyId:c,description:a.description&&a.description.value||""}}});g.resolve(b)}).always(function(){g.resolve([])}),g.promise()):g.resolve([]).promise()},c.prototype._searchEntities=function(b,c){var d=a.Deferred();return b&&""!==b.trim()?(this._api.searchEntities(b,c).done(function(a){var b=a.search.map(function(a){return{id:a.id,text:a.label,data:a}});d.resolve(b)}),d.promise()):d.resolve([]).promise()},c.prototype._renderSelect2=function(b,c,d){var e={},f=function(c,d){return c.data?(e[c.data.id]={text:c.text,propertyId:c.data.propertyId},b.attr("data-options",JSON.stringify(e)),a("<span><b>"+c.text+" ("+c.data.id+")</b></span><br/><small>"+c.data.description+"</small>")):c.text},g=this._createLookupService(c,d);b.select2({width:"auto",templateResult:f,ajax:{delay:250,transport:g},cache:!0})},c.prototype._i18n=function(b,c){return a.i18n?a.i18n(d+"-"+b):c},c}(jQuery,wikibase);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryTemplate=function(a,b){"use strict";function c(){}return c.prototype._definition={},c.prototype._template=null,c.prototype._variables=[],c.parse=function(a){var b,d,e=a.getCommentContent("TEMPLATE=");if(!e)return null;try{b=JSON.parse(e)}catch(f){return null}return d=new c,d._definition=b,d._fragments=c._getQueryTemplateFragments(b),d},c._getQueryTemplateFragments=function(a){function b(a){var b=a.replace(new RegExp("\\"+c,"g"),"\x00").split("\x00");d.push(b[0]);for(var e=1;e<b.length;e++)d.push(c),d.push(b[e])}if(a.template.match(/\0/))throw new Error("query template must not contain null bytes");var c,d,e=[a.template];for(c in a.variables){if(!c.match(/\?[a-z][a-z0-9]*/i))throw new Error("invalid variable name in query template");d=[],e.forEach(b),e=d}return e},c._buildTemplate=function(b,c){var d=a("<span>");d.append(document.createTextNode(b[0]));for(var e=1;e<b.length;e+=2){var f=b[e],g=a("<span>").text(f);f in c||(c[f]=[]),c[f].push(g),d.append(g),d.append(document.createTextNode(b[e+1]))}return d},c.prototype.getHtml=function(b,d,e){if(null!==this._template)return this._template;this._template=c._buildTemplate(this._fragments,this._variables);var f=this;return a.each(this._definition.variables,function(c,g){b(c).done(function(b,h,i,j){a.each(f._variables[c],function(i,k){k.text("");var l=a("<a>").text(b).attr({"data-id":h,"data-type":j,href:"#"}).appendTo(k);g.query&&l.attr("data-sparql",g.query),d.add(l,null,function(a,b){for(var d in f._variables[c]){var g=f._variables[c][d];g.find('a[data-id="'+h+'"]').attr("data-id",a).text(b),e(c,h,a),h=a}})})})}),this._template},c}(jQuery,wikibase);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.QueryExampleDialog=function(a){"use strict";function b(a,b,c,d){this._$element=a,this._querySamplesApi=b,this._callback=c,this._previewUrl=d,this._init()}var c="wikibase.queryService.ui.examples.";return b.prototype._querySamplesApi=null,b.prototype._callback=null,b.prototype._previewUrl=null,b.prototype._examples=null,b.prototype._trackingApi=null,b.prototype._init=function(){this._querySamplesApi||(this._querySamplesApi=new wikibase.queryService.api.QuerySamples),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._initFilter(),this._initExamples();var a=this;this._$element.focus(function(){a._$element.find(".tableFilter").focus()})},b.prototype._initFilter=function(){var b=this;this._$element.find(".tableFilter").keyup(a.proxy(this._filterTable,this)),this._$element.find(".tagFilter").tags({afterAddingTag:a.proxy(this._filterTable,this),afterDeletingTag:function(){b._filterTable(),b._drawTagCloud(!0)}})},b.prototype._initExamples=function(){var b=this,c=null;this._querySamplesApi.getExamples().done(function(d){b._examples=d,b._initTagCloud(),b._updateExamplesCount(d.length),a.each(d,function(d,e){e.category!==c&&(c=e.category,b._$element.find(".searchable").append(a("<tr>").addClass("active").append(a('<td colspan="4">').text(c)))),b._addExample(e.title,e.query,e.href,e.tags)})})},b.prototype._initTagCloud=function(){var a=this,b=window.setInterval(function(){a._$element.is(":visible")&&(a._drawTagCloud(),clearInterval(b))},300)},b.prototype._drawTagCloud=function(b){var c=this,d=[];return a.each(this._getCloudTags(),function(b,e){d.push({text:b,weight:e,link:"#",html:{title:e+" match(es)"},handlers:{click:function(b){return c._$element.find(".tagFilter").tags().addTag(a(this).text()),c._drawTagCloud(!0),!1}}})}),b?void a(".tagCloud").jQCloud("update",d):void a(".tagCloud").jQCloud(d,{delayedMode:!0,autoResize:!0})},b.prototype._getCloudTags=function(){var b=this,c=function(a){var c=b._$element.find(".tagFilter").tags().getTags();return c.every(function(b){return-1!==a.indexOf(b)})},d=function(a){var c=b._$element.find(".tagFilter").tags().getTags();return-1!==c.indexOf(a)},e={};return a.each(b._examples,function(b,f){c(f.tags)&&a.each(f.tags,function(a,b){d(b)||(e[b]?e[b]++:e[b]=1)})}),e},b.prototype._addExample=function(b,c,d,e){var f=this,g=a('<a title="Select" data-dismiss="modal">').text(b).attr("href","#").click(function(){f._callback(c,b),f._track("select")}),h=a("<a>").attr({title:"Edit",href:d,target:"_blank"}).append("<span>").addClass("glyphicon glyphicon-pencil").click(function(){f._track("edit")}),i=a("<span>").addClass("glyphicon glyphicon-eye-open").popover({placement:"bottom",trigger:"hover",container:"body",title:f._i18n("wdqs-dialog-examples-preview-query","Preview query"),content:a('<pre style="white-space:pre-line; word-break:break-word;"/>').text(c),html:!0}),j=a('<a href="#">').addClass("glyphicon glyphicon-camera").clickover({placement:"left",global_close:!0,esc_close:!0,trigger:"click",container:"body",title:f._i18n("wdqs-dialog-examples-preview-result","Preview result"),content:a('<iframe width="400" height="350" frameBorder="0" src="'+(f._previewUrl||"embed.html#")+encodeURIComponent(c)+'">'),html:!0}).click(function(){f._track("preview")});a(".exampleTable").scroll(function(){j.clickover&&j.clickover("hide").removeAttr("data-clickover-open")});var k=a("<tr>");k.append(a("<td>").append(g).append(" ",h)),k.append(a("<td>").addClass("exampleIcons").append(j)),k.append(a("<td>").addClass("exampleIcons").append(i)),k.append(a("<td>").text(e.join("|")).hide()),k.append(a("<td>").text(c).hide()),this._$element.find(".searchable").append(k)},b.prototype._filterTable=function(){var b=this._$element.find(".tableFilter"),c=new RegExp(b.val(),"i"),d=this._$element.find(".tagFilter").tags().getTags(),e=function(b){var c=!0;return b=b.toLowerCase(),a.each(d,function(a,d){-1===b.indexOf(d.toLowerCase())&&(c=!1)}),c};this._$element.find(".searchable tr").hide();var f=this._$element.find(".searchable tr").filter(function(){return c.test(a(this).text())&&e(a(this).text())});f.show(),f.each(function(b,c){a(c).prevAll("tr.active").first().show()}),this._updateExamplesCount(f.length)},b.prototype._updateExamplesCount=function(a){this._$element.find(".count").text(a)},b.prototype._track=function(a,b,d){this._trackingApi.track(c+a,b,d)},b.prototype._i18n=function(b,c){var d=null;return a.i18n&&(d=a.i18n(b))!==b?d:c},b}(jQuery);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.ResultView=function(a,b){"use strict";function c(a){this._sparqlApi=a,this._init()}var d="wikibase.queryService.ui.app.";return c.prototype._query=null,c.prototype._sparqlApi=null,c.prototype._selectedResultBrowser=null,c.prototype._actionBar=null,c.prototype._trackingApi=null,c.prototype._hasRunFirstQuery=!1,c.prototype._resultBrowsers={Table:{icon:"glyphicon-th-list",label:"Table","class":"TableResultBrowser",object:null,$element:null},ImageGrid:{icon:"glyphicon-picture",label:"Image Grid","class":"ImageResultBrowser",object:null,$element:null},Polestar:{icon:"fa-certificate",label:"Graph builder","class":"PolestarResultBrowser",object:null,$element:null},Map:{icon:"glyphicon-map-marker",label:"Map","class":"CoordinateResultBrowser",object:null,$element:null},LineChart:{icon:"fa-line-chart",label:"Line Chart","class":"LineChartResultBrowser",object:null,$element:null},BarChart:{icon:"fa-bar-chart",label:"Bar Chart","class":"BarChartResultBrowser",object:null,$element:null},ScatterChart:{icon:"fa-braille",label:"Scatter Chart","class":"ScatterChartResultBrowser",object:null,$element:null},AreaChart:{icon:"fa-area-chart",label:"Area Chart","class":"AreaChartResultBrowser",object:null,$element:null},BubbleChart:{icon:"glyphicon-tint",label:"Bubble Chart","class":"BubbleChartResultBrowser",object:null,$element:null},TreeMap:{icon:"glyphicon-th",label:"Tree Map","class":"TreeMapResultBrowser",object:null,$element:null},Tree:{icon:"fa-tree",label:"Tree","class":"TreeResultBrowser",object:null,$element:null},Timeline:{icon:"glyphicon-calendar",label:"Timeline","class":"TimelineResultBrowser",object:null,$element:null},Dimensions:{icon:"glyphicon-random",label:"Dimensions","class":"MultiDimensionResultBrowser",object:null,$element:null},Graph:{icon:"glyphicon-retweet",label:"Graph","class":"GraphResultBrowser",object:null,$element:null}},c.prototype._init=function(){this._sparqlApi||(this._sparqlApi=new wikibase.queryService.api.Sparql),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._actionBar=new wikibase.queryService.ui.toolbar.Actionbar(a(".action-bar")),this._initResultBrowserMenu()},c.prototype._initResultBrowserMenu=function(){a.each(this._resultBrowsers,function(b,c){var d=a('<li><a class="result-browser" href="#"><span class="'+c.icon.split("-",1)[0]+" "+c.icon+'"></span>'+c.label+"</a></li>");d.appendTo(a("#result-browser-menu")),c.$element=d})},c.prototype.draw=function(b){var c=this,d=a.Deferred();return this._query=b,this._actionBar.show("wdqs-action-query","","info",100),a("#query-result").empty().hide(),a(".query-total").hide(),a("#query-error").hide(),this._sparqlApi.query(b).done(function(){c._handleQueryResult(),d.resolve()}).fail(function(){var a=c._handleQueryError();d.reject(a)}),d.promise()},c.prototype._handleQueryError=function(){a("#execute-button").prop("disabled",!1);var b=this._sparqlApi.getError(),c=null,d=this._sparqlApi.ERROR_CODES;switch(b.code){case d.TIMEOUT:c="wdqs-action-timeout";break;case d.MALFORMED:c="wdqs-action-malformed-query";break;case d.SERVER:c="wdqs-action-server-error";break;default:c="wdqs-action-unknow-error"}return b.debug&&a("#query-error").html(a("<pre>").text(b.debug)).show(),this._actionBar.show(c||"",b.message||"","danger"),this._track("result.error."+(c||"unknown")),b.debug},c.prototype._handleQueryResult=function(){var b=this._sparqlApi;a("#total-results").text(b.getResultLength()),a("#query-time").text(b.getExecutionTime()),a(".query-total").show(),a("#execute-button").prop("disabled",!1);var c=this._createResultBrowsers(b.getResultRawData());return this._drawResult(c),this._selectedResultBrowser=null,this._track("result.resultLength",b.getResultLength()),this._track("result.executionTime",b.getExecutionTime(),"ms"),this._track("result.received.success"),!1},c.prototype._createResultBrowsers=function(b){var c=this,d=this._getDefaultResultBrowser();return this._track("result.browser."+(d||"default")),a.each(this._resultBrowsers,function(a,b){var e=new wikibase.queryService.ui.resultBrowser[b["class"]];e.setSparqlApi(c._sparqlApi),null!==d&&d!==a||(d=e),b.object=e}),d.resetVisitors(),a.each(this._resultBrowsers,function(a,c){d.addVisitor(c.object),c.object.setResult(b)}),d},c.prototype._getDefaultResultBrowser=function(){var a=this._query.match(/#defaultView:(\w+)/);return a&&this._resultBrowsers[a[1]]?a[1]:null},c.prototype._handleQueryResultBrowsers=function(){var b=this;a.each(this._resultBrowsers,function(c,d){d.$element.off("click"),d.object.isDrawable()?(d.$element.css("opacity",1).attr("href","#"),d.$element.click(function(){return a(this).closest(".open").removeClass("open"),a("#query-result").html(""),b._drawResult(d.object),b._selectedResultBrowser=c,b._track("buttonClick.display."+c),!1})):d.$element.css("opacity",.5).removeAttr("href")})},c.prototype._drawResult=function(c){var d=this;this._actionBar.show("wdqs-action-render","","success",100),b.setTimeout(function(){try{a("#query-result").show(),c.draw(a("#query-result")),d._actionBar.hide()}catch(e){d._actionBar.show("wdqs-action-error-display","","warning"),b.console.error(e)}d._handleQueryResultBrowsers()},20)},c.prototype._track=function(a,b,c){this._trackingApi.track(d+a,b,c)},c}(jQuery,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.FormatterHelper=function(a,b){"use strict";function c(){}var d="http://commons.wikimedia.org/wiki/special:filepath/",e="https://commons.wikimedia.org/wiki/File:{FILENAME}",f="http://www.w3.org/2001/XMLSchema#dateTime",g="uri",h="http://www.w3.org/1998/Math/MathML",i=["http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#positiveInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger"];return c.prototype.formatRow=function(b,c){var d=this,e=a("<div/>");return a.each(b,function(f,g){d._isLabelField(f,b)||(g=a.extend({label:d._getLabel(b,f)},g),e.prepend(a("<div>").append(d.formatValue(g,f,c))))}),e},c.prototype._isLabelField=function(a,b){return a.endsWith("Label")&&"undefined"!=typeof b[a.slice(0,-5)]},c.prototype._getLabel=function(a,b){var c=a[b+"Label"];return c&&c.value||null},c.prototype.formatValue=function(b,c,d){var i=b.value,j=a("<span>");if(c||(c=b.dataType||""),!b.type)return a("<span>").text(i).attr("title",c);switch(b.datatype||b.type){case g:var k=a("<a>").attr({title:c,href:i,target:"_blank",rel:"noopener"});j.append(k),this.isCommonsResource(i)?d?(k.click(this.handleCommonResourceItem),k.append(a("<img>").attr("src",this.getCommonsResourceFileNameThumbnail(i,"120"))).width("120")):(k.attr({href:e.replace(/{FILENAME}/g,this.getCommonsResourceFileName(i))}),k.text("commons:"+decodeURIComponent(this.getCommonsResourceFileName(i))),j.prepend(this.createGalleryButton(i,c)," ")):(k.text(b.label||this.abbreviateUri(i)),this.isEntityUri(i)&&j.prepend(this.createExploreButton(i)," "));break;case f:c||(c=this._i18n("wdqs-app-result-formatter-title-datetime","Raw ISO timestamp"));var l=a("<span>").text(this._formatDate(i));l.attr("title",c+": "+i),j.append(l);break;case h:j.append(a(b.value));break;default:var m=a("<span>").text(i);b["xml:lang"]?m.attr("title",c+": "+i+"@"+b["xml:lang"]):m.attr("title",c),j.append(m)}return j},c.prototype._formatDate=function(a){var b,c=!1,d=a.replace(/^(?:-\d+|\+?0+\b)/,function(a){return c=!0,Math.abs(a)+1}),e=this.parseDate(d);if(e.isValid())b=e.format("ll");else{var f=d.replace(/^\+?(\d+).*/,"$1");b="0000".slice(f.length)+f}return c&&(b+=" BCE"),b},c.prototype.parseDate=function(a){return a=a.replace(/^(?![+-])/,"+"),a=a.replace(/^([+-]?)(\d{1,5}\b)/,function(a,b,c){return b+("00000"+c).slice(-6)}),a=a.replace(/Z$/,""),b(a,b.ISO_8601)},c.prototype.isEntityUri=function(a){return"string"==typeof a&&/^https?:\/\/www\.wikidata\.org\/entity\/./.test(a)},c.prototype.createExploreButton=function(b){var c=a('<a href="'+b+'" title="Explore item" class="explore glyphicon glyphicon-search" aria-hidden="true">');return c.click(a.proxy(this.handleExploreItem,this)),c},c.prototype.isCommonsResource=function(a){return a.toLowerCase().startsWith(d.toLowerCase())},c.prototype.getCommonsResourceFileName=function(a){var b=new RegExp(d,"ig");return decodeURIComponent(a.replace(b,""))},c.prototype.getCommonsResourceFileNameThumbnail=function(a,b){return this.isCommonsResource(a)?a.replace(/^http(?=:\/\/)/,"https")+"?width="+(b||400):a},c.prototype.createGalleryButton=function(b,c){var d=this.getCommonsResourceFileName(b),e=this.getCommonsResourceFileNameThumbnail(b,900),f=a("<a>").attr({title:"Show Gallery",href:e,"aria-hidden":"true","class":"gallery glyphicon glyphicon-picture","data-gallery":"G_"+c,"data-title":decodeURIComponent(d)});return f.click(this.handleCommonResourceItem),f},c.prototype.abbreviateUri=function(a){var b,c,d,e=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS,f=0;for(b in e)for(c in e[b])0===a.indexOf(e[b][c])&&e[b][c].length>f&&(f=e[b][c].length,d=c);return d?d+":"+a.substr(f):"<"+a+">"},c.prototype.handleExploreItem=function(b){var c=a(b.target).attr("href");b.preventDefault();var d=a.i18n&&a.i18n().locale||"en",e="SELECT ?item ?itemLabel WHERE { BIND( <"+c+'> as ?item ).	SERVICE wikibase:label { bd:serviceParam wikibase:language "'+d+'" } }',f="embed.html#"+encodeURIComponent("#defaultView:Graph\n"+e);return a(".explorer-panel .panel-body").html(a('<iframe frameBorder="0" scrolling="no"></iframe>').attr("src",f)),a(".explorer-panel").show(),!1},c.prototype.handleCommonResourceItem=function(b){b.preventDefault(),a(this).ekkoLightbox({scale_height:!0})},c.prototype.isLabel=function(a){return a?"xml:lang"in a||"literal"===a.type&&!a.datatype:!1},c.prototype.isNumber=function(a){return a&&a.datatype&&-1!==i.indexOf(a.datatype)},c.prototype.isDateTime=function(a){return a&&a.datatype===f},c.prototype.isEntity=function(a){return a&&a.value&&this.isEntityUri(a.value)},c.prototype.isColor=function(a){return a&&"literal"===a.type&&a.value&&/^([\dA-F]{1,2}){3}$/i.test(a.value)},c.prototype.getColorForHtml=function(a){return"#"+a.value},c.prototype.calculateLuminance=function(a){var b=parseInt(a.substr(1,2),16)/255,c=parseInt(a.substr(3,2),16)/255,d=parseInt(a.substr(5,2),16)/255;if(isFinite(b)&&isFinite(c)&&isFinite(d)){b=.04045>=b?b/12.92:Math.pow((b+.055)/1.055,2.4),c=.04045>=c?c/12.92:Math.pow((c+.055)/1.055,2.4),d=.04045>=d?d/12.92:Math.pow((d+.055)/1.055,2.4);var e=.2126*b+.7152*c+.0722*d;return e}return NaN},c.prototype._i18n=function(b,c){var d;return a.i18n&&(d=a.i18n(b))!==b?d:c},c}(jQuery,moment);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractResultBrowser=function(a,b){"use strict";function c(){this._visitors=[]}return c.prototype._formatter=null,c.prototype._result=null,c.prototype._visitors=null,c.prototype._drawable=!1,c.prototype._sparqlApi=null,c.prototype.setResult=function(a){this._result=a},c.prototype.setSparqlApi=function(a){this._sparqlApi=a},c.prototype.getSparqlApi=function(){return this._sparqlApi},c.prototype._iterateResult=function(b){var c=this;a.each(this._result.results.bindings,function(d,e){a.each(c._result.head.vars,function(a,f){var g=e[f]||null;c.processVisitors(g,f),b(g,f,e,d)})})},c.prototype.isDrawable=function(){return this._drawable},c.prototype.draw=function(a){jQuery.error("Method draw() needs to be implemented!")},c.prototype.addVisitor=function(a){this._visitors.push(a)},c.prototype.resetVisitors=function(){this._visitors=[]},c.prototype.processVisitors=function(b,c){var d=this,e={};0!==this._visitors.length&&(a.each(this._visitors,function(a,d){d.visit&&"function"==typeof d.visit&&d.visit(b,c)===!1&&(e[a]=!0)}),d._visitors=d._visitors.filter(function(a,b){return!e[b]}))},c.prototype.visit=function(a){return!1},c.prototype.setFormatter=function(a){this._formatter=a},c.prototype._getFormatter=function(){return null===this._formatter&&(this._formatter=new b.queryService.ui.resultBrowser.helper.FormatterHelper),this._formatter},c.prototype._i18n=function(b,c){var d=null;return a.i18n&&(d=a.i18n(b))!==b?d:c},c}(jQuery,wikibase);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser=function(a,b){"use strict";function c(){}return c.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,c.prototype._getLabelColumns=function(){var a=this,b=a._getRows()[0];return a._getColumns().filter(function(c){return a._getFormatter().isLabel(b[c])})},c.prototype._getNumberColumns=function(){var a=this,b=a._getRows()[0];return a._getColumns().filter(function(c){return a._getFormatter().isNumber(b[c])})},c.prototype._getColumns=function(){return this._result.head.vars},c.prototype._getRows=function(){return this._result.results.bindings},c}(jQuery,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},
window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser=function(a,b,c,d,e){"use strict";function f(){}return f.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,f.prototype._dataColumns=null,f.prototype._data=null,f.prototype._$element=null,f.prototype._svg=null,f.prototype._chart=null,f.prototype._chartLegend=null,f.prototype._chartSeriesKey=null,f.prototype._chartStoryKey=null,f.prototype._isStoryPaused=!1,f.prototype.draw=function(b){var c=this;this._$element=a("<div>").css({width:"100%",height:"98vh"}),b.html(this._$element),this._createData(),this._drawSvg(),this._createChart(),this._drawChart(),this._createLegendFilter(),d.onresize=function(){c._drawChart(250,!0)}},f.prototype._createData=function(){var a=[],b={},c=null;this._iterateResult(function(d,e,f){null===c&&(c=f),f!==c&&(c=f,a.push(b),b={}),d&&d.value&&(b[e]=d.value)}),a.push(b),this._data=a},f.prototype._drawSvg=function(){this._svg=e.newSvg(this._$element[0],"100%","100%")},f.prototype._createChart=function(){this._chart=new e.chart(this._svg,this._data),this._chart.setBounds(0,0,"100%","100%"),this._chart.setMargins("5%","5%","2%","25%"),this._createChartAxis();var a=this._chart.addSeries(this._chartSeriesKey,this._getPlotType());a.addOrderRule(this._chartSeriesKey),a.lineMarkers=!0,this._chartStoryKey&&this._createChartStory(),this._chartLegend=this._chart.addLegend("1%","85%","100%","15%")},f.prototype._getPlotType=function(){jQuery.error("Method _getPlotType() needs to be implemented!")},f.prototype._createChartAxis=function(){var b=this,c=this._getRows()[0],d=this._getFormatter(),e=this._chart,f=["y","x"],g=!1;a.each(this._getColumns(),function(a,h){if(0!==f.length)d.isLabel(c[h])&&(e.addCategoryAxis(f.pop(),h),g=!0),d.isNumber(c[h])&&e.addMeasureAxis(f.pop(),h),d.isDateTime(c[h])&&(e.addTimeAxis(f.pop(),h,"%Y-%m-%dT%H:%M:%SZ","%m-%d-%Y"),g=!0);else if(d.isLabel(c[h])){if(!b._chartSeriesKey)return void(b._chartSeriesKey=h);if(!b._chartStoryKey)return b._chartStoryKey=h,!1}}),g||this._chartSeriesKey||!e.axes[0]||(this._chartSeriesKey=e.axes[0].measure)},f.prototype._createChartStory=function(){var a=this,b=this._chart.setStoryboard(this._chartStoryKey);b.frameDuration=5e3,this._$element.click(function(){return a._isStoryPaused?(b.startAnimation(),void(a._isStoryPaused=!1)):(b.pauseAnimation(),void(a._isStoryPaused=!0))})},f.prototype._createLegendFilter=function(){var a=this,b=e.getUniqueValues(this._data,this._chartSeriesKey);this._chart.legends=[],this._chartLegend.shapes.selectAll("rect").on("click",function(d){var f=!1,g=[];b.forEach(function(a){a===d.aggField.slice(-1)[0]?f=!0:g.push(a)}),c.select(this).style("opacity",f?.2:.8),f||g.push(d.aggField.slice(-1)[0]),b=g,a._chart.data=e.filterData(a._data,a._chartSeriesKey,b),a._drawChart(800)})},f.prototype._drawChart=function(a,c){var d=this;this._chart.draw(a,c),b.delay(function(){d._svg.selectAll(".dimple-marker,.dimple-marker-back").attr("r",2)},1.2*a)},f.prototype.isDrawable=function(){return Object.keys(this._dataColumns).length>=2},f.prototype.visit=function(a,b){return this._checkColumn(a,b)},f.prototype._checkColumn=function(a,b){return this._getFormatter().isLabel(a)&&(this._dataColumns[b]=!0),this._getFormatter().isNumber(a)&&(this._dataColumns[b]=!0),this._getFormatter().isDateTime(a)&&(this._dataColumns[b]=!0),!this.isDrawable()},f}(jQuery,_,d3,window,dimple);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.ImageResultBrowser=function(a){"use strict";function b(){}return b.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,b.prototype._grid=null,b.prototype.draw=function(b){var c=this;this._grid=a('<div class="masonry">'),this._iterateResult(function(a,b,d){if(a&&c._isCommonsResource(a.value)){var e=a.value,f=c._getFormatter().getCommonsResourceFileName(e);c._grid.append(c._getItem(c._getThumbnail(e),c._getThumbnail(e,1e3),f,d))}}),b.html(this._grid)},b.prototype._getItem=function(b,c,d,e){var f=a("<a>").click(this._getFormatter().handleCommonResourceItem).attr({href:c,"data-gallery":"g","data-title":d}).append(a("<img>").attr("src",b)),g=this._getFormatter().formatRow(e);return a('<div class="item">').append(f,g)},b.prototype._isCommonsResource=function(a){return this._getFormatter().isCommonsResource(a)},b.prototype._getThumbnail=function(a,b){return this._getFormatter().getCommonsResourceFileNameThumbnail(a,b)},b.prototype.visit=function(a){return this._checkImage(a)},b.prototype._checkImage=function(a){return a&&a.value&&this._isCommonsResource(a.value)?(this._drawable=!0,!1):!0},b}(jQuery);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TableResultBrowser=function(a,b){"use strict";function c(){}var d=200,e=[10,50,100,200,500,1e3];return c.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,c.prototype._columns=null,c.prototype._rows=null,c.prototype._sorter={string:function(a,b){return a.localeCompare(b)},number:function(a,b){return a>=b?-1:1},generic:function(a,b){if(!b)return 1;if(!a)return-1;var c=this._getFormatter();return c.isNumber(a)&&c.isNumber(b)?this._sorter.number(Number(a.value),Number(b.value)):c.isEntityUri(a.value)&&c.isEntityUri(b.value)?this._sorter.number(Number(a.value.replace(/[^0-9]/gi,"")),Number(b.value.replace(/[^0-9]/gi,""))):this._sorter.string(a.value,b.value)}},c.prototype.draw=function(c){var d=this._result;if("undefined"!=typeof d["boolean"]){var e=a("<table>").attr("class","table");return e.append("<tr><td>"+d["boolean"]+"</td></tr>").addClass("boolean"),void c.html(e)}this.columns=d.head.vars,this.rows=d.results.bindings;var f=a("<table/>");c.html(f),this.drawBootstrapTable(f),f.children().width()>a(b).width()&&f.bootstrapTable("toggleView")},c.prototype.drawBootstrapTable=function(b){var c=this,f=this.rows.length>d;jQuery.fn.bootstrapTable.columnDefaults.formatter=function(a,b,d){return a?(c.processVisitors(a,this.field),c._getFormatter().formatValue(a).html()):""};var g={"click .explore":a.proxy(this._getFormatter().handleExploreItem,this),"click .gallery":this._getFormatter().handleCommonResourceItem};b.bootstrapTable({columns:this.columns.map(function(b){return{title:b,field:b,events:g,sortable:!0,sorter:a.proxy(c._sorter.generic,c)}}),data:this.rows,mobileResponsive:!0,search:f,pagination:f,showPaginationSwitch:f,pageSize:d,pageList:e,keyEvents:!0,cookie:!0,cookieIdTable:"1",cookieExpire:"1y",cookiesEnabled:["bs.table.pageList"]})},c.prototype.isDrawable=function(){return!0},c.prototype.visit=function(a){return!1},c}(jQuery,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.CoordinateResultBrowser=function(a,b,c,d,e){"use strict";function f(){this._getMarkerGroupColor=c.scale.category10(),l=b.Control.extend({options:{position:"topright"},onAdd:function(c){var d=b.DomUtil.create("button");return a(d).addClass("btn btn-default"),a(d).append(a(' <span class="glyphicon glyphicon-chevron-up"/> ')),d.onclick=function(){c.isFullscreen()&&c.toggleFullscreen(),a(e).scrollTop(0,0)},d}})}var g="http://www.opengis.net/ont/geosparql#wktLiteral",h="Q2",i=["layerLabel","layer"],j="_LAYER_DEFAULT_GROUP",k={wikimedia:{url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",options:{id:"wikipedia-map-01",attribution:' <a href="http://maps.wikimedia.org/">Wikimedia</a> | &copy; <a href="http://openstreetmap.org/copyright">Open Street Map</a> contributors'}},osm:{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}}},l=null;return f.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,f.prototype._map=null,f.prototype._markerGroups=null,f.prototype._getMarkerGroupColor=null,f.prototype.draw=function(c){var e=a("<div>").attr("id","map").height("100vh");c.html(e),this._createMarkerGroups(),this._map=b.map("map",{center:[0,0],maxZoom:18,minZoom:2,fullscreenControl:!0,preferCanvas:!0,layers:d.compact(this._markerGroups)}).fitBounds(this._markerGroups[j].getBounds()),this._setTileLayer(),this._createControls(),this._createMarkerZoomResize(),c.html(e)},f.prototype._createControls=function(){var c=this;this._map.addControl(b.control.zoomBox({modal:!1,className:"glyphicon glyphicon-zoom-in"})),this._map.addControl(new l);var d=Object.keys(this._markerGroups).length;if(d>1){var e=this._getLayerControl(this._markerGroups).addTo(this._map);this._map.on("overlayadd overlayremove",function(b){b.layer===c._markerGroups[j]&&(a.each(c._markerGroups,function(a,d){"overlayadd"===b.type?c._map.addLayer(d):c._map.removeLayer(d)}),e._update())})}},f.prototype._createMarkerZoomResize=function(){var a=this;if(!(this._markerGroups[j].getLayers().length>1e3)){var b=function(){a._markerGroups[j].setStyle({radius:a._getMarkerRadius()})};this._map.on("zoomend",b)}},f.prototype._getMarkerRadius=function(){if(!this._map)return 3;var a=this._map.getZoom();return.5*a},f.prototype._getLayerControl=function(){var c=this,d={},e="";return a.each(this._markerGroups,function(a,b){if(a===j)e=c._i18n("wdqs-result-map-layers-all","All layers");else{var f=c._getMarkerGroupColor(a);e='<span style="color:'+f+'">&#x2b24;</span> '+a}d[e]=b}),b.control.layers(null,d)},f.prototype._createMarkerGroups=function(){var c=this,d={};if(d[j]=[],this._iterateResult(function(a,e,f){if(a&&a.datatype===g){var h=c._extractLongLat(a.value);if(null===h||!h[0]||!h[1])return!0;var i=b.popup(),k=h[0],l=h[1],m=c._getMarkerGroupsLayer(f),n=b.circleMarker([l,k],c._getMarkerStyle(m)).bindPopup(i);n.on("click",function(){var a=c._getItemDescription(f);i.setContent(a[0])}),d[m]||(d[m]=[]),d[m].push(n),d[j].push(n)}}),0===Object.keys(d).length){var e=b.marker([0,0]).bindPopup("Nothing found!").openPopup();return{"null":b.featureGroup([e])}}a.each(d,function(a){d[a]=b.featureGroup(d[a])}),this._markerGroups=d},f.prototype._getMarkerGroupsLayer=function(a){var b=i.find(function(b){return a[b]});return b?a[b].value:j},f.prototype._getMarkerStyle=function(a){var b="#e04545";return a!==j&&(b=this._getMarkerGroupColor(a)),{color:b,opacity:.8,fillColor:b,fillOpacity:.9,radius:this._getMarkerRadius()}},f.prototype._extractLongLat=function(a){var b=this._extractGlobe(a);return null!==b&&b!==h?null:(a=a.match(/Point\((.*)\)/).pop(),a.split(" "))},f.prototype._extractGlobe=function(a){var b=null;return(b=a.match(/<http\:\/\/www\.wikidata\.org\/entity\/(.+)>/i))&&(b=b.pop()),b},f.prototype._getItemDescription=function(b){var c=a("<div/>").append(this._getFormatter().formatRow(b,!0));return c},f.prototype._setTileLayer=function(){var a=k.osm;("query.wikidata.org"===e.location.host||"localhost"===e.location.host||e.location.host.endsWith(".wmflabs.org"))&&(a=k.wikimedia),b.tileLayer(a.url,a.options).addTo(this._map)},f.prototype.visit=function(a){return this._checkCoordinate(a)},f.prototype._checkCoordinate=function(a){if(a&&a.datatype===g){var b=this._extractGlobe(a.value);if(null===b||b===h)return this._drawable=!0,!1}return!0},f}(jQuery,L,d3,_,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeMapResultBrowser=function(a,b,c){"use strict";function d(){this._labelColumns={}}return d.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,d.prototype._labelColumns=null,d.prototype.draw=function(a){var b=this,c={},d=c,e=null,f=null,g=null;this._iterateResult(function(a,h,i){i!==g&&(null!==g&&(d.data={size:e,url:f},e=null,f=null,d=c),g=i),b._getFormatter().isLabel(a)&&(d[a.value]||(d[a.value]={}),d=d[a.value]),b._getFormatter().isNumber(a)&&(e=a.value),a&&a.value&&b._getFormatter().isEntityUri(a.value)&&(f=a.value)}),d.data={size:e,url:f};var h=this._createTreeData(c),i={name:"treeMap",children:h};this._draw(a,i)},d.prototype._createTreeData=function(b){var c,d=this,e=[];return b.data?e:(a.each(b,function(a,b){var f=d._createTreeData(b);if(0!==f.length)c={id:a,name:a,children:f};else{var g=1;b.data.size&&b.data.size>0&&(g=b.data.size);var h=a,i=b.data.url;i&&(h=i),c={id:h+Math.random(),name:a,size:g,url:i}}e.push(c)}),e)},d.prototype._draw=function(d,e){function f(a){return a.size}function g(a){return 1}function h(a){var b=a.substring(1,3),c=a.substring(3,5),d=a.substring(5,7);return{R:parseInt(b,16),G:parseInt(c,16),B:parseInt(d,16)}}function i(a){var b=105,c=h(a),d=.299*c.R+.587*c.G+.114*c.B;return b>255-d?"#000000":"#ffffff"}function j(a){v.padding([s/(o/a.dy),0,0,0]).nodes(a);var c=n/a.dx,d=o/a.dy,e=a;p.domain([a.x,a.x+a.dx]),q.domain([a.y,a.y+a.dy]),w.selectAll(".labelbody .label").style("display","block");var f=w.selectAll("g.cell").transition().duration(u).attr("transform",function(a){return"translate("+p(a.x)+","+q(a.y)+")"}).each("end",function(a,b){b||e===self.root||(w.selectAll(".cell.child").filter(function(a){return a.parent===self.node}).select(".foreignObject .labelbody .label").style("color",function(a){return i(r(a.parent.name))}),m?w.selectAll(".cell.child").filter(function(a){return a.parent===self.node}).select(".foreignObject").style("display",""):w.selectAll(".cell.child").filter(function(a){return a.parent===self.node}).select(".foreignObject .labelbody .label").style("display",""))});f.select(".foreignObject").attr("width",function(a){return Math.max(.01,c*a.dx)}).attr("height",function(a){return a.children?s:Math.max(.01,d*a.dy)}).select(".labelbody .label").text(function(a){return a.name}),f.select("rect").attr("width",function(a){return Math.max(.01,c*a.dx)}).attr("height",function(a){return a.children?s:Math.max(.01,d*a.dy)}).style("fill",function(a){return a.children?t:r(a.parent.name)}),l=a,b.event&&b.event.stopPropagation()}var k,l,m=!1,n=a(c).width(),o=a(c).height(),p=b.scale.linear().range([0,n]),q=b.scale.linear().range([0,o]),r=b.scale.category10(),s=20,t="#555555",u=500,v=b.layout.treemap().round(!1).size([n,o]).sticky(!0).value(function(a){return a.size}),w=b.select(d[0]).append("svg:svg").attr("width",n).attr("height",o).append("svg:g");l=k=e;var x=v.nodes(k),y=x.filter(function(a){return!a.children}),z=x.filter(function(a){return a.children}),A=w.selectAll("g.cell.parent").data(z,function(a){return"p-"+a.id}),B=A.enter().append("g").attr("class","cell parent").on("click",function(a){j(a)});B.append("rect").attr("width",function(a){return Math.max(.01,a.dx)}).attr("height",s).style("fill",t),B.append("foreignObject").attr("class","foreignObject").append("xhtml:body").attr("class","labelbody").append("div").attr("class","label");var C=A.transition().duration(u);C.select(".cell").attr("transform",function(a){return"translate("+a.dx+","+a.y+")"}),C.select("rect").attr("width",function(a){return Math.max(.01,a.dx)}).attr("height",s).style("fill",t),C.select(".foreignObject").attr("width",function(a){return Math.max(.01,a.dx)}).attr("height",s).select(".labelbody .label").text(function(a){return a.name}),A.exit().remove();var D=w.selectAll("g.cell.child").data(y,function(a){return"c-"+a.id}),E=D.enter().append("g").attr("class","cell child").on("click",function(a){j(l===a.parent?k:a.parent)});E.append("rect").classed("background",!0).style("fill",function(a){return r(a.parent.name)}),E.append("foreignObject").attr({"class":"foreignObject",width:function(a){return Math.max(.01,a.dx)},height:function(a){return Math.max(.01,a.dy)}}).append("xhtml:body").attr("class","labelbody").append("div").attr("class","label").text(function(a){return a.name}).on("click",function(a){a.url&&(c.open(a.url,"_blank"),b.event.stopPropagation())});var F=D.transition().duration(u);F.select(".cell").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),F.select("rect").attr("width",function(a){return Math.max(.01,a.dx)}).attr("height",function(a){return a.dy}).style("fill",function(a){return r(a.parent.name)}),F.select(".foreignObject").attr("width",function(a){return Math.max(.01,a.dx)}).attr("height",function(a){return Math.max(.01,a.dy)}).select(".labelbody .label").text(function(a){return a.name}),D.exit().remove(),b.select("select").on("change",function(){console.log("select zoom(node)"),v.value("size"==value?f:g).nodes(k),j(l)}),j(l)},d.prototype.isDrawable=function(){return Object.keys(this._labelColumns).length>1},d.prototype.visit=function(a,b){return this._checkColumn(a,b)},d.prototype._checkColumn=function(a,b){return this._getFormatter().isLabel(a,b)?(this._labelColumns[b]=!0,!this.isDrawable()):!0},d}(jQuery,d3,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeResultBrowser=function(a,b,c){"use strict";function d(){this._labelColumns={}}var e='SELECT ?property ?propertyLabel ?value ?valueItemLabel ?valueImage WHERE {       {         SELECT ?property ?value ?valueImage ?valueItem WHERE {           BIND(<{ENTITY_URI}> AS ?item)           ?item ?prop ?value.           ?property wikibase:directClaim ?prop.           ?property rdf:type wikibase:Property.           OPTIONAL { ?value wdt:P18 ?valueImage. }           OPTIONAL { BIND(?value AS ?valueItem).  FILTER(STRSTARTS(STR(?value), STR(wd:))) }         }       }       SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }    }  ';return d.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,d.prototype._isDrawable=!1,d.prototype._jsTree=null,d.prototype._nodes=null,d.prototype.draw=function(d){var e=this;this._nodes=this._extractNodes(a.proxy(this._iterateResult,this));var f=a("<div>").jstree({core:{data:b.compact(e._nodes),check_callback:!0},plugins:["types","wholerow","contextmenu","unique"],types:{"default":{icon:"glyphicon glyphicon-barcode"}},contextmenu:{items:function(a){return{Open:{label:e._nodes[a.id].url,icon:"glyphicon glyphicon-link",action:function(){c.open(e._nodes[a.id].url,"_blank")}},explore:{label:e._nodes[a.id].url,icon:"glyphicon glyphicon-download-alt",action:function(){e._expandTree(e._nodes[a.id])}}}}}});this._jsTree=f.jstree(),d.empty().append(f)},d.prototype._extractNodes=function(a,b){var c=null,d={},e=null,f={},g=this._getFormatter();return a(function(a,h,i){i!==c&&(e=null,c=i),a&&a.value&&(e&&(g.isLabel(a)||g.isNumber(a))&&(f[e].text=(f[e].text||"")+" "+a.value),e&&g.isCommonsResource(a.value)&&(f[e].icon=g.getCommonsResourceFileNameThumbnail(a.value,24)),g.isEntity(a)&&(d={},d.parent=e||b||"#",d.id=d.parent+a.value,d.url=a.value,d.state={opened:!1},f[d.id]=d,e=d.id))}),f},d.prototype._expandTree=function(b){var c=this;this.getSparqlApi().query(e.replace("{ENTITY_URI}",b.url)).done(function(){var d=c.getSparqlApi().getResultRawData(),e=function(b){a.each(d.results.bindings,function(c,e){a.each(d.head.vars,function(a,d){var f=e[d]||null;b(f,d,e,c)})})},f=c._extractNodes(e,b.id);a.extend(c._nodes,f),a.each(f,function(a,b){c._jsTree.create_node(b.parent,b)})})},d.prototype.isDrawable=function(){return this._isDrawable},d.prototype.visit=function(a){return this._getFormatter().isEntity(a)?(this._isDrawable=!0,!1):!0},d}(jQuery,_,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.BubbleChartResultBrowser=function(a,b,c){"use strict";function d(){}return d.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,d.prototype._hasLabel=!1,d.prototype._hasNumber=!1,d.prototype.draw=function(b){var c=this,d={name:"bubblechart",children:[]},e=this._getLabelColumns()[0],f=this._getNumberColumns()[0],g=null;this._iterateResult(function(a,b,h){if(h!==g){var i={url:null};g=h,h.rgb&&c._getFormatter().isColor(h.rgb)&&(i.color=c._getFormatter().getColorForHtml(h.rgb)),h[e]&&h[f]&&(i.name=h[e].value,i.size=h[f].value,d.children.push(i))}if(a&&a.value&&c._getFormatter().isEntityUri(a.value)){var j=d.children[d.children.length-1];null===j.url&&(j.url=a.value)}});var h=a("<center>");b.html(h),this._drawBubbleChart(h,d)},d.prototype._drawBubbleChart=function(d,e){function f(a){function b(a,d){d.children?d.children.forEach(function(a){b(d.name,a)}):c.push({packageName:a,className:d.name,value:d.size,url:d.url,color:d.color})}var c=[];return b(null,a),{children:c}}var g=this,h=Math.min(.98*a(c).height(),a(c).width()),i=b.scale.category20c(),j=b.layout.pack().sort(null).size([h,h]).padding(1.5),k=b.select(d[0]).append("svg").attr({"class":"bubble",width:h,height:h}),l=k.selectAll(".node").data(j.nodes(f(e)).filter(function(a){return!a.children})).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});l.append("title").text(function(a){return a.className+": "+a.value}),l.append("circle").attr("r",function(a){return a.r}).style("fill",function(a){return a.color||i(a.className)}),l.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(a){return a.className.substring(0,a.r/4)}).on("click",function(a){a.url&&c.open(a.url,"_blank")}).style("fill",function(a){return a.color?g._getFormatter().calculateLuminance(a.color)<=.5?"#FFF":"#000":void 0}).style("cursor","pointer")},d.prototype.isDrawable=function(){return this._hasLabel&&this._hasNumber},d.prototype.visit=function(a){return this._checkColumn(a)},d.prototype._checkColumn=function(a){return this._getFormatter().isNumber(a)&&(this._hasNumber=!0),this._getFormatter().isLabel(a)&&(this._hasLabel=!0),!this.isDrawable()},d}(jQuery,d3,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.LineChartResultBrowser=function(a){"use strict";function b(){this._dataColumns={}}var c=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return b.prototype=new c,b.prototype._getPlotType=function(){return a.plot.line},b}(dimple);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.BarChartResultBrowser=function(a){"use strict";function b(){this._dataColumns={}}var c=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return b.prototype=new c,b.prototype._getPlotType=function(){return a.plot.bar},b}(dimple);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.ScatterChartResultBrowser=function(a){"use strict";function b(){this._dataColumns={}}var c=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return b.prototype=new c,b.prototype._getPlotType=function(){return a.plot.scatter},b}(dimple);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AreaChartResultBrowser=function(a){"use strict";function b(){this._dataColumns={}}var c=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return b.prototype=new c,b.prototype._getPlotType=function(){return a.plot.area},b}(dimple);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TimelineResultBrowser=function(a,b,c,d){"use strict";function e(){}var f={minHeight:"400px",orientation:{axis:"both",item:"top"},align:"auto",zoomKey:"ctrlKey"};return e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,e.prototype.draw=function(c){var d=a("<div>"),e=new b.Timeline(d[0],this._getItems(),f);e.on("changed",function(){a(e.dom.root).find(".vis-item.vis-range").each(function(){var b=a(this);b.css("min-width","unset"),b.css("min-width",b.css("width"))})}),c.append(d.prepend(this._createToolbar(e)))},e.prototype._getItems=function(){var a=this,c=[];return this._iterateResult(function(b,d,e,f){if(a._getFormatter().isDateTime(b))if(c[f]){var g=[];g.push(a._getFormatter().parseDate(b.value)),c[f].start&&g.push(c[f].start),c[f].end&&g.push(c[f].end),c[f].start=g.reduce(function(a,b){return b>a?a:b}),c[f].end=g.reduce(function(a,b){return a>b?a:b})}else c[f]={id:f,content:a._getHtml(e).html(),start:a._getFormatter().parseDate(b.value)}}),new b.DataSet(d.compact(c))},e.prototype._getHtml=function(b){var c=a("<div/>").append(this._getFormatter().formatRow(b,!0));return c},e.prototype._createToolbar=function(b){function c(a){var c=b.getWindow(),d=c.end-c.start;b.setWindow({start:c.start.valueOf()-d*a,end:c.end.valueOf()+d*a})}var d=a('<div style="margin-top: -35px; text-align: center;">');return a('<a class="btn btn-default">').click(a.proxy(b.redraw,b)).append('<span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>').appendTo(d),a('<a class="btn btn-default">').click(a.proxy(b.fit,b)).append('<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>').appendTo(d),a('<a class="btn btn-default">').click(function(){c(.2)}).append('<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>').appendTo(d),a('<a class="btn btn-default">').click(function(){c(-.2)}).append('<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>').appendTo(d),d},e.prototype.visit=function(a){return this._getFormatter().isDateTime(a)?(this._drawable=!0,!1):!0},e}(jQuery,vis,window,_);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.MultiDimensionResultBrowser=function(a,b,c){"use strict";function d(){}var e="http://www.w3.org/2001/XMLSchema#dateTime";return d.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,d.prototype.draw=function(a){var b={},c=[],d=this._getFormatter();this._iterateResult(function(a,f,g,h){if(c[h]||(c[h]={}),c[h][f]=a&&a.value||"undefined",a&&a.type===e&&(c[h][f]=new Date(a.value).toLocaleDateString()),!b[f]){var i={key:f,description:f,type:"STRING"};d.isNumber(a)&&(i.type="NUMBER"),a&&a.type===e&&(i.type="DATE"),b[f]=i}}),this._draw(a,c,_.values(b))},d.prototype._draw=function(d,e,f){function g(a){return o(f.map(function(b){return[n(b.key),b.scale(a[b.key])]}))}function h(){b.event.sourceEvent.stopPropagation()}function i(){var a=f.filter(function(a){return!a.brush.empty()}),c=a.map(function(a){return a.brush.extent()});b.selectAll(".foreground path").style("display",function(b){return a.every(function(a,d){return a.type.within(b[a.key],c[d],a)})?null:"none"})}var j={top:50,right:80,bottom:10,left:100},k=a(c).width()-(j.left+j.right),l=a(c).height()-(j.top+j.bottom),m={NUMBER:{key:"Number",coerce:function(a){return+a},extent:b.extent,within:function(a,b){return b[0]<=a&&a<=b[1]},defaultScale:b.scale.linear().range([l,0])},STRING:{key:"String",coerce:String,extent:function(a){return a.sort()},within:function(a,b,c){return b[0]<=c.scale(a)&&c.scale(a)<=b[1]},defaultScale:b.scale.ordinal().rangePoints([0,l])},DATE:{key:"Date",coerce:function(a){return new Date(a)},extent:b.extent,within:function(a,b){return b[0]<=a&&a<=b[1]},defaultScale:b.time.scale().range([0,l])}};a.each(f,function(){this.type=m[this.type]});var n=b.scale.ordinal().domain(f.map(function(a){return a.key})).rangePoints([0,k]),o=b.svg.line().defined(function(a){return!isNaN(a[1])}),p=b.svg.axis().orient("left"),q=b.select(d[0]).append("svg").attr({width:k+j.left+j.right,height:l+j.top+j.bottom}).append("g").attr("transform","translate("+j.left+","+j.top+")"),r=q.append("g").attr("class","foreground"),s=q.selectAll(".axis").data(f).enter().append("g").attr("class","axis").attr("transform",function(a){return"translate("+n(a.key)+")"});e.forEach(function(a){f.forEach(function(b){a[b.key]=b.type.coerce(a[b.key])})}),f.forEach(function(a){"domain"in a||(a.domain=b.functor(a.type.extent)(e.map(function(b){return b[a.key]})),a.domain.sort(function(a,b){return a-b})),"scale"in a||(a.scale=a.type.defaultScale.copy()),a.scale.domain(a.domain)}),r.selectAll("path").data(e).enter().append("path").attr("d",g).style("stroke",function(a){return"#6ac"}),s.append("g").attr("class","axis").each(function(a){var c=a.axis&&a.axis.scale(a.scale)||p.scale(a.scale);b.select(this).call(c)}).append("text").attr("class","title").attr("text-anchor","start").text(function(a){return a.description||a.key}),s.append("g").attr("class","brush").each(function(a){b.select(this).call(a.brush=b.svg.brush().y(a.scale).on("brushstart",h).on("brush",i))}).selectAll("rect").attr("x",-8).attr("width",16)},d.prototype.isDrawable=function(){return this._drawable},d.prototype.visit=function(a){return this._drawable=!0,!1},d}(jQuery,d3,window);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowser=function(a,b,c,d){"use strict";function e(){}var f={autoResize:!0,physics:{stabilization:{enabled:!0,iterations:10,fit:!0}},nodes:{shadow:!0,color:"#fff"},edges:{arrows:{to:!0}}};return e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,e.prototype.draw=function(d){var e=a("<div>").height("100vh"),g=this._getData(),h=new b.Network(e[0],g,f);h.on("doubleClick",function(a){1===a.nodes.length&&c.open(a.nodes[0],"_blank")});var i=new wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser(g.nodes,g.edges,this.getSparqlApi());h.on("click",function(a){var b=a.nodes[0]||null;i.browse(b)}),e.prepend(this._createToolbar(h)),d.append(e)},e.prototype._createToolbar=function(b){function c(a){b.setOptions({layout:{hierarchical:{direction:a,sortMethod:"directed"}}})}var d=a('<div style="margin-top: -35px; text-align: center;">');return a('<a class="btn btn-default">').click(function(){b.stabilize(100)}).append('<span class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-stabilize")+'"></span>').appendTo(d),a('<a class="btn btn-default">').click(function(){c("LR")}).append('<span class="glyphicon glyphicon-indent-left" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-lr")+'"></span>').appendTo(d),a('<a class="btn btn-default">').click(function(){c("UD")}).append('<span class="glyphicon glyphicon-align-center" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-ud")+'"></span>').appendTo(d),a('<a class="btn btn-default">').click(function(){
c("RL")}).append('<span class="glyphicon glyphicon-indent-right" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-rl")+'"></span>').appendTo(d),d},e.prototype._getData=function(){var a={},c={},e=[],f=this._getFormatter(),g={};return this._iterateResult(function(b,d,h,i){if(b&&b.value){if(f.isEntity(b)){var j=h[d+"Label"]&&h[d+"Label"].value||b.value,k=b.value;if(g={id:k,label:j,title:j},e[i]){var l={from:e[i],to:k};c[l.from+l.to]=l,a[k]||(a[k]=g)}else a[k]=g,e[i]=g.id}if(f.isCommonsResource(b.value)&&(g.image=f.getCommonsResourceFileNameThumbnail(b.value,150),g.shape="image",g.font={color:"black"}),f.isNumber(b)&&(g.value=b.value,g.title+=" value:"+b.value,g.shape="dot",g.font={color:"black"}),"rgb"===d&&f.isColor(b)&&(g.color=f.getColorForHtml(b),"dot"!==g.shape&&"image"!==g.shape)){var m=f.calculateLuminance(b.value)<=.5?"#FFF":"#000";g.font={color:m}}}}),{nodes:new b.DataSet(d.compact(a)),edges:new b.DataSet(d.compact(c))}},e.prototype.visit=function(a){return this._getFormatter().isEntity(a)?(this._drawable=!0,!1):!0},e}(jQuery,vis,window,_);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser=function(a,b,c,d){"use strict";function e(a,b,c){this._nodes=a,this._edges=b,this._sparql=c}var f='SELECT ?p (SAMPLE(?pl) AS ?pl) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol)  WHERE {<{entityUri}> ?p ?o .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p',g='SELECT ?o ?ol WHERE {<{entityUri}> <{propertyUri}> ?o .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50';return e.prototype._nodes=null,e.prototype._nodes=null,e.prototype._sparql=null,e.prototype._selectedNodeId=null,e.prototype._temporaryNodes={},e.prototype._temporaryEdges={},e.prototype._getEntites=function(b,c){var d=this,e=a.Deferred();return this._sparql.query(g.replace("{entityUri}",b).replace("{propertyUri}",c)).done(function(){var b=d._sparql.getResultRawData(),c=[];a.each(b.results.bindings,function(a,b){c.push({id:b.o.value,label:b.ol.value})}),e.resolve(c)}),e},e.prototype._getProperties=function(b){var c=this,d=a.Deferred();return this._sparql.query(f.replace("{entityUri}",b)).done(function(){var b=c._sparql.getResultRawData(),e=[];a.each(b.results.bindings,function(a,b){e.push({id:b.p.value,label:b.pl.value,count:b.count.value,items:b.ol.value})}),d.resolve(e)}),d},e.prototype._removeTemporaryNodes=function(b){var c=this;a.each(this._temporaryNodes,function(a,b){c._nodes.remove(b.id)}),a.each(this._temporaryEdges,function(a,b){c._edges.remove(b.id)}),this._temporaryNodes={},this._temporaryEdges={}},e.prototype._expandPropertyNode=function(b){var c=this,d=this._temporaryNodes[b];this._getEntites(d.entityId,d.id).done(function(b){a.each(b,function(a,b){null===c._nodes.get(b.id)&&c._nodes.add({id:b.id,label:b.label}),c._edges.add({dashes:!0,from:d.entityId,to:b.id,label:d.propertyLabel,linkType:d.id})})})},e.prototype._expandEntityNode=function(b){var c=this;this._getProperties(b).done(function(d){a.each(d,function(a,d){if(!(c._edges.get({filter:function(a){return a.linkType===d.id&&a.from===b}}).length>0)){var e={id:d.id,label:"1"===d.count?d.items:d.count,title:d.items,entityId:b,propertyLabel:d.label,color:"#abc9f2"},f={id:d.id,dashes:!0,label:d.label,from:b,to:d.id};c._temporaryNodes[e.id]=e,c._nodes.add(e),c._temporaryEdges[f.id]=f,c._edges.add(f)}})})},e.prototype.browse=function(a){return null===a?void this._removeTemporaryNodes():this._temporaryNodes[a]?(this._expandPropertyNode(a),void this._removeTemporaryNodes()):(null!==this._selectedNodeId&&a!==this._selectedNodeId&&this._removeTemporaryNodes(),this._expandEntityNode(a),void(this._selectedNodeId=a))},e}(jQuery,vis,window,_);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.PolestarResultBrowser=function(a,b,c){"use strict";function d(){}var e="polestar/embed.html",f="wikidatasparql://query.wikidata.org/?query=";return d.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,d.prototype.draw=function(c){var d={url:f+location.hash.substr(1),name:"Imported from Wikidata Query Service",_directEmbed:!0},g=a("<iframe>").attr({src:e+"#"+encodeURIComponent(JSON.stringify(d)),"class":"graph-iframe"}).height("98vh");c.append(g),b.setTimeout(function(){g.scrollIntoView()},50)},d.prototype.visit=function(a){return this._drawable=!0,!1},d}(jQuery,window,_);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Sparql=function(a){"use strict";function b(a,b){this._serviceUri=a||c,this._language=b||f}var c="https://query.wikidata.org/bigdata/namespace/wdq/sparql",d={TIMEOUT:10,MALFORMED:20,SERVER:30,UNKNOWN:100},e={"QueryTimeoutException: Query deadline is expired":d.TIMEOUT,"MalformedQueryException: ":d.MALFORMED},f="en";return b.prototype.ERROR_CODES=d,b.prototype._serviceUri=null,b.prototype._executionTime=null,b.prototype._error=null,b.prototype._resultLength=null,b.prototype._rawData=null,b.prototype._queryUri=null,b.prototype._language=null,b.prototype.queryDataUpdatedTime=function(){var b=a.Deferred(),c=encodeURI("prefix schema: <http://schema.org/> SELECT * WHERE {<http://www.wikidata.org> schema:dateModified ?y}"),d=this._serviceUri+"?query="+c+"&nocache="+Math.floor(Date.now()/6e4),e={headers:{Accept:"application/sparql-results+json"}};return a.ajax(d,e).done(function(a,c,d){if(!a.results.bindings[0])return void b.reject();var e=new Date(a.results.bindings[0][a.head.vars[0]].value),f=e.toLocaleTimeString(navigator.language,{timeZoneName:"short"})+", "+e.toLocaleDateString(navigator.language,{month:"short",day:"numeric",year:"numeric"}),g=Math.round((new Date-e)/1e3);b.resolve(f,g)}).fail(function(){b.reject()}),b},b.prototype.query=function(b,c){function d(a,b,c){g._executionTime=Date.now()-g._executionTime,"boolean"==typeof a["boolean"]?g._resultLength=1:g._resultLength=a.results.bindings.length||0,g._rawData=a,h.resolve(a)}function e(a,b,c){g._executionTime=null,g._rawData=null,g._resultLength=null,g._generateErrorMessage(a,b,c),h.reject()}b=this._replaceAutoLanguage(b);var f="query="+encodeURIComponent(b);c&&(f+="&maxQueryTimeMillis="+c);var g=this,h=a.Deferred(),i={headers:{Accept:"application/sparql-results+json"},data:f};return this._queryUri=this._serviceUri+"?"+i.data,this._executionTime=Date.now(),a.ajax(this._serviceUri,i).done(d).fail(function(b,c,f){""===b.getAllResponseHeaders()?(i.method="POST",a.ajax(g._serviceUri,i).done(d).fail(e)):e.apply(this,arguments)}),h},b.prototype._generateErrorMessage=function(a,b,c){var f={code:d.UNKNOWN,message:null,debug:a.responseText};(0===a.status||c)&&(f.code=d.SERVER,f.message=c.message);try{var g=f.debug.substring(f.debug.indexOf("java.util.concurrent.ExecutionException:"));for(var h in e)-1!==g.indexOf(h)&&(f.code=e[h],f.message=null);f.code!==d.UNKNOWN&&f.code!==d.MALFORMED||(f.message=f.debug.match(/(java\.util\.concurrent\.ExecutionException\:)+(.*)(Exception\:)+(.*)/).pop().trim())}catch(i){}this._error=f},b.prototype.getExecutionTime=function(){return this._executionTime},b.prototype.getError=function(){return this._error},b.prototype.getResultLength=function(){return this._resultLength},b.prototype.getQueryUri=function(){return this._queryUri},b.prototype._processData=function(a,b,c){for(var d=a.results.bindings.length,e=0;d>e;e++){for(var f={},g=0;g<a.head.vars.length;g++)a.head.vars[g]in a.results.bindings[e]?f[a.head.vars[g]]=a.results.bindings[e][a.head.vars[g]]:f[a.head.vars[g]]=void 0;c=b(f,c)}return c},b.prototype._encodeCsv=function(a){var b=a.replace(/"/g,'""');return/[",\n]/.test(b)&&(b='"'+b+'"'),b},b.prototype.getResultRawData=function(){return this._rawData},b.prototype.getResultAsCsv=function(){var a=this,b=a._rawData,c=b.head.vars.map(this._encodeCsv).join(",")+"\n";return c=this._processData(b,function(b,c){var d,e="",f=!0;for(var g in b)d=void 0===b[g]?"":a._encodeCsv(b[g].value),f?f=!1:e+=",",e+=d;return e+="\n",c+e},c)},b.prototype.getResultAsJson=function(){var a=[],b=this._rawData;return a=this._processData(b,function(a,b){var c={};for(var d in a)c[d]=(a[d]||{}).value;return b.push(c),b},a),JSON.stringify(a)},b.prototype.getResultAsAllJson=function(){return JSON.stringify(this._rawData)},b.prototype._renderValueTSV=function(a){var b=a.value.replace(/\t/g,"");switch(a.type){case"uri":return"<"+b+">";case"bnode":return"_:"+b;case"literal":var c=JSON.stringify(b);return a["xml:lang"]?c+"@"+a["xml:lang"]:a.datatype?"http://www.w3.org/2001/XMLSchema#integer"===a.datatype||"http://www.w3.org/2001/XMLSchema#decimal"===a.datatype||"http://www.w3.org/2001/XMLSchema#double"===a.datatype?b:c+"^^<"+a.datatype+">":c}return b},b.prototype.getSparqlTsv=function(){var a=this,b=this._rawData,c=b.head.vars.map(function(a){return"?"+a}).join("	")+"\n";return c=this._processData(b,function(b,c){var d,e="",f=!0;for(var g in b)d=void 0===b[g]?"":a._renderValueTSV(b[g]),f?f=!1:e+="	",e+=d;return e+="\n",c+e},c)},b.prototype.getSimpleTsv=function(){var a=this._rawData,b=a.head.vars.join("	")+"\n";return b=this._processData(a,function(a,b){var c,d="",e=!0;for(var f in a)c=void 0===a[f]?"":a[f].value.replace(/\t/g,""),e?e=!1:d+="	",d+=c;return d+="\n",b+d},b)},b.prototype._replaceAutoLanguage=function(a){return a.replace(/\[AUTO_LANGUAGE\]/g,this._language)},b.prototype.setLanguage=function(a){this._language=a},b}(jQuery);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.QuerySamples=function(a){"use strict";function b(){}var c="https://www.wikidata.org/",d=c+"api/rest_v1/page/html/",e="Wikidata:SPARQL query service/queries/examples",f=c+"wiki/"+e;return b.prototype.getExamples=function(){var b=a.Deferred(),c=this;return a.ajax({url:d+encodeURIComponent(e)+"?redirect=false",dataType:"html"}).done(function(a){b.resolve(c._parseHTML(a))}),b},b.prototype._findPrevHeader=function(a){var b=a.prop("tagName");return"H"!==b[0]&&"h"!==b[0]?null:this._findPrev(a,"h"+(b.substr(1)-1))},b.prototype._findPrev=function(a,b){var c=a.prev().filter(b);return c.length>0?c:(c=a.prevUntil(b).last().prev(),c.length>0?c:c=a.parent().prev().filter(b))},b.prototype._extractTagsFromUL=function(b){return b.find('a[rel="mw:WikiLink"]').map(function(){return a(this).text().trim()}).get()},b.prototype._parseHTML=function(b){var c=document.createElement("div"),d=this;c.innerHTML=b;var e=a(c).find("[data-mw]").map(function(){var b=a(this),c=b.attr("data-mw");if(c){var e,g=JSON.parse(c);if(g.parts&&g.parts[0].template&&"./Template:SPARQL"===g.parts[0].template.target.href)e=g.parts[0].template.params.query.wt;else{if(!g.body)return null;e=g.body.extsrc}e=e.replace(/\{\{!}}/g,"|");var h=d._findPrev(b,"h2,h3,h4,h5,h6,h7");if(!h||!h.length)return null;var i=h.text().trim(),j=b.prevUntil(h).filter("ul");return{title:i,query:e,href:f+"#"+encodeURIComponent(i.replace(/ /g,"_")).replace(/%/g,"."),tags:d._extractTagsFromUL(j),category:d._findPrevHeader(h).text().trim()}}}).get();return _.flatten(_.toArray(_.groupBy(e,"category")))},b}(jQuery);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Wikibase=function(a){"use strict";function b(a,b){this._endpoint=c,a&&(this._endpoint=a),b&&(this._language=b)}var c="https://www.wikidata.org/w/api.php",d="en",e={action:"wbsearchentities",format:"json","continue":0,language:d,uselang:d},f={action:"query",meta:"siteinfo",format:"json",siprop:"languages"};return b.prototype._endpoint=null,b.prototype._language=null,b.prototype.searchEntities=function(a,b,c){var d=e;return d.search=a,b&&(d.type=b),(this._language||c)&&(d.language=c||this._language,d.uselang=c||this._language),this._query(d)},b.prototype.getLanguages=function(){return this._query(f)},b.prototype._query=function(b){return a.ajax({url:this._endpoint+"?"+jQuery.param(b),dataType:"jsonp"})},b.prototype.setLanguage=function(a){this._language=a},b}(jQuery);var tracking=tracking||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Tracking=function(a){"use strict";function b(a){this._endpoint=c,a&&(this._endpoint=a)}var c="https://www.wikidata.org/beacon/statsv";return b.prototype._endpoint=null,b.prototype.track=function(a,b,c){return b||(b=1),c||(c="c"),"query.wikidata.org"===location.hostname?this._track(a+"="+b+c):void 0},b.prototype._track=function(b){return a.ajax({url:this._endpoint+"?"+b,dataType:"jsonp"})},b}(jQuery);var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.RdfNamespaces={},function(a,b){"use strict";b.NAMESPACE_SHORTCUTS={Wikidata:{wikibase:"http://wikiba.se/ontology#",wd:"http://www.wikidata.org/entity/",wdt:"http://www.wikidata.org/prop/direct/",wds:"http://www.wikidata.org/entity/statement/",p:"http://www.wikidata.org/prop/",wdref:"http://www.wikidata.org/reference/",wdv:"http://www.wikidata.org/value/",ps:"http://www.wikidata.org/prop/statement/",psv:"http://www.wikidata.org/prop/statement/value/",psn:"http://www.wikidata.org/prop/statement/value-normalized/",pq:"http://www.wikidata.org/prop/qualifier/",pqv:"http://www.wikidata.org/prop/qualifier/value/",pqn:"http://www.wikidata.org/prop/qualifier/value-normalized/",pr:"http://www.wikidata.org/prop/reference/",prv:"http://www.wikidata.org/prop/reference/value/",prn:"http://www.wikidata.org/prop/reference/value-normalized/",wdno:"http://www.wikidata.org/prop/novalue/",wdata:"http://www.wikidata.org/wiki/Special:EntityData/"},W3C:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",owl:"http://www.w3.org/2002/07/owl#",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",prov:"http://www.w3.org/ns/prov#"},"Social/Other":{schema:"http://schema.org/",geof:"http://www.opengis.net/def/geosparql/function/"},Blazegraph:{bd:"http://www.bigdata.com/rdf#",bds:"http://www.bigdata.com/rdf/search#",gas:"http://www.bigdata.com/rdf/gas#",hint:"http://www.bigdata.com/queryHints#"}},b.ENTITY_TYPES={"http://www.wikidata.org/prop/direct/":"property","http://www.wikidata.org/prop/":"property","http://www.wikidata.org/prop/novalue/":"property","http://www.wikidata.org/prop/statement/":"property","http://www.wikidata.org/prop/statement/value/":"property","http://www.wikidata.org/prop/statement/value-normalized/":"property","http://www.wikidata.org/prop/qualifier/":"property","http://www.wikidata.org/prop/qualifier/value/":"property","http://www.wikidata.org/prop/qualifier/value-normalized/":"property","http://www.wikidata.org/prop/reference/":"property","http://www.wikidata.org/prop/reference/value/":"property","http://www.wikidata.org/prop/reference/value-normalized/":"property","http://www.wikidata.org/wiki/Special:EntityData/":"item","http://www.wikidata.org/entity/":"item"},b.ALL_PREFIXES=a.map(b.NAMESPACE_SHORTCUTS,function(a){return a}).reduce(function(b,c,d){return a.extend(b,c)},{}),b.STANDARD_PREFIXES={wd:"PREFIX wd: <http://www.wikidata.org/entity/>",wdt:"PREFIX wdt: <http://www.wikidata.org/prop/direct/>",wikibase:"PREFIX wikibase: <http://wikiba.se/ontology#>",p:"PREFIX p: <http://www.wikidata.org/prop/>",ps:"PREFIX ps: <http://www.wikidata.org/prop/statement/>",pq:"PREFIX pq: <http://www.wikidata.org/prop/qualifier/>",rdfs:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>",bd:"PREFIX bd: <http://www.bigdata.com/rdf#>"},b.getPrefixMap=function(c){var d={};return a.each(b.ALL_PREFIXES,function(a,b){c[b]&&(d[a]=c[b])}),d}}(jQuery,wikibase.queryService.RdfNamespaces);var CONFIG=function(a,b){"use strict";var c={language:"en",api:{sparql:{uri:"/bigdata/namespace/wdq/sparql"},wikibase:{uri:"https://www.wikidata.org/w/api.php"}},i18nLoad:function(a){var c=null;return a!==this.language&&(c=b.i18n().load("i18n/"+this.language+".json",this.language)),b.when(c,b.i18n().load("i18n/"+a+".json",a))},brand:{logo:"logo.svg",title:"Wikidata Query"}},d=b.extend(!0,{},c,{api:{sparql:{uri:"https://query.wikidata.org/bigdata/namespace/wdq/sparql"}},i18nLoad:function(a){return b.when(b.i18n().load("i18n/"+a+".json",a),b.i18n().load("node_modules/jquery.uls/i18n/"+a+".json",a))},brand:{title:"Localhost"}}),e=a.location.hostname.toLowerCase();return""===e||"localhost"===e||"127.0.0.1"===e?d:c}(window,jQuery);!function(a,b,c){"use strict";function d(){a(".navbar-brand img").attr("src",b.brand.logo),a(".navbar-brand a > span").text(b.brand.title)}function e(d){Cookies.set("lang",d),a.i18n.debug=!0,a.i18n().locale=d,c.locale(d),a.when(b.i18nLoad(d)).done(function(){a(".wikibase-queryservice").i18n(),a("html").attr({lang:d,dir:a.uls.data.getDir(d)})})}var f=wikibase.queryService;a(document).ready(function(){d();var c=Cookies.get("lang")?Cookies.get("lang"):b.language;e(c);var g=new f.api.Wikibase(b.api.wikibase.uri,c),h=new f.api.Sparql(b.api.sparql.uri,c),i=new f.ui.i18n.LanguageSelector(a(".uls-trigger"),g,c);i.setChangeListener(function(a){g.setLanguage(a),h.setLanguage(a),e(a)});var j=new f.ui.editor.hint.Rdf(g),k=new f.ui.editor.tooltip.Rdf(g);new f.ui.App(a(".wikibase-queryservice "),new f.ui.editor.Editor(j,null,k),new f.ui.queryHelper.QueryHelper(g,h),h)})}(jQuery,CONFIG,moment);