var CONFIG=function(e,r){"use strict";var t,i="https://query.wikidata.org/",a={language:(t=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage,(t&&"string"==typeof t?t.split("-").shift():null)||"en"),api:{sparql:{uri:"/sparql"},wikibase:{uri:"https://www.wikidata.org/w/api.php"}},i18nLoad:function(e){var t=null;return e!==this.language&&(t=r.i18n().load("i18n",this.language)),r.when(t,r.i18n().load("i18n",e))},brand:{logo:"logo.svg",title:"Wikidata Query"},location:{root:i,index:i},showBirthdayPresents:(new Date).getTime()>=Date.UTC(2017,9,29)},n=e.location.hostname.toLowerCase();return""===n||"localhost"===n||"127.0.0.1"===n?r.extend(!0,{},a,{api:{sparql:{uri:"https://query.wikidata.org/sparql"}},i18nLoad:function(e){return r.when(r.i18n().load("i18n",e),r.i18n().load("node_modules/jquery.uls/i18n",e))},brand:{title:"Localhost"},location:{root:"./",index:"./index.html"},showBirthdayPresents:!0}):a}(window,jQuery);(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.ResultView=function(s,o){"use strict";function e(e){this._sparqlApi=e,this._init()}return e.prototype._query=null,e.prototype._sparqlQuery=null,e.prototype._sparqlApi=null,e.prototype._selectedResultBrowser=null,e.prototype._actionBar=null,e.prototype._trackingApi=null,e.prototype._hasRunFirstQuery=!1,e.prototype._resultBrowsers={Table:{icon:"glyphicon-th-list",label:["wdqs-app-resultbrowser-table","Table"],class:"TableResultBrowser",object:null,$element:null},ImageGrid:{icon:"glyphicon-picture",label:["wdqs-app-resultbrowser-image-grid","Image grid"],class:"ImageResultBrowser",object:null,$element:null},Polestar:{icon:"fa-certificate",label:["wdqs-app-resultbrowser-graph-builder","Graph builder"],class:"PolestarResultBrowser",object:null,$element:null},Map:{icon:"glyphicon-map-marker",label:["wdqs-app-resultbrowser-map","Map"],class:"CoordinateResultBrowser",object:null,$element:null},LineChart:{icon:"fa-line-chart",label:["wdqs-app-resultbrowser-line-chart","Line chart"],class:"LineChartResultBrowser",object:null,$element:null},BarChart:{icon:"fa-bar-chart",label:["wdqs-app-resultbrowser-bar-chart","Bar chart"],class:"BarChartResultBrowser",object:null,$element:null},ScatterChart:{icon:"fa-braille",label:["wdqs-app-resultbrowser-scatter-chart","Scatter chart"],class:"ScatterChartResultBrowser",object:null,$element:null},AreaChart:{icon:"fa-area-chart",label:["wdqs-app-resultbrowser-area-chart","Area chart"],class:"AreaChartResultBrowser",object:null,$element:null},BubbleChart:{icon:"glyphicon-tint",label:["wdqs-app-resultbrowser-bubble-chart","Bubble chart"],class:"BubbleChartResultBrowser",object:null,$element:null},TreeMap:{icon:"glyphicon-th",label:["wdqs-app-resultbrowser-tree-map","Tree map"],class:"TreeMapResultBrowser",object:null,$element:null},Tree:{icon:"fa-tree",label:["wdqs-app-resultbrowser-tree","Tree"],class:"TreeResultBrowser",object:null,$element:null},Timeline:{icon:"glyphicon-calendar",label:["wdqs-app-resultbrowser-timeline","Timeline"],class:"TimelineResultBrowser",object:null,$element:null},Dimensions:{icon:"glyphicon-random",label:["wdqs-app-resultbrowser-dimensions","Dimensions"],class:"MultiDimensionResultBrowser",object:null,$element:null},Graph:{icon:"glyphicon-retweet",label:["wdqs-app-resultbrowser-graph","Graph"],class:"GraphResultBrowser",object:null,$element:null}},e.prototype.trackingNamespace="wikibase.queryService.ui.app.",e.prototype._init=function(){this._sparqlApi||(this._sparqlApi=new wikibase.queryService.api.Sparql),this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._actionBar=new wikibase.queryService.ui.toolbar.Actionbar(s(".action-bar")),this._sparqlQuery=this._query=new wikibase.queryService.ui.queryHelper.SparqlQuery,this._internationalizeCharts(),this._initResultBrowserMenu()},e.prototype._internationalizeCharts=function(){var a=this;s.each(this._resultBrowsers,function(e,t){var r=t.label[0],i=t.label[1];t.label=a._i18n(r,i)})},e.prototype._initResultBrowserMenu=function(){s.each(this._resultBrowsers,function(e,t){var r=s('<li><a class="result-browser" href="#"><span class="'+t.icon.split("-",1)[0]+" "+t.icon+'"></span>'+t.label+"</a></li>");r.appendTo(s("#result-browser-menu")),t.$element=r})},e.prototype.draw=function(e){var t=this,r=s.Deferred();return this._query=e,this._actionBar.show("wdqs-action-query","","info",100),s("#query-result").empty().hide(),s(".result").hide(),s("#query-error").hide(),this._sparqlApi.query(e).done(function(){t._handleQueryResult(),r.resolve()}).fail(function(){var e=t._handleQueryError();r.reject(e)}),r.promise()},e.prototype.drawPreview=function(e){var t=this,r=s.Deferred(),i=wikibase.queryService.RdfNamespaces.ALL_PREFIXES,a=this._sparqlQuery.getQueryString();return this._query=e,this._sparqlQuery.parse(e,i),this._sparqlQuery.setLimit(20),a===this._sparqlQuery.getQueryString()?r.reject().promise():(s("#query-result").empty().hide(),s(".result").hide(),s("#query-error").hide(),this._actionBar.hide(),this._sparqlApi.query(this._sparqlQuery.getQueryString(),1e3).done(function(){t._handleQueryResult(),r.resolve(),o.setTimeout(function(){t._actionBar.show("wdqs-action-preview","","default")},200)}).fail(function(){r.reject()}),r.promise())},e.prototype._handleQueryError=function(){s("#execute-button").prop("disabled",!1);var e=this._sparqlApi.getError(),t=null,r=this._sparqlApi.ERROR_CODES;switch(e.code){case r.TIMEOUT:t="wdqs-action-timeout";break;case r.MALFORMED:t="wdqs-action-malformed-query";break;case r.SERVER:t="wdqs-action-server-error";break;default:t="wdqs-action-unknow-error"}return e.debug&&s("#query-error").html(s("<pre>").text(e.debug)).show(),this._actionBar.show(t||"",e.message||"","danger"),this._track("result.error."+(t||"unknown")),void 0===e.debug?"":e.debug},e.prototype._handleQueryResult=function(){var e=this._sparqlApi;s("#response-summary").html(this._i18n("wdqs-app-resultbrowser-response-summary","$1 results in $2&nbsp;ms",[e.getResultLength(),e.getExecutionTime()])),s(".result").show(),s("#execute-button").prop("disabled",!1);var t=this._createResultBrowsers(e.getResultRawData());return this._drawResult(t),this._selectedResultBrowser=null,this._track("result.resultLength",e.getResultLength()),this._track("result.executionTime",e.getExecutionTime(),"ms"),this._track("result.received.success"),!1},e.prototype._createResultBrowsers=function(r){var a=this,n=this._getBrowserOptions(),o=null;return null!==n.defaultName?this._track("result.browser."+n.defaultName):this._track("result.browser.default"),s.each(this._resultBrowsers,function(e,t){var r=new wikibase.queryService.ui.resultBrowser[t.class];if(r.setSparqlApi(a._sparqlApi),n.defaultName===e&&(a._setSelectedDisplayType(t),o=r),n.optionsMap.has(e)){var i=new wikibase.queryService.ui.resultBrowser.helper.Options(n.optionsMap.get(e));r.setOptions(i)}t.object=r}),null===o&&(o=this._resultBrowsers.Table.object),o.resetVisitors(),s.each(this._resultBrowsers,function(e,t){o.addVisitor(t.object),t.object.setResult(r)}),o},e.prototype._getBrowserOptions=function(){for(var e,t=null,r=new Map,i=/#(defaultView|view):(\w+)(\{.*\})?/g;null!==(e=i.exec(this._query));){var a=e[2];if(this._resultBrowsers.hasOwnProperty(a)&&("defaultView"===e[1]&&(t=a),e[3])){var n=r.has(a)?r.get(a):{};try{r.set(a,s.extend(n,JSON.parse(e[3])))}catch(e){o.console.error(e)}}}return{defaultName:t,optionsMap:r}},e.prototype._handleQueryResultBrowsers=function(){var r=this;s.each(this._resultBrowsers,function(e,t){t.$element.off("click"),t.object.isDrawable()?(t.$element.css("opacity",1).attr("href","#"),t.$element.click(function(){return s(this).closest(".open").removeClass("open"),r._setSelectedDisplayType(t),s("#query-result").html(""),r._drawResult(t.object),r._selectedResultBrowser=e,r._track("buttonClick.display."+e),!1})):t.$element.css("opacity",.5).removeAttr("href")})},e.prototype._drawResult=function(e){var t=this;s(o).off("scroll.resultBrowser"),s(o).off("resize.resultBrowser"),this._actionBar.show("wdqs-action-render","","success",100),o.setTimeout(function(){try{s("#query-result").show(),e.draw(s("#query-result")),t._actionBar.hide()}catch(e){t._actionBar.show("wdqs-action-error-display","","warning"),o.console.error(e)}t._handleQueryResultBrowsers()},20)},e.prototype._setSelectedDisplayType=function(e){s("#display-button-icon").attr("class",e.icon.split("-",1)[0]+" "+e.icon),s("#display-button-label").text(e.label)},e.prototype._track=function(e,t,r){this._trackingApi.track(this.trackingNamespace+e,t,r)},e.prototype._i18n=function(e,t,r){var i=null;return s.i18n&&(i=s.i18n.apply(s,[e].concat(r||[])))!==e||(i=t,r&&s.each(r,function(e,t){i=i.replace(new RegExp("\\$"+(e+1),"g"),t)})),i},e}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.FormatterHelper=function(l,t){"use strict";var r="http://commons.wikimedia.org/wiki/special:filepath/",u="http://www.w3.org/2001/XMLSchema#dateTime",i=["http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#positiveInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger"];function e(e,t){this._i18n=e,this._options=t||new wikibase.queryService.ui.resultBrowser.helper.Options({})}e.initMoment=function(){t.updateLocale("en",{longDateFormat:{LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"}})},e.prototype.getOptions=function(){return this._options},e.prototype.setOptions=function(e){this._options=e},e.prototype.formatRow=function(r,i){var a=this,n=l("<div/>");return l.each(r,function(e,t){a._isLabelField(e,r)||a._isHiddenField(e)||(t=l.extend({label:a._getLabel(r,e)},t),n.prepend(l("<div>").append(a.formatValue(t,e,i))))}),n},e.prototype._isLabelField=function(e,t){return e.endsWith("Label")&&void 0!==t[e.slice(0,-5)]},e.prototype._isHiddenField=function(e){return-1!==this.getOptions().getColumnNames("hide",[]).indexOf(e)},e.prototype._getLabel=function(e,t){var r=e[t+"Label"];return r&&r.value||null},e.prototype.formatValue=function(e,t,r){var i=e.value,a=l("<span>");if(t||(t=e.dataType||""),!e.type)return l("<span>").text(i).attr("title",t);switch(e.datatype||e.type){case"uri":var n=l("<a>").attr({title:t,href:i,target:"_blank",class:"item-link",rel:"noopener"});a.append(n),this.isCommonsResource(i)?(n.attr("href",this.getCommonsResourceFullUrl(i)),n.attr("title",t+": commons:"+this.getCommonsResourceFileName(i)),r?(n.click(this.handleCommonResourceItem),n.append(l("<img>").attr("src",this.getCommonsResourceThumbnailUrl(i,"120"))).width("120")):(n.attr({href:"https://commons.wikimedia.org/wiki/File:{FILENAME}".replace(/{FILENAME}/g,this.getCommonsResourceFileName(i))}),n.text("commons:"+decodeURIComponent(this.getCommonsResourceFileName(i))),a.prepend(this.createGalleryButton(i,t)," "))):(n.text(e.label||this.abbreviateUri(i)),this.isEntityUri(i)&&a.prepend(this.createExploreButton(i)," "));break;case u:t||(t=this._i18n("wdqs-app-result-formatter-title-datetime","Raw ISO timestamp"));var o=l("<span>").text(this._formatDate(i));o.attr("title",t+": "+i),a.append(o);break;case"http://www.w3.org/1998/Math/MathML":a.append(l(e.value));break;default:var s=l("<span>").text(i);e["xml:lang"]?s.attr("title",t+": "+i+"@"+e["xml:lang"]):s.attr("title",t+": "+i),a.append(s)}return a},e.prototype._formatDate=function(e){var t,r=!1,i=e.replace(/^(?:-\d+|\+?0+\b)/,function(e){return r=!0,Math.abs(e)+1}),a=this.parseDate(i);if(a.isValid())t=a.format("LL");else{var n=i.replace(/^\+?(\d+).*/,"$1");t="0000".slice(n.length)+n}return r&&(t+=" BCE"),t},e.prototype.parseDate=function(e){return e=(e=(e=e.replace(/^(?![+-])/,"+")).replace(/^([+-]?)(\d{1,5}\b)/,function(e,t,r){return t+("00000"+r).slice(-6)})).replace(/Z$/,""),t(e,t.ISO_8601)},e.prototype.isEntityUri=function(e){return"string"==typeof e&&/\/entity\/(Q|P|L|M)[0-9]+$/.test(e)},e.prototype.createExploreButton=function(e){var t=l('<a href="'+e+'" title="Explore item" class="explore glyphicon glyphicon-search" tabindex="-1" aria-hidden="true">');return t.click(l.proxy(this.handleExploreItem,this)),t},e.prototype.isCommonsResource=function(e){return e.toLowerCase().startsWith(r.toLowerCase())},e.prototype.getCommonsResourceFileName=function(e){var t=new RegExp(r,"ig");return decodeURIComponent(e.replace(t,""))},e.prototype.getCommonsResourceFullUrl=function(e){return this.isCommonsResource(e)?e.replace(/^http:/,"https:"):e},e.prototype.getCommonsResourceThumbnailUrl=function(e,t){return this.isCommonsResource(e)?e.replace(/^http:/,"https:")+"?width="+(t||400):e},e.prototype.createGalleryButton=function(e,t){var r=this.getCommonsResourceFileName(e),i=this.getCommonsResourceThumbnailUrl(e,900),a=l("<a>").attr({title:"Show Gallery",href:i,"aria-hidden":"true",class:"gallery glyphicon glyphicon-picture","data-gallery":"G_"+t,"data-title":decodeURIComponent(r)});return a.click(this.handleCommonResourceItem),a},e.prototype.abbreviateUri=function(e){var t,r,i,a=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS,n=0;for(t in a)for(r in a[t])0===e.indexOf(a[t][r])&&a[t][r].length>n&&(n=a[t][r].length,i=r);return i?i+":"+e.substr(n):"<"+e+">"};var s=100;return e.prototype.handleExploreItem=function(e,t){var r=l("#explorer-dialogs .explorer-dialog").clone().dialog({uiLibrary:"bootstrap",autoOpen:!1,maxWidth:window.innerWidth,maxHeight:window.innerHeight,minHeight:250,minWidth:250,resizable:!0,width:window.innerWidth/2,height:Math.min(window.innerWidth,window.innerHeight)/2,drag:function(e){r.children("div.explorer-body").css("visibility","hidden"),l("body").addClass("disable-selection"),r.mousemove(function(e){e.pageY<30&&r.css("top","10px")})},dragStop:function(e){r.children("div.explorer-body").css("visibility","visible"),l("body").removeClass("disable-selection")},resize:function(e){r.children("div.explorer-body").css("visibility","hidden"),l("body").addClass("disable-selection")},resizeStop:function(e){r.children("div.explorer-body").css("visibility","visible"),l("body").removeClass("disable-selection")}});e.preventDefault();var i=l.i18n&&l.i18n().locale||"en",a="SELECT ?item ?itemLabel WHERE { BIND( <"+t.value+'> as ?item ).\tSERVICE wikibase:label { bd:serviceParam wikibase:language "'+i+'" } }',n="embed.html#"+encodeURIComponent("#defaultView:Graph\n"+a),o=l(window).scrollTop()+200;return r.children("div.explorer-body").html(l('<iframe frameBorder="0" scrolling="no"></iframe>').attr("src",n)),r.css("left",s),r.css("top",o),r.open(),s+=10,!1},e.prototype.handleCommonResourceItem=function(e){e.preventDefault(),l(this).ekkoLightbox({scale_height:!0})},e.prototype.isLabel=function(e){return!!e&&("xml:lang"in e||"literal"===e.type&&!e.datatype)},e.prototype.isNumber=function(e){return e&&e.datatype&&-1!==i.indexOf(e.datatype)},e.prototype.isDateTime=function(e){return e&&e.datatype===u},e.prototype.isEntity=function(e){return e&&e.value&&this.isEntityUri(e.value)},e.prototype.isColor=function(e){return e&&"literal"===e.type&&e.value&&/^([\dA-F]{1,2}){3}$/i.test(e.value)},e.prototype.getColorForHtml=function(e){return"#"+e.value},e.prototype.calculateLuminance=function(e){var t=parseInt(e.substr(1,2),16)/255,r=parseInt(e.substr(3,2),16)/255,i=parseInt(e.substr(5,2),16)/255;return isFinite(t)&&isFinite(r)&&isFinite(i)?.2126*(t=t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(r=r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(i=i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)):NaN},e.prototype._i18n=null,e.prototype._options=null,e}(jQuery,moment),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.Options=function(e){"use strict";function t(e){if("object"!=typeof e)throw new Error("options must be an object");this._options=e}return t.prototype._options=null,t.prototype._requireTwoArguments=function(e){if(2!==e.length)throw new Error("must be called with exactly two arguments")},t.prototype.get=function(e,t){return this._requireTwoArguments(arguments),e in this._options?this._options[e]:t},t.prototype.getArray=function(e,t){this._requireTwoArguments(arguments);var r=this.get(e,t);return Array.isArray(r)?r:[r]},t.prototype.getColumnNames=function(e,t){return this._requireTwoArguments(arguments),this.getArray(e,t).filter(function(e){return!("string"!=typeof e||!e.startsWith("?"))||(window.console.warn("column name "+e+" is not a variable name, ignoring"),!1)}).map(function(e){return e.substring(1)})},t}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractResultBrowser=function(s,e){"use strict";function t(){this._visitors=[]}return t.prototype._formatter=null,t.prototype._result=null,t.prototype._options=null,t.prototype._visitors=null,t.prototype._drawable=!1,t.prototype._sparqlApi=null,t.prototype.setResult=function(e){this._result=e},t.prototype.setOptions=function(e){this._options=e,this._getFormatter().setOptions(e)},t.prototype.getOptions=function(){return this._options||new e.queryService.ui.resultBrowser.helper.Options({})},t.prototype.setSparqlApi=function(e){this._sparqlApi=e},t.prototype.getSparqlApi=function(){return this._sparqlApi},t.prototype._iterateResult=function(n){var o=this;s.each(this._result.results.bindings,function(i,a){s.each(o._result.head.vars,function(e,t){var r=a[t]||null;o.processVisitors(r,t),n(r,t,a,i)})})},t.prototype.isDrawable=function(){return this._drawable},t.prototype.draw=function(e){jQuery.error("Method draw() needs to be implemented!")},t.prototype.addVisitor=function(e){this._visitors.push(e)},t.prototype.resetVisitors=function(){this._visitors=[]},t.prototype.processVisitors=function(r,i){var a={};0!==this._visitors.length&&(s.each(this._visitors,function(e,t){t.visit&&"function"==typeof t.visit&&!1===t.visit(r,i)&&(a[e]=!0)}),this._visitors=this._visitors.filter(function(e,t){return!a[t]}))},t.prototype.visit=function(e){return!1},t.prototype.setFormatter=function(e){this._formatter=e},t.prototype._getFormatter=function(){return null===this._formatter&&(this._formatter=new e.queryService.ui.resultBrowser.helper.FormatterHelper(this._i18n)),this._formatter},t.prototype._i18n=function(e,t,r){var i=null;return s.i18n&&(i=s.i18n.apply(s,[e].concat(r||[])))!==e||(i=t,r&&s.each(r,function(e,t){i=i.replace(new RegExp("\\$"+(e+1),"g"),t)})),i},t}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser=function(e,t){"use strict";function r(){}return(r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._getLabelColumns=function(){var t=this,r=t._getRows()[0];return t._getColumns().filter(function(e){return t._getFormatter().isLabel(r[e])})},r.prototype._getNumberColumns=function(){var r=this,e=r._getRows();return r._getColumns().filter(function(t){return e.some(function(e){return e[t]&&r._getFormatter().isNumber(e[t])})})},r.prototype._getColumns=function(){return this._result.head.vars},r.prototype._getRows=function(){return this._result.results.bindings},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser=function(l,i,n,r,o){"use strict";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._dataColumns=null,e.prototype._data=null,e.prototype._$element=null,e.prototype._svg=null,e.prototype._chart=null,e.prototype._chartLegend=null,e.prototype._chartSeriesKey=null,e.prototype._chartStoryKey=null,e.prototype._isStoryPaused=!1,e.prototype.draw=function(e){var t=this;this._$element=l("<div>").css({width:"100%",height:"98vh"}),e.html(this._$element),this._createData(),this._drawSvg(),this._createChart(),this._drawChart(),this._createLegendFilter(),r.onresize=function(){t._drawChart(250,!0)}},e.prototype._createData=function(){var i=[],a={},n=null;this._iterateResult(function(e,t,r){null===n&&(n=r),r!==n&&(n=r,i.push(a),a={}),e&&e.value&&(a[t]=e.value)}),i.push(a),this._data=i},e.prototype._drawSvg=function(){this._svg=o.newSvg(this._$element[0],"100%","100%")},e.prototype._createChart=function(){this._chart=new o.chart(this._svg,this._data),this._chart.setBounds(0,0,"100%","100%"),this._chart.setMargins("5%","5%","2%","25%"),this._createChartAxis();var e=this._chart.addSeries(this._chartSeriesKey,this._getPlotType());e.addOrderRule(this._chartSeriesKey),e.lineMarkers=!0,this._chartStoryKey&&this._createChartStory(),this._chartLegend=this._chart.addLegend("1%","85%","100%","15%")},e.prototype._getPlotType=function(){jQuery.error("Method _getPlotType() needs to be implemented!")},e.prototype._createChartAxis=function(){var r=this,i=this._getRows()[0],a=this._getFormatter(),n=this._chart,o=["y","x"],s=!1;l.each(this._getColumns(),function(e,t){if(0!==o.length)a.isLabel(i[t])&&(n.addCategoryAxis(o.pop(),t),s=!0),a.isNumber(i[t])&&n.addMeasureAxis(o.pop(),t),a.isDateTime(i[t])&&(n.addTimeAxis(o.pop(),t,"%Y-%m-%dT%H:%M:%SZ","%m-%d-%Y"),s=!0);else if(a.isLabel(i[t])){if(!r._chartSeriesKey)return void(r._chartSeriesKey=t);if(!r._chartStoryKey)return r._chartStoryKey=t,!1}}),s||this._chartSeriesKey||!n.axes[0]||(this._chartSeriesKey=n.axes[0].measure)},e.prototype._createChartStory=function(){var e=this,t=this._chart.setStoryboard(this._chartStoryKey);t.frameDuration=5e3,this._$element.click(function(){if(e._isStoryPaused)return t.startAnimation(),void(e._isStoryPaused=!1);t.pauseAnimation(),e._isStoryPaused=!0})},e.prototype._createLegendFilter=function(){var e=this,a=o.getUniqueValues(this._data,this._chartSeriesKey);this._chart.legends=[],this._chartLegend.shapes.selectAll("rect").on("click",function(t){var r=!1,i=[];a.forEach(function(e){e===t.aggField.slice(-1)[0]?r=!0:i.push(e)}),n.select(this).style("opacity",r?.2:.8),r||i.push(t.aggField.slice(-1)[0]),a=i,e._chart.data=o.filterData(e._data,e._chartSeriesKey,a),e._drawChart(800)})},e.prototype._drawChart=function(e,t){var r=this;this._chart.draw(e,t),i.delay(function(){r._svg.selectAll(".dimple-marker,.dimple-marker-back").attr("r",2)},1.2*e)},e.prototype.isDrawable=function(){return 2<=Object.keys(this._dataColumns).length},e.prototype.visit=function(e,t){return this._checkColumn(e,t)},e.prototype._checkColumn=function(e,t){return this._getFormatter().isLabel(e)&&(this._dataColumns[t]=!0),this._getFormatter().isNumber(e)&&(this._dataColumns[t]=!0),this._getFormatter().isDateTime(e)&&(this._dataColumns[t]=!0),!this.isDrawable()},e}(jQuery,_,d3,window,dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.ImageResultBrowser=function(l,t){"use strict";function e(){this._queue=[]}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._grid=null,e.prototype._loading=l("#loading-spinner"),e.prototype._heightThreshold=400,e.prototype._widthThreshold=70,e.prototype._fixedItemWidth=0,e.prototype._totalWidth=0,e.prototype._lineHeight=0,e.prototype._queue=null,e.prototype.draw=function(e){var i=this;this._queue.splice(0,this._queue.length),this._grid=l('<div class="img-grid">').html('<div class="item-row hidden-row">'),e.html(this._grid),this._lineHeight=1.5*parseFloat(this._grid.css("font-size")),this._iterateResult(function(e,t,r){e&&i._isCommonsResource(e.value)&&(r.url=e.value,i._queue.push(r))}),this._fixedItemWidth=this._calculateBaseWidth(),this._gridWidth=this._grid.width(),this._lazyLoad()},e.prototype._calculateBaseWidth=function(){var t=0,r=l('<div class="item hidden">');return this._grid.append(r),["margin-left","margin-right","padding-left","padding-right"].forEach(function(e){t+=parseFloat(r.css(e))}),r.remove(),t},e.prototype._lazyLoad=function(){var e=this;l(window).off("scroll.resultBrowser"),l(window).off("resize.resultBrowser"),this._queue.length?this._getPosFromTop()<3*window.innerHeight?(this._loading.show(),this._loadNextChunk().done(function(){e._lazyLoad.call(e)})):(l(window).on("scroll.resultBrowser",l.proxy(t.debounce(e._lazyLoad,100),e)),this._loading.hide()):(this._showFinalRow(),this._loading.hide()),l(window).on("resize.resultBrowser",l.proxy(t.debounce(this._layoutPage,100),e))},e.prototype._showFinalRow=function(e){var t=l(".item-row").last(),r=t.find(".item"),i={height:0,widths:[]};t.children().length?(i.height=this._heightThreshold,i.widths=r.map(function(){return l(this).data("aspectRatio")*(i.height-l(this).data("fixedHeight"))}).toArray(),this._setDimensions(t,i,e)):t.remove()},e.prototype._loadNextChunk=function(){var a=this,e=this._queue.splice(0,8),n=[l.when()];return e.forEach(function(e,t){var r=n[t],i=l.when(a._preloadItem(e),r);n.push(i),i.done(function(e){a._appendItem(e)})}),n[e.length]},e.prototype._getPosFromTop=function(){return l(".item-row").last().offset().top-l(window).scrollTop()},e.prototype._calculateDimensions=function(e){var t=e.find(".item"),r=this._fixedItemWidth*t.length,i=this._gridWidth-r,a=0,n=0,o={height:0,widths:[]};return t.each(function(){var e=l(this).data("aspectRatio"),t=l(this).data("fixedHeight");a+=e,n+=e*t}),o.height=(i+n)/a,o.widths=t.map(function(){var e=l(this).data("aspectRatio")*(o.height-l(this).data("fixedHeight"));return Math.trunc(100*e)/100}).toArray(),o},e.prototype._layoutPage=function(){var e=l(".item");this._gridWidth=this._grid.width(),l(".item").unwrap(),this._grid.append(l('<div class="item-row hidden-row">')),e.each(l.proxy(function(e,t){this._appendItem(t,!0)},this)),this._queue.length?l(".hidden-row").not(".hidden-row:last").removeClass("hidden-row"):(this._showFinalRow(!0),l(".hidden-row").removeClass("hidden-row"))},e.prototype._appendItem=function(e,t){var r=l(".item-row").last();r.append(e),this._layOutRow(r,t)},e.prototype._preloadItem=function(e){var t=this,r=l.Deferred(),i=this._getThumbnail(e.url,1e3),a=this._getFormatter().getCommonsResourceFileName(i),n=this._getItem(this._getThumbnail(i),this._getThumbnail(i,1e3),a,e),o=this._lineHeight*n.find(".summary")[0].childElementCount,s=n.find(".item-img");return s[0].onerror=function(){s.attr("src","https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg")},s[0].onload=function(){var e=this.naturalWidth/this.naturalHeight;r.resolveWith(t,n.data("aspectRatio",e))},n.data("fixedHeight",o),s.attr("src",i),r.promise()},e.prototype._layOutRow=function(e,t){var r=this._calculateDimensions(e);(r.height<this._heightThreshold||Math.min(r.widths)<this._widthThreshold)&&(this._setDimensions(e,r,t),this._grid.append(l('<div class="item-row hidden-row">')))},e.prototype._setDimensions=function(e,t,r){e.find(".item").width(function(e){return t.widths[e]}),r||e.removeClass("hidden-row")},e.prototype._getItem=function(e,t,r,i){var a=l("<a>").click(this._getFormatter().handleCommonResourceItem).attr({href:t,"data-gallery":"g","data-title":r}).append(l('<img class="item-img" >')),n=this._getFormatter().formatRow(i).addClass("summary");return l('<div class="item">').append(a,n)},e.prototype._isCommonsResource=function(e){return this._getFormatter().isCommonsResource(e)},e.prototype._getThumbnail=function(e,t){return this._getFormatter().getCommonsResourceThumbnailUrl(e,t)},e.prototype.visit=function(e){return this._checkImage(e)},e.prototype._checkImage=function(e){return!(e&&e.value&&this._isCommonsResource(e.value))||!(this._drawable=!0)},e}(jQuery,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TableResultBrowser=function(n,o){"use strict";function e(){}var i=[10,50,100,200,500,1e3];return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._columns=null,e.prototype._rows=null,e.prototype._$selectedCell={},e.prototype._selectedCellHighlighted=!1,e.prototype._tableNumber=!1,e.prototype._pageLoading=!0,e.prototype._sorter={string:function(e,t){return e.localeCompare(t)},number:function(e,t){return t<=e?-1:1},generic:function(e,t){if(!t)return 1;if(!e)return-1;var r=this._getFormatter();return r.isNumber(e)&&r.isNumber(t)?this._sorter.number(Number(e.value),Number(t.value)):r.isEntityUri(e.value)&&r.isEntityUri(t.value)?this._sorter.number(Number(e.value.replace(/[^0-9]/gi,"")),Number(t.value.replace(/[^0-9]/gi,""))):this._sorter.string(e.value,t.value)}},e.prototype.draw=function(e){var t=this._result;if(void 0!==t.boolean){var r=n("<table>").attr("class","table");return r.append("<tr><td>"+t.boolean+"</td></tr>").addClass("boolean"),void e.html(r)}this.columns=t.head.vars,this.rows=t.results.bindings;var i=n("<table/>");e.html(i),this.drawBootstrapTable(i),i.children().width()>n(o).width()&&i.bootstrapTable("toggleView")},e.prototype.drawBootstrapTable=function(r){var a=this,e=200<this.rows.length;jQuery.fn.bootstrapTable.columnDefaults.formatter=function(e,t,r){return e?(a.processVisitors(e,this.field),a._getFormatter().formatValue(e).html()):""};var t={"click .explore":n.proxy(this._getFormatter().handleExploreItem,this),"click .gallery":this._getFormatter().handleCommonResourceItem};r.bootstrapTable({columns:this.columns.map(function(e){return{title:e,field:e,events:t,sortable:!0,sorter:n.proxy(a._sorter.generic,a)}}),data:this.rows,mobileResponsive:!0,search:e,pagination:e,showPaginationSwitch:e,pageSize:200,pageList:i,keyEvents:!1,cookie:!0,cookieIdTable:"1",cookieExpire:"1y",cookiesEnabled:["bs.table.pageList"],onResetView:function(e,t){void 0===o._currentTableNumber&&(o._currentTableNumber=0),o._currentTableNumber++,a._tableNumber=o._currentTableNumber,a._selectedCellHighlighted=!1,a._pageLoading=!1,a.selectFirstCell(r),n("button:focus").blur()},onClickCell:function(e,t,r,i){a._selectedCellHighlighted=!0,a.selectCell(i)}}),n(document).keydown(function(e){a.keyPressed(e)}),n("#result-browser-menu a").on("click",function(){void 0===o._currentTableNumber&&(o._currentTableNumber=0),o._currentTableNumber++})},e.prototype.selectFirstCell=function(e){var t=e.find("td").first();this.selectCell(t)},e.prototype.selectCell=function(e){!0===this._selectedCellHighlighted?e.length&&(n(".table-cell-selected").removeClass("table-cell-selected"),this._$selectedCell=e,this._$selectedCell.parent().hasClass("no-records-found")||this._$selectedCell.addClass("table-cell-selected")):this._$selectedCell=e},e.prototype.scrollToCell=function(e){var t=e.offset().top;n("html, body").scrollTop(t-o.innerHeight/3)},e.prototype.keyPressed=function(e){if(o._currentTableNumber===this._tableNumber&&!n(document.activeElement).is("textarea, input, button")&&0!==this._$selectedCell.length){if(!0!==this._selectedCellHighlighted)return"ArrowLeft"!==e.key&&"ArrowUp"!==e.key&&"ArrowRight"!==e.key&&"ArrowDown"!==e.key||(this._selectedCellHighlighted=!0,this.selectCell(this._$selectedCell),this.scrollToCell(this._$selectedCell)),void e.stopImmediatePropagation();if((e.ctrlKey||e.metaKey)&&("c"===e.key||"C"===e.key))return""!==o.getSelection().toString()?void 0:(this.copyToClipboard(this._$selectedCell),void e.stopImmediatePropagation());if(!(e.ctrlKey||e.metaKey||e.altKey)){switch(e.key){case"Enter":this._$selectedCell.find("a").each(function(){return!n(this).text().trim().length||(o.open(n(this).prop("href")),!1)});break;case"ArrowLeft":0===this._$selectedCell.prev().length?!1===this._pageLoading&&(this._pageLoading=!0,n(".page-pre a").click()):this.selectCell(this._$selectedCell.prev());break;case"ArrowUp":this._$selectedCell.parent().prev().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")").length&&(this.selectCell(this._$selectedCell.parent().prev().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")")),this.scrollToCell(this._$selectedCell));break;case"ArrowRight":0===this._$selectedCell.next().length?!1===this._pageLoading&&(this._pageLoading=!0,n(".page-next a").click()):this.selectCell(this._$selectedCell.next());break;case"ArrowDown":this._$selectedCell.parent().next().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")").length&&(this.selectCell(this._$selectedCell.parent().next().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")")),this.scrollToCell(this._$selectedCell))}e.stopImmediatePropagation()}}},e.prototype.copyToClipboard=function(e){var t=n("<input>");n("body").append(t),t.val(e.text().trim()).select(),document.execCommand("copy"),t.remove()},e.prototype.isDrawable=function(){return!0},e.prototype.visit=function(e){return!1},e}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.CoordinateResultBrowser=function(l,u,e,s,r,i){"use strict";var t=["http://www.opengis.net/ont/geosparql#wktLiteral","http://www.openlinksw.com/schemas/virtrdf#Geometry"],a="http://www.opengis.net/def/crs/OGC/1.3/CRS84",n=["http://www.wikidata.org/entity/Q2",a],o=["?layerLabel","?layer"],p="_LAYER_DEFAULT_GROUP",c={url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",options:{id:"wikipedia-map-01",attribution:' <a href="https://maps.wikimedia.org/">Wikimedia</a> | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},d={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},h=null;function y(){this._markerGroupColors={};var t=e.scale.category10();this._getMarkerGroupColor=function(e){return e in this._markerGroupColors?this._markerGroupColors[e]:t(e)},h=u.Control.extend({options:{position:"topright"},onAdd:function(e){var t=u.DomUtil.create("button");return l(t).addClass("btn btn-default wdqs-control-scroll-top"),l(t).append(l(' <span class="glyphicon glyphicon-chevron-up"/> ')),t.onclick=function(){e.isFullscreen()&&e.toggleFullscreen(),l(i).scrollTop(0,0)},t}})}return(y.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._map=null,y.prototype._markerGroups=null,y.prototype._markerGroupsProgress=null,y.prototype._markerGroupColors=null,y.prototype._getMarkerGroupColor=null,y.prototype.draw=function(i){var e,a=this,n=l("<div>").attr("id","map").height("100vh");function o(){clearInterval(e),l("#map-progress").remove()}function t(){o();var e=s.compact(a._markerGroups),t=a._getMarkerClusterOptions(e.length);if(t){var r=u.markerClusterGroup(t);r.addLayers(e),e=[r]}a._map=u.map("map",{center:[0,0],maxZoom:18,minZoom:2,fullscreenControl:!0,preferCanvas:!0,layers:e}).fitBounds(a._markerGroups[p].getBounds()),a._setTileLayer(),a._createControls(),a._createMarkerZoomResize(),i.html(n)}i.html(n),e=setInterval(function(){if(0<a._markerGroupsProgress&&a._markerGroupsProgress<1){var e=(100*a._markerGroupsProgress).toFixed(2),t=a._i18n("wdqs-result-map-progress","Loading map data: $1%",[e]);n.html(l("<div>").attr("id","map-progress").css({position:"relative",top:"20%",width:"100%",textAlign:"center"}).text(t))}else 1<=a._markerGroupsProgress&&o()},200),this._createMarkerGroups().done(t).fail(t)},y.prototype._createControls=function(){var i=this;if(this._map.addControl(u.control.zoomBox({modal:!1,className:"glyphicon glyphicon-zoom-in"})),this._map.addControl(new h),1<Object.keys(this._markerGroups).length){var e=this._getLayerControl(this._markerGroups).addTo(this._map);this._map.on("overlayadd overlayremove",function(r){r.layer===i._markerGroups[p]&&(l.each(i._markerGroups,function(e,t){"overlayadd"===r.type?i._map.addLayer(t):i._map.removeLayer(t)}),e._update())})}u.control.locate().addTo(this._map);new u.Control.MiniMap(new u.TileLayer(c.url,c.url.options),{zoomLevelOffset:-7,toggleDisplay:!0}).addTo(this._map)},y.prototype._createMarkerZoomResize=function(){var e=this;if(!(1e3<this._markerGroups[p].getLayers().length)){this._map.on("zoomend",function(){e._markerGroups[p].setStyle({radius:e._getMarkerRadius()})})}},y.prototype._getMarkerRadius=function(){return this._map?.5*this._map.getZoom():3},y.prototype._getLayerControl=function(){var i=this,a={},n="";return l.each(this._markerGroups,function(e,t){if(e===p)n=i._i18n("wdqs-result-map-layers-all","All layers");else{var r=i._getMarkerGroupColor(e);n='<span style="color:'+r+'">&#x2b24;</span> '+e}a[n]=t}),u.control.layers(null,a)},y.prototype._createMarkerGroups=function(){var a=this,n=[],o=0,s={};function e(){if(0===Object.keys(s).length){var e=u.marker([0,0]).bindPopup("Nothing found!").openPopup();return{null:u.featureGroup([e])}}a._markerGroups={},l.each(s,function(e){a._markerGroups[e]=u.featureGroup(s[e])})}return s[p]=[],this._iterateResult(function(e,t,r){var i=a._extractGeoJson(e);null!==i&&n.push(l.when(i,r))}),l.each(n,function(e,t){t.done(function(e,i){o++,a._markerGroupsProgress=o/n.length;var r=a._getMarkerGroupsLayer(i);s[r]||(s[r]=[]);var t=u.geoJson(e,{style:a._getMarkerStyle(r,i),pointToLayer:function(e,t){return u.circleMarker(t,a._getMarkerStyle(r,i))},onEachFeature:function(e,t){var r=u.popup();t.bindPopup(r),t.on("click",function(){var e=a._getItemDescription(i);r.setContent(e[0])})}});s[r].push(t),s[p].push(t)})}),l.when.apply(l,n).done(e).fail(e)},y.prototype._getMarkerGroupsLayer=function(t){var e=this.getOptions().getColumnNames("layer",o).find(function(e){return t[e]});return e?t[e].value:p},y.prototype._getMarkerStyle=function(e,t){var r,i=this._getFormatter();return"rgb"in t&&i.isColor(t.rgb)?(r=i.getColorForHtml(t.rgb),this._markerGroupColors[e]=r):r=e!==p?this._getMarkerGroupColor(e):"#e04545",{color:r,opacity:.8,fillColor:r,fillOpacity:.9,radius:this._getMarkerRadius()}},y.prototype._getMarkerIcon=function(e){var t=e.getAllChildMarkers()[0].options,r=2*(1+t.radius),i='<div style="background-color: '+t.color+"; border-radius: 100%; width: "+r+"px; height: "+r+'px"></div>';return new u.DivIcon({html:i,className:"",iconSize:new u.Point(r,r)})},y.prototype._getMarkerClusterOptions=function(e){var t=this.getOptions().get("markercluster",1===e);return!!t&&(!0===t?{maxClusterRadius:0,iconCreateFunction:this._getMarkerIcon}:l.extend({},t))},y.prototype._splitWktLiteral=function(e){var t=e.match(/(<([^>]*)> +)?(.*)/);return t?{crs:t[2]||a,wkt:t[3]}:null},y.prototype._isWktLiteral=function(e){return e&&"literal"===e.type&&-1!==t.indexOf(e.datatype)},y.prototype._isCommonsMap=function(e){return e&&"uri"===e.type&&e.value.startsWith("http://commons.wikimedia.org/data/main/")&&e.value.endsWith(".map")},y.prototype._extractGeoJson=function(e){return this._isWktLiteral(e)?this._extractGeoJsonWktLiteral(e.value):this._isCommonsMap(e)?this._extractGeoJsonCommonsMap(e.value):null},y.prototype._extractGeoJsonWktLiteral=function(e){var t=this._splitWktLiteral(e);return t?-1===n.indexOf(t.crs)?null:l.when(r.parse(t.wkt)):null},y.prototype._extractGeoJsonCommonsMap=function(e){if(!CONFIG.showBirthdayPresents)return null;var t=e.match(/^http:\/\/commons.wikimedia.org\/data\/main\/(.*)$/)[1],r=decodeURIComponent(t);return r=r.replace(/\+/g," "),l.getJSON("https://commons.wikimedia.org/w/api.php",{format:"json",action:"query",titles:r,prop:"revisions",rvprop:"content",origin:"*",maxage:3600}).then(function(e){var t,r;for(t in e.query.pages)return r=e.query.pages[t].revisions[0]["*"],JSON.parse(r).data}).promise()},y.prototype._getItemDescription=function(e){return l("<div/>").append(this._getFormatter().formatRow(e,!0))},y.prototype._setTileLayer=function(){var e=d;("query.wikidata.org"===i.location.host||"localhost"===i.location.host||i.location.host.endsWith(".wmflabs.org"))&&(e=c),u.tileLayer(e.url,e.options).addTo(this._map)},y.prototype.visit=function(e){return this._checkCoordinate(e)},y.prototype._checkCoordinate=function(e){return!this._isWktLiteral(e)&&!this._isCommonsMap(e)||!(this._drawable=!0)},y}(jQuery,L,d3,_,wellknown,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeMapResultBrowser=function(E,C,R){"use strict";function e(){this._labelColumns={}}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._labelColumns=null,e.prototype.draw=function(e){var i=this,a={},n=a,o=null,s=null,l=null;this._iterateResult(function(e,t,r){r!==l&&(null!==l&&(n.data={size:o,url:s},s=o=null,n=a),l=r),i._getFormatter().isLabel(e)&&(n[e.value]||(n[e.value]={}),n=n[e.value]),i._getFormatter().isNumber(e)&&(o=e.value),e&&e.value&&i._getFormatter().isEntityUri(e.value)&&(s=e.value)}),n.data={size:o,url:s};var t={name:"treeMap",children:this._createTreeData(a)};this._draw(e,t)},e.prototype._createTreeData=function(e){var o,s=this,l=[];return e.data||E.each(e,function(e,t){var r=s._createTreeData(t);if(0!==r.length)o={id:e,name:e,children:r};else{var i=1;t.data.size&&0<t.data.size&&(i=t.data.size);var a=e,n=t.data.url;n&&(a=n),o={id:a+Math.random(),name:e,size:i,url:n}}l.push(o)}),l},e.prototype._draw=function(e,t){var r,n,o=E(R).width(),s=E(R).height(),l=C.scale.linear().range([0,o]),u=C.scale.linear().range([0,s]),p=C.scale.category10(),c=20,d="#555555",h=C.layout.treemap().round(!1).size([o,s]).sticky(!0).value(function(e){return e.size}),y=C.select(e[0]).append("svg:svg").attr("width",o).attr("height",s).append("svg:g");n=r=t;var i=h.nodes(r),a=i.filter(function(e){return!e.children}),w=i.filter(function(e){return e.children}),g=y.selectAll("g.cell.parent").data(w,function(e){return"p-"+e.id}),f=g.enter().append("g").attr("class","cell parent").on("click",function(e){T(e)});f.append("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",c).style("fill",d),f.append("foreignObject").attr("class","foreignObject").append("xhtml:body").attr("class","labelbody").append("div").attr("class","label");var m=g.transition().duration(500);m.select(".cell").attr("transform",function(e){return"translate("+e.dx+","+e.y+")"}),m.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",c).style("fill",d),m.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",c).select(".labelbody .label").text(function(e){return e.name}),g.exit().remove();var b=y.selectAll("g.cell.child").data(a,function(e){return"c-"+e.id}),_=b.enter().append("g").attr("class","cell child").on("click",function(e){T(n===e.parent?r:e.parent)});_.append("rect").classed("background",!0).style("fill",function(e){return p(e.parent.name)}),_.append("foreignObject").attr({class:"foreignObject",width:function(e){return Math.max(.01,e.dx)},height:function(e){return Math.max(.01,e.dy)}}).append("xhtml:body").attr("class","labelbody").append("div").attr("class","label").text(function(e){return e.name}).on("click",function(e){e.url&&(R.open(e.url,"_blank"),C.event.stopPropagation())});var v=b.transition().duration(500);function k(e){return e.size}function S(e){return 1}function q(e){var t,r,i,a,n=(r=(t=e).substring(1,3),i=t.substring(3,5),a=t.substring(5,7),{R:parseInt(r,16),G:parseInt(i,16),B:parseInt(a,16)});return 255-(.299*n.R+.587*n.G+.114*n.B)<105?"#000000":"#ffffff"}function T(e){h.padding([c/(s/e.dy),0,0,0]).nodes(e);var t=o/e.dx,r=s/e.dy,i=e;l.domain([e.x,e.x+e.dx]),u.domain([e.y,e.y+e.dy]),y.selectAll(".labelbody .label").style("display","block");var a=y.selectAll("g.cell").transition().duration(500).attr("transform",function(e){return"translate("+l(e.x)+","+u(e.y)+")"}).each("end",function(e,t){t||i===self.root||(y.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("color",function(e){return q(p(e.parent.name))}),y.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("display",""))});a.select(".foreignObject").attr("width",function(e){return Math.max(.01,t*e.dx)}).attr("height",function(e){return e.children?c:Math.max(.01,r*e.dy)}).select(".labelbody .label").text(function(e){return e.name}),a.select("rect").attr("width",function(e){return Math.max(.01,t*e.dx)}).attr("height",function(e){return e.children?c:Math.max(.01,r*e.dy)}).style("fill",function(e){return e.children?d:p(e.parent.name)}),n=e,C.event&&C.event.stopPropagation()}v.select(".cell").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),v.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return e.dy}).style("fill",function(e){return p(e.parent.name)}),v.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return Math.max(.01,e.dy)}).select(".labelbody .label").text(function(e){return e.name}),b.exit().remove(),C.select("select").on("change",function(){console.log("select zoom(node)"),h.value("size"==value?k:S).nodes(r),T(n)}),T(n)},e.prototype.isDrawable=function(){return 1<Object.keys(this._labelColumns).length},e.prototype.visit=function(e,t){return this._checkColumn(e,t)},e.prototype._checkColumn=function(e,t){return!this._getFormatter().isLabel(e,t)||(this._labelColumns[t]=!0,!this.isDrawable())},e}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeResultBrowser=function(o,i,a){"use strict";var e='SELECT ?property ?propertyLabel ?value ?valueItemLabel ?valueImage WHERE {       {         SELECT ?property ?value ?valueImage ?valueItem WHERE {           BIND(<{ENTITY_URI}> AS ?item)           ?item ?prop ?value.           ?property wikibase:directClaim ?prop.           ?property rdf:type wikibase:Property.           OPTIONAL { ?value wdt:P18 ?valueImage. }           OPTIONAL { BIND(?value AS ?valueItem).  FILTER(STRSTARTS(STR(?value), STR(wd:))) }         }       }       SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }    }  ';function t(){this._labelColumns={}}return(t.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._isDrawable=!1,t.prototype._jsTree=null,t.prototype._nodes=null,t.prototype.draw=function(e){var t=this;this._nodes=this._extractNodes(o.proxy(this._iterateResult,this));var r=o("<div>").jstree({core:{data:i.compact(t._nodes),check_callback:!0},plugins:["types","wholerow","contextmenu","unique"],types:{default:{icon:"glyphicon glyphicon-barcode"}},contextmenu:{items:function(e){return{Open:{label:t._nodes[e.id].url,icon:"glyphicon glyphicon-link",action:function(){a.open(t._nodes[e.id].url,"_blank")}},explore:{label:t._nodes[e.id].url,icon:"glyphicon glyphicon-download-alt",action:function(){t._expandTree(t._nodes[e.id])}}}}}});this._jsTree=r.jstree(),e.empty().append(r)},t.prototype._extractNodes=function(e,i){var a=null,n={},o=null,s={},l=this._getFormatter();return e(function(e,t,r){r!==a&&(o=null,a=r),e&&e.value&&(o&&(l.isLabel(e)||l.isNumber(e))&&(s[o].text=(s[o].text||"")+" "+e.value),o&&l.isCommonsResource(e.value)&&(s[o].icon=l.getCommonsResourceThumbnailUrl(e.value,24)),l.isEntity(e)&&((n={}).parent=o||i||"#",n.id=n.parent+e.value,n.url=e.value,n.state={opened:!1},s[n.id]=n,o=n.id))}),s},t.prototype._expandTree=function(r){var i=this;this.getSparqlApi().query(e.replace("{ENTITY_URI}",r.url)).done(function(){var e=i.getSparqlApi().getResultRawData(),t=i._extractNodes(function(n){o.each(e.results.bindings,function(i,a){o.each(e.head.vars,function(e,t){var r=a[t]||null;n(r,t,a,i)})})},r.id);o.extend(i._nodes,t),o.each(t,function(e,t){i._jsTree.create_node(t.parent,t)})})},t.prototype.isDrawable=function(){return this._isDrawable},t.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||!(this._isDrawable=!0)},t}(jQuery,_,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.BubbleChartResultBrowser=function(p,u,c){"use strict";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._hasLabel=!1,e.prototype._hasNumber=!1,e.prototype.draw=function(e){var n=this,o={name:"bubblechart",children:[]},s=this._getLabelColumns()[0],l=this._getNumberColumns()[0],u=null;this._iterateResult(function(e,t,r){if(r!==u){var i={url:null};(u=r).rgb&&n._getFormatter().isColor(r.rgb)&&(i.color=n._getFormatter().getColorForHtml(r.rgb)),r[s]&&r[l]&&(i.name=r[s].value,i.size=r[l].value,o.children.push(i))}if(e&&e.value&&n._getFormatter().isEntityUri(e.value)){var a=o.children[o.children.length-1];a&&null===a.url&&(a.url=e.value)}});var t=p("<center>");e.html(t),this._drawBubbleChart(t,o)},e.prototype._drawBubbleChart=function(e,t){var r=this;var i,a,n=Math.min(.98*p(c).height(),p(c).width()),o=u.scale.category20c(),s=u.layout.pack().sort(null).size([n,n]).padding(1.5),l=u.select(e[0]).append("svg").attr({class:"bubble",width:n,height:n}).selectAll(".node").data(s.nodes((i=t,a=[],function t(e,r){r.children?r.children.forEach(function(e){t(r.name,e)}):a.push({packageName:e,className:r.name,value:r.size,url:r.url,color:r.color})}(null,i),{children:a})).filter(function(e){return!e.children})).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});l.append("title").text(function(e){return e.className+": "+e.value}),l.append("circle").attr("r",function(e){return e.r}).style("fill",function(e){return e.color||o(e.className)}),l.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(e){return e.className.substring(0,e.r/4)}).on("click",function(e){e.url&&c.open(e.url,"_blank")}).style("fill",function(e){if(e.color)return r._getFormatter().calculateLuminance(e.color)<=.5?"#FFF":"#000"}).style("cursor","pointer")},e.prototype.isDrawable=function(){return this._hasLabel&&this._hasNumber},e.prototype.visit=function(e){return this._checkColumn(e)},e.prototype._checkColumn=function(e){return this._getFormatter().isNumber(e)&&(this._hasNumber=!0),this._getFormatter().isLabel(e)&&(this._hasLabel=!0),!this.isDrawable()},e}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.LineChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.line},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.BarChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.bar},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.ScatterChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.scatter},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AreaChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.area},r}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TimelineResultBrowser=function(a,i,e,t){"use strict";var n={minHeight:"400px",orientation:{axis:"both",item:"top"},align:"auto",zoomKey:"ctrlKey"};function r(){}return(r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(e){var t=a("<div>"),r=new i.Timeline(t[0],this._getItems(),n);r.on("changed",function(){a(r.dom.root).find(".vis-item.vis-range").each(function(){var e=a(this);e.css("min-width","unset"),e.css("min-width",e.css("width"))})}),e.append(t.prepend(this._createToolbar(r)))},r.prototype._getItems=function(){var n=this,o=[];return this._iterateResult(function(e,t,r,i){if(n._getFormatter().isDateTime(e))if(o[i]){var a=[];a.push(n._getFormatter().parseDate(e.value)),o[i].start&&a.push(o[i].start),o[i].end&&a.push(o[i].end),o[i].start=a.reduce(function(e,t){return e<t?e:t}),o[i].end=a.reduce(function(e,t){return t<e?e:t})}else o[i]={id:i,content:n._getHtml(r).html(),start:n._getFormatter().parseDate(e.value)}}),new i.DataSet(t.compact(o))},r.prototype._getHtml=function(e){return a("<div/>").append(this._getFormatter().formatRow(e,!0))},r.prototype._createToolbar=function(i){var e=a('<div style="margin-top: -35px; text-align: center;">');function t(e){var t=i.getWindow(),r=t.end-t.start;i.setWindow({start:t.start.valueOf()-r*e,end:t.end.valueOf()+r*e})}return a('<a class="btn btn-default">').click(a.proxy(i.redraw,i)).append('<span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>').appendTo(e),a('<a class="btn btn-default">').click(a.proxy(i.fit,i)).append('<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>').appendTo(e),a('<a class="btn btn-default">').click(function(){t(.2)}).append('<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>').appendTo(e),a('<a class="btn btn-default">').click(function(){t(-.2)}).append('<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>').appendTo(e),e},r.prototype.visit=function(e){return!this._getFormatter().isDateTime(e)||!(this._drawable=!0)},r}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.MultiDimensionResultBrowser=function(m,b,v){"use strict";var l="http://www.w3.org/2001/XMLSchema#dateTime";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser).draw=function(e){var n={},o=[],s=this._getFormatter();this._iterateResult(function(e,t,r,i){if(o[i]||(o[i]={}),o[i][t]=e&&e.value||"undefined",e&&e.type===l&&(o[i][t]=new Date(e.value).toLocaleDateString()),!n[t]){var a={key:t,description:t,type:"STRING"};s.isNumber(e)&&(a.type="NUMBER"),e&&e.type===l&&(a.type="DATE"),n[t]=a}}),this._draw(e,o,_.values(n)),e.children("svg").css({display:"block"})},e.prototype._draw=function(e,r,a){var t=50,i=80,n=10,o=100,s=m(v).width()-(o+i),l=m(v).height()-(t+n),u={NUMBER:{key:"Number",coerce:function(e){return+e},extent:b.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:b.scale.linear().range([l,0])},STRING:{key:"String",coerce:String,extent:function(e){return e.sort()},within:function(e,t,r){return t[0]<=r.scale(e)&&r.scale(e)<=t[1]},defaultScale:b.scale.ordinal().rangePoints([0,l])},DATE:{key:"Date",coerce:function(e){return new Date(e)},extent:b.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:b.time.scale().range([0,l])}};m.each(a,function(){this.type=u[this.type]});var p=b.scale.ordinal().domain(a.map(function(e){return e.key})).rangePoints([0,s]),c=b.svg.line().defined(function(e){return!isNaN(e[1])}),d=b.svg.axis().orient("left"),h=b.select(e[0]).append("svg").attr({width:s+o+i,height:l+t+n}).append("g").attr("transform","translate("+o+","+t+")"),y=h.append("g").attr("class","foreground"),w=h.selectAll(".axis").data(a).enter().append("g").attr("class","axis").attr("transform",function(e){return"translate("+p(e.key)+")"});function g(){b.event.sourceEvent.stopPropagation()}function f(){var e=a.filter(function(e){return!e.brush.empty()}),i=e.map(function(e){return e.brush.extent()});b.selectAll(".foreground path").style("display",function(r){return e.every(function(e,t){return e.type.within(r[e.key],i[t],e)})?null:"none"})}r.forEach(function(t){a.forEach(function(e){t[e.key]=e.type.coerce(t[e.key])})}),a.forEach(function(t){"domain"in t||(t.domain=b.functor(t.type.extent)(r.map(function(e){return e[t.key]})),t.domain.sort(function(e,t){return e-t})),"scale"in t||(t.scale=t.type.defaultScale.copy()),t.scale.domain(t.domain)}),y.selectAll("path").data(r).enter().append("path").attr("d",function(t){return c(a.map(function(e){return[p(e.key),e.scale(t[e.key])]}))}).style("stroke",function(e){return"#6ac"}),w.append("g").attr("class","axis").each(function(e){var t=e.axis&&e.axis.scale(e.scale)||d.scale(e.scale);b.select(this).call(t)}).append("text").attr("class","title").attr("text-anchor","start").text(function(e){return e.description||e.key}),w.append("g").attr("class","brush").each(function(e){b.select(this).call(e.brush=b.svg.brush().y(e.scale).on("brushstart",g).on("brush",f))}).selectAll("rect").attr("x",-8).attr("width",16)},e.prototype.isDrawable=function(){return this._drawable},e.prototype.visit=function(e){return!(this._drawable=!0)},e}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowser=function(n,o,s,e){"use strict";var l={autoResize:!0,physics:{stabilization:{enabled:!0,iterations:10,fit:!0},barnesHut:{springLength:150,centralGravity:.5,damping:.2,avoidOverlap:.1}},nodes:{shadow:!0,color:"#fff"},edges:{arrows:{to:!0}}};function t(){}return(t.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(e){var t=n("<div>").height("100vh"),r=this._getData(),i=new o.Network(t[0],r,l);i.on("doubleClick",function(e){1===e.nodes.length&&s.open(e.nodes[0],"_blank")});var a=new wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser(r.nodes,r.edges,this.getSparqlApi());i.on("click",function(e){var t=e.nodes[0]||null;a.browse(t)}),t.prepend(this._createToolbar(i)),e.append(t)},t.prototype._createToolbar=function(t){var e=n('<div id="layout-options" style="margin-top: -35px; text-align: center;">');function r(e){t.setOptions({layout:{hierarchical:{direction:e,sortMethod:"directed"}}})}return n('<a class="btn btn-default">').click(function(){t.stabilize(100)}).append('<span class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-stabilize")+'"></span>').appendTo(e),n('<a class="btn btn-default">').click(function(){r("LR")}).append('<span class="glyphicon glyphicon-indent-left" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-lr")+'"></span>').appendTo(e),n('<a class="btn btn-default">').click(function(){r("UD")}).append('<span class="glyphicon glyphicon-align-center" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-ud")+'"></span>').appendTo(e),n('<a class="btn btn-default">').click(function(){r("RL")}).append('<span class="glyphicon glyphicon-indent-right" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-rl")+'"></span>').appendTo(e),e},t.prototype._getData=function(){var s={},l={},u=[],p=this._getFormatter(),c={},d={};return this._iterateResult(function(e,t,r,i){if(e&&e.value){if(p.isEntity(e)){var a=r[t+"Label"]&&r[t+"Label"].value||e.value,n=e.value;c={id:n,label:a,title:a},u[i]?(d={from:u[i],to:n},l[d.from+d.to]=d,s[n]||(s[n]=c)):(s[n]=c,u[i]=c.id)}if(p.isCommonsResource(e.value)&&(c.image=p.getCommonsResourceThumbnailUrl(e.value,150),c.shape="image",c.font={color:"black"}),p.isNumber(e)&&(c.value=e.value,c.title+=" value:"+e.value,c.shape="dot",c.font={color:"black"}),"rgb"===t&&p.isColor(e)&&(c.color=p.getColorForHtml(e),"dot"!==c.shape&&"image"!==c.shape)){var o=p.calculateLuminance(e.value)<=.5?"#FFF":"#000";c.font={color:o}}"edgeLabel"===t&&(d.label=e.value)}}),{nodes:new o.DataSet(e.compact(s)),edges:new o.DataSet(e.compact(l))}},t.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||!(this._drawable=!0)},t}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser=function(o,e,t,r){"use strict";var a='SELECT ?p (SAMPLE(?pl) AS ?pl) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol)  WHERE {<{entityUri}> ?p ?o .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p',n='SELECT ?o ?ol WHERE {<{entityUri}> <{propertyUri}> ?o .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50';function i(e,t,r){this._nodes=e,this._edges=t,this._sparql=r}return i.prototype._nodes=i.prototype._nodes=null,i.prototype._sparql=null,i.prototype._selectedNodeId=null,i.prototype._temporaryNodes={},i.prototype._temporaryEdges={},i.prototype._getEntites=function(e,t){var i=this,a=o.Deferred();return this._sparql.query(n.replace("{entityUri}",e).replace("{propertyUri}",t)).done(function(){var e=i._sparql.getResultRawData(),r=[];o.each(e.results.bindings,function(e,t){r.push({id:t.o.value,label:t.ol.value})}),a.resolve(r)}),a},i.prototype._getProperties=function(e){var t=this,i=o.Deferred();return this._sparql.query(a.replace("{entityUri}",e)).done(function(){var e=t._sparql.getResultRawData(),r=[];o.each(e.results.bindings,function(e,t){r.push({id:t.p.value,label:t.pl.value,count:t.count.value,items:t.ol.value})}),i.resolve(r)}),i},i.prototype._removeTemporaryNodes=function(e){var r=this;o.each(this._temporaryNodes,function(e,t){r._nodes.remove(t.id)}),o.each(this._temporaryEdges,function(e,t){r._edges.remove(t.id)}),this._temporaryNodes={},this._temporaryEdges={}},i.prototype._expandPropertyNode=function(e){var r=this,i=this._temporaryNodes[e];this._getEntites(i.entityId,i.id).done(function(e){o.each(e,function(e,t){null===r._nodes.get(t.id)&&r._nodes.add({id:t.id,label:t.label}),r._edges.add({dashes:!0,from:i.entityId,to:t.id,label:i.propertyLabel,linkType:i.id})})})},i.prototype._expandEntityNode=function(a){var n=this;this._getProperties(a).done(function(e){o.each(e,function(e,t){if(!(0<n._edges.get({filter:function(e){return e.linkType===t.id&&e.from===a}}).length)){var r={id:t.id,label:"1"===t.count?t.items:t.count,title:t.items,entityId:a,propertyLabel:t.label,color:"#abc9f2"},i={id:t.id,dashes:!0,label:t.label,from:a,to:t.id};n._temporaryNodes[r.id]=r,n._nodes.add(r),n._temporaryEdges[i.id]=i,n._edges.add(i)}})})},i.prototype.browse=function(e){if(null!==e){if(this._temporaryNodes[e])return this._expandPropertyNode(e),void this._removeTemporaryNodes();null!==this._selectedNodeId&&e!==this._selectedNodeId&&this._removeTemporaryNodes(),this._expandEntityNode(e),this._selectedNodeId=e}else this._removeTemporaryNodes()},i}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.PolestarResultBrowser=function(i,a,e){"use strict";function t(){}return(t.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(e){var t={url:"wikidatasparql://query.wikidata.org/?query="+location.hash.substr(1),name:"Imported from Wikidata Query Service",_directEmbed:!0},r=i("<iframe>").attr({src:"polestar/embed.html#"+encodeURIComponent(JSON.stringify(t)),class:"graph-iframe"}).height("98vh");e.append(r),a.setTimeout(function(){r.scrollIntoView()},50)},t.prototype.visit=function(e){return!(this._drawable=!0)},t}(jQuery,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Sparql=function(l){"use strict";var o={TIMEOUT:10,MALFORMED:20,SERVER:30,UNKNOWN:100},s={"QueryTimeoutException: Query deadline is expired":o.TIMEOUT,"java.util.concurrent.TimeoutException":o.TIMEOUT,"MalformedQueryException: ":o.MALFORMED};function e(e,t){this._serviceUri=e||"https://query.wikidata.org/bigdata/namespace/wdq/sparql",this._language=t||"en"}return e.prototype.ERROR_CODES=o,e.prototype._serviceUri=null,e.prototype._executionTime=null,e.prototype._error=null,e.prototype._resultLength=null,e.prototype._rawData=null,e.prototype._queryUri=null,e.prototype._language=null,e.prototype.queryDataUpdatedTime=function(){var o=l.Deferred(),e=encodeURI("prefix schema: <http://schema.org/> SELECT * WHERE {<http://www.wikidata.org> schema:dateModified ?y}"),t=this._serviceUri+"?query="+e+"&nocache="+Math.floor(Date.now()/6e4);return l.ajax(t,{headers:{Accept:"application/sparql-results+json"}}).done(function(e,t,r){if(e.results.bindings[0]){var i=new Date(e.results.bindings[0][e.head.vars[0]].value),a=i.toLocaleTimeString(navigator.language,{timeZoneName:"short"})+", "+i.toLocaleDateString(navigator.language,{month:"short",day:"numeric",year:"numeric"}),n=Math.round((new Date-i)/1e3);o.resolve(a,n)}else o.reject()}).fail(function(){o.reject()}),o},e.prototype.query=function(e,t){var r=this;return e=this._replaceAutoLanguage(e),this._replaceAutoCoordinates(e).then(function(e){return r._query(e,t)})},e.prototype._query=function(e,t){var r="query="+encodeURIComponent(e);t&&(r+="&maxQueryTimeMillis="+t);var i=this,a=l.Deferred(),n={headers:{Accept:"application/sparql-results+json"},data:r};function o(e,t,r){i._executionTime=Date.now()-i._executionTime,"boolean"==typeof e.boolean?i._resultLength=1:i._resultLength=e.results.bindings.length||0,i._rawData=e,a.resolve(e)}function s(e,t,r){i._executionTime=null,i._rawData=null,i._resultLength=null,i._generateErrorMessage(e,t,r),a.reject()}return this._queryUri=this._serviceUri+"?"+n.data,this._executionTime=Date.now(),l.ajax(this._serviceUri,n).done(o).fail(function(e,t,r){""===e.getAllResponseHeaders()?(n.method="POST",l.ajax(i._serviceUri,n).done(o).fail(s)):s.apply(this,arguments)}),a},e.prototype._generateErrorMessage=function(e,t,r){var i={code:o.UNKNOWN,message:null,debug:e.responseText};(0===e.status||r)&&(i.code=o.SERVER,i.message=r.message);try{var a=i.debug.substring(i.debug.indexOf("java.util.concurrent.ExecutionException:"));for(var n in s)-1!==a.indexOf(n)&&(i.code=s[n],i.message=null);i.code!==o.UNKNOWN&&i.code!==o.MALFORMED||(i.message=i.debug.match(/(java\.util\.concurrent\.ExecutionException\:)+(.*)(Exception\:)+(.*)/).pop().trim())}catch(e){}this._error=i},e.prototype.getExecutionTime=function(){return this._executionTime},e.prototype.getError=function(){return this._error},e.prototype.getResultLength=function(){return this._resultLength},e.prototype.getQueryUri=function(){return this._queryUri},e.prototype._processData=function(e,t,r){for(var i=e.results.bindings.length,a=0;a<i;a++){for(var n={},o=0;o<e.head.vars.length;o++)e.head.vars[o]in e.results.bindings[a]?n[e.head.vars[o]]=e.results.bindings[a][e.head.vars[o]]:n[e.head.vars[o]]=void 0;r=t(n,r)}return r},e.prototype._encodeCsv=function(e){var t=e.replace(/"/g,'""');return/[",\n]/.test(t)&&(t='"'+t+'"'),t},e.prototype.getResultRawData=function(){return this._rawData},e.prototype.getResultAsCsv=function(){var n=this,e=n._rawData,t=e.head.vars.map(this._encodeCsv).join(",")+"\n";return t=this._processData(e,function(e,t){var r="",i=!0;for(var a in e)i?i=!1:r+=",",r+=void 0===e[a]?"":n._encodeCsv(e[a].value);return t+(r+="\n")},t)},e.prototype.getResultHTML=function(){var e=this._rawData,t=l("<html>"),r=l("<head>").append(l("<meta>").attr("charset","utf-8"));t.append(r);var i=[],a=l("<table>"),n=l("<tr>");e.head.vars.forEach(function(e){n.append("<th>"+e+"</th>"),i.push(e)}),a.append(n),e.results.bindings.forEach(function(e){for(var t in n=l("<tr>"),i)if(e[i[t]]){var r=e[i[t]].value.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;");n.append("<td>"+r+"</td>")}a.append(n)});var o=l("<body>").append(a);return t.append(o),t.prop("outerHTML")},e.prototype.getResultAsJson=function(){var e=[],t=this._rawData;return e=this._processData(t,function(e,t){var r={};for(var i in e)r[i]=(e[i]||{}).value;return t.push(r),t},e),JSON.stringify(e)},e.prototype.getResultAsAllJson=function(){return JSON.stringify(this._rawData)},e.prototype._renderValueTSV=function(e){var t=e.value.replace(/\t/g,"");switch(e.type){case"uri":return"<"+t+">";case"bnode":return"_:"+t;case"literal":var r=JSON.stringify(t);return e["xml:lang"]?r+"@"+e["xml:lang"]:e.datatype?"http://www.w3.org/2001/XMLSchema#integer"===e.datatype||"http://www.w3.org/2001/XMLSchema#decimal"===e.datatype||"http://www.w3.org/2001/XMLSchema#double"===e.datatype?t:r+"^^<"+e.datatype+">":r}return t},e.prototype.getSparqlTsv=function(){var n=this,e=this._rawData,t=e.head.vars.map(function(e){return"?"+e}).join("\t")+"\n";return t=this._processData(e,function(e,t){var r="",i=!0;for(var a in e)i?i=!1:r+="\t",r+=void 0===e[a]?"":n._renderValueTSV(e[a]);return t+(r+="\n")},t)},e.prototype.getSimpleTsv=function(){var e=this._rawData,t=e.head.vars.join("\t")+"\n";return t=this._processData(e,function(e,t){var r="",i=!0;for(var a in e)i?i=!1:r+="\t",r+=void 0===e[a]?"":e[a].value.replace(/\t/g,"");return t+(r+="\n")},t)},e.prototype._replaceAutoLanguage=function(e){return e.replace(/\[AUTO_LANGUAGE\]/g,this._language)},e.prototype._replaceAutoCoordinates=function(r){var i=l.Deferred();return navigator&&navigator.geolocation&&r.match(/\"\[AUTO_COORDINATES\]\"/g)?(navigator.geolocation.getCurrentPosition(function(e){var t='"Point('+e.coords.longitude+" "+e.coords.latitude+')"^^geo:wktLiteral';r=r.replace(/\"\[AUTO_COORDINATES\]\"/g,t),i.resolve(r)},function(){r=r.replace(/\"\[AUTO_COORDINATES\]\"/g,'"Point(13.381138 52.498243)"^^geo:wktLiteral'),i.resolve(r)},{timeout:1e4,maximumAge:1e4}),i.promise()):i.resolve(r).promise()},e.prototype.setLanguage=function(e){this._language=e},e}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Wikibase=function(i){"use strict";var a="en",n={action:"wbsearchentities",format:"json",limit:50,continue:0,language:a,uselang:a},e={action:"query",meta:"siteinfo",format:"json",siprop:"languages"},r={action:"wbgetentities",props:"labels",format:"json",languages:a,languagefallback:"1"},o={action:"wbgetentities",props:"datatype",format:"json"};function t(e,t){this._endpoint="https://www.wikidata.org/w/api.php",e&&(this._endpoint=e),t&&(this._language=t)}return t.prototype._endpoint=null,t.prototype._language=null,t.prototype.searchEntities=function(e,t,r){var i=n;return i.search=e,t&&(i.type=t),this._language||r?(i.language=r||this._language,i.uselang=r||this._language):(i.language=a,i.uselang=a),this._query(i)},t.prototype.getLanguages=function(){return this._query(e)},t.prototype.getLabels=function(e){"string"==typeof e&&(e=[e]);var t=r;return t.ids=e.join("|"),this._language&&(t.languages=this._language),this._query(t)},t.prototype.getDataType=function(t){var e=o,r=i.Deferred();return e.ids=t,this._query(e).done(function(e){e.entities&&e.entities[t]&&e.entities[t].datatype&&r.resolve(e.entities[t].datatype),r.reject()}).fail(r.reject),r.promise()},t.prototype._query=function(e){return i.ajax({url:this._endpoint+"?"+jQuery.param(e),dataType:"jsonp"})},t.prototype.setLanguage=function(e){this._language=e},t}(jQuery);var wikibase,tracking=tracking||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Tracking=function(i){"use strict";function e(e){this._endpoint="https://www.wikidata.org/beacon/statsv",e&&(this._endpoint=e)}return e.prototype._endpoint=null,e.prototype.track=function(e,t,r){return t||(t=1),r||(r="c"),"query.wikidata.org"!==location.hostname||/^1|yes/.test(navigator.doNotTrack||window.doNotTrack)?i.when():this._track(e+"="+t+r)},e.prototype._track=function(e){return i.ajax({url:this._endpoint+"?"+e,dataType:"jsonp"})},e}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.RdfNamespaces={},function(a,e){"use strict";e.NAMESPACE_SHORTCUTS={Wikidata:{wikibase:"http://wikiba.se/ontology#",wd:"http://www.wikidata.org/entity/",wdt:"http://www.wikidata.org/prop/direct/",wds:"http://www.wikidata.org/entity/statement/",p:"http://www.wikidata.org/prop/",wdref:"http://www.wikidata.org/reference/",wdv:"http://www.wikidata.org/value/",ps:"http://www.wikidata.org/prop/statement/",psv:"http://www.wikidata.org/prop/statement/value/",psn:"http://www.wikidata.org/prop/statement/value-normalized/",pq:"http://www.wikidata.org/prop/qualifier/",pqv:"http://www.wikidata.org/prop/qualifier/value/",pqn:"http://www.wikidata.org/prop/qualifier/value-normalized/",pr:"http://www.wikidata.org/prop/reference/",prv:"http://www.wikidata.org/prop/reference/value/",prn:"http://www.wikidata.org/prop/reference/value-normalized/",wdno:"http://www.wikidata.org/prop/novalue/",wdata:"http://www.wikidata.org/wiki/Special:EntityData/"},W3C:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",owl:"http://www.w3.org/2002/07/owl#",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",prov:"http://www.w3.org/ns/prov#"},"Social/Other":{schema:"http://schema.org/",geo:"http://www.opengis.net/ont/geosparql#",geof:"http://www.opengis.net/def/geosparql/function/"},Blazegraph:{bd:"http://www.bigdata.com/rdf#",bds:"http://www.bigdata.com/rdf/search#",gas:"http://www.bigdata.com/rdf/gas#",hint:"http://www.bigdata.com/queryHints#"}},e.ENTITY_TYPES={"http://www.wikidata.org/prop/direct/":"property","http://www.wikidata.org/prop/":"property","http://www.wikidata.org/prop/novalue/":"property","http://www.wikidata.org/prop/statement/":"property","http://www.wikidata.org/prop/statement/value/":"property","http://www.wikidata.org/prop/statement/value-normalized/":"property","http://www.wikidata.org/prop/qualifier/":"property","http://www.wikidata.org/prop/qualifier/value/":"property","http://www.wikidata.org/prop/qualifier/value-normalized/":"property","http://www.wikidata.org/prop/reference/":"property","http://www.wikidata.org/prop/reference/value/":"property","http://www.wikidata.org/prop/reference/value-normalized/":"property","http://www.wikidata.org/wiki/Special:EntityData/":"item","http://www.wikidata.org/entity/":"item"},e.ALL_PREFIXES=a.map(e.NAMESPACE_SHORTCUTS,function(e){return e}).reduce(function(e,t,r){return a.extend(e,t)},{}),e.STANDARD_PREFIXES={wd:"PREFIX wd: <http://www.wikidata.org/entity/>",wdt:"PREFIX wdt: <http://www.wikidata.org/prop/direct/>",wikibase:"PREFIX wikibase: <http://wikiba.se/ontology#>",p:"PREFIX p: <http://www.wikidata.org/prop/>",ps:"PREFIX ps: <http://www.wikidata.org/prop/statement/>",pq:"PREFIX pq: <http://www.wikidata.org/prop/qualifier/>",rdfs:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>",bd:"PREFIX bd: <http://www.bigdata.com/rdf#>"},e.getPrefixMap=function(r){var i={};return a.each(e.ALL_PREFIXES,function(e,t){r[t]&&(i[e]=r[t])}),i}}(jQuery,wikibase.queryService.RdfNamespaces),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryHelper=function(p,l,n){"use strict";var t={"http://www.w3.org/2000/01/rdf-schema#label":!0,"http://schema.org/description":!0,"http://www.bigdata.com/queryHints#optimizer":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},r="wdqs-ve-",o={formatNoMatches:function(){}};function e(e,t,r){this._api=e||new l.queryService.api.Wikibase,this._selectorBox=r||new l.queryService.ui.queryHelper.SelectorBox(this._api,t),this._query=new l.queryService.ui.queryHelper.SparqlQuery}return e.prototype._api=null,e.prototype._selectorBox=null,e.prototype._changeListener=null,e.prototype._query=null,e.prototype._$element=null,e.prototype._triples=[],e.prototype._isSimpleMode=!1,e.prototype._labels={filter:"Filter",show:"Show",anything:"anything",with:"with",any:"any",or:"or",subtype:"subtype",limit:"Limit"},e.prototype.setQuery=function(e){var t=l.queryService.RdfNamespaces.ALL_PREFIXES;this._query.parse(e,t),this._selectorBox.setQuery(this._query)},e.prototype.getQuery=function(){try{var e=this._query.getQueryString();return(e=this._cleanQueryPrefixes(e).trim()).trim()}catch(e){return null}},e.prototype._cleanQueryPrefixes=function(e){for(var t,r=/PREFIX ([a-z]+): <(.*)>/gi,i={},a=e.replace(r,"").replace(/\n+/g,"\n");t=r.exec(e);){var n=t[1],o=t[2].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s=a.replace(new RegExp("<"+o+"([^/>#]+?)>","gi"),n+":$1");a!==s&&(a=s,l.queryService.RdfNamespaces.STANDARD_PREFIXES[n]||(i[t[0]]=!0))}return a=Object.keys(i).join("\n")+"\n\n"+a.trim()},e.prototype.draw=function(e){var t=l.queryService.ui.queryHelper.QueryTemplate.parse(this._query),i=this,a=this._query.getBindings();if(e&&(this._$element=e),null!==t)try{return this._$element.html(t.getHtml(function(e){return i._getLabel(a[e].expression)},this._selectorBox,function(e,t,r){a[e].expression=a[e].expression.replace(new RegExp(t+"$"),"")+r,i._changeListener&&i._changeListener(i)}))}catch(e){window.console.error(e)}this._triples=this._query.getTriples();for(var r=this._query.getSubQueries();0<r.length;){var n=r.pop();this._triples=this._triples.concat(n.getTriples()),r.concat(n.getSubQueries())}this._isSimpleMode=this._isSimpleQuery(),this._$element.html(this._getHtml())},e.prototype.setChangeListener=function(e){this._changeListener=e},e.prototype._i18n=function(e){return p.i18n?p.i18n(r+e):this._labels[e]},e.prototype._i18nSpan=function(e){return p("<span>").attr("data-i18n",r+e).text(this._i18n(e))},e.prototype._getHtml=function(){var r=this,e=p("<div>").attr("class","panel-body-sub"),i=p("<table>").attr("class","query-helper-data").bootstrapTable(o),a=p("<table>").attr("class","query-helper-data").bootstrapTable(o);return p.each(this._triples,function(e,t){r._isNotRelevant(t.triple)||(r._isInShowSection(t.triple)?a.append(r._getTripleHtml(t)):i.append(r._getTripleHtml(t)))}),this._createTagCloud(),e.append(this._createSection(i,this._createFindButton(i)),this._createSection(a,this._createShowButton(a)),this._getLimitSection())},e.prototype._createTagCloud=function(){},e.prototype._getLimitSection=function(){var e=p("<div>").attr("class","query-helper-limit-section"),t=p('<a data-type="number">').attr("href","#").attr("id","query-helper-limit").data("value",this._query.getLimit()).append(this._i18nSpan("limit")),r=p("<span>").text(this._query.getLimit()||""),i=this;return this._selectorBox.add(t,null,function(e){"0"===e&&(e=null),r.text(e||""),i._query.setLimit(e),i._changeListener&&i._changeListener(i)},{trash:function(){return i._query.setLimit(null),t.data("value",""),r.text(""),i._changeListener&&i._changeListener(i),i._createTagCloud(),!0}}),e.append(t.append(" ",r))},e.prototype._createSection=function(e,t){return p("<table>").attr("class","query-helper-section").append(p("<tr>").append(p("<td>").append(t),p("<td>").append(e)))},e.prototype._createTagCloudShow=function(){var s=this,e=p('<div data-entity="property" data-type="tagCloud" class="tagCloud">');return this._selectorBox.add(e,null,function(e,t,r){var i="http://www.wikidata.org/prop/direct/"+e,a=s._query.getBoundVariables().shift()||"?item",n="?"+t.replace(/( |[^a-z0-9])/gi,"_"),o=s._query.addTriple(a,i,n,!0);s._query.addVariable(n),s._addLabelVariableAfterItemColumn(i.split("/").pop(),o),s._changeListener&&s._changeListener(s),s.draw()}),e},e.prototype._createTagCloudFilter=function(){var l=this,e=p('<div data-entity="item" data-type="tagCloud" class="tagCloud">');return l._selectorBox.add(e,null,function(e,t,r,i){var a="http://www.wikidata.org/entity/"+e,n=l._query.getBoundVariables().shift();n||(n="?"+t.replace(/( |[^a-z0-9])/gi,"_"));var o="http://www.wikidata.org/prop/direct/"+(r||"P31"),s=l._query.addTriple(n,o,a,!1);l._query.hasVariable(n)||l._query.addVariable(n),l._addLabelVariableAfterItemColumn(o.split("/").pop(),s),l._changeListener&&l._changeListener(l),l.draw()}),e},e.prototype._createFindButton=function(s){var e=p('<a class="btn">').append(this._i18nSpan("filter")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new item"}).attr("id","query-helper-filter").attr("data-type","item").attr("data-auto_open",!0),l=this;return this._selectorBox.add(e,null,function(e,t,r){var i="http://www.wikidata.org/entity/"+e,a=l._query.getBoundVariables().shift();a||(a="?"+t.replace(/( |[^a-z0-9])/gi,"_"));var n="http://www.wikidata.org/prop/direct/"+(r||"P31"),o=l._query.addTriple(a,n,i,!1);l._query.hasVariable(a)||l._query.addVariable(a),l._addLabelVariableAfterItemColumn(n.split("/").pop(),o),s.append(l._getTripleHtml(o)),l._changeListener&&l._changeListener(l),l._createTagCloud()}),e},e.prototype._createShowButton=function(o){var e=p('<a class="btn">').append(this._i18nSpan("show")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new property"}).attr("id","query-helper-show").attr("data-type","property").attr("data-auto_open",!0),s=this;return this._selectorBox.add(e,null,function(e,t){var r="http://www.wikidata.org/prop/direct/"+e,i=s._query.getBoundVariables().shift()||"?item",a="?"+t.replace(/( |[^a-z0-9])/gi,"_"),n=s._query.addTriple(i,r,a,!0);s._query.addVariable(a),s._addLabelVariableAfterItemColumn(r.split("/").pop(),n),o.append(s._getTripleHtml(n)),s._changeListener&&s._changeListener(s),s._createTagCloud()}),e},e.prototype._addLabelVariableAfterItemColumn=function(e,t){var r=this;this._api.getDataType(e).done(function(e){"wikibase-item"===e&&r._addLabelVariable(t)})},e.prototype._isNotRelevant=function(e){return!!t[e.predicate]||!(!this._isSimpleMode||!this._isInShowSection(e)||!1!==this._query.hasVariable(e.object)||!1!==this._query.hasVariable(e.object+"Label")||!1!==this._query.isWildcardQuery())},e.prototype._isInShowSection=function(e){var t=this._query.getBindings();return!(!this._isVariable(e.subject)||!this._isVariable(e.object)||t[e.subject]||t[e.object])},e.prototype._getTripleHtml=function(r){var i=this,a=p("<tr>"),n=this._query.getBindings();return p.each(r.triple,function(e,t){if(i._isVariable(t)&&n[t]&&"string"==typeof n[t].expression&&(t=n[t].expression),i._isVariable(t)){if(i._isSimpleMode)return;return t=t.replace("?","").replace(/_/g,"_<wbr>"),void a.append(p("<td>").append(t))}t.type&&"path"===t.type?a.append(p("<td>").append(i._getTripleEntityPathHtml(t,r,e))," "):a.append(p("<td>").append(i._getTripleEntityHtml(t,r,e))," ")}),a.append(this._getTripleHtmlToolbar(a,r))},e.prototype._getTripleHtmlToolbar=function(r,i){var a=this,e=p('<a href="#">').addClass("fa fa-trash-o").click(function(){var e=n.compact(i.triple).filter(function(e){return"string"==typeof e&&e.startsWith("?")}),t=e.map(function(e){return e+"Label"});return i.remove(),r.remove(),a._query.cleanupVariables(e.concat(t)),a._changeListener&&a._changeListener(a),a._createTagCloud(),!1}).tooltip({title:a._i18n("remove-row-title")}),t=p('<a href="#">').addClass("fa fa-tag").click(function(){return a._addLabelVariable(i),a._changeListener&&a._changeListener(a),!1}).tooltip({title:a._i18n("add-label-title")});return p('<td class="toolbar">').append(t,e)},e.prototype._addLabelVariable=function(e){this._query.convertWildcardQueryToUseVariables(),e.triple.object.startsWith("?")?this._query.addVariable(e.triple.object+"Label"):this._query.addVariable(e.triple.subject+"Label"),this._changeListener&&this._changeListener(this)},e.prototype._isVariable=function(e){return"string"==typeof e&&e.startsWith("?")},e.prototype._isSimpleQuery=function(){var r={},i=this;return p.each(this._triples,function(e,t){i._isVariable(t.triple.subject)&&!1===i._isVariable(t.triple.object)&&(r[t.triple.subject]=!0)}),Object.keys(r).length<=1},e.prototype._getTripleEntityPathHtml=function(i,a){var n=this,o=p("<span>");return p.each(i.items,function(e,t){if(t.type&&"path"===t.type)o.append(n._getTripleEntityPathHtml(t,a));else{0<e&&"/"===i.pathType&&o.append(" "+n._i18n("or")+" "+n._i18n("subtype")+" "),"*"===i.pathType&&o.append(" "+n._i18n("any")+" ");var r=i.items.reduce(function(e,t,r){return e[r]=t,e},{});r=p.extend(r,a.triple),(a=p.extend({},a)).triple=r,o.append(n._getTripleEntityHtml(t,a,e))}}),o},e.prototype._getTripleEntityHtml=function(n,o,s){var l=this,u=p("<span>");return this._getLabel(n).done(function(e,r,t,i){var a=p("<a>").text(e).attr({"data-id":r,"data-type":i,href:"#"}).appendTo(u);u.tooltip({title:"("+r+") "+t}),p(u).on("show.bs.tooltip",function(){p(".tooltip").is(":visible")&&p(".tooltip").not(this).hide()}),l._selectorBox.add(a,o.triple,function(e){var t=n.replace(new RegExp(r+"$"),"")+e;u.replaceWith(l._getTripleEntityHtml(t,o,s)),l._isVariable(o.triple[s])?l._query.getBindings()[o.triple[s]].expression=t:o.triple[s]=t,l._changeListener&&l._changeListener(l),l._createTagCloud()})}).fail(function(){u.text(n)}),u},e.prototype._getLabel=function(e){var r=p.Deferred(),t=e.match(/(Q|P)([0-9]+)/);if(!t)return r.reject().promise();var i={P:"property",Q:"item"};i=i[t[1]];var a=t[0];return this._api.searchEntities(a,i).done(function(e){p.each(e.search,function(e,t){return r.resolve(t.label,t.id,t.description,i),!1})}),r.promise()},e}(jQuery,wikibase,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SparqlQuery=function(o,e,a){"use strict";function i(e){this._query=e}return i.prototype._query=null,i.prototype._queryComments=null,i.prototype.parse=function(e,t){var r=new a.Parser(t),i=[];this._query=r.parse(e),o.each(e.split("\n"),function(e,t){0===t.indexOf("#")&&i.push(t)}),this._queryComments=i},i.prototype.getQueryString=function(){try{var e=(new a.Generator).stringify(this._query),t=this._queryComments.join("\n").trim();return""!==t?t+"\n"+e:e}catch(e){return null}},i.prototype.getLimit=function(){return this._query.limit||null},i.prototype.setLimit=function(e){return e?this._query.limit=e:delete this._query.limit,this},i.prototype.hasVariable=function(e){return 0!==this._query.variables.length&&0<=this._query.variables.indexOf(e)},i.prototype.isWildcardQuery=function(){return!(!this._query.variables||"*"!==this._query.variables[0])},i.prototype.convertWildcardQueryToUseVariables=function(){if(this.isWildcardQuery()){var e=this.getQueryString().match(/(\?\w+)/g);this._query.variables=o.unique(e)||"*"}},i.prototype.addVariable=function(e){return e&&e.startsWith("?")&&(0<=this._query.variables.indexOf(e)||this.isWildcardQuery()||this._query.variables.push(e)),this},i.prototype.removeVariable=function(e){if(e.startsWith("?")&&!this.isWildcardQuery()){var t=this._query.variables.indexOf(e);0<=t&&this._query.variables.splice(t,1),0===this._query.variables.length&&this._query.variables.push("*")}},i.prototype.cleanupVariables=function(t){var r=this,i=this.getTripleVariables();this._query.variables.filter(function(e){return(!t||-1!==t.indexOf(e))&&-1===i.indexOf(e)}).map(function(e){r.removeVariable(e)})},i.prototype.getTriples=function(e,r){var i=[];e||(e=this._query.where),r||(r=!1);var a=this;return o.each(e,function(e,t){t.type&&"bgp"===t.type&&(i=i.concat(a._createTriples(t.triples,r))),t.type&&"optional"===t.type&&(i=i.concat(a.getTriples(t.patterns,!0))),t.type&&"union"===t.type&&(i=i.concat(a.getTriples(t.patterns,!1)))}),i},i.prototype.getBindings=function(){var r={};return o.each(this._query.where,function(e,t){t.type&&"bind"===t.type&&(r[t.variable]=t)}),r},i.prototype._createTriples=function(r,i){var a=this,n=[];return o.each(r,function(e,t){n.push({optional:i,query:a,triple:t,remove:function(){r.splice(e,1)}})}),n},i.prototype.getSubQueries=function(){var r=[];return o.each(this._query.where,function(e,t){t.queryType&&r.push(new i(t))}),r},i.prototype.addTriple=function(e,t,r,i){var a={type:"bgp",triples:[{subject:e,predicate:t,object:r}]};if(i){var n={type:"optional",patterns:[a]};this._query.where.push(n)}else this._query.where.push(a);return this._createTriples(a.triples,i)[0]},i.prototype.getTripleVariables=function(){var r={};return o.each(this.getTriples(),function(e,t){"string"==typeof t.triple.subject&&t.triple.subject.startsWith("?")&&(r[t.triple.subject]=!0),"string"==typeof t.triple.predicate&&t.triple.predicate.startsWith("?")&&(r[t.triple.predicate]=!0),"string"==typeof t.triple.object&&t.triple.object.startsWith("?")&&(r[t.triple.object]=!0)}),Object.keys(r)},i.prototype.getBoundVariables=function(){var r={};return o.each(this.getTriples(),function(e,t){t.triple.subject.startsWith("?")&&!t.triple.object.startsWith("?")&&(r[t.triple.subject]=!0),!t.triple.subject.startsWith("?")&&t.triple.object.startsWith("?")&&(r[t.triple.object]=!0)}),Object.keys(r)},i.prototype.getServices=function(){var r=[];return o.each(this._query.where,function(e,t){t&&"service"===t.type&&r.push(t)}),r},i.prototype.removeService=function(r){var i=this;return o.each(this._query.where,function(e,t){"service"===t.type&&t.name===r&&delete i._query.where[e]}),this},i.prototype.getCommentContent=function(e){var t,r;for(t=0;t<this._queryComments.length;t++)if((r=this._queryComments[t]).startsWith("#"+e))return r.substring(1+e.length);return null},i.prototype.clone=function(){var e=new i;return e.parse(this.getQueryString()),e},i}(jQuery,0,sparqljs),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SelectorBox=function(u,r){"use strict";var n={item:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i <{PROPERTY_URI}> ?id. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t}\t\t\t\t\tLIMIT 100',genericSuggest:function(){if(0===this._query.getTriples().length)return'SELECT ?id ?label ?description WHERE {\t\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?id wdt:P1424 ?p. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100';var e=this._query.getBoundVariables().shift()||this._query.getTripleVariables().shift(),t=this._query.clone().setLimit(1e3).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\t\tSELECT ?id ?label ?description ?property (?count as ?rank) WITH {\n\t\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\t\tSELECT ?value ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t\t?statement ?ps ?value.\n\t\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p; wikibase:statementProperty ?ps.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tGROUP BY ?value ?property\n\t\t\t\t\t\t\tHAVING(isIRI(?value) && STRSTARTS(STR(?value), STR(wd:Q)))\n\t\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t\t} AS %values WHERE {\n\t\t\t\t\t\t\tINCLUDE %values.\n\t\t\t\t\t\t\tBIND(?value AS ?id).\n\t\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,instanceOf:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t{\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t\t}\t\t\t\t\tLIMIT 100'},property:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t{\t\t\t\t\t\tSELECT DISTINCT ?id WHERE {\t\t\t\t\t\t?i ?prop <{ITEM_URI}>.\t\t\t\t\t\t?id ?x ?prop.\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100\t\t\t\t\t}\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}\t\t\t\tLIMIT 100',genericSuggest:function(){if(0===this._query.getTriples().length)return'SELECT ?id ?label ?description (?count as ?rank) WITH {\t\t\t\t\tSELECT ?pred (COUNT(?value) AS ?count) WHERE\t\t\t\t\t{\t\t\t\t\t?subj ?pred ?value .\t\t\t\t\t} GROUP BY ?pred ORDER BY DESC(?count) LIMIT 1000\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id wikibase:claim ?pred.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100';var e=this._query.getBoundVariables().shift()||this._query.getTripleVariables().shift(),t=this._query.clone().setLimit(500).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString(),r=t.match(/.*\bPREFIX\b(.*)/gi).join("\n");return t=t.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\tSELECT ?id ?label ?description (?count as ?rank) WITH {\n\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t}\n\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\tSELECT ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p.\n\t\t\t\t\t\t}\n\t\t\t\t\t\tGROUP BY ?property\n\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t} AS %properties WHERE {\n\t\t\t\t\t\tINCLUDE %properties.\n\t\t\t\t\t\tBIND(?property AS ?id).\n\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",t).replace("{VARIABLE}",e).replace("{PREFIXES}",r)},search:null,seeAlso:'SELECT ?id ?label ?description WHERE {\t\t\t\t\tBIND( <{PROPERTY_URI}> as ?prop).\t\t\t\t\t?props ?x  ?prop.\t\t\t\t\t?props rdf:type wikibase:Property.\t\t\t\t\t?props wdt:P1659 ?id.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}'},sparql:{search:'SELECT ?id ?label ?description WITH {\t\t\t\t\t{SPARQL}\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\tFILTER(STRSTARTS(LCASE(?label), LCASE("{TERM}")))\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100',suggest:'SELECT ?id ?label ?description WITH {\t\t\t\t{SPARQL}\t\t\t\t} AS %inner\t\t\tWHERE {\t\t\t\tINCLUDE %inner\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t} ORDER BY DESC(?count)\t\t\tLIMIT 100'}};function e(e,t){this._api=e||new r.queryService.api.Wikibase,this._sparqlApi=t||new r.queryService.api.Sparql}return e.prototype._api=null,e.prototype._sparqlApi=null,e.prototype._query=null,e.prototype.setQuery=function(e){this._query=e},e.prototype.add=function(e,t,r,i){switch(e.data("type").toLowerCase()){case"number":this._createInput(e,r,i);break;case"tagcloud":this._createTagCloud(e,t,r,i);break;default:this._createSelect(e,t,r,i)}},e.prototype._createInput=function(t,e,r){var i=u("<input>").attr("type",t.data("type")),a=this._getCloseButton(),n=this._getToolbar(r,t),o=u("<div>").append(a," ",i," ",n);t.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return o}}).click(function(e){i.val(t.data("value")||"")}),i.on("keyup mouseup",function(){e&&e(i.val())})},e.prototype._createTagCloud=function(e,t,r,i){var a=this,n=e.data("entity"),o=e.data("sparql"),s=[];(s=[],a._searchEntitiesSparql(null,n,t,o).then(function(e){e.forEach(function(t){s.push({text:t.text,weight:t.data.rank||(9<Math.round(10*Math.random())?5:Math.round(3*Math.random())),link:"#",html:{title:t.data.description+(t.data.rank?" ("+t.data.rank+")":""),"data-id":t.id},handlers:{click:function(e){return t.data.propertyId?r(t.id,t.text,t.data.propertyId):a._suggestPropertyId(t.id).always(function(e){r(t.id,t.text,e)}),!1}}})})})).then(function(){0!==s.length?(e.show(),e.jQCloud(s,{delayedMode:!0,autoResize:!0})):e.hide()})},e.prototype._createSelect=function(n,t,o,e){var s=this,l=this._getSelectBox(n),r=this._getCloseButton(),i=this._getToolbar(e,n),a=u("<div>").append(r," ",l," ",i);0!==n.children().length?(n.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return a}}).click(function(e){return l.toggleClass("open"),l.data("select2")||u.proxy(s._renderSelect2(l,n,t),s),l.hasClass("open")&&n.data("auto_open")&&l.data("select2").open(),!1}),l.change(function(e){if(o){var t=l.val(),r=l.find("option:selected").text(),i=n.data("items"),a=i&&i[t]&&i[t].propertyId||null;a?o(t,r,a):s._suggestPropertyId(t).always(function(e){o(t,r,e)})}n.click(),l.html("")})):this._createSelectInline(n,t,o)},e.prototype._suggestPropertyId=function(e){var t=u.Deferred(),r="SELECT ?id (COUNT(?id) AS ?count) WHERE { { SELECT ?id WHERE {\t\t\t\t\t\t\t?i ?prop wd:{ITEM_ID}.\t\t\t\t\t\t\t?id wikibase:directClaim ?prop.\t\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t\t}\t\t\t\t\t\t\tLIMIT 10000 } } GROUP BY ?id ORDER BY DESC(?count) LIMIT 1".replace("{ITEM_ID}",e);return this._sparqlApi.query(r,2e3).done(function(e){try{t.resolve(e.results.bindings[0].id.value.split("/").pop())}catch(e){t.reject()}}).fail(function(){t.reject()}),t.promise()},e.prototype._createSelectInline=function(a,e,n){var o=this._getSelectBox(a);a.replaceWith(o),this._renderSelect2(o,a,e),o.change(function(e){if(n){var t=o.val(),r=a.data("items"),i=r&&r[t]&&r[t].propertyId||null;n(t,o.find("option:selected").text(),i)}})},e.prototype._getSelectBox=function(e){var t=e.data("id"),r=e.text(),i=u("<select>");return t&&i.append(u("<option>").attr("value",t).text(r)),i},e.prototype._getCloseButton=function(){return u('<a href="#" data-dismiss="clickover">').append('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>')},e.prototype._getToolbar=function(e,i){var a=u("<span>");return u.each(e,function(e,t){var r=u("<a>").attr("href","#");r.prepend('<span class="glyphicon glyphicon-'+e+'" aria-hidden="true"></span>'," "),r.click(function(){return t()&&i.click(),!1}),a.append(r," ")}),a},e.prototype._createLookupService=function(i,a){var n=this,o=i.data("type"),s=i.data("sparql");return function(e,r,t){u.when(n._searchEntitiesSparql(e.data.term,o,a,s),n._searchEntities(e.data.term,o)).done(function(e,t){n._addItemMetaData(i,e.concat(t)),0<e.length&&(e=[{text:n._i18n("suggestions","Suggestions"),children:e}]),0<t.length&&0<e.length&&(t=[{text:n._i18n("other","Other"),children:t}]),r({results:e.concat(t)})})}},e.prototype._addItemMetaData=function(e,t){var r={};t.forEach(function(e){r[e.data.id]||(r[e.data.id]={}),r[e.data.id].text=e.text,e.data.propertyId&&(r[e.data.id].propertyId=e.data.propertyId)}),e.data("items",r)},e.prototype._getSparqlTemplate=function(e,t,r,i){var a=this._getSparqlTemplateDefinition(e,t,r,i),n="function"==typeof a?a.apply(this):a;return i&&(n=n.replace("{SPARQL}",i)),n},e.prototype._getSparqlTemplateDefinition=function(e,t,r,i){if(i)return e?n.sparql.search:n.sparql.suggest;var a=n[t];if(e&&""!==e.trim())return r?a.search:null;if("property"===t){if(!r)return a.genericSuggest;if(0===r.object.indexOf("?"))return a.seeAlso}else if(!r)return a.genericSuggest;return a.suggest},e.prototype._searchEntitiesSparqlCreateQuery=function(e,t,r,i){var a=this._getSparqlTemplate(e,t,r,i);return a&&(r&&(a=a.replace("{PROPERTY_URI}",function e(t){return"string"==typeof t?t:e(t.items[0])}(r.predicate)).replace("{ITEM_URI}",r.object)),e&&(a=a.replace("{TERM}",e)),a=a.replace(/\{LANGUAGE\}/g,u.i18n&&u.i18n().locale||"en")),a},e.prototype._searchEntitiesSparql=function(e,t,r,i){var a=u.Deferred(),n=this._searchEntitiesSparqlCreateQuery(e,t,r,i);return n?(this._sparqlApi.query(n,4e3).done(function(e){var t=e.results.bindings.map(function(e){var t=e.id.value.split("/").pop(),r=e.property&&e.property.value.split("/").pop()||null;return{id:t,text:e.label.value,data:{id:t,propertyId:r,description:e.description&&e.description.value||"",rank:e.rank&&e.rank.value||null}}});a.resolve(t)}).always(function(){a.resolve([])}),a.promise()):a.resolve([]).promise()},e.prototype._searchEntities=function(e,t){var r=u.Deferred();return e&&""!==e.trim()?(this._api.searchEntities(e,t).done(function(e){var t=e.search.map(function(e){return{id:e.id,text:e.label,data:e}});r.resolve(t)}),r.promise()):r.resolve([]).promise()},e.prototype._renderSelect2=function(e,t,r){var i=this._createLookupService(t,r);e.select2({width:"auto",templateResult:function(e,t){return e.data?u("<span><b>"+e.text+" ("+e.data.id+")</b></span><br/><small>"+e.data.description+"</small>"):e.text},ajax:{delay:250,transport:i},cache:!0})},e.prototype._i18n=function(e,t){return u.i18n?u.i18n("wdqs-ve-sb-"+e):t},e}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryTemplate=function(c,e){"use strict";function a(){}return a.prototype._definition={},a.prototype._template=null,a.prototype._variables=[],a.parse=function(e){var t,r,i=e.getCommentContent("TEMPLATE=");if(!i)return null;try{t=JSON.parse(i)}catch(e){return null}return(r=new a)._definition=t,r._fragments=a._getQueryTemplateFragments(t),r},a._getQueryTemplateText=function(e,t,r,i){var a,n,o,s;if(-1===["string","object"].indexOf(typeof e.template))throw new Error("unsupported template type, should be single string or map from language code to string");if("string"==typeof e.template)return e.template;if(t in(a=e.template))return a[t];for(o in n=r&&r[t]||{})if((s=n[o])in a)return a[s];if((s=i||"en")in a)return a[s];for(o in a)return a[o];return""},a._getQueryTemplateFragments=function(e){var i,a,t=c.i18n&&c.i18n().locale||"en",r=c.i18n&&c.i18n.fallbacks,n=c.i18n&&c.i18n().options.fallbackLocale,o=this._getQueryTemplateText(e,t,r,n),s=[o];if(o.match(/\0/))throw new Error("query template must not contain null bytes");function l(e){var t=e.replace(new RegExp("\\"+i,"g"),"\0").split("\0");a.push(t[0]);for(var r=1;r<t.length;r++)a.push(i),a.push(t[r])}for(i in e.variables){if(!i.match(/\?[a-z][a-z0-9]*/i))throw new Error("invalid variable name in query template");a=[],s.forEach(l),s=a}return s},a._buildTemplate=function(e,t){var r=c("<span>");r.append(document.createTextNode(e[0]));for(var i=1;i<e.length;i+=2){var a=e[i],n=c("<span>").text(a);a in t||(t[a]=[]),t[a].push(n),r.append(n),r.append(document.createTextNode(e[i+1]))}return r},a.prototype.getHtml=function(e,l,u){if(null!==this._template)return this._template;this._template=a._buildTemplate(this._fragments,this._variables);var p=this;return c.each(this._definition.variables,function(o,s){e(o).done(function(i,a,e,n){c.each(p._variables[o],function(e,t){t.text("");var r=c("<a>").text(i).attr({"data-id":a,"data-type":n,href:"#"}).appendTo(t);s.query&&r.attr("data-sparql",s.query),l.add(r,null,function(e,t){for(var r in p._variables[o]){p._variables[o][r].find('a[data-id="'+a+'"]').attr("data-id",e).text(t),u(o,a,e),a=e}})})})}),this._template},a}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.toolbar=wikibase.queryService.toolbar||{},wikibase.queryService.ui.toolbar.Actionbar=function(n){"use strict";function e(e){this._$element=e}return e.prototype._$element=null,e.prototype.show=function(e,t,r,i){var a=e;n.i18n&&(a=n.i18n(e)),""!==t&&(a=a+": "+t),this._$element.find(".message").html(""),r||(r="info"),void 0===i||!1===i?this._$element.find(".message").append(this._getBar(a,r)):this._$element.find(".message").append(this._getProgressbar(a,r,i)),this._$element.show()},e.prototype._getProgressbar=function(e,t,r){return n('<div class="progress"><div class="progress-bar progress-bar-'+t+' progress-bar-striped active" role="progressbar" style="width: '+r+'%">'+e+"</div></div>")},e.prototype._getBar=function(e,t){return n('<div class="label label-'+t+'"/>').text(e)},e.prototype.hide=function(){this._$element.hide()},e}(jQuery);