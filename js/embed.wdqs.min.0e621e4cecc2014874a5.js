var wikibase=wikibase||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.FormatterHelper=function(t,e){"use strict";function r(){}var i=["http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#positiveInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger"];return r.prototype.formatRow=function(e,r){var i=this,a=t("<div/>");return t.each(e,function(n,o){i._isLabelField(n,e)||(o=t.extend({label:i._getLabel(e,n)},o),a.prepend(t("<div>").append(i.formatValue(o,n,r))))}),a},r.prototype._isLabelField=function(t,e){return t.endsWith("Label")&&void 0!==e[t.slice(0,-5)]},r.prototype._getLabel=function(t,e){var r=t[e+"Label"];return r&&r.value||null},r.prototype.formatValue=function(e,r,i){var a=e.value,n=t("<span>");if(r||(r=e.dataType||""),!e.type)return t("<span>").text(a).attr("title",r);switch(e.datatype||e.type){case"uri":var o=t("<a>").attr({title:r,href:a,target:"_blank",rel:"noopener"});n.append(o),this.isCommonsResource(a)?i?(o.click(this.handleCommonResourceItem),o.append(t("<img>").attr("src",this.getCommonsResourceFileNameThumbnail(a,"120"))).width("120")):(o.attr({href:"https://commons.wikimedia.org/wiki/File:{FILENAME}".replace(/{FILENAME}/g,this.getCommonsResourceFileName(a))}),o.text("commons:"+decodeURIComponent(this.getCommonsResourceFileName(a))),n.prepend(this.createGalleryButton(a,r)," ")):(o.text(e.label||this.abbreviateUri(a)),this.isEntityUri(a)&&n.prepend(this.createExploreButton(a)," "));break;case"http://www.w3.org/2001/XMLSchema#dateTime":r||(r=this._i18n("wdqs-app-result-formatter-title-datetime","Raw ISO timestamp"));var s=t("<span>").text(this._formatDate(a));s.attr("title",r+": "+a),n.append(s);break;case"http://www.w3.org/1998/Math/MathML":n.append(t(e.value));break;default:var u=t("<span>").text(a);e["xml:lang"]?u.attr("title",r+": "+a+"@"+e["xml:lang"]):u.attr("title",r),n.append(u)}return n},r.prototype._formatDate=function(t){var e,r=!1,i=t.replace(/^(?:-\d+|\+?0+\b)/,function(t){return r=!0,Math.abs(t)+1}),a=this.parseDate(i);if(a.isValid())e=a.format("ll");else{var n=i.replace(/^\+?(\d+).*/,"$1");e="0000".slice(n.length)+n}return r&&(e+=" BCE"),e},r.prototype.parseDate=function(t){return t=t.replace(/^(?![+-])/,"+"),t=t.replace(/^([+-]?)(\d{1,5}\b)/,function(t,e,r){return e+("00000"+r).slice(-6)}),t=t.replace(/Z$/,""),e(t,e.ISO_8601)},r.prototype.isEntityUri=function(t){return"string"==typeof t&&/^https?:\/\/www\.wikidata\.org\/entity\/./.test(t)},r.prototype.createExploreButton=function(e){var r=t('<a href="'+e+'" title="Explore item" class="explore glyphicon glyphicon-search" aria-hidden="true">');return r.click(t.proxy(this.handleExploreItem,this)),r},r.prototype.isCommonsResource=function(t){return t.toLowerCase().startsWith("http://commons.wikimedia.org/wiki/special:filepath/".toLowerCase())},r.prototype.getCommonsResourceFileName=function(t){var e=new RegExp("http://commons.wikimedia.org/wiki/special:filepath/","ig");return decodeURIComponent(t.replace(e,""))},r.prototype.getCommonsResourceFileNameThumbnail=function(t,e){return this.isCommonsResource(t)?t.replace(/^http(?=:\/\/)/,"https")+"?width="+(e||400):t},r.prototype.createGalleryButton=function(e,r){var i=this.getCommonsResourceFileName(e),a=this.getCommonsResourceFileNameThumbnail(e,900),n=t("<a>").attr({title:"Show Gallery",href:a,"aria-hidden":"true",class:"gallery glyphicon glyphicon-picture","data-gallery":"G_"+r,"data-title":decodeURIComponent(i)});return n.click(this.handleCommonResourceItem),n},r.prototype.abbreviateUri=function(t){var e,r,i,a=wikibase.queryService.RdfNamespaces.NAMESPACE_SHORTCUTS,n=0;for(e in a)for(r in a[e])0===t.indexOf(a[e][r])&&a[e][r].length>n&&(n=a[e][r].length,i=r);return i?i+":"+t.substr(n):"<"+t+">"},r.prototype.handleExploreItem=function(e){var r=t(e.target).attr("href");e.preventDefault();var i="SELECT ?item ?itemLabel WHERE { BIND( <"+r+'> as ?item ).\tSERVICE wikibase:label { bd:serviceParam wikibase:language "'+(t.i18n&&t.i18n().locale||"en")+'" } }',a="embed.html#"+encodeURIComponent("#defaultView:Graph\n"+i);return t(".explorer-panel .panel-body").html(t('<iframe frameBorder="0" scrolling="no"></iframe>').attr("src",a)),t(".explorer-panel").show(),!1},r.prototype.handleCommonResourceItem=function(e){e.preventDefault(),t(this).ekkoLightbox({scale_height:!0})},r.prototype.isLabel=function(t){return!!t&&("xml:lang"in t||"literal"===t.type&&!t.datatype)},r.prototype.isNumber=function(t){return t&&t.datatype&&-1!==i.indexOf(t.datatype)},r.prototype.isDateTime=function(t){return t&&"http://www.w3.org/2001/XMLSchema#dateTime"===t.datatype},r.prototype.isEntity=function(t){return t&&t.value&&this.isEntityUri(t.value)},r.prototype.isColor=function(t){return t&&"literal"===t.type&&t.value&&/^([\dA-F]{1,2}){3}$/i.test(t.value)},r.prototype.getColorForHtml=function(t){return"#"+t.value},r.prototype.calculateLuminance=function(t){var e=parseInt(t.substr(1,2),16)/255,r=parseInt(t.substr(3,2),16)/255,i=parseInt(t.substr(5,2),16)/255;return isFinite(e)&&isFinite(r)&&isFinite(i)?.2126*(e=e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(r=r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(i=i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)):NaN},r.prototype._i18n=function(e,r){var i;return t.i18n&&(i=t.i18n(e))!==e?i:r},r}(jQuery,moment),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractResultBrowser=function(t,e){"use strict";function r(){this._visitors=[]}return r.prototype._formatter=null,r.prototype._result=null,r.prototype._visitors=null,r.prototype._drawable=!1,r.prototype._sparqlApi=null,r.prototype.setResult=function(t){this._result=t},r.prototype.setSparqlApi=function(t){this._sparqlApi=t},r.prototype.getSparqlApi=function(){return this._sparqlApi},r.prototype._iterateResult=function(e){var r=this;t.each(this._result.results.bindings,function(i,a){t.each(r._result.head.vars,function(t,n){var o=a[n]||null;r.processVisitors(o,n),e(o,n,a,i)})})},r.prototype.isDrawable=function(){return this._drawable},r.prototype.draw=function(t){jQuery.error("Method draw() needs to be implemented!")},r.prototype.addVisitor=function(t){this._visitors.push(t)},r.prototype.resetVisitors=function(){this._visitors=[]},r.prototype.processVisitors=function(e,r){var i=this,a={};0!==this._visitors.length&&(t.each(this._visitors,function(t,i){i.visit&&"function"==typeof i.visit&&!1===i.visit(e,r)&&(a[t]=!0)}),i._visitors=i._visitors.filter(function(t,e){return!a[e]}))},r.prototype.visit=function(t){return!1},r.prototype.setFormatter=function(t){this._formatter=t},r.prototype._getFormatter=function(){return null===this._formatter&&(this._formatter=new e.queryService.ui.resultBrowser.helper.FormatterHelper),this._formatter},r.prototype._i18n=function(e,r){var i=null;return t.i18n&&(i=t.i18n(e))!==e?i:r},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser=function(t,e){"use strict";function r(){}return r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,r.prototype._getLabelColumns=function(){var t=this,e=t._getRows()[0];return t._getColumns().filter(function(r){return t._getFormatter().isLabel(e[r])})},r.prototype._getNumberColumns=function(){var t=this,e=t._getRows()[0];return t._getColumns().filter(function(r){return t._getFormatter().isNumber(e[r])})},r.prototype._getColumns=function(){return this._result.head.vars},r.prototype._getRows=function(){return this._result.results.bindings},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser=function(t,e,r,i,a){"use strict";function n(){}return n.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,n.prototype._dataColumns=null,n.prototype._data=null,n.prototype._$element=null,n.prototype._svg=null,n.prototype._chart=null,n.prototype._chartLegend=null,n.prototype._chartSeriesKey=null,n.prototype._chartStoryKey=null,n.prototype._isStoryPaused=!1,n.prototype.draw=function(e){var r=this;this._$element=t("<div>").css({width:"100%",height:"98vh"}),e.html(this._$element),this._createData(),this._drawSvg(),this._createChart(),this._drawChart(),this._createLegendFilter(),i.onresize=function(){r._drawChart(250,!0)}},n.prototype._createData=function(){var t=[],e={},r=null;this._iterateResult(function(i,a,n){null===r&&(r=n),n!==r&&(r=n,t.push(e),e={}),i&&i.value&&(e[a]=i.value)}),t.push(e),this._data=t},n.prototype._drawSvg=function(){this._svg=a.newSvg(this._$element[0],"100%","100%")},n.prototype._createChart=function(){this._chart=new a.chart(this._svg,this._data),this._chart.setBounds(0,0,"100%","100%"),this._chart.setMargins("5%","5%","2%","25%"),this._createChartAxis();var t=this._chart.addSeries(this._chartSeriesKey,this._getPlotType());t.addOrderRule(this._chartSeriesKey),t.lineMarkers=!0,this._chartStoryKey&&this._createChartStory(),this._chartLegend=this._chart.addLegend("1%","85%","100%","15%")},n.prototype._getPlotType=function(){jQuery.error("Method _getPlotType() needs to be implemented!")},n.prototype._createChartAxis=function(){var e=this,r=this._getRows()[0],i=this._getFormatter(),a=this._chart,n=["y","x"],o=!1;t.each(this._getColumns(),function(t,s){if(0!==n.length)i.isLabel(r[s])&&(a.addCategoryAxis(n.pop(),s),o=!0),i.isNumber(r[s])&&a.addMeasureAxis(n.pop(),s),i.isDateTime(r[s])&&(a.addTimeAxis(n.pop(),s,"%Y-%m-%dT%H:%M:%SZ","%m-%d-%Y"),o=!0);else if(i.isLabel(r[s])){if(!e._chartSeriesKey)return void(e._chartSeriesKey=s);if(!e._chartStoryKey)return e._chartStoryKey=s,!1}}),o||this._chartSeriesKey||!a.axes[0]||(this._chartSeriesKey=a.axes[0].measure)},n.prototype._createChartStory=function(){var t=this,e=this._chart.setStoryboard(this._chartStoryKey);e.frameDuration=5e3,this._$element.click(function(){if(t._isStoryPaused)return e.startAnimation(),void(t._isStoryPaused=!1);e.pauseAnimation(),t._isStoryPaused=!0})},n.prototype._createLegendFilter=function(){var t=this,e=a.getUniqueValues(this._data,this._chartSeriesKey);this._chart.legends=[],this._chartLegend.shapes.selectAll("rect").on("click",function(i){var n=!1,o=[];e.forEach(function(t){t===i.aggField.slice(-1)[0]?n=!0:o.push(t)}),r.select(this).style("opacity",n?.2:.8),n||o.push(i.aggField.slice(-1)[0]),e=o,t._chart.data=a.filterData(t._data,t._chartSeriesKey,e),t._drawChart(800)})},n.prototype._drawChart=function(t,r){var i=this;this._chart.draw(t,r),e.delay(function(){i._svg.selectAll(".dimple-marker,.dimple-marker-back").attr("r",2)},1.2*t)},n.prototype.isDrawable=function(){return Object.keys(this._dataColumns).length>=2},n.prototype.visit=function(t,e){return this._checkColumn(t,e)},n.prototype._checkColumn=function(t,e){return this._getFormatter().isLabel(t)&&(this._dataColumns[e]=!0),this._getFormatter().isNumber(t)&&(this._dataColumns[e]=!0),this._getFormatter().isDateTime(t)&&(this._dataColumns[e]=!0),!this.isDrawable()},n}(jQuery,_,d3,window,dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.ImageResultBrowser=function(t){"use strict";function e(){}return e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,e.prototype._grid=null,e.prototype.draw=function(e){var r=this;this._grid=t('<div class="masonry">'),this._iterateResult(function(t,e,i){if(t&&r._isCommonsResource(t.value)){var a=t.value,n=r._getFormatter().getCommonsResourceFileName(a);r._grid.append(r._getItem(r._getThumbnail(a),r._getThumbnail(a,1e3),n,i))}}),e.html(this._grid)},e.prototype._getItem=function(e,r,i,a){var n=t("<a>").click(this._getFormatter().handleCommonResourceItem).attr({href:r,"data-gallery":"g","data-title":i}).append(t("<img>").attr("src",e)),o=this._getFormatter().formatRow(a);return t('<div class="item">').append(n,o)},e.prototype._isCommonsResource=function(t){return this._getFormatter().isCommonsResource(t)},e.prototype._getThumbnail=function(t,e){return this._getFormatter().getCommonsResourceFileNameThumbnail(t,e)},e.prototype.visit=function(t){return this._checkImage(t)},e.prototype._checkImage=function(t){return!(t&&t.value&&this._isCommonsResource(t.value))||(this._drawable=!0,!1)},e}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TableResultBrowser=function(t,e){"use strict";function r(){}var i=[10,50,100,200,500,1e3];return r.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,r.prototype._columns=null,r.prototype._rows=null,r.prototype._sorter={string:function(t,e){return t.localeCompare(e)},number:function(t,e){return t>=e?-1:1},generic:function(t,e){if(!e)return 1;if(!t)return-1;var r=this._getFormatter();return r.isNumber(t)&&r.isNumber(e)?this._sorter.number(Number(t.value),Number(e.value)):r.isEntityUri(t.value)&&r.isEntityUri(e.value)?this._sorter.number(Number(t.value.replace(/[^0-9]/gi,"")),Number(e.value.replace(/[^0-9]/gi,""))):this._sorter.string(t.value,e.value)}},r.prototype.draw=function(r){var i=this._result;if(void 0!==i.boolean){var a=t("<table>").attr("class","table");return a.append("<tr><td>"+i.boolean+"</td></tr>").addClass("boolean"),void r.html(a)}this.columns=i.head.vars,this.rows=i.results.bindings;var n=t("<table/>");r.html(n),this.drawBootstrapTable(n),n.children().width()>t(e).width()&&n.bootstrapTable("toggleView")},r.prototype.drawBootstrapTable=function(e){var r=this,a=this.rows.length>200;jQuery.fn.bootstrapTable.columnDefaults.formatter=function(t,e,i){return t?(r.processVisitors(t,this.field),r._getFormatter().formatValue(t).html()):""};var n={"click .explore":t.proxy(this._getFormatter().handleExploreItem,this),"click .gallery":this._getFormatter().handleCommonResourceItem};e.bootstrapTable({columns:this.columns.map(function(e){return{title:e,field:e,events:n,sortable:!0,sorter:t.proxy(r._sorter.generic,r)}}),data:this.rows,mobileResponsive:!0,search:a,pagination:a,showPaginationSwitch:a,pageSize:200,pageList:i,keyEvents:!0,cookie:!0,cookieIdTable:"1",cookieExpire:"1y",cookiesEnabled:["bs.table.pageList"]})},r.prototype.isDrawable=function(){return!0},r.prototype.visit=function(t){return!1},r}(jQuery,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.CoordinateResultBrowser=function(t,e,r,i,a,n){"use strict";function o(){this._getMarkerGroupColor=r.scale.category10(),h=e.Control.extend({options:{position:"topright"},onAdd:function(r){var i=e.DomUtil.create("button");return t(i).addClass("btn btn-default"),t(i).append(t(' <span class="glyphicon glyphicon-chevron-up"/> ')),i.onclick=function(){r.isFullscreen()&&r.toggleFullscreen(),t(n).scrollTop(0,0)},i}})}var s=["http://www.opengis.net/ont/geosparql#wktLiteral","http://www.openlinksw.com/schemas/virtrdf#Geometry"],u="http://www.opengis.net/def/crs/OGC/1.3/CRS84",l=["http://www.wikidata.org/entity/Q2",u],p=["layerLabel","layer"],c={wikimedia:{url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",options:{id:"wikipedia-map-01",attribution:' <a href="http://maps.wikimedia.org/">Wikimedia</a> | &copy; <a href="http://openstreetmap.org/copyright">Open Street Map</a> contributors'}},osm:{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}}},h=null;return o.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,o.prototype._map=null,o.prototype._markerGroups=null,o.prototype._getMarkerGroupColor=null,o.prototype.draw=function(r){var a=t("<div>").attr("id","map").height("100vh");r.html(a),this._createMarkerGroups(),this._map=e.map("map",{center:[0,0],maxZoom:18,minZoom:2,fullscreenControl:!0,preferCanvas:!0,layers:i.compact(this._markerGroups)}).fitBounds(this._markerGroups._LAYER_DEFAULT_GROUP.getBounds()),this._setTileLayer(),this._createControls(),this._createMarkerZoomResize(),r.html(a)},o.prototype._createControls=function(){var r=this;if(this._map.addControl(e.control.zoomBox({modal:!1,className:"glyphicon glyphicon-zoom-in"})),this._map.addControl(new h),Object.keys(this._markerGroups).length>1){var i=this._getLayerControl(this._markerGroups).addTo(this._map);this._map.on("overlayadd overlayremove",function(e){e.layer===r._markerGroups._LAYER_DEFAULT_GROUP&&(t.each(r._markerGroups,function(t,i){"overlayadd"===e.type?r._map.addLayer(i):r._map.removeLayer(i)}),i._update())})}},o.prototype._createMarkerZoomResize=function(){var t=this;if(!(this._markerGroups._LAYER_DEFAULT_GROUP.getLayers().length>1e3)){this._map.on("zoomend",function(){t._markerGroups._LAYER_DEFAULT_GROUP.setStyle({radius:t._getMarkerRadius()})})}},o.prototype._getMarkerRadius=function(){return this._map?.5*this._map.getZoom():3},o.prototype._getLayerControl=function(){var r=this,i={},a="";return t.each(this._markerGroups,function(t,e){if("_LAYER_DEFAULT_GROUP"===t)a=r._i18n("wdqs-result-map-layers-all","All layers");else{var n=r._getMarkerGroupColor(t);a='<span style="color:'+n+'">&#x2b24;</span> '+t}i[a]=e}),e.control.layers(null,i)},o.prototype._createMarkerGroups=function(){var r=this,i={};if(i._LAYER_DEFAULT_GROUP=[],this._iterateResult(function(t,a,n){if(t&&-1!==s.indexOf(t.datatype)){var o=r._extractGeoJson(t.value);if(!o)return;var u=r._getMarkerGroupsLayer(n);i[u]||(i[u]=[]);var l=e.geoJson(o,{style:r._getMarkerStyle(u),pointToLayer:function(t,i){return e.circleMarker(i,r._getMarkerStyle(u))},onEachFeature:function(t,i){var a=e.popup();i.bindPopup(a),i.on("click",function(){var t=r._getItemDescription(n);a.setContent(t[0])})}});i[u].push(l),i._LAYER_DEFAULT_GROUP.push(l)}}),0===Object.keys(i).length){var a=e.marker([0,0]).bindPopup("Nothing found!").openPopup();return{null:e.featureGroup([a])}}t.each(i,function(t){i[t]=e.featureGroup(i[t])}),this._markerGroups=i},o.prototype._getMarkerGroupsLayer=function(t){var e=p.find(function(e){return t[e]});return e?t[e].value:"_LAYER_DEFAULT_GROUP"},o.prototype._getMarkerStyle=function(t){var e="#e04545";return"_LAYER_DEFAULT_GROUP"!==t&&(e=this._getMarkerGroupColor(t)),{color:e,opacity:.8,fillColor:e,fillOpacity:.9,radius:this._getMarkerRadius()}},o.prototype._splitWktLiteral=function(t){var e=t.match(/(<([^>]*)> +)?(.*)/);return e?{crs:e[2]||u,wkt:e[3]}:null},o.prototype._extractGeoJson=function(t){var e=this._splitWktLiteral(t);return e?-1===l.indexOf(e.crs)?null:a.parse(e.wkt):null},o.prototype._getItemDescription=function(e){return t("<div/>").append(this._getFormatter().formatRow(e,!0))},o.prototype._setTileLayer=function(){var t=c.osm;("query.wikidata.org"===n.location.host||"localhost"===n.location.host||n.location.host.endsWith(".wmflabs.org"))&&(t=c.wikimedia),e.tileLayer(t.url,t.options).addTo(this._map)},o.prototype.visit=function(t){return this._checkCoordinate(t)},o.prototype._checkCoordinate=function(t){return!t||-1===s.indexOf(t.datatype)||null===this._extractGeoJson(t.value)||(this._drawable=!0,!1)},o}(jQuery,L,d3,_,wellknown,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeMapResultBrowser=function(t,e,r){"use strict";function i(){this._labelColumns={}}return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._labelColumns=null,i.prototype.draw=function(t){var e=this,r={},i=r,a=null,n=null,o=null;this._iterateResult(function(t,s,u){u!==o&&(null!==o&&(i.data={size:a,url:n},a=null,n=null,i=r),o=u),e._getFormatter().isLabel(t)&&(i[t.value]||(i[t.value]={}),i=i[t.value]),e._getFormatter().isNumber(t)&&(a=t.value),t&&t.value&&e._getFormatter().isEntityUri(t.value)&&(n=t.value)}),i.data={size:a,url:n};var s={name:"treeMap",children:this._createTreeData(r)};this._draw(t,s)},i.prototype._createTreeData=function(e){var r,i=this,a=[];return e.data?a:(t.each(e,function(t,e){var n=i._createTreeData(e);if(0!==n.length)r={id:t,name:t,children:n};else{var o=1;e.data.size&&e.data.size>0&&(o=e.data.size);var s=t,u=e.data.url;u&&(s=u),r={id:s+Math.random(),name:t,size:o,url:u}}a.push(r)}),a)},i.prototype._draw=function(i,a){function n(t){return t.size}function o(t){return 1}function s(t){var e=t.substring(1,3),r=t.substring(3,5),i=t.substring(5,7);return{R:parseInt(e,16),G:parseInt(r,16),B:parseInt(i,16)}}function u(t){var e=s(t);return 255-(.299*e.R+.587*e.G+.114*e.B)<105?"#000000":"#ffffff"}function l(t){_.padding([b/(y/t.dy),0,0,0]).nodes(t);var r=d/t.dx,i=y/t.dy,a=t;w.domain([t.x,t.x+t.dx]),f.domain([t.y,t.y+t.dy]),k.selectAll(".labelbody .label").style("display","block");var n=k.selectAll("g.cell").transition().duration(v).attr("transform",function(t){return"translate("+w(t.x)+","+f(t.y)+")"}).each("end",function(t,e){e||a===self.root||(k.selectAll(".cell.child").filter(function(t){return t.parent===self.node}).select(".foreignObject .labelbody .label").style("color",function(t){return u(g(t.parent.name))}),h?k.selectAll(".cell.child").filter(function(t){return t.parent===self.node}).select(".foreignObject").style("display",""):k.selectAll(".cell.child").filter(function(t){return t.parent===self.node}).select(".foreignObject .labelbody .label").style("display",""))});n.select(".foreignObject").attr("width",function(t){return Math.max(.01,r*t.dx)}).attr("height",function(t){return t.children?b:Math.max(.01,i*t.dy)}).select(".labelbody .label").text(function(t){return t.name}),n.select("rect").attr("width",function(t){return Math.max(.01,r*t.dx)}).attr("height",function(t){return t.children?b:Math.max(.01,i*t.dy)}).style("fill",function(t){return t.children?m:g(t.parent.name)}),c=t,e.event&&e.event.stopPropagation()}var p,c,h=!1,d=t(r).width(),y=t(r).height(),w=e.scale.linear().range([0,d]),f=e.scale.linear().range([0,y]),g=e.scale.category10(),b=20,m="#555555",v=500,_=e.layout.treemap().round(!1).size([d,y]).sticky(!0).value(function(t){return t.size}),k=e.select(i[0]).append("svg:svg").attr("width",d).attr("height",y).append("svg:g");c=p=a;var S=_.nodes(p),q=S.filter(function(t){return!t.children}),E=S.filter(function(t){return t.children}),L=k.selectAll("g.cell.parent").data(E,function(t){return"p-"+t.id}),T=L.enter().append("g").attr("class","cell parent").on("click",function(t){l(t)});T.append("rect").attr("width",function(t){return Math.max(.01,t.dx)}).attr("height",b).style("fill",m),T.append("foreignObject").attr("class","foreignObject").append("xhtml:body").attr("class","labelbody").append("div").attr("class","label");var R=L.transition().duration(v);R.select(".cell").attr("transform",function(t){return"translate("+t.dx+","+t.y+")"}),R.select("rect").attr("width",function(t){return Math.max(.01,t.dx)}).attr("height",b).style("fill",m),R.select(".foreignObject").attr("width",function(t){return Math.max(.01,t.dx)}).attr("height",b).select(".labelbody .label").text(function(t){return t.name}),L.exit().remove();var x=k.selectAll("g.cell.child").data(q,function(t){return"c-"+t.id}),C=x.enter().append("g").attr("class","cell child").on("click",function(t){l(c===t.parent?p:t.parent)});C.append("rect").classed("background",!0).style("fill",function(t){return g(t.parent.name)}),C.append("foreignObject").attr({class:"foreignObject",width:function(t){return Math.max(.01,t.dx)},height:function(t){return Math.max(.01,t.dy)}}).append("xhtml:body").attr("class","labelbody").append("div").attr("class","label").text(function(t){return t.name}).on("click",function(t){t.url&&(r.open(t.url,"_blank"),e.event.stopPropagation())});var A=x.transition().duration(v);A.select(".cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),A.select("rect").attr("width",function(t){return Math.max(.01,t.dx)}).attr("height",function(t){return t.dy}).style("fill",function(t){return g(t.parent.name)}),A.select(".foreignObject").attr("width",function(t){return Math.max(.01,t.dx)}).attr("height",function(t){return Math.max(.01,t.dy)}).select(".labelbody .label").text(function(t){return t.name}),x.exit().remove(),e.select("select").on("change",function(){console.log("select zoom(node)"),_.value("size"==value?n:o).nodes(p),l(c)}),l(c)},i.prototype.isDrawable=function(){return Object.keys(this._labelColumns).length>1},i.prototype.visit=function(t,e){return this._checkColumn(t,e)},i.prototype._checkColumn=function(t,e){return!this._getFormatter().isLabel(t,e)||(this._labelColumns[e]=!0,!this.isDrawable())},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeResultBrowser=function(t,e,r){"use strict";function i(){this._labelColumns={}}var a='SELECT ?property ?propertyLabel ?value ?valueItemLabel ?valueImage WHERE {       {         SELECT ?property ?value ?valueImage ?valueItem WHERE {           BIND(<{ENTITY_URI}> AS ?item)           ?item ?prop ?value.           ?property wikibase:directClaim ?prop.           ?property rdf:type wikibase:Property.           OPTIONAL { ?value wdt:P18 ?valueImage. }           OPTIONAL { BIND(?value AS ?valueItem).  FILTER(STRSTARTS(STR(?value), STR(wd:))) }         }       }       SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }    }  ';return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._isDrawable=!1,i.prototype._jsTree=null,i.prototype._nodes=null,i.prototype.draw=function(i){var a=this;this._nodes=this._extractNodes(t.proxy(this._iterateResult,this));var n=t("<div>").jstree({core:{data:e.compact(a._nodes),check_callback:!0},plugins:["types","wholerow","contextmenu","unique"],types:{default:{icon:"glyphicon glyphicon-barcode"}},contextmenu:{items:function(t){return{Open:{label:a._nodes[t.id].url,icon:"glyphicon glyphicon-link",action:function(){r.open(a._nodes[t.id].url,"_blank")}},explore:{label:a._nodes[t.id].url,icon:"glyphicon glyphicon-download-alt",action:function(){a._expandTree(a._nodes[t.id])}}}}}});this._jsTree=n.jstree(),i.empty().append(n)},i.prototype._extractNodes=function(t,e){var r=null,i={},a=null,n={},o=this._getFormatter();return t(function(t,s,u){u!==r&&(a=null,r=u),t&&t.value&&(a&&(o.isLabel(t)||o.isNumber(t))&&(n[a].text=(n[a].text||"")+" "+t.value),a&&o.isCommonsResource(t.value)&&(n[a].icon=o.getCommonsResourceFileNameThumbnail(t.value,24)),o.isEntity(t)&&((i={}).parent=a||e||"#",i.id=i.parent+t.value,i.url=t.value,i.state={opened:!1},n[i.id]=i,a=i.id))}),n},i.prototype._expandTree=function(e){var r=this;this.getSparqlApi().query(a.replace("{ENTITY_URI}",e.url)).done(function(){var i=r.getSparqlApi().getResultRawData(),a=r._extractNodes(function(e){t.each(i.results.bindings,function(r,a){t.each(i.head.vars,function(t,i){var n=a[i]||null;e(n,i,a,r)})})},e.id);t.extend(r._nodes,a),t.each(a,function(t,e){r._jsTree.create_node(e.parent,e)})})},i.prototype.isDrawable=function(){return this._isDrawable},i.prototype.visit=function(t){return!this._getFormatter().isEntity(t)||(this._isDrawable=!0,!1)},i}(jQuery,_,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.BubbleChartResultBrowser=function(t,e,r){"use strict";function i(){}return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype._hasLabel=!1,i.prototype._hasNumber=!1,i.prototype.draw=function(e){var r=this,i={name:"bubblechart",children:[]},a=this._getLabelColumns()[0],n=this._getNumberColumns()[0],o=null;this._iterateResult(function(t,e,s){if(s!==o){var u={url:null};o=s,s.rgb&&r._getFormatter().isColor(s.rgb)&&(u.color=r._getFormatter().getColorForHtml(s.rgb)),s[a]&&s[n]&&(u.name=s[a].value,u.size=s[n].value,i.children.push(u))}if(t&&t.value&&r._getFormatter().isEntityUri(t.value)){var l=i.children[i.children.length-1];null===l.url&&(l.url=t.value)}});var s=t("<center>");e.html(s),this._drawBubbleChart(s,i)},i.prototype._drawBubbleChart=function(i,a){var n=this,o=Math.min(.98*t(r).height(),t(r).width()),s=e.scale.category20c(),u=e.layout.pack().sort(null).size([o,o]).padding(1.5),l=e.select(i[0]).append("svg").attr({class:"bubble",width:o,height:o}).selectAll(".node").data(u.nodes(function(t){function e(t,i){i.children?i.children.forEach(function(t){e(i.name,t)}):r.push({packageName:t,className:i.name,value:i.size,url:i.url,color:i.color})}var r=[];return e(null,t),{children:r}}(a)).filter(function(t){return!t.children})).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});l.append("title").text(function(t){return t.className+": "+t.value}),l.append("circle").attr("r",function(t){return t.r}).style("fill",function(t){return t.color||s(t.className)}),l.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(t){return t.className.substring(0,t.r/4)}).on("click",function(t){t.url&&r.open(t.url,"_blank")}).style("fill",function(t){if(t.color)return n._getFormatter().calculateLuminance(t.color)<=.5?"#FFF":"#000"}).style("cursor","pointer")},i.prototype.isDrawable=function(){return this._hasLabel&&this._hasNumber},i.prototype.visit=function(t){return this._checkColumn(t)},i.prototype._checkColumn=function(t){return this._getFormatter().isNumber(t)&&(this._hasNumber=!0),this._getFormatter().isLabel(t)&&(this._hasLabel=!0),!this.isDrawable()},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.LineChartResultBrowser=function(t){"use strict";function e(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return e.prototype=new r,e.prototype._getPlotType=function(){return t.plot.line},e}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.BarChartResultBrowser=function(t){"use strict";function e(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return e.prototype=new r,e.prototype._getPlotType=function(){return t.plot.bar},e}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.ScatterChartResultBrowser=function(t){"use strict";function e(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return e.prototype=new r,e.prototype._getPlotType=function(){return t.plot.scatter},e}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AreaChartResultBrowser=function(t){"use strict";function e(){this._dataColumns={}}var r=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;return e.prototype=new r,e.prototype._getPlotType=function(){return t.plot.area},e}(dimple),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TimelineResultBrowser=function(t,e,r,i){"use strict";function a(){}var n={minHeight:"400px",orientation:{axis:"both",item:"top"},align:"auto",zoomKey:"ctrlKey"};return a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,a.prototype.draw=function(r){var i=t("<div>"),a=new e.Timeline(i[0],this._getItems(),n);a.on("changed",function(){t(a.dom.root).find(".vis-item.vis-range").each(function(){var e=t(this);e.css("min-width","unset"),e.css("min-width",e.css("width"))})}),r.append(i.prepend(this._createToolbar(a)))},a.prototype._getItems=function(){var t=this,r=[];return this._iterateResult(function(e,i,a,n){if(t._getFormatter().isDateTime(e))if(r[n]){var o=[];o.push(t._getFormatter().parseDate(e.value)),r[n].start&&o.push(r[n].start),r[n].end&&o.push(r[n].end),r[n].start=o.reduce(function(t,e){return t<e?t:e}),r[n].end=o.reduce(function(t,e){return t>e?t:e})}else r[n]={id:n,content:t._getHtml(a).html(),start:t._getFormatter().parseDate(e.value)}}),new e.DataSet(i.compact(r))},a.prototype._getHtml=function(e){return t("<div/>").append(this._getFormatter().formatRow(e,!0))},a.prototype._createToolbar=function(e){function r(t){var r=e.getWindow(),i=r.end-r.start;e.setWindow({start:r.start.valueOf()-i*t,end:r.end.valueOf()+i*t})}var i=t('<div style="margin-top: -35px; text-align: center;">');return t('<a class="btn btn-default">').click(t.proxy(e.redraw,e)).append('<span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>').appendTo(i),t('<a class="btn btn-default">').click(t.proxy(e.fit,e)).append('<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>').appendTo(i),t('<a class="btn btn-default">').click(function(){r(.2)}).append('<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>').appendTo(i),t('<a class="btn btn-default">').click(function(){r(-.2)}).append('<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>').appendTo(i),i},a.prototype.visit=function(t){return!this._getFormatter().isDateTime(t)||(this._drawable=!0,!1)},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.MultiDimensionResultBrowser=function(t,e,r){"use strict";function i(){}var a="http://www.w3.org/2001/XMLSchema#dateTime";return i.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser,i.prototype.draw=function(t){var e={},r=[],i=this._getFormatter();this._iterateResult(function(t,n,o,s){if(r[s]||(r[s]={}),r[s][n]=t&&t.value||"undefined",t&&t.type===a&&(r[s][n]=new Date(t.value).toLocaleDateString()),!e[n]){var u={key:n,description:n,type:"STRING"};i.isNumber(t)&&(u.type="NUMBER"),t&&t.type===a&&(u.type="DATE"),e[n]=u}}),this._draw(t,r,_.values(e))},i.prototype._draw=function(i,a,n){function o(){e.event.sourceEvent.stopPropagation()}function s(){var t=n.filter(function(t){return!t.brush.empty()}),r=t.map(function(t){return t.brush.extent()});e.selectAll(".foreground path").style("display",function(e){return t.every(function(t,i){return t.type.within(e[t.key],r[i],t)})?null:"none"})}var u={top:50,right:80,bottom:10,left:100},l=t(r).width()-(u.left+u.right),p=t(r).height()-(u.top+u.bottom),c={NUMBER:{key:"Number",coerce:function(t){return+t},extent:e.extent,within:function(t,e){return e[0]<=t&&t<=e[1]},defaultScale:e.scale.linear().range([p,0])},STRING:{key:"String",coerce:String,extent:function(t){return t.sort()},within:function(t,e,r){return e[0]<=r.scale(t)&&r.scale(t)<=e[1]},defaultScale:e.scale.ordinal().rangePoints([0,p])},DATE:{key:"Date",coerce:function(t){return new Date(t)},extent:e.extent,within:function(t,e){return e[0]<=t&&t<=e[1]},defaultScale:e.time.scale().range([0,p])}};t.each(n,function(){this.type=c[this.type]});var h=e.scale.ordinal().domain(n.map(function(t){return t.key})).rangePoints([0,l]),d=e.svg.line().defined(function(t){return!isNaN(t[1])}),y=e.svg.axis().orient("left"),w=e.select(i[0]).append("svg").attr({width:l+u.left+u.right,height:p+u.top+u.bottom}).append("g").attr("transform","translate("+u.left+","+u.top+")"),f=w.append("g").attr("class","foreground"),g=w.selectAll(".axis").data(n).enter().append("g").attr("class","axis").attr("transform",function(t){return"translate("+h(t.key)+")"});a.forEach(function(t){n.forEach(function(e){t[e.key]=e.type.coerce(t[e.key])})}),n.forEach(function(t){"domain"in t||(t.domain=e.functor(t.type.extent)(a.map(function(e){return e[t.key]})),t.domain.sort(function(t,e){return t-e})),"scale"in t||(t.scale=t.type.defaultScale.copy()),t.scale.domain(t.domain)}),f.selectAll("path").data(a).enter().append("path").attr("d",function(t){return d(n.map(function(e){return[h(e.key),e.scale(t[e.key])]}))}).style("stroke",function(t){return"#6ac"}),g.append("g").attr("class","axis").each(function(t){var r=t.axis&&t.axis.scale(t.scale)||y.scale(t.scale);e.select(this).call(r)}).append("text").attr("class","title").attr("text-anchor","start").text(function(t){return t.description||t.key}),g.append("g").attr("class","brush").each(function(t){e.select(this).call(t.brush=e.svg.brush().y(t.scale).on("brushstart",o).on("brush",s))}).selectAll("rect").attr("x",-8).attr("width",16)},i.prototype.isDrawable=function(){return this._drawable},i.prototype.visit=function(t){return this._drawable=!0,!1},i}(jQuery,d3,window),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowser=function(t,e,r,i){"use strict";function a(){}var n={autoResize:!0,physics:{stabilization:{enabled:!0,iterations:10,fit:!0}},nodes:{shadow:!0,color:"#fff"},edges:{arrows:{to:!0}}};return a.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser,a.prototype.draw=function(i){var a=t("<div>").height("100vh"),o=this._getData(),s=new e.Network(a[0],o,n);s.on("doubleClick",function(t){1===t.nodes.length&&r.open(t.nodes[0],"_blank")});var u=new wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser(o.nodes,o.edges,this.getSparqlApi());s.on("click",function(t){var e=t.nodes[0]||null;u.browse(e)}),a.prepend(this._createToolbar(s)),i.append(a)},a.prototype._createToolbar=function(e){function r(t){e.setOptions({layout:{hierarchical:{direction:t,sortMethod:"directed"}}})}var i=t('<div style="margin-top: -35px; text-align: center;">');return t('<a class="btn btn-default">').click(function(){e.stabilize(100)}).append('<span class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-stabilize")+'"></span>').appendTo(i),t('<a class="btn btn-default">').click(function(){r("LR")}).append('<span class="glyphicon glyphicon-indent-left" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-lr")+'"></span>').appendTo(i),t('<a class="btn btn-default">').click(function(){r("UD")}).append('<span class="glyphicon glyphicon-align-center" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-ud")+'"></span>').appendTo(i),t('<a class="btn btn-default">').click(function(){r("RL")}).append('<span class="glyphicon glyphicon-indent-right" aria-hidden="true" title="'+this._i18n("wdqs-app-resultbrowser-hierarchical-rl")+'"></span>').appendTo(i),i},a.prototype._getData=function(){var t={},r={},a=[],n=this._getFormatter(),o={},s={};return this._iterateResult(function(e,i,u,l){if(e&&e.value){if(n.isEntity(e)){var p=u[i+"Label"]&&u[i+"Label"].value||e.value,c=e.value;o={id:c,label:p,title:p},a[l]?(s={from:a[l],to:c},r[s.from+s.to]=s,t[c]||(t[c]=o)):(t[c]=o,a[l]=o.id)}if(n.isCommonsResource(e.value)&&(o.image=n.getCommonsResourceFileNameThumbnail(e.value,150),o.shape="image",o.font={color:"black"}),n.isNumber(e)&&(o.value=e.value,o.title+=" value:"+e.value,o.shape="dot",o.font={color:"black"}),"rgb"===i&&n.isColor(e)&&(o.color=n.getColorForHtml(e),"dot"!==o.shape&&"image"!==o.shape)){var h=n.calculateLuminance(e.value)<=.5?"#FFF":"#000";o.font={color:h}}"edgeLabel"===i&&(s.label=e.value)}}),{nodes:new e.DataSet(i.compact(t)),edges:new e.DataSet(i.compact(r))}},a.prototype.visit=function(t){return!this._getFormatter().isEntity(t)||(this._drawable=!0,!1)},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser=function(t,e,r,i){"use strict";function a(t,e,r){this._nodes=t,this._edges=e,this._sparql=r}var n='SELECT ?p (SAMPLE(?pl) AS ?pl) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol)  WHERE {<{entityUri}> ?p ?o .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p',o='SELECT ?o ?ol WHERE {<{entityUri}> <{propertyUri}> ?o .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50';return a.prototype._nodes=null,a.prototype._nodes=null,a.prototype._sparql=null,a.prototype._selectedNodeId=null,a.prototype._temporaryNodes={},a.prototype._temporaryEdges={},a.prototype._getEntites=function(e,r){var i=this,a=t.Deferred();return this._sparql.query(o.replace("{entityUri}",e).replace("{propertyUri}",r)).done(function(){var e=i._sparql.getResultRawData(),r=[];t.each(e.results.bindings,function(t,e){r.push({id:e.o.value,label:e.ol.value})}),a.resolve(r)}),a},a.prototype._getProperties=function(e){var r=this,i=t.Deferred();return this._sparql.query(n.replace("{entityUri}",e)).done(function(){var e=r._sparql.getResultRawData(),a=[];t.each(e.results.bindings,function(t,e){a.push({id:e.p.value,label:e.pl.value,count:e.count.value,items:e.ol.value})}),i.resolve(a)}),i},a.prototype._removeTemporaryNodes=function(e){var r=this;t.each(this._temporaryNodes,function(t,e){r._nodes.remove(e.id)}),t.each(this._temporaryEdges,function(t,e){r._edges.remove(e.id)}),this._temporaryNodes={},this._temporaryEdges={}},a.prototype._expandPropertyNode=function(e){var r=this,i=this._temporaryNodes[e];this._getEntites(i.entityId,i.id).done(function(e){t.each(e,function(t,e){null===r._nodes.get(e.id)&&r._nodes.add({id:e.id,label:e.label}),r._edges.add({dashes:!0,from:i.entityId,to:e.id,label:i.propertyLabel,linkType:i.id})})})},a.prototype._expandEntityNode=function(e){var r=this;this._getProperties(e).done(function(i){t.each(i,function(t,i){if(!(r._edges.get({filter:function(t){return t.linkType===i.id&&t.from===e}}).length>0)){var a={id:i.id,label:"1"===i.count?i.items:i.count,title:i.items,entityId:e,propertyLabel:i.label,color:"#abc9f2"},n={id:i.id,dashes:!0,label:i.label,from:e,to:i.id};r._temporaryNodes[a.id]=a,r._nodes.add(a),r._temporaryEdges[n.id]=n,r._edges.add(n)}})})},a.prototype.browse=function(t){if(null!==t){if(this._temporaryNodes[t])return this._expandPropertyNode(t),void this._removeTemporaryNodes();null!==this._selectedNodeId&&t!==this._selectedNodeId&&this._removeTemporaryNodes(),this._expandEntityNode(t),this._selectedNodeId=t}else this._removeTemporaryNodes()},a}(jQuery,vis,window,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Sparql=function(t){"use strict";function e(t,e){this._serviceUri=t||r,this._language=e||n}var r="https://query.wikidata.org/bigdata/namespace/wdq/sparql",i={TIMEOUT:10,MALFORMED:20,SERVER:30,UNKNOWN:100},a={"QueryTimeoutException: Query deadline is expired":i.TIMEOUT,"MalformedQueryException: ":i.MALFORMED},n="en";return e.prototype.ERROR_CODES=i,e.prototype._serviceUri=null,e.prototype._executionTime=null,e.prototype._error=null,e.prototype._resultLength=null,e.prototype._rawData=null,e.prototype._queryUri=null,e.prototype._language=null,e.prototype.queryDataUpdatedTime=function(){var e=t.Deferred(),r=encodeURI("prefix schema: <http://schema.org/> SELECT * WHERE {<http://www.wikidata.org> schema:dateModified ?y}"),i=this._serviceUri+"?query="+r+"&nocache="+Math.floor(Date.now()/6e4),a={headers:{Accept:"application/sparql-results+json"}};return t.ajax(i,a).done(function(t,r,i){if(t.results.bindings[0]){var a=new Date(t.results.bindings[0][t.head.vars[0]].value),n=a.toLocaleTimeString(navigator.language,{timeZoneName:"short"})+", "+a.toLocaleDateString(navigator.language,{month:"short",day:"numeric",year:"numeric"}),o=Math.round((new Date-a)/1e3);e.resolve(n,o)}else e.reject()}).fail(function(){e.reject()}),e},e.prototype.query=function(e,r){function i(t,e,r){o._executionTime=Date.now()-o._executionTime,"boolean"==typeof t.boolean?o._resultLength=1:o._resultLength=t.results.bindings.length||0,o._rawData=t,s.resolve(t)}function a(t,e,r){o._executionTime=null,o._rawData=null,o._resultLength=null,o._generateErrorMessage(t,e,r),s.reject()}e=this._replaceAutoLanguage(e);var n="query="+encodeURIComponent(e);r&&(n+="&maxQueryTimeMillis="+r);var o=this,s=t.Deferred(),u={headers:{Accept:"application/sparql-results+json"},data:n};return this._queryUri=this._serviceUri+"?"+u.data,this._executionTime=Date.now(),t.ajax(this._serviceUri,u).done(i).fail(function(e,r,n){""===e.getAllResponseHeaders()?(u.method="POST",t.ajax(o._serviceUri,u).done(i).fail(a)):a.apply(this,arguments)}),s},e.prototype._generateErrorMessage=function(t,e,r){var n={code:i.UNKNOWN,message:null,debug:t.responseText};(0===t.status||r)&&(n.code=i.SERVER,n.message=r.message);try{var o=n.debug.substring(n.debug.indexOf("java.util.concurrent.ExecutionException:"));for(var s in a)-1!==o.indexOf(s)&&(n.code=a[s],n.message=null);n.code!==i.UNKNOWN&&n.code!==i.MALFORMED||(n.message=n.debug.match(/(java\.util\.concurrent\.ExecutionException\:)+(.*)(Exception\:)+(.*)/).pop().trim())}catch(t){}this._error=n},e.prototype.getExecutionTime=function(){return this._executionTime},e.prototype.getError=function(){return this._error},e.prototype.getResultLength=function(){return this._resultLength},e.prototype.getQueryUri=function(){return this._queryUri},e.prototype._processData=function(t,e,r){for(var i=t.results.bindings.length,a=0;a<i;a++){for(var n={},o=0;o<t.head.vars.length;o++)t.head.vars[o]in t.results.bindings[a]?n[t.head.vars[o]]=t.results.bindings[a][t.head.vars[o]]:n[t.head.vars[o]]=void 0;r=e(n,r)}return r},e.prototype._encodeCsv=function(t){var e=t.replace(/"/g,'""');return/[",\n]/.test(e)&&(e='"'+e+'"'),e},e.prototype.getResultRawData=function(){return this._rawData},e.prototype.getResultAsCsv=function(){var t=this,e=t._rawData,r=e.head.vars.map(this._encodeCsv).join(",")+"\n";return r=this._processData(e,function(e,r){var i,a="",n=!0;for(var o in e)i=void 0===e[o]?"":t._encodeCsv(e[o].value),n?n=!1:a+=",",a+=i;return a+="\n",r+a},r)},e.prototype.getResultAsJson=function(){var t=[],e=this._rawData;return t=this._processData(e,function(t,e){var r={};for(var i in t)r[i]=(t[i]||{}).value;return e.push(r),e},t),JSON.stringify(t)},e.prototype.getResultAsAllJson=function(){return JSON.stringify(this._rawData)},e.prototype._renderValueTSV=function(t){var e=t.value.replace(/\t/g,"");switch(t.type){case"uri":return"<"+e+">";case"bnode":return"_:"+e;case"literal":var r=JSON.stringify(e);return t["xml:lang"]?r+"@"+t["xml:lang"]:t.datatype?"http://www.w3.org/2001/XMLSchema#integer"===t.datatype||"http://www.w3.org/2001/XMLSchema#decimal"===t.datatype||"http://www.w3.org/2001/XMLSchema#double"===t.datatype?e:r+"^^<"+t.datatype+">":r}return e},e.prototype.getSparqlTsv=function(){var t=this,e=this._rawData,r=e.head.vars.map(function(t){return"?"+t}).join("\t")+"\n";return r=this._processData(e,function(e,r){var i,a="",n=!0;for(var o in e)i=void 0===e[o]?"":t._renderValueTSV(e[o]),n?n=!1:a+="\t",a+=i;return a+="\n",r+a},r)},e.prototype.getSimpleTsv=function(){var t=this._rawData,e=t.head.vars.join("\t")+"\n";return e=this._processData(t,function(t,e){var r,i="",a=!0;for(var n in t)r=void 0===t[n]?"":t[n].value.replace(/\t/g,""),a?a=!1:i+="\t",i+=r;return i+="\n",e+i},e)},e.prototype._replaceAutoLanguage=function(t){return t.replace(/\[AUTO_LANGUAGE\]/g,this._language)},e.prototype.setLanguage=function(t){this._language=t},e}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Wikibase=function(t){"use strict";function e(t,e){this._endpoint=r,t&&(this._endpoint=t),e&&(this._language=e)}var r="https://www.wikidata.org/w/api.php",i={action:"wbsearchentities",format:"json",continue:0,languages:"en",uselang:"en"},a={action:"query",meta:"siteinfo",format:"json",siprop:"languages"},n={action:"wbgetentities",props:"labels",format:"json",languages:"en",languagefallback:"1"};return e.prototype._endpoint=null,e.prototype._language=null,e.prototype.searchEntities=function(t,e,r){var a=i;return a.search=t,e&&(a.type=e),(this._language||r)&&(a.language=r||this._language,a.uselang=r||this._language),this._query(a)},e.prototype.getLanguages=function(){return this._query(a)},e.prototype.getLabels=function(t){"string"==typeof t&&(t=[t]);var e=n;return e.ids=t.join("|"),this._language&&(e.languages=this._language),this._query(e)},e.prototype._query=function(e){return t.ajax({url:this._endpoint+"?"+jQuery.param(e),dataType:"jsonp"})},e.prototype.setLanguage=function(t){this._language=t},e}(jQuery);var tracking=tracking||{};wikibase.queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Tracking=function(t){"use strict";function e(t){this._endpoint=r,t&&(this._endpoint=t)}var r="https://www.wikidata.org/beacon/statsv";return e.prototype._endpoint=null,e.prototype.track=function(t,e,r){if(e||(e=1),r||(r="c"),"query.wikidata.org"===location.hostname)return this._track(t+"="+e+r)},e.prototype._track=function(e){return t.ajax({url:this._endpoint+"?"+e,dataType:"jsonp"})},e}(jQuery),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.RdfNamespaces={},function(t,e){"use strict";e.NAMESPACE_SHORTCUTS={Wikidata:{wikibase:"http://wikiba.se/ontology#",wd:"http://www.wikidata.org/entity/",wdt:"http://www.wikidata.org/prop/direct/",wds:"http://www.wikidata.org/entity/statement/",p:"http://www.wikidata.org/prop/",wdref:"http://www.wikidata.org/reference/",wdv:"http://www.wikidata.org/value/",ps:"http://www.wikidata.org/prop/statement/",psv:"http://www.wikidata.org/prop/statement/value/",psn:"http://www.wikidata.org/prop/statement/value-normalized/",pq:"http://www.wikidata.org/prop/qualifier/",pqv:"http://www.wikidata.org/prop/qualifier/value/",pqn:"http://www.wikidata.org/prop/qualifier/value-normalized/",pr:"http://www.wikidata.org/prop/reference/",prv:"http://www.wikidata.org/prop/reference/value/",prn:"http://www.wikidata.org/prop/reference/value-normalized/",wdno:"http://www.wikidata.org/prop/novalue/",wdata:"http://www.wikidata.org/wiki/Special:EntityData/"},W3C:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",owl:"http://www.w3.org/2002/07/owl#",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",prov:"http://www.w3.org/ns/prov#"},"Social/Other":{schema:"http://schema.org/",geo:"http://www.opengis.net/ont/geosparql#",geof:"http://www.opengis.net/def/geosparql/function/"},Blazegraph:{bd:"http://www.bigdata.com/rdf#",bds:"http://www.bigdata.com/rdf/search#",gas:"http://www.bigdata.com/rdf/gas#",hint:"http://www.bigdata.com/queryHints#"}},e.ENTITY_TYPES={"http://www.wikidata.org/prop/direct/":"property","http://www.wikidata.org/prop/":"property","http://www.wikidata.org/prop/novalue/":"property","http://www.wikidata.org/prop/statement/":"property","http://www.wikidata.org/prop/statement/value/":"property","http://www.wikidata.org/prop/statement/value-normalized/":"property","http://www.wikidata.org/prop/qualifier/":"property","http://www.wikidata.org/prop/qualifier/value/":"property","http://www.wikidata.org/prop/qualifier/value-normalized/":"property","http://www.wikidata.org/prop/reference/":"property","http://www.wikidata.org/prop/reference/value/":"property","http://www.wikidata.org/prop/reference/value-normalized/":"property","http://www.wikidata.org/wiki/Special:EntityData/":"item","http://www.wikidata.org/entity/":"item"},e.ALL_PREFIXES=t.map(e.NAMESPACE_SHORTCUTS,function(t){return t}).reduce(function(e,r,i){return t.extend(e,r)},{}),e.STANDARD_PREFIXES={wd:"PREFIX wd: <http://www.wikidata.org/entity/>",wdt:"PREFIX wdt: <http://www.wikidata.org/prop/direct/>",wikibase:"PREFIX wikibase: <http://wikiba.se/ontology#>",p:"PREFIX p: <http://www.wikidata.org/prop/>",ps:"PREFIX ps: <http://www.wikidata.org/prop/statement/>",pq:"PREFIX pq: <http://www.wikidata.org/prop/qualifier/>",rdfs:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>",bd:"PREFIX bd: <http://www.bigdata.com/rdf#>"},e.getPrefixMap=function(r){var i={};return t.each(e.ALL_PREFIXES,function(t,e){r[e]&&(i[t]=r[e])}),i}}(jQuery,wikibase.queryService.RdfNamespaces),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryHelper=function(t,e,r){"use strict";function i(t,r,i){this._api=t||new e.queryService.api.Wikibase,this._selectorBox=i||new e.queryService.ui.queryHelper.SelectorBox(this._api,r),this._query=new e.queryService.ui.queryHelper.SparqlQuery}var a={"http://www.w3.org/2000/01/rdf-schema#label":!0,"http://schema.org/description":!0,"http://www.bigdata.com/queryHints#optimizer":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},n={formatNoMatches:function(){}};return i.prototype._api=null,i.prototype._selectorBox=null,i.prototype._changeListener=null,i.prototype._query=null,i.prototype._triples=[],i.prototype._isSimpleMode=!1,i.prototype._labels={filter:"Filter",show:"Show",anything:"anything",with:"with",any:"any",or:"or",subtype:"subtype"},i.prototype.setQuery=function(t){var r=e.queryService.RdfNamespaces.ALL_PREFIXES;this._query.parse(t,r),this._selectorBox.setQuery(this._query)},i.prototype.getQuery=function(){try{var t=this._query.getQueryString();return(t=this._cleanQueryPrefixes(t).trim()).trim()}catch(t){return null}},i.prototype._cleanQueryPrefixes=function(t){for(var r,i=/PREFIX ([a-z]+): <(.*)>/gi,a={},n=t.replace(i,"").replace(/\n+/g,"\n");r=i.exec(t);){var o=r[1],s=r[2].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),u=n.replace(new RegExp("<"+s+"([^/>#]+?)>","gi"),o+":$1");n!==u&&(n=u,e.queryService.RdfNamespaces.STANDARD_PREFIXES[o]||(a[r[0]]=!0))}return n=Object.keys(a).join("\n")+"\n\n"+n.trim()},i.prototype.draw=function(t){var r=e.queryService.ui.queryHelper.QueryTemplate.parse(this._query),i=this,a=this._query.getBindings();if(null!==r)try{return t.html(r.getHtml(function(t){return i._getLabel(a[t].expression)},this._selectorBox,function(t,e,r){a[t].expression=a[t].expression.replace(new RegExp(e+"$"),"")+r,i._changeListener&&i._changeListener(i)}))}catch(t){window.console.error(t)}this._triples=this._query.getTriples();for(var n=this._query.getSubQueries();n.length>0;){var o=n.pop();this._triples=this._triples.concat(o.getTriples()),n.concat(o.getSubQueries())}this._isSimpleMode=this._isSimpleQuery(),t.html(this._getHtml())},i.prototype.setChangeListener=function(t){this._changeListener=t},i.prototype._i18n=function(e){return t.i18n?t.i18n("wdqs-ve-"+e):this._labels[e]},i.prototype._getHtml=function(){var e=this,r=t("<div>"),i=t("<table>").bootstrapTable(n),a=t("<table>").bootstrapTable(n);return t.each(this._triples,function(t,r){e._isNotRelevant(r.triple)||(e._isInShowSection(r.triple)?a.append(e._getTripleHtml(r)):i.append(e._getTripleHtml(r)))}),r.append(this._createSection(i,this._createFindButton(i)),this._createSection(a,this._createShowButton(a)),this._getLimitSection())},i.prototype._getLimitSection=function(){var e=t("<div>"),r=t('<a data-type="number">').attr("href","#").text("Limit").data("value",this._query.getLimit()),i=t("<span>").text(this._query.getLimit()||""),a=this;return this._selectorBox.add(r,null,function(t){"0"===t&&(t=null),i.text(t||""),a._query.setLimit(t),a._changeListener&&a._changeListener(a)},{trash:function(){return a._query.setLimit(null),r.data("value",""),i.text(""),a._changeListener&&a._changeListener(a),!0}}),e.append(r.append(" ",i))},i.prototype._createSection=function(e,r){return t("<table>").append(t("<tr>").append(t("<td>").append(r),t("<td>").append(e)))},i.prototype._createFindButton=function(e){var r=t('<a class="btn">').text(this._i18n("filter")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new item"}).attr("data-type","item").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(t,r,a){var n="http://www.wikidata.org/entity/"+t,o=i._query.getBoundVariables().shift();o||(o="?"+r.replace(/( |[^a-z0-9])/gi,"_"));var s="http://www.wikidata.org/prop/direct/"+(a&&a[t]&&a[t].propertyId||"P31"),u=i._query.addTriple(o,s,n,!1);i._query.hasVariable(o)||i._query.addVariable(o),e.append(i._getTripleHtml(u)),i._changeListener&&i._changeListener(i)}),r},i.prototype._createShowButton=function(e){var r=t('<a class="btn">').text(this._i18n("show")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new property"}).attr("data-type","property").attr("data-auto_open",!0),i=this;return this._selectorBox.add(r,null,function(t,r){var a="http://www.wikidata.org/prop/direct/"+t,n=i._query.getBoundVariables().shift()||"?item",o="?"+r.replace(/( |[^a-z0-9])/gi,"_"),s=i._query.addTriple(n,a,o,!0);i._query.addVariable(o),e.append(i._getTripleHtml(s)),i._changeListener&&i._changeListener(i)}),r},i.prototype._isNotRelevant=function(t){return!!a[t.predicate]||!(!this._isSimpleMode||!this._isInShowSection(t)||!1!==this._query.hasVariable(t.object)||!1!==this._query.hasVariable(t.object+"Label")||!1!==this._query.isWildcardQuery())},i.prototype._isInShowSection=function(t){var e=this._query.getBindings();return!(!this._isVariable(t.subject)||!this._isVariable(t.object)||e[t.subject]||e[t.object])},i.prototype._getTripleHtml=function(e){var r=this,i=t("<tr>"),a=this._query.getBindings();return t.each(e.triple,function(n,o){if(r._isVariable(o)&&a[o]&&"string"==typeof a[o].expression&&(o=a[o].expression),r._isVariable(o)){if(r._isSimpleMode)return;return o=o.replace("?","").replace(/_/g,"_<wbr>"),void i.append(t("<td>").append(o))}o.type&&"path"===o.type?i.append(t("<td>").append(r._getTripleEntityPathHtml(o,e,n))," "):i.append(t("<td>").append(r._getTripleEntityHtml(o,e,n))," ")}),i.append(this._getTripleHtmlToolbar(i,e))},i.prototype._getTripleHtmlToolbar=function(e,i){var a=this,n=t('<a href="#">').addClass("fa fa-trash-o").click(function(){var t=r.compact(i.triple).filter(function(t){return"string"==typeof t&&t.startsWith("?")}),n=t.map(function(t){return t+"Label"});return i.remove(),e.remove(),a._query.cleanupVariables(t.concat(n)),a._changeListener&&a._changeListener(a),!1}).tooltip({title:a._i18n("remove-row-title")}),o=t('<a href="#">').addClass("fa fa-tag").click(function(){return i.triple.object.startsWith("?")?a._query.addVariable(i.triple.object+"Label"):a._query.addVariable(i.triple.subject+"Label"),a._changeListener&&a._changeListener(a),!1}).tooltip({title:a._i18n("add-label-title")});return t('<td class="toolbar">').append(o,n)},i.prototype._isVariable=function(t){return"string"==typeof t&&t.startsWith("?")},i.prototype._isSimpleQuery=function(){var e={},r=this;return t.each(this._triples,function(t,i){r._isVariable(i.triple.subject)&&!1===r._isVariable(i.triple.object)&&(e[i.triple.subject]=!0)}),Object.keys(e).length<=1},i.prototype._getTripleEntityPathHtml=function(e,r){var i=this,a=t("<span>");return t.each(e.items,function(n,o){if(o.type&&"path"===o.type)a.append(i._getTripleEntityPathHtml(o,r));else{n>0&&"/"===e.pathType&&a.append(" "+i._i18n("or")+" "+i._i18n("subtype")+" "),"*"===e.pathType&&a.append(" "+i._i18n("any")+" ");var s=e.items.reduce(function(t,e,r){return t[r]=e,t},{});s=t.extend(s,r.triple),(r=t.extend({},r)).triple=s,a.append(i._getTripleEntityHtml(o,r,n))}}),a},i.prototype._getTripleEntityHtml=function(e,r,i){var a=this,n=t("<span>");return this._getLabel(e).done(function(o,s,u,l){var p=t("<a>").text(o).attr({"data-id":s,"data-type":l,href:"#"}).appendTo(n);n.tooltip({title:"("+s+") "+u}),t(n).on("show.bs.tooltip",function(){t(".tooltip").is(":visible")&&t(".tooltip").not(this).hide()}),a._selectorBox.add(p,r.triple,function(t){var o=e.replace(new RegExp(s+"$"),"")+t;n.replaceWith(a._getTripleEntityHtml(o,r,i)),a._isVariable(r.triple[i])?a._query.getBindings()[r.triple[i]].expression=o:r.triple[i]=o,a._changeListener&&a._changeListener(a)})}).fail(function(){n.text(e)}),n},i.prototype._getLabel=function(e){var r=t.Deferred(),i=e.match(/(Q|P)([0-9]+)/);if(!i)return r.reject().promise();var a={P:"property",Q:"item"};a=a[i[1]];var n=i[0];return this._api.searchEntities(n,a).done(function(e){t.each(e.search,function(t,e){return r.resolve(e.label,e.id,e.description,a),!1})}),r.promise()},i}(jQuery,wikibase,_),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SparqlQuery=function(t,e,r){"use strict";function i(t){this._query=t}return i.prototype._query=null,i.prototype._queryComments=null,i.prototype.parse=function(e,i){var a=new r.Parser(i),n=[];this._query=a.parse(e),t.each(e.split("\n"),function(t,e){0===e.indexOf("#")&&n.push(e)}),this._queryComments=n},i.prototype.getQueryString=function(){try{var t=(new r.Generator).stringify(this._query),e=this._queryComments.join("\n").trim();return""!==e?e+"\n"+t:t}catch(t){return null}},i.prototype.getLimit=function(){return this._query.limit||null},i.prototype.setLimit=function(t){return t?this._query.limit=t:delete this._query.limit,this},i.prototype.hasVariable=function(t){return 0!==this._query.variables.length&&this._query.variables.indexOf(t)>=0},i.prototype.isWildcardQuery=function(){return!(!this._query.variables||"*"!==this._query.variables[0])},i.prototype.addVariable=function(t){return t&&t.startsWith("?")?this._query.variables.indexOf(t)>=0?this:this.isWildcardQuery()?this:(this._query.variables.push(t),this):this},i.prototype.removeVariable=function(t){if(t.startsWith("?")&&!this.isWildcardQuery()){var e=this._query.variables.indexOf(t);e>=0&&this._query.variables.splice(e,1),0===this._query.variables.length&&this._query.variables.push("*")}},i.prototype.cleanupVariables=function(t){var e=this,r=this.getTripleVariables();this._query.variables.filter(function(e){return(!t||-1!==t.indexOf(e))&&-1===r.indexOf(e)}).map(function(t){e.removeVariable(t)})},i.prototype.getTriples=function(e,r){var i=[];e||(e=this._query.where),r||(r=!1);var a=this;return t.each(e,function(t,e){e.type&&"bgp"===e.type&&(i=i.concat(a._createTriples(e.triples,r))),e.type&&"optional"===e.type&&(i=i.concat(a.getTriples(e.patterns,!0))),e.type&&"union"===e.type&&(i=i.concat(a.getTriples(e.patterns,!1)))}),i},i.prototype.getBindings=function(){var e={};return t.each(this._query.where,function(t,r){r.type&&"bind"===r.type&&(e[r.variable]=r)}),e},i.prototype._createTriples=function(e,r){var i=this,a=[];return t.each(e,function(t,n){a.push({optional:r,query:i,triple:n,remove:function(){e.splice(t,1)}})}),a},i.prototype.getSubQueries=function(){var e=[];return t.each(this._query.where,function(t,r){r.queryType&&e.push(new i(r))}),e},i.prototype.addTriple=function(t,e,r,i){var a={type:"bgp",triples:[{subject:t,predicate:e,object:r}]};if(i){var n={type:"optional",patterns:[a]};this._query.where.push(n)}else this._query.where.push(a);return this._createTriples(a.triples,i)[0]},i.prototype.getTripleVariables=function(){var e={};return t.each(this.getTriples(),function(t,r){"string"==typeof r.triple.subject&&r.triple.subject.startsWith("?")&&(e[r.triple.subject]=!0),"string"==typeof r.triple.predicate&&r.triple.predicate.startsWith("?")&&(e[r.triple.predicate]=!0),"string"==typeof r.triple.object&&r.triple.object.startsWith("?")&&(e[r.triple.object]=!0)}),Object.keys(e)},i.prototype.getBoundVariables=function(){var e={};return t.each(this.getTriples(),function(t,r){r.triple.subject.startsWith("?")&&!r.triple.object.startsWith("?")&&(e[r.triple.subject]=!0),!r.triple.subject.startsWith("?")&&r.triple.object.startsWith("?")&&(e[r.triple.object]=!0)}),Object.keys(e)},i.prototype.getServices=function(){var e=[];return t.each(this._query.where,function(t,r){r&&"service"===r.type&&e.push(r)}),e},i.prototype.removeService=function(e){var r=this;return t.each(this._query.where,function(t,i){"service"===i.type&&i.name===e&&delete r._query.where[t]}),this},i.prototype.getCommentContent=function(t){var e,r;for(e=0;e<this._queryComments.length;e++)if((r=this._queryComments[e]).startsWith("#"+t))return r.substring(1+t.length);return null},i.prototype.clone=function(){var t=new i;return t.parse(this.getQueryString()),t},i}(jQuery,0,sparqljs),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SelectorBox=function(t,e){"use strict";function r(t,r){this._api=t||new e.queryService.api.Wikibase,this._sparqlApi=r||new e.queryService.api.Sparql}var i={item:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i <{PROPERTY_URI}> ?id. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t}\t\t\t\t\tLIMIT 100',genericSuggest:function(){if(0===this._query.getTriples().length)return'SELECT ?id ?label ?description WHERE {\t\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100';var t=this._query.getBoundVariables().shift(),e=this._query.clone().setLimit(1e3).removeService("http://wikiba.se/ontology#label").addVariable(t).getQueryString(),r=e.match(/.*\bPREFIX\b(.*)/gi).join("\n");return e=e.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\t\tSELECT ?id ?label ?description ?property WITH {\n\t\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\t\tSELECT ?value ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t\t?statement ?ps ?value.\n\t\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p; wikibase:statementProperty ?ps.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tGROUP BY ?value ?property\n\t\t\t\t\t\t\tHAVING(isIRI(?value) && STRSTARTS(STR(?value), STR(wd:Q)))\n\t\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t\t} AS %values WHERE {\n\t\t\t\t\t\t\tINCLUDE %values.\n\t\t\t\t\t\t\tBIND(?value AS ?id).\n\t\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",e).replace("{VARIABLE}",t).replace("{PREFIXES}",r)},search:null,instanceOf:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t{\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t\t}\t\t\t\t\tLIMIT 100'},property:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t{\t\t\t\t\t\tSELECT DISTINCT ?id WHERE {\t\t\t\t\t\t?i ?prop <{ITEM_URI}>.\t\t\t\t\t\t?id ?x ?prop.\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100\t\t\t\t\t}\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}\t\t\t\tLIMIT 100',genericSuggest:function(){if(0===this._query.getTriples().length)return'SELECT ?id ?label ?description WITH {\t\t\t\t\tSELECT ?pred (COUNT(?value) AS ?count) WHERE\t\t\t\t\t{\t\t\t\t\t?subj ?pred ?value .\t\t\t\t\t} GROUP BY ?pred ORDER BY DESC(?count) LIMIT 1000\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id wikibase:claim ?pred.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100';var t=this._query.getBoundVariables().shift(),e=this._query.clone().setLimit(500).removeService("http://wikiba.se/ontology#label").addVariable(t).getQueryString(),r=e.match(/.*\bPREFIX\b(.*)/gi).join("\n");return e=e.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\tSELECT ?id ?label ?description WITH {\n\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t}\n\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\tSELECT ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p.\n\t\t\t\t\t\t}\n\t\t\t\t\t\tGROUP BY ?property\n\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t} AS %properties WHERE {\n\t\t\t\t\t\tINCLUDE %properties.\n\t\t\t\t\t\tBIND(?property AS ?id).\n\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",e).replace("{VARIABLE}",t).replace("{PREFIXES}",r)},search:null,seeAlso:'SELECT ?id ?label ?description WHERE {\t\t\t\t\tBIND( <{PROPERTY_URI}> as ?prop).\t\t\t\t\t?props ?x  ?prop.\t\t\t\t\t?props rdf:type wikibase:Property.\t\t\t\t\t?props wdt:P1659 ?id.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}'},sparql:{search:'SELECT ?id ?label ?description WITH {\t\t\t\t\t{SPARQL}\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\tFILTER(STRSTARTS(LCASE(?label), LCASE("{TERM}")))\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100',suggest:'SELECT ?id ?label ?description WITH {\t\t\t\t{SPARQL}\t\t\t\t} AS %inner\t\t\tWHERE {\t\t\t\tINCLUDE %inner\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t} ORDER BY DESC(?count)\t\t\tLIMIT 100'}};return r.prototype._api=null,r.prototype._sparqlApi=null,r.prototype._query=null,r.prototype.setQuery=function(t){this._query=t},r.prototype.add=function(t,e,r,i){switch(t.data("type").toLowerCase()){case"number":this._createInput(t,r,i);break;default:this._createSelect(t,e,r,i)}},r.prototype._createInput=function(e,r,i){var a=t("<input>").attr("type",e.data("type")),n=this._getCloseButton(),o=this._getToolbar(i,e),s=t("<div>").append(n," ",a," ",o);e.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return s}}).click(function(t){a.val(e.data("value")||"")}),a.on("keyup mouseup",function(){r&&r(a.val())})},r.prototype._createSelect=function(e,r,i,a){var n=this,o=this._getSelectBox(e),s=this._getCloseButton(),u=this._getToolbar(a,e),l=t("<div>").append(s," ",o," ",u);0!==e.children().length?(e.clickover({placement:"bottom",global_close:!1,html:!0,content:function(){return l}}).click(function(i){return o.toggleClass("open"),o.data("select2")||t.proxy(n._renderSelect2(o,e,r),n),o.hasClass("open")&&e.data("auto_open")&&o.data("select2").open(),!1}),o.change(function(r){i&&i(o.val(),o.find("option:selected").text(),t(r.target).data("options")),e.click(),o.html("")})):this._createSelectInline(e,r,i)},r.prototype._createSelectInline=function(e,r,i){var a=this._getSelectBox(e);e.replaceWith(a),this._renderSelect2(a,e,r),a.change(function(e){i&&i(a.val(),a.find("option:selected").text(),t(e.target).data("options"))})},r.prototype._getSelectBox=function(e){var r=e.data("id"),i=e.text(),a=t("<select>");return r&&a.append(t("<option>").attr("value",r).text(i)),a},r.prototype._getCloseButton=function(){return t('<a href="#" data-dismiss="clickover">').append('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>')},r.prototype._getToolbar=function(e,r){var i=t("<span>");return t.each(e,function(e,a){var n=t("<a>").attr("href","#");n.prepend('<span class="glyphicon glyphicon-'+e+'" aria-hidden="true"></span>'," "),n.click(function(){return a()&&r.click(),!1}),i.append(n," ")}),i},r.prototype._createLookupService=function(e,r){var i=this,a=e.data("type"),n=e.data("sparql");return function(e,o,s){t.when(i._searchEntitiesSparql(e.data.term,a,r,n),i._searchEntities(e.data.term,a)).done(function(t,e){t.length>0&&(t=[{text:i._i18n("suggestions","Suggestions"),children:t}]),e.length>0&&t.length>0&&(e=[{text:i._i18n("other","Other"),children:e}]),o({results:t.concat(e)})})}},r.prototype._getSparqlTemplate=function(t,e,r,i){var a=this._getSparqlTemplateDefinition(t,e,r,i),n="function"==typeof a?a.apply(this):a;return i&&(n=n.replace("{SPARQL}",i)),n},r.prototype._getSparqlTemplateDefinition=function(t,e,r,a){if(a)return t?i.sparql.search:i.sparql.suggest;var n=i[e];if(t&&""!==t.trim())return r?n.search:null;if("property"===e){if(!r)return n.genericSuggest;if(0===r.object.indexOf("?"))return n.seeAlso}else if(!r)return n.genericSuggest;return n.suggest},r.prototype._searchEntitiesSparqlCreateQuery=function(e,r,i,a){function n(t){return"string"==typeof t?t:n(t.items[0])}var o=this._getSparqlTemplate(e,r,i,a);return o&&(i&&(o=o.replace("{PROPERTY_URI}",n(i.predicate)).replace("{ITEM_URI}",i.object)),e&&(o=o.replace("{TERM}",e)),o=o.replace(/\{LANGUAGE\}/g,t.i18n&&t.i18n().locale||"en")),o},r.prototype._searchEntitiesSparql=function(e,r,i,a){var n=t.Deferred(),o=this._searchEntitiesSparqlCreateQuery(e,r,i,a);return o?(this._sparqlApi.query(o,4e3).done(function(t){var e=t.results.bindings.map(function(t){var e=t.id.value.split("/").pop(),r=t.property&&t.property.value.split("/").pop()||null;return{id:e,text:t.label.value,data:{id:e,propertyId:r,description:t.description&&t.description.value||""}}});n.resolve(e)}).always(function(){n.resolve([])}),n.promise()):n.resolve([]).promise()},r.prototype._searchEntities=function(e,r){var i=t.Deferred();return e&&""!==e.trim()?(this._api.searchEntities(e,r).done(function(t){var e=t.search.map(function(t){return{id:t.id,text:t.label,data:t}});i.resolve(e)}),i.promise()):i.resolve([]).promise()},r.prototype._renderSelect2=function(e,r,i){var a={},n=this._createLookupService(r,i);e.select2({width:"auto",templateResult:function(r,i){return r.data?(a[r.data.id]={text:r.text,propertyId:r.data.propertyId},e.attr("data-options",JSON.stringify(a)),t("<span><b>"+r.text+" ("+r.data.id+")</b></span><br/><small>"+r.data.description+"</small>")):r.text},ajax:{delay:250,transport:n},cache:!0})},r.prototype._i18n=function(e,r){return t.i18n?t.i18n("wdqs-ve-sb-"+e):r},r}(jQuery,wikibase),(wikibase=wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryTemplate=function(t,e){"use strict";function r(){}return r.prototype._definition={},r.prototype._template=null,r.prototype._variables=[],r.parse=function(t){var e,i,a=t.getCommentContent("TEMPLATE=");if(!a)return null;try{e=JSON.parse(a)}catch(t){return null}return i=new r,i._definition=e,i._fragments=r._getQueryTemplateFragments(e),i},r._getQueryTemplateFragments=function(t){if(t.template.match(/\0/))throw new Error("query template must not contain null bytes");var e,r,i=[t.template];for(e in t.variables){if(!e.match(/\?[a-z][a-z0-9]*/i))throw new Error("invalid variable name in query template");r=[],i.forEach(function(t){var i=t.replace(new RegExp("\\"+e,"g"),"\0").split("\0");r.push(i[0]);for(var a=1;a<i.length;a++)r.push(e),r.push(i[a])}),i=r}return i},r._buildTemplate=function(e,r){var i=t("<span>");i.append(document.createTextNode(e[0]));for(var a=1;a<e.length;a+=2){var n=e[a],o=t("<span>").text(n);n in r||(r[n]=[]),r[n].push(o),i.append(o),i.append(document.createTextNode(e[a+1]))}return i},r.prototype.getHtml=function(e,i,a){if(null!==this._template)return this._template;this._template=r._buildTemplate(this._fragments,this._variables);var n=this;return t.each(this._definition.variables,function(r,o){e(r).done(function(e,s,u,l){t.each(n._variables[r],function(u,p){p.text("");var c=t("<a>").text(e).attr({"data-id":s,"data-type":l,href:"#"}).appendTo(p);o.query&&c.attr("data-sparql",o.query),i.add(c,null,function(t,e){for(var i in n._variables[r])n._variables[r][i].find('a[data-id="'+s+'"]').attr("data-id",t).text(e),a(r,s,t),s=t})})})}),this._template},r}(jQuery);