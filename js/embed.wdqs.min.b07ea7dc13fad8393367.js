{{var CONFIG=function(i,r){"use strict";var t,a,e={language:((n=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage)&&"string"==typeof n?n.split("-").shift():null)||"en",i18nLoad:function(e){var t=null;return e!==this.language&&(t=r.i18n().load("i18n",this.language)),r.when(t,r.i18n().load("i18n",e))}},n=i.location.hostname.toLowerCase(),o=(""!==n&&"localhost"!==n&&"127.0.0.1"!==n||(e.i18nLoad=function(e){return r.when(r.i18n().load("i18n",e),r.i18n().load("node_modules/jquery.uls/i18n",e))}),r.Deferred());function s(){return r.extend(!0,{},e,t,a)}function l(e){void 0!==(t=e)&&void 0!==a&&o.resolve(s())}function u(e){a=e,void 0!==t&&void 0!==a&&o.resolve(s())}return{getConfig:function(){return"resolved"!==o.state()&&(r.getJSON("./default-config.json").done(l).fail(function(e,t,r){i.console.error("Failed loading default-config.json: "+r),o.reject("Failed loading default-config.json: "+r)}),r.getJSON("./custom-config.json").done(u).fail(function(e,t,r){404===e.status||"file:"===location.protocol&&0===e.status?u({}):(i.console.error("Failed loading custom-config.json: "+r),o.reject("Failed loading custom-config.json: "+r))})),o.promise()},reset:function(){o=r.Deferred(),a=t=void 0}}}(window,jQuery),wikibase=window.wikibase||{},wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.VariableNames={},!function(e){"use strict";var t="A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�",r=t+"0-9_",i=r+"·̀-ͯ‿⁀",a=(e.VariablePattern="\\?["+r+"]["+i+"]*",e.PrefixPattern="["+t+"](?:["+i+".-]*["+i+"-])?",new RegExp("[^"+i+"]","g"));e.makeVariableName=function(e){return"?"+e.replace(a,"_")},e.ValidCharacters=i}((jQuery,wikibase.queryService.VariableNames)),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.i18n=wikibase.queryService.ui.i18n||{},wikibase.queryService.ui.i18n.getMessage=function(a){"use strict";return function(t,e,r){var i=null;if(a.i18n)try{if((i=a.i18n.apply(a,[t].concat(r||[])))!==t)return i}catch(e){window.console.warn('$.i18n( "'+t+'" ) threw error, invalid translation?'),window.console.warn(e)}return i=e,r&&a.each(r,function(e,t){i=i.replace(new RegExp("\\$"+(e+1),"g"),t)}),i}}(jQuery),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.dialog=wikibase.queryService.ui.dialog||{},wikibase.queryService.ui.dialog.QueryExampleDialog=function(p){"use strict";function e(e,t,r,i,a,n){this._$element=e,this._querySamplesApi=t,this._callback=r,this._wikibaseApi=i,this._queryBuilderUrl=a,this._previewUrl=n||"embed.html#",this._init()}return e.prototype._querySamplesApi=null,e.prototype._wikibaseApi=null,e.prototype._callback=null,e.prototype._previewUrl=null,e.prototype._examples=null,e.prototype._trackingApi=null,e.prototype._init=function(){this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._wikibaseApi||(this._wikibaseApi=new wikibase.queryService.api.Wikibase,this._wikibaseApi.setLanguage(this._querySamplesApi.getLanguage())),this._initFilter(),this._initExamples();var e=p("<span>").attr("data-i18n","[html]wdqs-app-query-builder-example-banner-content").addClass("wdqs-app-query-builder-banner-content").html("You can create queries without having to write SPARQL in the <a>Query Builder</a>"),t=(new wikibase.queryService.ui.Banner("queryBuilderExampleDialog",function(e){e.css("margin-top","15px"),p(e).insertAfter(".exampleTable")},function(){p(".navbar").css("border-top-width","")},!0,e),this);this._$element.focus(function(){t._$element.find(".tableFilter").focus()})},e.prototype._initFilter=function(){var e=this;this._$element.find(".tableFilter").keyup(p.proxy(this._filterTable,this)),this._$element.find(".tagFilter").tags({afterAddingTag:p.proxy(this._filterTable,this),afterDeletingTag:function(){e._filterTable(),e._drawTagCloud(!0)}})},e.prototype._initExamples=function(){var r=this,i=null;this._querySamplesApi.getExamples().then(function(e){r._examples=e,r._initTagCloud(),r._updateExamplesCount(e.length),p.each(e,function(e,t){t.category!==i&&(i=t.category,r._$element.find(".searchable").append(p("<tr>").addClass("active").append(p('<td colspan="4">').text(i)))),r._addExample(t.title,t.query,t.href,t.tags,i)})})},e.prototype._initTagCloud=function(){var e=this,t=window.setInterval(function(){e._$element.is(":visible")&&(e._drawTagCloud(),clearInterval(t))},300)},e.prototype._drawTagCloud=function(r){var i=this,a=[];this._getCloudTags().then(function(e){var t=p(".tagCloud");p.each(e,function(e,t){var r=t.label+" ("+t.id+")";a.push({text:r,weight:t.weight,link:"#",html:{title:"("+t.weight+")","data-id":t.id},handlers:{click:function(e){return i._$element.find(".tagFilter").tags().addTag(p(this).text()),i._drawTagCloud(!0),!1}}})}),r?t.jQCloud("update",a):t.jQCloud(a,{delayedMode:!0,autoResize:!0})})},e.prototype._getCloudTags=function(){var i=this._$element.find(".tagFilter").tags().getTags(),a={};return p.each(this._examples,function(e,t){var r;r=t.tags,i.every(function(e){return-1!==r.indexOf(e.match(/\((.*)\)/)[1])})&&p.each(t.tags,function(e,t){var r;r=t,-1===i.map(function(e){return e.match(/\((.*)\)/)[1]}).indexOf(r)&&(a[t]?a[t].weight++:a[t]={id:t,weight:1})})}),a=_.compact(a).sort(function(e,t){return t.weight-e.weight}).slice(0,50),this._wikibaseApi.getLabels(a.map(function(e){return e.id})).then(function(t){return a.forEach(function(e){e.label=_.compact(t.entities[e.id].labels)[0].value}),a})},e.prototype._addExample=function(t,r,e,i,a){var n=this,o="#"+encodeURIComponent(r),o=p('<a title="Select">').text(t).attr("href",o).click(function(e){e.ctrlKey||e.metaKey||e.shiftKey||(e.preventDefault(),n._$element.modal("hide"),n._callback(r,t),n._track("select"),n._track("select.category."+a.replace(/[^a-zA-Z0-9]/g,"_")))}),e=p("<a>").attr({title:"Edit",href:e,target:"_blank"}).append("<span>").addClass("glyphicon glyphicon-pencil").click(function(){n._track("edit")}),s=p("<span>").addClass("glyphicon glyphicon-eye-open").popover({placement:"bottom",trigger:"hover",container:"body",title:wikibase.queryService.ui.i18n.getMessage("wdqs-dialog-examples-preview-query","Preview query"),content:p('<pre style="white-space:pre-line; word-break:normal;"/>').text(r),html:!0,sanitize:!1}),l=p('<a href="#">').addClass("glyphicon glyphicon-camera").clickover({placement:"left",global_close:!0,esc_close:!0,trigger:"click",container:"body",title:wikibase.queryService.ui.i18n.getMessage("wdqs-dialog-examples-preview-result","Preview result"),content:p('<iframe width="400" height="350" frameBorder="0" src="'+n._previewUrl+encodeURIComponent(r)+'">'),html:!0,sanitize:!1}).click(function(){n._track("preview")}),u=(p(".exampleTable").scroll(function(){l.clickover&&l.clickover("hide").removeAttr("data-clickover-open")}),p("<tr>"));u.append(p("<td>").append(o).append(" ",e)),u.append(p("<td>").addClass("exampleIcons").append(l)),u.append(p("<td>").addClass("exampleIcons").append(s)),u.append(p("<td>").text(i.join("|")).hide()),u.append(p("<td>").text(r).hide()),this._$element.find(".searchable").append(u)},e.prototype._filterTable=function(){var e=this._$element.find(".tableFilter"),t=new RegExp(e.val(),"i"),a=this._$element.find(".tagFilter").tags().getTags(),e=(this._$element.find(".searchable tr").hide(),this._$element.find(".searchable tr").filter(function(){return t.test(p(this).text())&&(r=p(this).text(),i=!0,r=r.toLowerCase(),p.each(a,function(e,t){-1===r.indexOf(t.toLowerCase().match(/\((.*)\)/)[1])&&(i=!1)}),i);var r,i}));e.show(),e.each(function(e,t){p(t).prevAll("tr.active").first().show()}),this._updateExamplesCount(e.length)},e.prototype._updateExamplesCount=function(e){this._$element.find(".count").text(e)},e.prototype._track=function(e,t,r){this._trackingApi.track("wikibase.queryService.ui.examples."+e,t,r)},e}(jQuery),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.ResultView=function(o,s,l){"use strict";function e(e,t,r,i,a,n,o){this._sparqlApi=e,this._querySamplesApi=t,this._wikibaseApi=r,this._codeSamplesApi=i,this._shorten=a,this._editor=n||null,this._queryBuilderUrl=o,this._init()}return e.prototype._query=null,e.prototype._sparqlQuery=null,e.prototype._sparqlApi=null,e.prototype._querySamplesApi=null,e.prototype._wikibaseApi=null,e.prototype._codeSamplesApi=null,e.prototype._editor=null,e.prototype._shorten=null,e.prototype._selectedResultBrowser=null,e.prototype._actionBar=null,e.prototype._trackingApi=null,e.prototype._hasRunFirstQuery=!1,e.prototype._queryBuilderUrl=null,e.prototype._resultBrowsers={Table:{icon:"glyphicon-th-list",label:["wdqs-app-resultbrowser-table","Table"],class:"TableResultBrowser",object:null,$element:null},ImageGrid:{icon:"glyphicon-picture",label:["wdqs-app-resultbrowser-image-grid","Image grid"],class:"ImageResultBrowser",object:null,$element:null},Polestar:{icon:"fa-certificate",label:["wdqs-app-resultbrowser-graph-builder","Graph builder"],class:"PolestarResultBrowser",object:null,$element:null},Map:{icon:"glyphicon-map-marker",label:["wdqs-app-resultbrowser-map","Map"],class:"CoordinateResultBrowser",object:null,$element:null},LineChart:{icon:"fa-line-chart",label:["wdqs-app-resultbrowser-line-chart","Line chart"],class:"LineChartResultBrowser",object:null,$element:null,supportsSvgDownload:!0},BarChart:{icon:"fa-bar-chart",label:["wdqs-app-resultbrowser-bar-chart","Bar chart"],class:"BarChartResultBrowser",object:null,$element:null,supportsSvgDownload:!0},ScatterChart:{icon:"fa-braille",label:["wdqs-app-resultbrowser-scatter-chart","Scatter chart"],class:"ScatterChartResultBrowser",object:null,$element:null,supportsSvgDownload:!0},AreaChart:{icon:"fa-area-chart",label:["wdqs-app-resultbrowser-area-chart","Area chart"],class:"AreaChartResultBrowser",object:null,$element:null,supportsSvgDownload:!0},BubbleChart:{icon:"glyphicon-tint",label:["wdqs-app-resultbrowser-bubble-chart","Bubble chart"],class:"BubbleChartResultBrowser",object:null,$element:null,supportsSvgDownload:!0},TreeMap:{icon:"glyphicon-th",label:["wdqs-app-resultbrowser-tree-map","Tree map"],class:"TreeMapResultBrowser",object:null,$element:null},Tree:{icon:"fa-tree",label:["wdqs-app-resultbrowser-tree","Tree"],class:"TreeResultBrowser",object:null,$element:null},Timeline:{icon:"glyphicon-calendar",label:["wdqs-app-resultbrowser-timeline","Timeline"],class:"TimelineResultBrowser",object:null,$element:null},Dimensions:{icon:"glyphicon-random",label:["wdqs-app-resultbrowser-dimensions","Dimensions"],class:"MultiDimensionResultBrowser",object:null,$element:null,supportsSvgDownload:!0},Graph:{icon:"glyphicon-retweet",label:["wdqs-app-resultbrowser-graph","Graph"],class:"GraphResultBrowser",object:null,$element:null}},e.prototype.trackingNamespace="wikibase.queryService.ui.index.",e.prototype._init=function(){this._trackingApi||(this._trackingApi=new wikibase.queryService.api.Tracking),this._actionBar=new wikibase.queryService.ui.toolbar.Actionbar(o(".action-bar")),this._sparqlQuery=this._query=new wikibase.queryService.ui.queryHelper.SparqlQuery,this._internationalizeCharts(),this._initResultBrowserMenu(),this._initExamples(),this._initCodeExamples(),this._initQueryLinkPopover(),this._initHandlersDownloads()},e.prototype._internationalizeCharts=function(){o.each(this._resultBrowsers,function(e,t){var r=t.label[0],i=t.label[1];t.label=wikibase.queryService.ui.i18n.getMessage(r,i)})},e.prototype._initResultBrowserMenu=function(){o.each(this._resultBrowsers,function(e,t){var r=o('<li class="result-browser-item"><a class="result-browser" href="#"><span class="toolbar-label">'+t.label+' </span><span class="toolbar-icon '+t.icon.split("-",1)[0]+" "+t.icon+'"></span></a></li>');r.appendTo(o("#result-browser-menu")),t.$element=r})},e.prototype.draw=function(e){var t=this,r=o.Deferred();return this._query=e,this._actionBar.show("wdqs-action-query","","info",100),o("#query-result").empty().hide(),o(".result").hide(),o("#query-error").hide(),this._sparqlApi.query(e).done(function(){t._handleQueryResult(),r.resolve()}).fail(function(){var e=t._handleQueryError();r.reject(e)}),r.promise()},e.prototype.drawPreview=function(e){var t=this,r=o.Deferred(),i=wikibase.queryService.RdfNamespaces.ALL_PREFIXES,a=this._sparqlQuery.getQueryString();return this._query=e,this._sparqlQuery.parse(e,i),this._sparqlQuery.setLimit(20),(a===this._sparqlQuery.getQueryString()?r.reject():(o("#query-result").empty().hide(),o(".result").hide(),o("#query-error").hide(),this._actionBar.hide(),this._sparqlApi.query(this._sparqlQuery.getQueryString(),1e3).done(function(){t._handleQueryResult(),r.resolve(),l.setTimeout(function(){t._actionBar.show("wdqs-action-preview","","default")},200)}).fail(function(){r.reject()}),r)).promise()},e.prototype._handleQueryError=function(){o("#execute-button").prop("disabled",!1);var e=this._sparqlApi.getError(),t=null,r=this._sparqlApi.ERROR_CODES;switch(e.code){case r.TIMEOUT:t="wdqs-action-timeout";break;case r.MALFORMED:t="wdqs-action-malformed-query";break;case r.SERVER:t="wdqs-action-server-error";break;default:t="wdqs-action-unknow-error"}return e.debug&&o("#query-error").html(o("<pre>").text(e.debug)).show(),this._actionBar.show(t||"",e.message||"","danger"),this._track("result.error."+(t||"unknown")),void 0===e.debug?"":e.debug},e.prototype._handleQueryResult=function(){var e=this._sparqlApi,t=(o("#response-summary").text(wikibase.queryService.ui.i18n.getMessage("wdqs-app-resultbrowser-response-summary","$1 results in $2&nbsp;ms",[e.getResultLength(),e.getExecutionTime()]).replace(/&nbsp;/g," ")),o(".result").show(),o("#execute-button").prop("disabled",!1),e.getQueryUri()),t=(o(".queryUri").attr("href",t),o(".rawGraphsUri").attr("href","http://wikidata.rawgraphs.io/?url="+t),this._createResultBrowsers(e.getResultRawData()));return this._drawResult(t),this._selectedResultBrowser=null,this._track("result.resultLength",e.getResultLength()),this._track("result.executionTime",e.getExecutionTime(),"ms"),this._track("result.received.success"),!1},e.prototype._createResultBrowsers=function(r){var e,i=this,a=this._getBrowserOptions(),n=null;return null!==a.defaultName?this._track("result.browser."+a.defaultName):this._track("result.browser.default"),o.each(this._resultBrowsers,function(e,t){var r=new wikibase.queryService.ui.resultBrowser[t.class];r.setSparqlApi(i._sparqlApi),a.defaultName===e&&(i._setSelectedDisplayType(t),i._setSvgDownloadVisibility(t),n=r),a.optionsMap.has(e)&&(e=new wikibase.queryService.ui.resultBrowser.helper.Options(a.optionsMap.get(e)),r.setOptions(e)),t.object=r}),null===n&&(e=this._resultBrowsers.Table,this._setSelectedDisplayType(e),this._setSvgDownloadVisibility(e),n=e.object),n.resetVisitors(),o.each(this._resultBrowsers,function(e,t){n.addVisitor(t.object),t.object.setResult(r)}),n},e.prototype._getBrowserOptions=function(){for(var e,t=null,r=new Map,i=/#(defaultView|view):(\w+)(\{.*\})?/g;null!==(e=i.exec(this._query));){var a=e[2];if(this._resultBrowsers.hasOwnProperty(a)&&("defaultView"===e[1]&&(t=a),e[3])){var n=r.has(a)?r.get(a):{};try{r.set(a,o.extend(n,JSON.parse(e[3])))}catch(e){l.console.error(e)}}}return{defaultName:t,optionsMap:r}},e.prototype._initExamples=function(){var r=this;new wikibase.queryService.ui.dialog.QueryExampleDialog(o("#QueryExamples"),this._querySamplesApi,function(e,t){e&&e.trim()&&(r._editor?(r._editor.setValue("#"+t+"\n"+e),o("#QueryExamples").one("hidden.bs.modal",function(){setTimeout(function(){r._editor.focus()},0)})):(r.draw(e),l.location.hash="#"+encodeURIComponent("#"+t+"\n"+e)))},this._wikibaseApi,this._queryBuilderUrl)},e.prototype._initCodeExamples=function(){var e=this;e._codeSamplesApi&&new wikibase.queryService.ui.dialog.CodeExample(o("#CodeExamples"),function(){return e._codeSamplesApi.getExamples(e._query)})},e.prototype._initQueryLinkPopover=function(){var t=this,e={placement:"left",global_close:!0,html:!0,sanitize:!1};o(".shortUrlTrigger.result").clickover(o.extend({content:function(){var e=t._editor?"#"+encodeURIComponent(t._editor.getValue()):l.location.hash,e=o("<a>").attr("href","embed.html"+e);return t._shorten.shorten(e[0].href)}},e)).click(function(){t._track("buttonClick.shortUrlResult")}),o("#shortUrlTrigger-result-query").clickover(o.extend({content:function(){var e="#"+encodeURIComponent(t._query),e=o("<a>").attr("href","index.html"+e);return t._shorten.shorten(e[0].href)}},e)).click(function(){t._track("buttonClick.shortUrlResultQuery")})},e.prototype._initHandlersDownloads=function(){var e,t=this._sparqlApi,r={CSV:{handler:o.proxy(t.getResultAsCsv,t),mimetype:"text/csv;charset=utf-8"},JSON:{handler:o.proxy(t.getResultAsJson,t),mimetype:"application/json;charset=utf-8"},TSV:{handler:o.proxy(t.getSparqlTsv,t),mimetype:"text/tab-separated-values;charset=utf-8"},"Simple TSV":{handler:o.proxy(t.getSimpleTsv,t),mimetype:"text/tab-separated-values;charset=utf-8",ext:"tsv"},"Full JSON":{handler:o.proxy(t.getResultAsAllJson,t),mimetype:"application/json;charset=utf-8",ext:"json"},HTML:{handler:o.proxy(t.getResultHTML,t),mimetype:"application/html;charset=utf-8",ext:"html"},SVG:{handler:function(){var e=o("#query-result svg");if(!e.length)return null;e.attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"});try{return'<?xml version="1.0" encoding="utf-8"?>\n'+e[0].outerHTML}catch(e){return null}},mimetype:"data:image/svg+xml;charset=utf-8",ext:"svg"}},a=this;for(e in r){var i=r[e].ext||e.toLowerCase(),n=e.replace(/\s/g,"-");o("#download"+n).click(function(t,r,i){return function(e){e.preventDefault(),a._track("buttonClick.download."+t);e=r();e?s(e,t,i):(l.console.warn("Unable to create "+t+" download"),a._track("buttonClick.downloadError."+t))}}("query."+i,r[e].handler,r[e].mimetype))}},e.prototype._handleQueryResultBrowsers=function(){var r=this;o.each(this._resultBrowsers,function(e,t){t.$element.off("click"),t.object.isDrawable()?(t.$element.removeClass("result-browser-inactive"),t.$element.css("opacity",1).attr("href","#"),t.$element.click(function(){return o(this).closest(".open").removeClass("open"),r._setSelectedDisplayType(t),r._setSvgDownloadVisibility(t),o("#query-result").html(""),r._drawResult(t.object),r._selectedResultBrowser=e,r._track("buttonClick.display."+e),!1})):(t.$element.addClass("result-browser-inactive"),t.$element.css("opacity",.5).removeAttr("href"))})},e.prototype._drawErrorResult=function(t){var e=_.find(this._resultBrowsers,function(e){if(e.object===t)return e});this._resultBrowsers.Table.object.draw(o("#query-result")),this._actionBar.show("wdqs-action-error-display",e&&e.label||null,"warning")},e.prototype._drawResult=function(t){var r=this;o(l).off("scroll.resultBrowser"),o(l).off("resize.resultBrowser"),this._actionBar.show("wdqs-action-render","","success",100),l.setTimeout(function(){try{o("#query-result").show(),MathJax.startup.output.clearCache(),t.draw(o("#query-result")),o("#MJX-CHTML-styles").replaceWith(MathJax.chtmlStylesheet()),r._actionBar.hide();var e=r._query.match(/#title:(.*)/);e&&e[1]&&r._actionBar.show(e[1],"")}catch(e){r._drawErrorResult(t),l.console.error(e)}r._handleQueryResultBrowsers()},20)},e.prototype._setSelectedDisplayType=function(e){o("#display-button-icon").attr("class",e.icon.split("-",1)[0]+" "+e.icon),o("#display-button-label").text(e.label)},e.prototype._setSvgDownloadVisibility=function(e){var t=o("#downloadSVG").parent("li");(t=t.add(t.prev("li.divider"))).toggle(!!e.supportsSvgDownload)},e.prototype._track=function(e,t,r){var i=this._getReferrerType();this._trackingApi.track(this.trackingNamespace+"app."+e,t,r),this._trackingApi.track(this.trackingNamespace+"referrer."+i+".app."+e,t,r)},e.prototype._getReferrerType=function(){return document.referrer?document.referrer.startsWith(this._queryBuilderUrl)?"query-builder":"other-referrer":"no-referrer"},e}(jQuery,download,window),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.FormatterHelper=function(o,t){"use strict";var r="http://commons.wikimedia.org/wiki/special:filepath/",s="http://www.w3.org/2001/XMLSchema#dateTime",l="http://www.w3.org/2001/XMLSchema#string",i=["http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#positiveInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger"];function e(e){this._options=e||new wikibase.queryService.ui.resultBrowser.helper.Options({})}e.initMoment=function(){t.updateLocale("en",{longDateFormat:{LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"}})},e.prototype.getOptions=function(){return this._options},e.prototype.setOptions=function(e){this._options=e},e.prototype.formatRow=function(r,i){var a=this,n=o("<div/>");return o.each(r,function(e,t){a._isLabelField(e,r)||a._isHiddenField(e)||(t=o.extend({label:a._getLabel(r,e)},t),n.prepend(o("<div>").append(a.formatValue(t,e,i))))}),n},e.prototype._isLabelField=function(e,t){return e.endsWith("Label")&&void 0!==t[e.slice(0,-5)]},e.prototype._isHiddenField=function(e){return-1!==this.getOptions().getColumnNames("hide",[]).indexOf(e)},e.prototype._getLabel=function(e,t){e=e[t+"Label"];return e&&e.value||null},e.prototype.formatValue=function(e,t,r){var i=e.value,a=o("<span>");if(t=t||e.dataType||"",!e.type)return o("<span>").text(i).attr("title",t);switch(e.datatype||e.type){case"uri":if(/^javascript:/.test(i))return e=o.extend({},e,{datatype:l}),this.formatValue(e,t,r);var n=o("<a>").attr({title:t,href:i,target:"_blank",class:"item-link",rel:"noopener"});a.append(n),this.isCommonsResource(i)?(n.attr("href",this.getCommonsResourceFullUrl(i)),n.attr("title",t+": commons:"+this.getCommonsResourceFileName(i)),r?(n.click(this.handleCommonResourceItem),n.append(o("<img>").attr("src",this.getCommonsResourceThumbnailUrl(i,"120"))).width("120")):(n.attr({href:"https://commons.wikimedia.org/wiki/File:{FILENAME}".replace(/{FILENAME}/g,this.getCommonsResourceFileName(i))}),n.text("commons:"+decodeURIComponent(this.getCommonsResourceFileName(i))),a.prepend(this.createGalleryButton(i,t)," "))):(n.text(e.label||this.abbreviateUri(i)),this.isEntityUri(i)&&a.prepend(this.createExploreButton(i)," "));break;case s:t=t||wikibase.queryService.ui.i18n.getMessage("wdqs-app-result-formatter-title-datetime","Raw ISO timestamp");n=o("<span>").text(this._formatDate(i));n.attr("title",t+": "+i),a.append(n);break;case"http://www.w3.org/1998/Math/MathML":try{a.append(MathJax.mathml2chtml(i.replace(/caligraphic/g,"calligraphic")));break}catch(e){window.console.error("Invalid MathML",e)}default:n=o("<span>").text(i);e["xml:lang"]?n.attr("title",t+": "+i+"@"+e["xml:lang"]):n.attr("title",t+": "+i),a.append(n)}return a},e.prototype._formatDate=function(e){var t=!1,e=e.replace(/^(?:-\d+|\+?0+\b)/,function(e){return t=!0,Math.abs(e)+1}),r=this.parseDate(e);return e=r.isValid()?r.format("LL"):(r=e.replace(/^\+?(\d+).*/,"$1"),"0000".slice(r.length)+r),t&&(e+=" BCE"),e},e.prototype.parseDate=function(e){return e=(e=(e=e.replace(/^(?![+-])/,"+")).replace(/^([+-]?)(\d{1,5}\b)/,function(e,t,r){return t+("00000"+r).slice(-6)})).replace(/Z$/,""),t(e,t.ISO_8601)},e.prototype.isEntityUri=function(e){return"string"==typeof e&&/\/entity\/(Q|P|L|M)[0-9]+$/.test(e)},e.prototype.createExploreButton=function(e){e=o("<a>").attr({href:e,title:"Explore item",class:"explore glyphicon glyphicon-search",tabindex:"-1","aria-hidden":"true"});return e.click(o.proxy(this.handleExploreItem,this)),e},e.prototype.isCommonsResource=function(e){return e.toLowerCase().startsWith(r.toLowerCase())},e.prototype.getCommonsResourceFileName=function(e){var t=new RegExp(r,"ig");return decodeURIComponent(e.replace(t,""))},e.prototype.getCommonsResourceFullUrl=function(e){return this.isCommonsResource(e)?e.replace(/^http:/,"https:"):e},e.prototype.getCommonsResourceThumbnailUrl=function(e,t){return this.isCommonsResource(e)?e.replace(/^http:/,"https:")+"?width="+(t||400):e},e.prototype.createGalleryButton=function(e,t){var r=this.getCommonsResourceFileName(e),e=this.getCommonsResourceThumbnailUrl(e,900),e=o("<a>").attr({title:"Show Gallery",href:e,"aria-hidden":"true",class:"gallery glyphicon glyphicon-picture","data-gallery":"G_"+t,"data-title":decodeURIComponent(r)});return e.click(this.handleCommonResourceItem),e},e.prototype.abbreviateUri=function(e){var t,r,i=wikibase.queryService.RdfNamespaces.ALL_PREFIXES,a=0;for(t in i)0===e.indexOf(i[t])&&i[t].length>a&&(a=i[t].length,r=t);return r?r+":"+e.substr(a):"<"+e+">"};var a=100;return e.prototype.handleExploreItem=function(e){var t=o("#explorer-dialogs .explorer-dialog").clone(),r=o(e.target).attr("href"),i=t.dialog({uiLibrary:"bootstrap",autoOpen:!1,maxWidth:window.innerWidth,maxHeight:window.innerHeight,minHeight:220,minWidth:220,resizable:!0,width:window.innerWidth/2,height:Math.min(window.innerWidth,window.innerHeight)/2,drag:function(e){i.children("div.explorer-body").css("visibility","hidden"),o("body").addClass("disable-selection"),i.mousemove(function(e){e.pageY<30&&i.css("top","10px")})},dragStop:function(e){i.children("div.explorer-body").css("visibility","visible"),o("body").removeClass("disable-selection")},resize:function(e){i.children("div.explorer-body").css("visibility","hidden"),o("body").addClass("disable-selection")},resizeStop:function(e){i.children("div.explorer-body").css("visibility","visible"),o("body").removeClass("disable-selection")}}),t=(e.preventDefault(),o.i18n&&o.i18n().locale||"en"),e="embed.html#"+encodeURIComponent("#defaultView:Graph\n"+("SELECT ?item ?itemLabel WHERE { BIND( <"+r+'> as ?item ).\tSERVICE wikibase:label { bd:serviceParam wikibase:language "'+t+'" } }')),r=o(window).scrollTop()+200;return i.children("div.explorer-body").html(o('<iframe frameBorder="0" scrolling="no"></iframe>').attr("src",e)),i.css("left",a),i.css("top",r),i.open(),a+=10,!1},e.prototype.handleCommonResourceItem=function(e){e.preventDefault(),o(this).ekkoLightbox({scale_height:!0})},e.prototype.isLabel=function(e){return!!e&&("xml:lang"in e||"literal"===e.type&&(!e.datatype||e.datatype===l))},e.prototype.isNumber=function(e){return e&&e.datatype&&-1!==i.indexOf(e.datatype)},e.prototype.isDateTime=function(e){return e&&e.datatype===s},e.prototype.isEntity=function(e){return e&&e.value&&this.isEntityUri(e.value)},e.prototype.isColor=function(e){return e&&"literal"===e.type&&e.value&&/^([\dA-F]{1,2}){3}$/i.test(e.value)},e.prototype.getColorForHtml=function(e){return"#"+e.value},e.prototype.calculateLuminance=function(e){var t=parseInt(e.substr(1,2),16)/255,r=parseInt(e.substr(3,2),16)/255,e=parseInt(e.substr(5,2),16)/255;return isFinite(t)&&isFinite(r)&&isFinite(e)?.2126*(t<=.04045?t/12.92:Math.pow((.055+t)/1.055,2.4))+.7152*(r<=.04045?r/12.92:Math.pow((.055+r)/1.055,2.4))+.0722*(e<=.04045?e/12.92:Math.pow((.055+e)/1.055,2.4)):NaN},e.prototype._options=null,e}(jQuery,moment),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.helper=wikibase.queryService.ui.resultBrowser.helper||{},wikibase.queryService.ui.resultBrowser.helper.Options=function(){"use strict";function e(e){if("object"!=typeof e)throw new Error("options must be an object");this._options=e}return e.prototype._options=null,e.prototype._requireTwoArguments=function(e){if(2!==e.length)throw new Error("must be called with exactly two arguments")},e.prototype.get=function(e,t){return this._requireTwoArguments(arguments),e in this._options?this._options[e]:t},e.prototype.getArray=function(e,t){this._requireTwoArguments(arguments);e=this.get(e,t);return Array.isArray(e)?e:[e]},e.prototype.getColumnNames=function(e,t){return this._requireTwoArguments(arguments),this.getArray(e,t).filter(function(e){return!("string"!=typeof e||!e.startsWith("?"))||(window.console.warn("column name "+e+" is not a variable name, ignoring"),!1)}).map(function(e){return e.substring(1)})},e}(jQuery),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractResultBrowser=function(e,t){"use strict";function r(){this._visitors=[]}return r.prototype._formatter=null,r.prototype._result=null,r.prototype._options=null,r.prototype._visitors=null,r.prototype._drawable=!1,r.prototype._sparqlApi=null,r.prototype.setResult=function(e){this._result=e},r.prototype.setOptions=function(e){this._options=e,this._getFormatter().setOptions(e)},r.prototype.getOptions=function(){return this._options||new t.queryService.ui.resultBrowser.helper.Options({})},r.prototype.setSparqlApi=function(e){this._sparqlApi=e},r.prototype.getSparqlApi=function(){return this._sparqlApi},r.prototype._iterateResult=function(n){var o=this;e.each(this._result.results.bindings,function(i,a){e.each(o._result.head.vars,function(e,t){var r=a[t]||null;o.processVisitors(r,t),n(r,t,a,i)})})},r.prototype.isDrawable=function(){return this._drawable},r.prototype.draw=function(e){jQuery.error("Method draw() needs to be implemented!")},r.prototype.addVisitor=function(e){this._visitors.push(e)},r.prototype.resetVisitors=function(){this._visitors=[]},r.prototype.processVisitors=function(r,i){var a={};0!==this._visitors.length&&(e.each(this._visitors,function(e,t){t.visit&&"function"==typeof t.visit&&!1===t.visit(r,i)&&(a[e]=!0)}),this._visitors=this._visitors.filter(function(e,t){return!a[t]}))},r.prototype.visit=function(e){return!1},r.prototype.setFormatter=function(e){this._formatter=e},r.prototype._getFormatter=function(){return null===this._formatter&&(this._formatter=new t.queryService.ui.resultBrowser.helper.FormatterHelper),this._formatter},r}(jQuery,wikibase),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser=function(){"use strict";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._getLabelColumns=function(){var t=this,r=t._getRows()[0];return t._getColumns().filter(function(e){return t._getFormatter().isLabel(r[e])})},e.prototype._getNumberColumns=function(){var r=this,e=r._getRows();return r._getColumns().filter(function(t){return e.some(function(e){return e[t]&&r._getFormatter().isNumber(e[t])})})},e.prototype._getColumns=function(){return this._result.head.vars},e.prototype._getRows=function(){return this._result.results.bindings},e}((jQuery,window)),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser=function(l,i,n,r,o){"use strict";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._dataColumns=null,e.prototype._data=null,e.prototype._$element=null,e.prototype._svg=null,e.prototype._chart=null,e.prototype._chartLegend=null,e.prototype._chartSeriesKey=null,e.prototype._chartStoryKey=null,e.prototype._isStoryPaused=!1,e.prototype.draw=function(e){var t=this;this._$element=l("<div>").css({width:"100%",height:"98vh"}),e.html(this._$element),this._createData(),this._drawSvg(),this._createChart(),this._drawChart(),this._createLegendFilter(),r.onresize=function(){t._drawChart(250,!0)}},e.prototype._createData=function(){var i=[],a={},n=null;this._iterateResult(function(e,t,r){r!==(n=null===n?r:n)&&(n=r,i.push(a),a={}),e&&e.value&&(a[t]=e.value)}),i.push(a),this._data=i},e.prototype._drawSvg=function(){this._svg=o.newSvg(this._$element[0],"100%","100%")},e.prototype._createChart=function(){this._chart=new o.chart(this._svg,this._data),this._chart.setBounds(0,0,"100%","100%"),this._chart.setMargins("5%","5%","2%","25%"),this._createChartAxis();var e=this._chart.addSeries(this._chartSeriesKey,this._getPlotType());e.addOrderRule(this._chartSeriesKey),e.lineMarkers=!0,this._chartStoryKey&&this._createChartStory(),this._chartLegend=this._chart.addLegend("1%","85%","100%","15%")},e.prototype._getPlotType=function(){jQuery.error("Method _getPlotType() needs to be implemented!")},e.prototype._createChartAxis=function(){var r=this,i=this._getRows()[0],a=this._getFormatter(),n=this._chart,o=["y","x"],s=!1;l.each(this._getColumns(),function(e,t){if(0===o.length){if(a.isLabel(i[t])){if(!r._chartSeriesKey)return void(r._chartSeriesKey=t);if(!r._chartStoryKey)return r._chartStoryKey=t,!1}}else a.isLabel(i[t])&&(n.addCategoryAxis(o.pop(),t),s=!0),a.isNumber(i[t])&&n.addMeasureAxis(o.pop(),t),a.isDateTime(i[t])&&(n.addTimeAxis(o.pop(),t,"%Y-%m-%dT%H:%M:%SZ","%m-%d-%Y"),s=!0)}),s||this._chartSeriesKey||!n.axes[0]||(this._chartSeriesKey=n.axes[0].measure)},e.prototype._createChartStory=function(){var e=this,t=this._chart.setStoryboard(this._chartStoryKey);t.frameDuration=5e3,this._$element.click(function(){e._isStoryPaused?(t.startAnimation(),e._isStoryPaused=!1):(t.pauseAnimation(),e._isStoryPaused=!0)})},e.prototype._createLegendFilter=function(){var e=this,a=o.getUniqueValues(this._data,this._chartSeriesKey);this._chart.legends=[],this._chartLegend.shapes.selectAll("rect").on("click",function(t){var r=!1,i=[];a.forEach(function(e){e===t.aggField.slice(-1)[0]?r=!0:i.push(e)}),n.select(this).style("opacity",r?.2:.8),r||i.push(t.aggField.slice(-1)[0]),a=i,e._chart.data=o.filterData(e._data,e._chartSeriesKey,a),e._drawChart(800)})},e.prototype._drawChart=function(e,t){var r=this;this._chart.draw(e,t),i.delay(function(){r._svg.selectAll(".dimple-marker,.dimple-marker-back").attr("r",2)},1.2*e)},e.prototype.isDrawable=function(){return 2<=Object.keys(this._dataColumns).length},e.prototype.visit=function(e,t){return this._checkColumn(e,t)},e.prototype._checkColumn=function(e,t){return this._getFormatter().isLabel(e)&&(this._dataColumns[t]=!0),this._getFormatter().isNumber(e)&&(this._dataColumns[t]=!0),this._getFormatter().isDateTime(e)&&(this._dataColumns[t]=!0),!this.isDrawable()},e}(jQuery,_,d3,window,dimple),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.ImageResultBrowser=function(s,t){"use strict";function e(){this._queue=[]}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._grid=null,e.prototype._loading=s("#loading-spinner"),e.prototype._heightThreshold=400,e.prototype._widthThreshold=70,e.prototype._fixedItemWidth=0,e.prototype._totalWidth=0,e.prototype._lineHeight=0,e.prototype._queue=null,e.prototype.draw=function(e){var i=this;this._queue.splice(0,this._queue.length),this._grid=s('<div class="img-grid">').html('<div class="item-row hidden-row">'),e.html(this._grid),this._lineHeight=1.5*parseFloat(this._grid.css("font-size")),this._iterateResult(function(e,t,r){e&&i._isCommonsResource(e.value)&&(r.url=e.value,i._queue.push(r))}),this._fixedItemWidth=this._calculateBaseWidth(),this._gridWidth=this._grid.width(),this._lazyLoad()},e.prototype._calculateBaseWidth=function(){var t=0,r=s('<div class="item hidden">');return this._grid.append(r),["margin-left","margin-right","padding-left","padding-right"].forEach(function(e){t+=parseFloat(r.css(e))}),r.remove(),t},e.prototype._lazyLoad=function(){var e=this;s(window).off("scroll.resultBrowser"),s(window).off("resize.resultBrowser"),this._queue.length?this._getPosFromTop()<3*window.innerHeight?(this._loading.show(),this._loadNextChunk().done(function(){e._lazyLoad.call(e)})):(s(window).on("scroll.resultBrowser",s.proxy(t.debounce(e._lazyLoad,100),e)),this._loading.hide()):(this._showFinalRow(),this._loading.hide()),s(window).on("resize.resultBrowser",s.proxy(t.debounce(this._layoutPage,100),e))},e.prototype._showFinalRow=function(e){var t=s(".item-row").last(),r=t.find(".item"),i={height:0,widths:[]};t.children().length?(i.height=this._heightThreshold,i.widths=r.map(function(){return s(this).data("aspectRatio")*(i.height-s(this).data("fixedHeight"))}).toArray(),this._setDimensions(t,i,e)):t.remove()},e.prototype._loadNextChunk=function(){var r=this,e=this._queue.splice(0,8),i=[s.when()];return e.forEach(function(e,t){t=i[t],e=s.when(r._preloadItem(e),t);i.push(e),e.done(function(e){r._appendItem(e)})}),i[e.length]},e.prototype._getPosFromTop=function(){return s(".item-row").last().offset().top-s(window).scrollTop()},e.prototype._calculateDimensions=function(e){var e=e.find(".item"),t=this._fixedItemWidth*e.length,t=this._gridWidth-t,r=0,i=0,a={height:0,widths:[]};return e.each(function(){var e=s(this).data("aspectRatio"),t=s(this).data("fixedHeight");r+=e,i+=e*t}),a.height=(t+i)/r,a.widths=e.map(function(){var e=s(this).data("aspectRatio")*(a.height-s(this).data("fixedHeight"));return Math.trunc(100*e)/100}).toArray(),a},e.prototype._layoutPage=function(){var e=s(".item");this._gridWidth=this._grid.width(),s(".item").unwrap(),this._grid.append(s('<div class="item-row hidden-row">')),e.each(s.proxy(function(e,t){this._appendItem(t,!0)},this)),(this._queue.length?s(".hidden-row").not(".hidden-row:last"):(this._showFinalRow(!0),s(".hidden-row"))).removeClass("hidden-row")},e.prototype._appendItem=function(e,t){var r=s(".item-row").last();r.append(e),this._layOutRow(r,t)},e.prototype._preloadItem=function(e){var t=this,r=s.Deferred(),i=this._getThumbnail(e.url,1024),a=this._getFormatter().getCommonsResourceFileName(i),n=this._getItem(this._getThumbnail(i),this._getThumbnail(i,1024),a,e),a=this._lineHeight*n.find(".summary")[0].childElementCount,o=n.find(".item-img");return o[0].onerror=function(){o.attr("src","https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg")},o[0].onload=function(){var e=this.naturalWidth/this.naturalHeight;r.resolveWith(t,n.data("aspectRatio",e))},n.data("fixedHeight",a),o.attr("src",i),r.promise()},e.prototype._layOutRow=function(e,t){var r=this._calculateDimensions(e);(r.height<this._heightThreshold||Math.min(r.widths)<this._widthThreshold)&&(this._setDimensions(e,r,t),this._grid.append(s('<div class="item-row hidden-row">')))},e.prototype._setDimensions=function(e,t,r){e.find(".item").width(function(e){return t.widths[e]}),r||e.removeClass("hidden-row")},e.prototype._getItem=function(e,t,r,i){t=s("<a>").click(this._getFormatter().handleCommonResourceItem).attr({href:t,"data-gallery":"g","data-title":r}).append(s('<img class="item-img" >')),r=this._getFormatter().formatRow(i).addClass("summary");return s('<div class="item">').append(t,r)},e.prototype._isCommonsResource=function(e){return this._getFormatter().isCommonsResource(e)},e.prototype._getThumbnail=function(e,t){return this._getFormatter().getCommonsResourceThumbnailUrl(e,t)},e.prototype.visit=function(e){return this._checkImage(e)},e.prototype._checkImage=function(e){return!(e&&e.value&&this._isCommonsResource(e.value))||!(this._drawable=!0)},e}(jQuery,_),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TableResultBrowser=function(i,n){"use strict";function e(){}var o=[10,50,100,200,500,1e3];return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._columns=null,e.prototype._rows=null,e.prototype._$selectedCell={},e.prototype._selectedCellHighlighted=!1,e.prototype._tableNumber=!1,e.prototype._pageLoading=!0,e.prototype._sorter={string:function(e,t){return e.localeCompare(t)},number:function(e,t){return t<=e?-1:1},generic:function(e,t){var r;return t?e?(r=this._getFormatter()).isNumber(e)&&r.isNumber(t)?this._sorter.number(Number(e.value),Number(t.value)):r.isEntityUri(e.value)&&r.isEntityUri(t.value)?this._sorter.number(Number(e.value.replace(/[^0-9]/gi,"")),Number(t.value.replace(/[^0-9]/gi,""))):this._sorter.string(e.value,t.value):-1:1}},e.prototype.draw=function(e){var t,r=this._result;void 0!==r.boolean?((t=i("<table>").attr("class","table")).append("<tr><td>"+r.boolean+"</td></tr>").addClass("boolean"),e.html(t)):(this.columns=r.head.vars,this.rows=r.results.bindings,t=i("<table/>"),e.html(t),this.drawBootstrapTable(t),t.children().width()>i(n).width()&&t.bootstrapTable("toggleView"))},e.prototype.drawBootstrapTable=function(r){var a=this,e=200<this.rows.length,t=(jQuery.fn.bootstrapTable.columnDefaults.formatter=function(e,t,r){return e?(a.processVisitors(e,this.field),a._getFormatter().formatValue(e).html()):""},{"click .explore":i.proxy(this._getFormatter().handleExploreItem,this),"click .gallery":this._getFormatter().handleCommonResourceItem});r.bootstrapTable({columns:this.columns.map(function(e){return{title:e,field:e,events:t,sortable:!0,sorter:i.proxy(a._sorter.generic,a)}}),data:this.rows,mobileResponsive:!0,search:e,pagination:e,showPaginationSwitch:e,pageSize:200,pageList:o,keyEvents:!1,cookie:!0,cookieIdTable:"1",cookieExpire:"1y",cookiesEnabled:["bs.table.pageList"],onResetView:function(e,t){void 0===n._currentTableNumber&&(n._currentTableNumber=0),n._currentTableNumber++,a._tableNumber=n._currentTableNumber,a._selectedCellHighlighted=!1,a._pageLoading=!1,a.selectFirstCell(r),i("button:focus").blur()},onClickCell:function(e,t,r,i){a._selectedCellHighlighted=!0,a.selectCell(i)}}),i(document).keydown(function(e){a.keyPressed(e)}),i("#result-browser-menu a").on("click",function(){void 0===n._currentTableNumber&&(n._currentTableNumber=0),n._currentTableNumber++})},e.prototype.selectFirstCell=function(e){e=e.find("td").first();this.selectCell(e)},e.prototype.selectCell=function(e){!0!==this._selectedCellHighlighted?this._$selectedCell=e:e.length&&(i(".table-cell-selected").removeClass("table-cell-selected"),this._$selectedCell=e,this._$selectedCell.parent().hasClass("no-records-found")||this._$selectedCell.addClass("table-cell-selected"))},e.prototype.scrollToCell=function(e){e=e.offset().top;i("html, body").scrollTop(e-n.innerHeight/3)},e.prototype.keyPressed=function(e){if(n._currentTableNumber===this._tableNumber&&!i(document.activeElement).is("textarea, input, button")&&0!==this._$selectedCell.length)if(!0!==this._selectedCellHighlighted)"ArrowLeft"!==e.key&&"ArrowUp"!==e.key&&"ArrowRight"!==e.key&&"ArrowDown"!==e.key||(this._selectedCellHighlighted=!0,this.selectCell(this._$selectedCell),this.scrollToCell(this._$selectedCell)),e.stopImmediatePropagation();else{if((e.ctrlKey||e.metaKey)&&("c"===e.key||"C"===e.key))return""!==n.getSelection().toString()?void 0:(this.copyToClipboard(this._$selectedCell),void e.stopImmediatePropagation());if(!(e.ctrlKey||e.metaKey||e.altKey)){switch(e.key){case"Enter":this._$selectedCell.find("a").each(function(){return!i(this).text().trim().length||(n.open(i(this).prop("href")),!1)});break;case"ArrowLeft":0===this._$selectedCell.prev().length?!1===this._pageLoading&&(this._pageLoading=!0,i(".page-pre a").click()):this.selectCell(this._$selectedCell.prev());break;case"ArrowUp":this._$selectedCell.parent().prev().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")").length&&(this.selectCell(this._$selectedCell.parent().prev().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")")),this.scrollToCell(this._$selectedCell));break;case"ArrowRight":0===this._$selectedCell.next().length?!1===this._pageLoading&&(this._pageLoading=!0,i(".page-next a").click()):this.selectCell(this._$selectedCell.next());break;case"ArrowDown":this._$selectedCell.parent().next().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")").length&&(this.selectCell(this._$selectedCell.parent().next().children("td:nth-child("+(this._$selectedCell.index()+1).toString()+")")),this.scrollToCell(this._$selectedCell))}e.stopImmediatePropagation()}}},e.prototype.copyToClipboard=function(e){var t=i("<input>");i("body").append(t),t.val(e.text().trim()).select(),document.execCommand("copy"),t.remove()},e.prototype.isDrawable=function(){return!0},e.prototype.visit=function(e){return!1},e}(jQuery,window),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.CoordinateResultBrowser=function(l,u,e,o,t,r){"use strict";var i=["http://www.opengis.net/ont/geosparql#wktLiteral","http://www.openlinksw.com/schemas/virtrdf#Geometry"],a="http://www.opengis.net/def/crs/OGC/1.3/CRS84",n=["http://www.wikidata.org/entity/Q2",a],s=["?layerLabel","?layer"],p="_LAYER_DEFAULT_GROUP",c={url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png",options:{id:"wikipedia-map-01",attribution:' <a href="https://maps.wikimedia.org/">Wikimedia</a> | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},d={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},h=null;function y(){this._markerGroupColors={};var t=e.scale.category10();this._getMarkerGroupColor=function(e){return e in this._markerGroupColors?this._markerGroupColors[e]:t(e)},h=u.Control.extend({options:{position:"topright"},onAdd:function(e){var t=u.DomUtil.create("button");return l(t).addClass("btn btn-default wdqs-control-scroll-top"),l(t).append(l(' <span class="glyphicon glyphicon-chevron-up"/> ')),t.onclick=function(){e.isFullscreen()&&e.toggleFullscreen(),l(r).scrollTop(0,0)},t}})}return(y.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser)._map=null,y.prototype._markerGroups=null,y.prototype._markerGroupsProgress=null,y.prototype._markerGroupColors=null,y.prototype._getMarkerGroupColor=null,y.prototype.draw=function(r){var e,i=this,a=l("<div>").attr("id","map").height("100vh");function n(){clearInterval(e),l("#map-progress").remove()}function t(){n();var e=o.compact(i._markerGroups),t=i._getMarkerClusterOptions(e.length);t&&((t=u.markerClusterGroup(t)).addLayers(e),e=[t]),i._map=u.map("map",{center:[0,0],maxZoom:18,minZoom:2,fullscreenControl:!0,preferCanvas:!0,layers:e}).fitBounds(i._markerGroups[p].getBounds()),i._setTileLayer(),i._createControls(),i._createMarkerZoomResize(),r.html(a)}r.html(a),e=setInterval(function(){var e;0<i._markerGroupsProgress&&i._markerGroupsProgress<1?(e=(100*i._markerGroupsProgress).toFixed(2),e=wikibase.queryService.ui.i18n.getMessage("wdqs-result-map-progress","Loading map data: $1%",[e]),a.html(l("<div>").attr("id","map-progress").css({position:"relative",top:"20%",width:"100%",textAlign:"center"}).text(e))):1<=i._markerGroupsProgress&&n()},200),this._createMarkerGroups().done(t).fail(t)},y.prototype._createControls=function(){var i=this;this._map.addControl(u.control.zoomBox({modal:!1,className:"glyphicon glyphicon-zoom-in"})),this._map.addControl(new h);var e;1<Object.keys(this._markerGroups).length&&(e=this._getLayerControl(this._markerGroups).addTo(this._map),this._map.on("overlayadd overlayremove",function(r){r.layer===i._markerGroups[p]&&(l.each(i._markerGroups,function(e,t){"overlayadd"===r.type?i._map.addLayer(t):i._map.removeLayer(t)}),e._update())})),u.control.locate().addTo(this._map);new u.Control.MiniMap(new u.TileLayer(c.url,c.url.options),{zoomLevelOffset:-7,toggleDisplay:!0}).addTo(this._map)},y.prototype._createMarkerZoomResize=function(){var e=this;1e3<this._markerGroups[p].getLayers().length||this._map.on("zoomend",function(){e._markerGroups[p].setStyle({radius:e._getMarkerRadius()})})},y.prototype._getMarkerRadius=function(){return this._map?.5*this._map.getZoom():3},y.prototype._getLayerControl=function(){var r=this,i={},a="";return l.each(this._markerGroups,function(e,t){a=e===p?wikibase.queryService.ui.i18n.getMessage("wdqs-result-map-layers-all","All layers"):'<span style="color:'+r._getMarkerGroupColor(e)+'">&#x2b24;</span> '+e,i[a]=t}),u.control.layers(null,i)},y.prototype._createMarkerGroups=function(){var a=this,n=[],o=0,s={};function e(){var e;if(0===Object.keys(s).length)return e=u.marker([0,0]).bindPopup("Nothing found!").openPopup(),{null:u.featureGroup([e])};a._markerGroups={},l.each(s,function(e){a._markerGroups[e]=u.featureGroup(s[e])})}return s[p]=[],this._iterateResult(function(e,t,r){e=a._extractGeoJson(e);null!==e&&n.push(l.when(e,r))}),l.each(n,function(e,t){t.done(function(e,i){o++,a._markerGroupsProgress=o/n.length;var r=a._getMarkerGroupsLayer(i),e=(s[r]||(s[r]=[]),u.geoJson(e,{style:a._getMarkerStyle(r,i),pointToLayer:function(e,t){return u.circleMarker(t,a._getMarkerStyle(r,i))},onEachFeature:function(e,t){var r=u.popup();t.bindPopup(r),t.on("click",function(){var e=a._getItemDescription(i);r.setContent(e[0])}),t.once("click",function(){r.getElement().querySelector(".leaflet-popup-close-button").addEventListener("click",function(){event.preventDefault()})})}}));s[r].push(e),s[p].push(e)})}),l.when.apply(l,n).done(e).fail(e)},y.prototype._getMarkerGroupsLayer=function(t){var e=this.getOptions().getColumnNames("layer",s).find(function(e){return t[e]});return e?t[e].value:p},y.prototype._getMarkerStyle=function(e,t){var r,i=this._getFormatter();return"rgb"in t&&i.isColor(t.rgb)?(r=i.getColorForHtml(t.rgb),this._markerGroupColors[e]=r):r=e!==p?this._getMarkerGroupColor(e):"#e04545",{color:r,opacity:.8,fillColor:r,fillOpacity:.9,radius:this._getMarkerRadius()}},y.prototype._getMarkerIcon=function(e){var e=e.getAllChildMarkers()[0].options,t=2*(1+e.radius),e='<div style="background-color: '+e.color+"; border-radius: 100%; width: "+t+"px; height: "+t+'px"></div>';return new u.DivIcon({html:e,className:"",iconSize:new u.Point(t,t)})},y.prototype._getMarkerClusterOptions=function(e){e=this.getOptions().get("markercluster",1===e);return!!e&&(!0===e?{maxClusterRadius:0,iconCreateFunction:this._getMarkerIcon}:l.extend({},e))},y.prototype._splitWktLiteral=function(e){e=e.match(/(<([^>]*)> +)?(.*)/);return e?{crs:e[2]||a,wkt:e[3]}:null},y.prototype._isWktLiteral=function(e){return e&&"literal"===e.type&&-1!==i.indexOf(e.datatype)},y.prototype._isCommonsMap=function(e){return e&&"uri"===e.type&&e.value.startsWith("http://commons.wikimedia.org/data/main/")&&e.value.endsWith(".map")},y.prototype._extractGeoJson=function(e){return this._isWktLiteral(e)?this._extractGeoJsonWktLiteral(e.value):this._isCommonsMap(e)?this._extractGeoJsonCommonsMap(e.value):null},y.prototype._extractGeoJsonWktLiteral=function(e){e=this._splitWktLiteral(e);return!e||-1===n.indexOf(e.crs)?null:l.when(t.parse(e.wkt))},y.prototype._extractGeoJsonCommonsMap=function(e){e=e.match(/^http:\/\/commons.wikimedia.org\/data\/main\/(.*)$/)[1],e=(e=decodeURIComponent(e)).replace(/\+/g," ");return l.getJSON("https://commons.wikimedia.org/w/api.php",{format:"json",action:"query",titles:e,prop:"revisions",rvprop:"content",origin:"*",maxage:3600}).then(function(e){var t,r;for(t in e.query.pages)return r=e.query.pages[t].revisions[0]["*"],JSON.parse(r).data}).promise()},y.prototype._getItemDescription=function(e){return l("<div/>").append(this._getFormatter().formatRow(e,!0))},y.prototype._setTileLayer=function(){var e=d;"query.wikidata.org"!==r.location.host&&"localhost"!==r.location.host&&!r.location.host.endsWith(".wmflabs.org")||(e=c),u.tileLayer(e.url,e.options).addTo(this._map)},y.prototype.visit=function(e){return this._checkCoordinate(e)},y.prototype._checkCoordinate=function(e){return!this._isWktLiteral(e)&&!this._isCommonsMap(e)||!(this._drawable=!0)},y}(jQuery,L,d3,_,wellknown,window),window.wikibase||{}),wikibase=(wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeMapResultBrowser=function(m,f,b){"use strict";function e(){this._labelColumns={}}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._labelColumns=null,e.prototype.draw=function(e){var i=this,a={},n=a,o=null,s=null,l=null,t=(this._iterateResult(function(e,t,r){r!==l&&(null!==l&&(n.data={size:o,url:s},s=o=null,n=a),l=r),i._getFormatter().isLabel(e)&&(n[e.value]||(n[e.value]={}),n=n[e.value]),i._getFormatter().isNumber(e)&&(o=e.value),e&&e.value&&i._getFormatter().isEntityUri(e.value)&&(s=e.value)}),n.data={size:o,url:s},this._createTreeData(a));this._draw(e,{name:"treeMap",children:t})},e.prototype._createTreeData=function(e){var i,a=this,n=[];return e.data||m.each(e,function(e,t){var r=a._createTreeData(t);i=0!==r.length?{id:e,name:e,children:r}:(r=1,t.data.size&&0<t.data.size&&(r=t.data.size),{id:((t=t.data.url)?t:e)+Math.random(),name:e,size:r,url:t}),n.push(i)}),n},e.prototype._draw=function(e,t){var r,n=m(b).width(),o=m(b).height(),s=f.scale.linear().range([0,n]),l=f.scale.linear().range([0,o]),u=f.scale.category10(),p="#555555",c=f.layout.treemap().round(!1).size([n,o]).sticky(!0).value(function(e){return e.size}),d=f.select(e[0]).append("svg:svg").attr("width",n).attr("height",o).append("svg:g"),h=r=t,e=c.nodes(r),t=e.filter(function(e){return!e.children}),e=e.filter(function(e){return e.children}),e=d.selectAll("g.cell.parent").data(e,function(e){return"p-"+e.id}),i=e.enter().append("g").attr("class","cell parent").on("click",function(e){g(e)}),i=(i.append("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",20).style("fill",p),i.append("foreignObject").attr("class","foreignObject").append("xhtml:body").attr("class","labelbody").append("div").attr("class","label"),e.transition().duration(500)),i=(i.select(".cell").attr("transform",function(e){return"translate("+e.dx+","+e.y+")"}),i.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",20).style("fill",p),i.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",20).select(".labelbody .label").text(function(e){return e.name}),e.exit().remove(),d.selectAll("g.cell.child").data(t,function(e){return"c-"+e.id})),e=i.enter().append("g").attr("class","cell child").on("click",function(e){g(h===e.parent?r:e.parent)}),t=(e.append("rect").classed("background",!0).style("fill",function(e){return u(e.parent.name)}),e.append("foreignObject").attr({class:"foreignObject",width:function(e){return Math.max(.01,e.dx)},height:function(e){return Math.max(.01,e.dy)}}).append("xhtml:body").attr("class","labelbody").append("div").attr("class","label").text(function(e){return e.name}).on("click",function(e){e.url&&(b.open(e.url,"_blank"),f.event.stopPropagation())}),i.transition().duration(500));function a(e){return e.size}function y(e){return 1}function w(e){r=(e=e).substring(1,3),t=e.substring(3,5),e=e.substring(5,7);var t,r={R:parseInt(r,16),G:parseInt(t,16),B:parseInt(e,16)};return 255-(.299*r.R+.587*r.G+.114*r.B)<105?"#000000":"#ffffff"}function g(e){c.padding([20/(o/e.dy),0,0,0]).nodes(e);var t=n/e.dx,r=o/e.dy,i=e,a=(s.domain([e.x,e.x+e.dx]),l.domain([e.y,e.y+e.dy]),d.selectAll(".labelbody .label").style("display","block"),d.selectAll("g.cell").transition().duration(500).attr("transform",function(e){return"translate("+s(e.x)+","+l(e.y)+")"}).each("end",function(e,t){t||i===self.root||(d.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("color",function(e){return w(u(e.parent.name))}),d.selectAll(".cell.child").filter(function(e){return e.parent===self.node}).select(".foreignObject .labelbody .label").style("display",""))}));a.select(".foreignObject").attr("width",function(e){return Math.max(.01,t*e.dx)}).attr("height",function(e){return e.children?20:Math.max(.01,r*e.dy)}).select(".labelbody .label").text(function(e){return e.name}),a.select("rect").attr("width",function(e){return Math.max(.01,t*e.dx)}).attr("height",function(e){return e.children?20:Math.max(.01,r*e.dy)}).style("fill",function(e){return e.children?p:u(e.parent.name)}),h=e,f.event&&f.event.stopPropagation()}t.select(".cell").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),t.select("rect").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return e.dy}).style("fill",function(e){return u(e.parent.name)}),t.select(".foreignObject").attr("width",function(e){return Math.max(.01,e.dx)}).attr("height",function(e){return Math.max(.01,e.dy)}).select(".labelbody .label").text(function(e){return e.name}),i.exit().remove(),f.select("select").on("change",function(){console.log("select zoom(node)"),c.value("size"==value?a:y).nodes(r),g(h)}),g(h)},e.prototype.isDrawable=function(){return 1<Object.keys(this._labelColumns).length},e.prototype.visit=function(e,t){return this._checkColumn(e,t)},e.prototype._checkColumn=function(e,t){return!this._getFormatter().isLabel(e,t)||(this._labelColumns[t]=!0,!this.isDrawable())},e}(jQuery,d3,window),window.wikibase||{});wikibase.queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TreeResultBrowser=function(o,i,a){"use strict";function e(){this._labelColumns={}}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._isDrawable=!1,e.prototype._jsTree=null,e.prototype._nodes=null,e.prototype.draw=function(e){var t=this,r=(this._nodes=this._extractNodes(o.proxy(this._iterateResult,this)),o("<div>").jstree({core:{data:i.compact(t._nodes),check_callback:!0},plugins:["types","wholerow","contextmenu","unique"],types:{default:{icon:"glyphicon glyphicon-barcode"}},contextmenu:{items:function(e){return{Open:{label:t._nodes[e.id].url,icon:"glyphicon glyphicon-link",action:function(){a.open(t._nodes[e.id].url,"_blank")}},explore:{label:t._nodes[e.id].url,icon:"glyphicon glyphicon-download-alt",action:function(){t._expandTree(t._nodes[e.id])}}}}}}));this._jsTree=r.jstree(),e.empty().append(r)},e.prototype._extractNodes=function(e,i){var a=null,n={},o=null,s={},l=this._getFormatter();return e(function(e,t,r){r!==a&&(o=null,a=r),e&&e.value&&(o&&(l.isLabel(e)||l.isNumber(e))&&(s[o].text=(s[o].text||"")+" "+e.value),o&&l.isCommonsResource(e.value)&&(s[o].icon=l.getCommonsResourceThumbnailUrl(e.value,24)),l.isEntity(e)&&((n={}).parent=o||i||"#",n.id=n.parent+e.value,n.url=e.value,n.state={opened:!1},o=(s[n.id]=n).id))}),s},e.prototype._expandTree=function(r){var i=this;this.getSparqlApi().query('SELECT ?property ?propertyLabel ?value ?valueItemLabel ?valueImage WHERE {       {         SELECT ?property ?value ?valueImage ?valueItem WHERE {           BIND(<{ENTITY_URI}> AS ?item)           ?item ?prop ?value.           ?property wikibase:directClaim ?prop.           ?property rdf:type wikibase:Property.           OPTIONAL { ?value wdt:P18 ?valueImage. }           OPTIONAL { BIND(?value AS ?valueItem).  FILTER(STRSTARTS(STR(?value), STR(wd:))) }         }       }       SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }    }  '.replace("{ENTITY_URI}",r.url)).done(function(){var e=i.getSparqlApi().getResultRawData(),t=i._extractNodes(function(n){o.each(e.results.bindings,function(i,a){o.each(e.head.vars,function(e,t){var r=a[t]||null;n(r,t,a,i)})})},r.id);o.extend(i._nodes,t),o.each(t,function(e,t){i._jsTree.create_node(t.parent,t)})})},e.prototype.isDrawable=function(){return this._isDrawable},e.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||!(this._isDrawable=!0)},e}(jQuery,_,window);var wikibase,wikibase,wikibase,wikibase,wikibase,wikibase,wikibase,wikibase,wikibase,wikibase,wikibase}(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.BubbleChartResultBrowser=function(u,s,l){"use strict";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser)._hasLabel=!1,e.prototype._hasNumber=!1,e.prototype.draw=function(e){var a=this,n={name:"bubblechart",children:[]},o=this._getLabelColumns()[0],s=this._getNumberColumns()[0],l=null,t=(this._iterateResult(function(e,t,r){var i;r!==l&&(i={url:null},(l=r).rgb&&a._getFormatter().isColor(r.rgb)&&(i.color=a._getFormatter().getColorForHtml(r.rgb)),r[o]&&r[s]&&(i.name=r[o].value,i.size=r[s].value,n.children.push(i))),e&&e.value&&a._getFormatter().isEntityUri(e.value)&&((r=n.children[n.children.length-1])&&null===r.url&&(r.url=e.value))}),u("<center>"));e.html(t),this._drawBubbleChart(t,n)},e.prototype._drawBubbleChart=function(e,t){var r=this;var i,a=Math.min(.98*u(l).height(),u(l).width()),n=s.scale.category20c(),o=s.layout.pack().sort(null).size([a,a]).padding(1.5),e=s.select(e[0]).append("svg").attr({class:"bubble",width:a,height:a}).selectAll(".node").data(o.nodes((i=[],function t(e,r){r.children?r.children.forEach(function(e){t(r.name,e)}):i.push({packageName:e,className:r.name,value:r.size,url:r.url,color:r.color})}(null,t),{children:i})).filter(function(e){return!e.children})).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});e.append("title").text(function(e){return e.className+": "+e.value}),e.append("circle").attr("r",function(e){return e.r}).style("fill",function(e){return e.color||n(e.className)}),e.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(e){return e.className.substring(0,e.r/4)}).on("click",function(e){e.url&&l.open(e.url,"_blank")}).style("fill",function(e){if(e.color)return r._getFormatter().calculateLuminance(e.color)<=.5?"#FFF":"#000"}).style("cursor","pointer")},e.prototype.isDrawable=function(){return this._hasLabel&&this._hasNumber},e.prototype.visit=function(e){return this._checkColumn(e)},e.prototype._checkColumn=function(e){return this._getFormatter().isNumber(e)&&(this._hasNumber=!0),this._getFormatter().isLabel(e)&&(this._hasLabel=!0),!this.isDrawable()},e}(jQuery,d3,window),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.LineChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.line},r}(dimple),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.BarChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.bar},r}(dimple),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.ScatterChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.scatter},r}(dimple),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},window.mediaWiki=window.mediaWiki||{},wikibase.queryService.ui.resultBrowser.AreaChartResultBrowser=function(e){"use strict";var t=wikibase.queryService.ui.resultBrowser.AbstractDimpleChartResultBrowser;function r(){this._dataColumns={}}return(r.prototype=new t)._getPlotType=function(){return e.plot.area},r}(dimple),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.TimelineResultBrowser=function(a,i,e){"use strict";var n={minHeight:"400px",orientation:{axis:"both",item:"top"},align:"auto",zoomKey:"ctrlKey"};function t(){}return(t.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(e){var t=a("<div>"),r=new i.Timeline(t[0],this._getItems(),n);r.on("changed",function(){a(r.dom.root).find(".vis-item.vis-range").each(function(){var e=a(this);e.css("min-width","unset"),e.css("min-width",e.css("width"))})}),e.append(t.prepend(this._createToolbar(r)))},t.prototype._getItems=function(){var n=this,o=[];return this._iterateResult(function(e,t,r,i){var a;n._getFormatter().isDateTime(e)&&(o[i]?((a=[]).push(n._getFormatter().parseDate(e.value)),o[i].start&&a.push(o[i].start),o[i].end&&a.push(o[i].end),o[i].start=a.reduce(function(e,t){return e<t?e:t}),o[i].end=a.reduce(function(e,t){return t<e?e:t})):o[i]={id:i,content:n._getHtml(r).html(),start:n._getFormatter().parseDate(e.value)})}),new i.DataSet(e.compact(o))},t.prototype._getHtml=function(e){return a("<div/>").append(this._getFormatter().formatRow(e,!0))},t.prototype._createToolbar=function(i){var e=a('<div style="margin-top: -35px; text-align: center;">');function t(e){var t=i.getWindow(),r=t.end-t.start;i.setWindow({start:t.start.valueOf()-r*e,end:t.end.valueOf()+r*e})}return a('<a class="btn btn-default">').click(a.proxy(i.redraw,i)).append('<span class="glyphicon glyphicon-resize-vertical" aria-hidden="true"></span>').appendTo(e),a('<a class="btn btn-default">').click(a.proxy(i.fit,i)).append('<span class="glyphicon glyphicon-resize-horizontal" aria-hidden="true"></span>').appendTo(e),a('<a class="btn btn-default">').click(function(){t(.2)}).append('<span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>').appendTo(e),a('<a class="btn btn-default">').click(function(){t(-.2)}).append('<span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>').appendTo(e),e},t.prototype.visit=function(e){return!this._getFormatter().isDateTime(e)||!(this._drawable=!0)},t}(jQuery,vis,(window,_)),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.MultiDimensionResultBrowser=function(w,g,m){"use strict";var s="http://www.w3.org/2001/XMLSchema#dateTime";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractChartResultBrowser).draw=function(e){var a={},n=[],o=this._getFormatter();this._iterateResult(function(e,t,r,i){n[i]||(n[i]={}),n[i][t]=e&&e.value||"undefined",e&&e.type===s&&(n[i][t]=new Date(e.value).toLocaleDateString()),a[t]||(i={key:t,description:t,type:"STRING"},o.isNumber(e)&&(i.type="NUMBER"),e&&e.type===s&&(i.type="DATE"),a[t]=i)}),this._draw(e,n,_.values(a)),e.children("svg").css({display:"block"})},e.prototype._draw=function(e,r,a){var t=50,i=80,n=10,o=100,s=w(m).width()-(o+i),l=w(m).height()-(t+n),u={NUMBER:{key:"Number",coerce:function(e){return+e},extent:g.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:g.scale.linear().range([l,0])},STRING:{key:"String",coerce:String,extent:function(e){return e.sort()},within:function(e,t,r){return t[0]<=r.scale(e)&&r.scale(e)<=t[1]},defaultScale:g.scale.ordinal().rangePoints([0,l])},DATE:{key:"Date",coerce:function(e){return new Date(e)},extent:g.extent,within:function(e,t){return t[0]<=e&&e<=t[1]},defaultScale:g.time.scale().range([0,l])}},p=(w.each(a,function(){this.type=u[this.type]}),g.scale.ordinal().domain(a.map(function(e){return e.key})).rangePoints([0,s])),c=g.svg.line().defined(function(e){return!isNaN(e[1])}),d=g.svg.axis().orient("left"),e=g.select(e[0]).append("svg").attr({width:s+o+i,height:l+t+n}).append("g").attr("transform","translate("+o+","+t+")"),s=e.append("g").attr("class","foreground"),i=e.selectAll(".axis").data(a).enter().append("g").attr("class","axis").attr("transform",function(e){return"translate("+p(e.key)+")"});function h(){g.event.sourceEvent.stopPropagation()}function y(){var e=a.filter(function(e){return!e.brush.empty()}),i=e.map(function(e){return e.brush.extent()});g.selectAll(".foreground path").style("display",function(r){return e.every(function(e,t){return e.type.within(r[e.key],i[t],e)})?null:"none"})}r.forEach(function(t){a.forEach(function(e){t[e.key]=e.type.coerce(t[e.key])})}),a.forEach(function(t){"domain"in t||(t.domain=g.functor(t.type.extent)(r.map(function(e){return e[t.key]})),t.domain.sort(function(e,t){return e-t})),"scale"in t||(t.scale=t.type.defaultScale.copy()),t.scale.domain(t.domain)}),s.selectAll("path").data(r).enter().append("path").attr("d",function(t){return c(a.map(function(e){return[p(e.key),e.scale(t[e.key])]}))}).style("stroke",function(e){return"#6ac"}),i.append("g").attr("class","axis").each(function(e){e=e.axis&&e.axis.scale(e.scale)||d.scale(e.scale);g.select(this).call(e)}).append("text").attr("class","title").attr("text-anchor","start").text(function(e){return e.description||e.key}),i.append("g").attr("class","brush").each(function(e){g.select(this).call(e.brush=g.svg.brush().y(e.scale).on("brushstart",h).on("brush",y))}).selectAll("rect").attr("x",-8).attr("width",16)},e.prototype.isDrawable=function(){return this._drawable},e.prototype.visit=function(e){return!(this._drawable=!0)},e}(jQuery,d3,window),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowser=function(n,c,o,e){"use strict";var s={autoResize:!0,physics:{stabilization:{enabled:!0,iterations:10,fit:!0},barnesHut:{springLength:150,centralGravity:.5,damping:.2,avoidOverlap:.1}},nodes:{shadow:!0,color:"#fff"},edges:{arrows:{to:!0}}};function t(){}return(t.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(e){var t=n("<div>").height("100vh"),r=(0!==n("#expand-type-switch").length&&(t=n("<div>").height("100vh"),n(".expand-type").show(),n("#expand-type-switch").bootstrapToggle({on:"Incoming",off:"Outgoing"})),this._getData()),i=new c.Network(t[0],r,s),a=(i.on("doubleClick",function(e){1===e.nodes.length&&o.open(e.nodes[0],"_blank")}),new wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser(r.nodes,r.edges,this.getSparqlApi()));i.on("click",function(e){e=e.nodes[0]||null;n("#expand-type-switch").is(":checked")?a.browse(e,"incoming"):a.browse(e,"outgoing")}),t.prepend(this._createToolbar(i)),e.append(t)},t.prototype._createToolbar=function(t){var e=n('<div id="layout-options">');function r(e){"none"===e?t.setOptions({layout:{hierarchical:{enabled:!1}}}):t.setOptions({layout:{hierarchical:{direction:e,sortMethod:"directed"}}})}return n('<a class="btn btn-default layout-button">').click(function(){t.stabilize(100)}).append('<span class="glyphicon glyphicon-fullscreen" aria-hidden="true" title="'+wikibase.queryService.ui.i18n.getMessage("wdqs-app-resultbrowser-stabilize")+'"></span>').appendTo(e),n('<a class="btn btn-default layout-button">').click(function(){r("LR")}).append('<span class="glyphicon glyphicon-indent-left" aria-hidden="true" title="'+wikibase.queryService.ui.i18n.getMessage("wdqs-app-resultbrowser-hierarchical-lr")+'"></span>').appendTo(e),n('<a class="btn btn-default layout-button">').click(function(){r("UD")}).append('<span class="glyphicon glyphicon-align-center" aria-hidden="true" title="'+wikibase.queryService.ui.i18n.getMessage("wdqs-app-resultbrowser-hierarchical-ud")+'"></span>').appendTo(e),n('<a class="btn btn-default layout-button">').click(function(){r("RL")}).append('<span class="glyphicon glyphicon-indent-right" aria-hidden="true" title="'+wikibase.queryService.ui.i18n.getMessage("wdqs-app-resultbrowser-hierarchical-rl")+'"></span>').appendTo(e),n('<a class="btn btn-default layout-button">').click(function(){r("none")}).append('<span class="glyphicon glyphicon-align-justify" aria-hidden="true" title="'+wikibase.queryService.ui.i18n.getMessage("wdqs-app-resultbrowser-non-hierarchical")+'"></span>').appendTo(e),e},t.prototype._getData=function(){var n={},o={},s=[],l=this._getFormatter(),u={},p={};return this._iterateResult(function(e,t,r,i){var a;e&&e.value&&(l.isEntity(e)&&(r=r[t+"Label"]&&r[t+"Label"].value||e.value,a=e.value,u={id:a,label:r,title:r},s[i]?(p={from:s[i],to:a},o[p.from+p.to]=p,n[a]||(n[a]=u)):(n[a]=u,s[i]=u.id)),l.isCommonsResource(e.value)&&(u.image=l.getCommonsResourceThumbnailUrl(e.value,150),u.shape="image",u.font={color:"black"}),l.isNumber(e)&&(u.value=e.value,u.title+=" value:"+e.value,u.shape="dot",u.font={color:"black"}),"rgb"===t&&l.isColor(e)&&(u.color=l.getColorForHtml(e),"dot"!==u.shape&&"image"!==u.shape&&(r=l.calculateLuminance(e.value)<=.5?"#FFF":"#000",u.font={color:r})),"edgeLabel"===t&&(p.label=e.value))}),{nodes:new c.DataSet(e.compact(n)),edges:new c.DataSet(e.compact(o))}},t.prototype.visit=function(e){return!this._getFormatter().isEntity(e)||!(this._drawable=!0)},t}(jQuery,vis,window,_),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.GraphResultBrowserNodeBrowser=function(o,s){"use strict";var l="incoming",u="outgoing";function e(e,t,r){this._nodes=e,this._incomingNodes=e,this._edges=t,this._incomingEdges=t,this._sparql=r}return e.prototype._incomingNodes=null,e.prototype._nodes=null,e.prototype._sparql=null,e.prototype._selectedNodeId=null,e.prototype._temporaryNodes={},e.prototype._incomingTemporaryNodes={},e.prototype._temporaryEdges={},e.prototype._incomingTemporaryEdges={},e.prototype._getEntites=function(e,t){var i=this;return this._sparql.query('SELECT ?o ?ol WHERE {<{entityUri}> <{propertyUri}> ?o .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50'.replace("{entityUri}",e).replace("{propertyUri}",t)).then(function(){var e=i._sparql.getResultRawData(),r=[];return o.each(e.results.bindings,function(e,t){r.push({id:t.o.value,label:t.ol.value})}),r})},e.prototype._getIncomingEntites=function(e,t){var i=this;return this._sparql.query('SELECT ?o ?ol WHERE {?o <{propertyUri}> <{entityUri}> .?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )} LIMIT 50'.replace("{entityUri}",e).replace("{propertyUri}",t)).then(function(){var e=i._sparql.getResultRawData(),r=[];return o.each(e.results.bindings,function(e,t){r.push({id:t.o.value,label:t.ol.value})}),r})},e.prototype._getProperties=function(e){var t=this;return this._sparql.query('SELECT ?p (SAMPLE(?pl) AS ?pl_) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol_)  WHERE {<{entityUri}> ?p ?o .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p'.replace("{entityUri}",e)).then(function(){var e=t._sparql.getResultRawData(),r=[];return o.each(e.results.bindings,function(e,t){r.push({id:t.p.value,label:t.pl_.value,count:t.count.value,items:t.ol_.value})}),r})},e.prototype._getIncomingProperties=function(e){var t=this;return this._sparql.query('SELECT ?p (SAMPLE(?pl) AS ?pl_) (COUNT(?o) AS ?count ) (group_concat(?ol;separator=", ") AS ?ol_)  WHERE {?o ?p <{entityUri}> .   ?o <http://www.w3.org/2000/01/rdf-schema#label> ?ol .    FILTER ( LANG(?ol) = "[AUTO_LANGUAGE]" )    ?s <http://wikiba.se/ontology#directClaim> ?p .    ?s rdfs:label ?pl .    FILTER ( LANG(?pl) = "[AUTO_LANGUAGE]" )} group by ?p'.replace("{entityUri}",e)).then(function(){var e=t._sparql.getResultRawData(),r=[];return o.each(e.results.bindings,function(e,t){r.push({id:t.p.value,label:t.pl_.value,count:t.count.value,items:t.ol_.value})}),r})},e.prototype._removeTemporaryNodes=function(e){var r=this;o.each(this._temporaryNodes,function(e,t){r._nodes.remove(t.id)}),o.each(this._temporaryEdges,function(e,t){r._edges.remove(t.id)}),this._temporaryNodes={},this._temporaryEdges={}},e.prototype._removeIncomingTemporaryNodes=function(e){var r=this;o.each(this._incomingTemporaryNodes,function(e,t){r._incomingNodes.remove(t.id)}),o.each(this._incomingTemporaryEdges,function(e,t){r._incomingEdges.remove(t.id)}),this._incomingTemporaryNodes={},this._incomingTemporaryEdges={}},e.prototype._expandPropertyNode=function(e){var r=this,i=this._temporaryNodes[e],t=r._nodes.get(e);this._getEntites(i.entityId,i.id).then(function(e){o.each(e,function(e,t){null===r._nodes.get(t.id)&&r._nodes.add({id:t.id,label:t.label,type:u}),r._edges.add({dashes:!0,from:i.entityId,to:t.id,label:i.propertyLabel,linkType:i.id,type:u})}),50<t.label&&r._getRemainingOutgoingNodes(i,t)},s.console.error)},e.prototype._getRemainingOutgoingNodes=function(e,t){t=t.label-50;this._incomingNodes.add({id:"remaining",label:"+"+t+" results ",color:"#e3eed9",type:u}),this._incomingEdges.add({dashes:!0,from:"remaining",to:e.entityId,linkType:e.id,type:u})},e.prototype._expandIncomingPropertyNode=function(e){var r=this,i=this._incomingTemporaryNodes[e],t=r._incomingNodes.get(e);this._getIncomingEntites(i.entityId,i.id).then(function(e){o.each(e,function(e,t){null===r._incomingNodes.get(t.id)&&r._incomingNodes.add({id:t.id,label:t.label,type:l}),r._incomingEdges.add({dashes:!0,from:t.id,to:i.entityId,label:i.propertyLabel,linkType:i.id,type:l})}),50<t.label&&r._getRemainingIncomingNodes(i,t)},s.console.error)},e.prototype._getRemainingIncomingNodes=function(e,t){t=t.label-50;this._incomingNodes.add({id:"remaining",label:"+"+t+" results ",color:"#e3eed9",type:l}),this._incomingEdges.add({dashes:!0,from:"remaining",to:e.entityId,linkType:e.id,type:l})},e.prototype._expandEntityNode=function(a){var n=this;this._getProperties(a).then(function(e){o.each(e,function(e,t){var r,i;0<n._edges.get({filter:function(e){return e.linkType===t.id&&e.from===a&&e.type===u}}).length||(r={id:t.id,label:"1"===t.count?t.items:t.count,title:t.items,entityId:a,propertyLabel:t.label,color:"#abc9f2",type:u},i={id:t.id,dashes:!0,label:t.label,from:a,to:t.id,type:u},n._temporaryNodes[r.id]=r,n._nodes.add(r),n._temporaryEdges[i.id]=i,n._edges.add(i))})},s.console.error)},e.prototype._expandIncomingEntityNode=function(a){var n=this;this._getIncomingProperties(a).then(function(e){o.each(e,function(e,t){var r,i;0<n._incomingEdges.get({filter:function(e){return e.linkType===t.id&&e.to===a&&e.type===l}}).length||(r={id:t.id,label:"1"===t.count?t.items:t.count,title:t.items,entityId:a,propertyLabel:t.label,color:"#abc9f2",type:l},i={id:t.id,dashes:!0,label:t.label,from:t.id,to:a,type:l},n._incomingTemporaryNodes[r.id]=r,n._incomingNodes.add(r),n._incomingTemporaryEdges[i.id]=i,n._incomingEdges.add(i))})},s.console.error)},e.prototype.browse=function(e,t){t===u?this.handleOutgoingNodes(e):this.handleIncomingNodes(e)},e.prototype.handleOutgoingNodes=function(e){this._removeIncomingTemporaryNodes(),null===e?this._removeTemporaryNodes():this._temporaryNodes[e]?(this._expandPropertyNode(e),this._removeTemporaryNodes()):(null!==this._selectedNodeId&&e!==this._selectedNodeId&&this._removeTemporaryNodes(),this._expandEntityNode(e),this._selectedNodeId=e)},e.prototype.handleIncomingNodes=function(e){this._removeTemporaryNodes(),null===e?this._removeIncomingTemporaryNodes():this._incomingTemporaryNodes[e]?(this._expandIncomingPropertyNode(e),this._removeIncomingTemporaryNodes()):(null!==this._selectedNodeId&&e!==this._selectedNodeId&&this._removeIncomingTemporaryNodes(),this._expandIncomingEntityNode(e),this._selectedNodeId=e)},e}(jQuery,(vis,window),_),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.resultBrowser=wikibase.queryService.ui.resultBrowser||{},wikibase.queryService.ui.resultBrowser.PolestarResultBrowser=function(i,a){"use strict";function e(){}return(e.prototype=new wikibase.queryService.ui.resultBrowser.AbstractResultBrowser).draw=function(e){var t={url:"wikidatasparql://query.wikidata.org/?query="+location.hash.substr(1),name:"Imported from Wikidata Query Service",_directEmbed:!0},r=i("<iframe>").attr({src:"polestar/embed.html#"+encodeURIComponent(JSON.stringify(t)),class:"graph-iframe"}).height("98vh");e.append(r),a.setTimeout(function(){r.scrollIntoView()},50)},e.prototype.visit=function(e){return!(this._drawable=!0)},e}(jQuery,window,_),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Sparql=function(l){"use strict";var o={TIMEOUT:10,MALFORMED:20,SERVER:30,UNKNOWN:100},s={"QueryTimeoutException: Query deadline is expired":o.TIMEOUT,"java.util.concurrent.TimeoutException":o.TIMEOUT,"MalformedQueryException: ":o.MALFORMED};function e(e,t){this._serviceUri=e||"https://query.wikidata.org/bigdata/namespace/wdq/sparql",this._language=t||"en"}return e.prototype.ERROR_CODES=o,e.prototype._serviceUri=null,e.prototype._executionTime=null,e.prototype._error=null,e.prototype._resultLength=null,e.prototype._rawData=null,e.prototype._queryUri=null,e.prototype._language=null,e.prototype.queryDataUpdatedTime=function(){var a=l.Deferred(),e=encodeURI("prefix schema: <http://schema.org/> SELECT * WHERE {<http://www.wikidata.org> schema:dateModified ?y}"),e=this._serviceUri+"?query="+e+"&nocache="+Math.floor(Date.now()/6e4);return l.ajax(e,{headers:{Accept:"application/sparql-results+json"}}).done(function(e,t,r){var i;e.results.bindings[0]?(i=(e=new Date(e.results.bindings[0][e.head.vars[0]].value)).toLocaleTimeString(navigator.language,{timeZoneName:"short"})+", "+e.toLocaleDateString(navigator.language,{month:"short",day:"numeric",year:"numeric"}),e=Math.round((new Date-e)/1e3),a.resolve(i,e)):a.reject()}).fail(function(){a.reject()}),a},e.prototype.query=function(e,t){var r=this;return e=this._replaceAutoLanguage(e),this._replaceAutoCoordinates(e).then(function(e){return r._query(e,t)})},e.prototype._query=function(e,t){var e="query="+encodeURIComponent(e),i=(t&&(e+="&maxQueryTimeMillis="+t),this),a=l.Deferred(),n={headers:{Accept:"application/sparql-results+json"},data:e};function o(e,t,r){i._executionTime=Date.now()-i._executionTime,"boolean"==typeof e.boolean?i._resultLength=1:i._resultLength=e.results.bindings.length||0,i._rawData=e,a.resolve(e)}function s(e,t,r){i._executionTime=null,i._rawData=null,i._resultLength=null,i._generateErrorMessage(e,t,r),a.reject()}return this._queryUri=this._serviceUri+"?"+n.data,this._executionTime=Date.now(),l.ajax(this._serviceUri,n).done(o).fail(function(e,t,r){""===e.getAllResponseHeaders()||414===e.status||431===e.status?(n.method="POST",l.ajax(i._serviceUri,n).done(o).fail(s)):s.apply(this,arguments)}),a},e.prototype._generateErrorMessage=function(e,t,r){var i={code:o.UNKNOWN,message:null,debug:e.responseText};0!==e.status&&!r||(i.code=o.SERVER,i.message=r.message);try{var a,n=i.debug.substring(i.debug.indexOf("java.util.concurrent.ExecutionException:"));for(a in s)-1!==n.indexOf(a)&&(i.code=s[a],i.message=null);i.code!==o.UNKNOWN&&i.code!==o.MALFORMED||(i.message=i.debug.match(/(java\.util\.concurrent\.ExecutionException\:)+(.*)(Exception\:)+(.*)/).pop().trim())}catch(e){}this._error=i},e.prototype.getExecutionTime=function(){return this._executionTime},e.prototype.getError=function(){return this._error},e.prototype.getResultLength=function(){return this._resultLength},e.prototype.getQueryUri=function(){return this._queryUri},e.prototype._processData=function(e,t,r){for(var i=e.results.bindings.length,a=0;a<i;a++){for(var n={},o=0;o<e.head.vars.length;o++)e.head.vars[o]in e.results.bindings[a]?n[e.head.vars[o]]=e.results.bindings[a][e.head.vars[o]]:n[e.head.vars[o]]=void 0;r=t(n,r)}return r},e.prototype._encodeCsv=function(e){e=e.replace(/"/g,'""');return e=/[",\n]/.test(e)?'"'+e+'"':e},e.prototype.getResultRawData=function(){return this._rawData},e.prototype.getResultAsCsv=function(){var n=this,e=n._rawData,t=e.head.vars.map(this._encodeCsv).join(",")+"\n";return this._processData(e,function(e,t){var r,i="",a=!0;for(r in e)a?a=!1:i+=",",i+=void 0===e[r]?"":n._encodeCsv(e[r].value);return t+(i+="\n")},t)},e.prototype.getResultHTML=function(){var e=this._rawData,t=l("<html>"),r=l("<head>").append(l("<meta>").attr("charset","utf-8")),i=(t.append(r),[]),r=l("<table>"),a=l("<thead>"),n=l("<tr>"),o=(e.head.vars.forEach(function(e){n.append("<th>"+e+"</th>"),i.push(e)}),a.append(n),r.append(a),l("<tbody>")),a=(e.results.bindings.forEach(function(e){for(var t in n=l("<tr>"),i)e[i[t]]?(t=e[i[t]].value.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"),n.append("<td>"+t+"</td>")):n.append("<td></td>");o.append(n)}),r.append(o),l("<body>").append(r));return t.append(a),t.prop("outerHTML")},e.prototype.getResultAsJson=function(){var e=this._rawData,e=this._processData(e,function(e,t){var r,i={};for(r in e)i[r]=(e[r]||{}).value;return t.push(i),t},[]);return JSON.stringify(e)},e.prototype.getResultAsAllJson=function(){return JSON.stringify(this._rawData)},e.prototype._renderValueTSV=function(e){var t=e.value.replace(/\t/g,"");switch(e.type){case"uri":return"<"+t+">";case"bnode":return"_:"+t;case"literal":var r=JSON.stringify(t);return e["xml:lang"]?r+"@"+e["xml:lang"]:e.datatype?"http://www.w3.org/2001/XMLSchema#integer"===e.datatype||"http://www.w3.org/2001/XMLSchema#decimal"===e.datatype||"http://www.w3.org/2001/XMLSchema#double"===e.datatype?t:r+"^^<"+e.datatype+">":r}return t},e.prototype.getSparqlTsv=function(){var n=this,e=this._rawData,t=e.head.vars.map(function(e){return"?"+e}).join("\t")+"\n";return this._processData(e,function(e,t){var r,i="",a=!0;for(r in e)a?a=!1:i+="\t",i+=void 0===e[r]?"":n._renderValueTSV(e[r]);return t+(i+="\n")},t)},e.prototype.getSimpleTsv=function(){var e=this._rawData,t=e.head.vars.join("\t")+"\n";return this._processData(e,function(e,t){var r,i="",a=!0;for(r in e)a?a=!1:i+="\t",i+=void 0===e[r]?"":e[r].value.replace(/\t/g,"");return t+(i+="\n")},t)},e.prototype._replaceAutoLanguage=function(e){return e.replace(/\[AUTO_LANGUAGE\]/g,this._language)},e.prototype._replaceAutoCoordinates=function(t){var r=l.Deferred();return(navigator&&navigator.geolocation&&t.match(/\"\[AUTO_COORDINATES\]\"/g)?(navigator.geolocation.getCurrentPosition(function(e){e='"Point('+e.coords.longitude+" "+e.coords.latitude+')"^^geo:wktLiteral';t=t.replace(/\"\[AUTO_COORDINATES\]\"/g,e),r.resolve(t)},function(){t=t.replace(/\"\[AUTO_COORDINATES\]\"/g,'"Point(13.381138 52.498243)"^^geo:wktLiteral'),r.resolve(t)},{timeout:1e4,maximumAge:1e4}),r):r.resolve(t)).promise()},e.prototype.setLanguage=function(e){this._language=e},e}(jQuery)}(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.QuerySamples=function(a){"use strict";function e(e,t){if(this._language=e,!t)throw new Error("Invalid method call: query sample settings are missing!");this._apiServer=t.server,this._apiUrl=this._apiServer+t.apiPath,this._pageTitle=t.pageTitle,this._pageUrl=this._apiServer+t.pagePathElement+"Special:MyLanguage/"+this._pageTitle}return e.prototype._language=null,e.prototype.getExamples=function(){var t=this;return t._parsePage(t._pageTitle+"/"+t._language).catch(function(){return t._parsePage(t._pageTitle)}).then(function(e){return t._parseHTML(e.parse.text)})},e.prototype._parsePage=function(e){return this._apiGet({action:"parse",page:e,redirects:"1",prop:"text",wrapoutputclass:"",disableeditsection:"1",smaxage:"600",maxage:"600",disabletoc:"1"})},e.prototype._apiGet=function(e){return a.getJSON(this._apiUrl,a.extend({},e,{format:"json",formatversion:2,origin:"*"})).then(function(e){if("error"in e)throw e.error;return e})},e.prototype._findPrevHeader=function(e){var t=e.prop("tagName");return"H"!==t[0]&&"h"!==t[0]?null:this._findPrev(e,"h"+(t.substr(1)-1))},e.prototype._findPrev=function(e,t){var r=e.prev().filter(t);return 0<r.length||0<(r=e.prevUntil(t).last().prev()).length||0===(r=e.parent()).length?r:this._findPrev(r,t)},e.prototype._extractTagsFromSPARQL=function(e){e=e.match(/\b[QP]\d+\b/g);return e||[]},e.prototype._parseHTML=function(e){var t=document.createElement("div"),i=this,e=(t.innerHTML=e,a(t).find(".mw-highlight").map(function(){var e,t=a(this),r=(t.find(".lineno").remove(),t.text().trim()),t=i._findPrev(t,"h2,h3,h4,h5,h6,h7");return t&&t.length?{title:e=t.text().trim(),query:r,href:i._pageUrl+"#"+encodeURIComponent(e.replace(/ /g,"_")).replace(/%/g,"."),tags:i._extractTagsFromSPARQL(r),category:i._findPrevHeader(t).text().trim()}:null}).get());return _.flatten(_.toArray(_.groupBy(e,"category")))},e.prototype.setLanguage=function(e){this._language=e},e.prototype.getLanguage=function(){return this._language},e.prototype.getExamplesPageUrl=function(){return this._pageUrl},e}(jQuery),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Wikibase=function(i){"use strict";var a="en",n={action:"wbsearchentities",format:"json",limit:50,continue:0,language:a,uselang:a},e={action:"query",meta:"siteinfo",format:"json",siprop:"languages"},r={action:"wbgetentities",props:"labels",format:"json",languages:a,languagefallback:"1"},o={action:"wbgetentities",props:"datatype",format:"json"};function t(e,t){this._endpoint="https://www.wikidata.org/w/api.php",e&&(this._endpoint=e),t&&(this._language=t)}return t.prototype._endpoint=null,t.prototype._language=null,t.prototype.searchEntities=function(e,t,r){var i=n;return i.search=e,t&&(i.type=t),this._language||r?(i.language=r||this._language,i.uselang=r||this._language):(i.language=a,i.uselang=a),this._query(i)},t.prototype.getLanguages=function(){return this._query(e)},t.prototype.getLabels=function(e){var t=r;return t.ids=(e="string"==typeof e?[e]:e).join("|"),this._language&&(t.languages=this._language),this._query(t)},t.prototype.getDataType=function(t){var e=o,r=i.Deferred();return e.ids=t,this._query(e).done(function(e){e.entities&&e.entities[t]&&e.entities[t].datatype&&r.resolve(e.entities[t].datatype),r.reject()}).fail(r.reject),r.promise()},t.prototype._query=function(e){return i.ajax({url:this._endpoint+"?origin=*&"+jQuery.param(e)})},t.prototype.setLanguage=function(e){this._language=e},t}(jQuery),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.Tracking=function(i){"use strict";function e(e){this._endpoint="https://www.wikidata.org/beacon/statsv",e&&(this._endpoint=e)}return e.prototype._endpoint=null,e.prototype.track=function(e,t,r){return t=t||1,r=r||"c","query.wikidata.org"!==location.hostname||/^1|yes/.test(navigator.doNotTrack||window.doNotTrack)?i.when():this._track(e+"="+t+r)},e.prototype._track=function(e){return i.ajax({url:this._endpoint+"?"+e})},e}(jQuery),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.api=wikibase.queryService.api||{},wikibase.queryService.api.UrlShortener=function(i){"use strict";var t={tinyurl:function(e){return this._getTinyUrl(e)},wmf:function(e){return this._getWikiShort(e,"meta.wikimedia.org")},wikibeta:function(e){return this._getWikiShort(e,"en.wikipedia.beta.wmflabs.org")}};function e(e){this._service=t[e]||this._badService}return e.prototype._service=null,e.prototype.shorten=function(e){var t="url-shortener-id-"+i.now();return i.when(this._service.call(this,e)).then(function(e){i("#"+t).html(e)}),'<div class="shortUrl" id="'+t+'">'+wikibase.queryService.ui.i18n.getMessage("wdqs-app-urlshortener-loading")+"</div>"},e.prototype._badService=function(e){return wikibase.queryService.ui.i18n.getMessage("wdqs-app-urlshortener-bad-service")},e.prototype._getTinyUrl=function(e){return'<iframe class="shortUrl" src="//tinyurl.com/api-create.php?url='+encodeURIComponent(e)+'" referrerpolicy="origin" sandbox="" ></iframe>'},e.prototype._getWikiShort=function(e,t){var r=i.Deferred();return i.ajax({url:"https://"+t+"/w/api.php",data:{action:"shortenurl",format:"json",origin:"*",url:e},dataType:"json",method:"POST"}).done(function(e){e=e&&!e.error&&e.shortenurl&&e.shortenurl.shorturl?e.shortenurl.shorturl:wikibase.queryService.ui.i18n.getMessage("wdqs-app-urlshortener-failed"),e='<!DOCTYPE html><meta charset="utf-8"><pre>'+e.replace(/[<&]/g,function(e){return"<"===e?"&lt;":"&"===e?"&amp;":void 0})+"</pre>",e=i("<iframe>").attr({class:"shortUrl",src:"data:text/html;charset=utf-8,"+encodeURI(e),sandbox:""});r.resolve(e)}).fail(function(){r.resolve(wikibase.queryService.ui.i18n.getMessage("wdqs-app-urlshortener-failed"))}),r},e}(jQuery),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.RdfNamespaces={},function(a,t){"use strict";t.NAMESPACE_SHORTCUTS={Wikidata:{wikibase:"http://wikiba.se/ontology#",wd:"http://www.wikidata.org/entity/",wdt:"http://www.wikidata.org/prop/direct/",wdtn:"http://www.wikidata.org/prop/direct-normalized/",wds:"http://www.wikidata.org/entity/statement/",p:"http://www.wikidata.org/prop/",wdref:"http://www.wikidata.org/reference/",wdv:"http://www.wikidata.org/value/",ps:"http://www.wikidata.org/prop/statement/",psv:"http://www.wikidata.org/prop/statement/value/",psn:"http://www.wikidata.org/prop/statement/value-normalized/",pq:"http://www.wikidata.org/prop/qualifier/",pqv:"http://www.wikidata.org/prop/qualifier/value/",pqn:"http://www.wikidata.org/prop/qualifier/value-normalized/",pr:"http://www.wikidata.org/prop/reference/",prv:"http://www.wikidata.org/prop/reference/value/",prn:"http://www.wikidata.org/prop/reference/value-normalized/",wdno:"http://www.wikidata.org/prop/novalue/",wdata:"http://www.wikidata.org/wiki/Special:EntityData/"},W3C:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",owl:"http://www.w3.org/2002/07/owl#",skos:"http://www.w3.org/2004/02/skos/core#",xsd:"http://www.w3.org/2001/XMLSchema#",prov:"http://www.w3.org/ns/prov#",ontolex:"http://www.w3.org/ns/lemon/ontolex#"},"Social/Other":{schema:"http://schema.org/",geo:"http://www.opengis.net/ont/geosparql#",geof:"http://www.opengis.net/def/geosparql/function/",dct:"http://purl.org/dc/terms/"},Blazegraph:{bd:"http://www.bigdata.com/rdf#",bds:"http://www.bigdata.com/rdf/search#",gas:"http://www.bigdata.com/rdf/gas#",hint:"http://www.bigdata.com/queryHints#"}},t.ENTITY_TYPES={"http://www.wikidata.org/prop/direct/":"property","http://www.wikidata.org/prop/direct-normalized/":"property","http://www.wikidata.org/prop/":"property","http://www.wikidata.org/prop/novalue/":"property","http://www.wikidata.org/prop/statement/":"property","http://www.wikidata.org/prop/statement/value/":"property","http://www.wikidata.org/prop/statement/value-normalized/":"property","http://www.wikidata.org/prop/qualifier/":"property","http://www.wikidata.org/prop/qualifier/value/":"property","http://www.wikidata.org/prop/qualifier/value-normalized/":"property","http://www.wikidata.org/prop/reference/":"property","http://www.wikidata.org/prop/reference/value/":"property","http://www.wikidata.org/prop/reference/value-normalized/":"property","http://www.wikidata.org/wiki/Special:EntityData/":"item","http://www.wikidata.org/entity/":"item"},t.ALL_PREFIXES=a.map(t.NAMESPACE_SHORTCUTS,function(e){return e}).reduce(function(e,t,r){return a.extend(e,t)},{}),t.STANDARD_PREFIXES={wd:"PREFIX wd: <http://www.wikidata.org/entity/>",wdt:"PREFIX wdt: <http://www.wikidata.org/prop/direct/>",wikibase:"PREFIX wikibase: <http://wikiba.se/ontology#>",p:"PREFIX p: <http://www.wikidata.org/prop/>",ps:"PREFIX ps: <http://www.wikidata.org/prop/statement/>",pq:"PREFIX pq: <http://www.wikidata.org/prop/qualifier/>",rdfs:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>",bd:"PREFIX bd: <http://www.bigdata.com/rdf#>"},t.addPrefixes=function(e){a.extend(t.ALL_PREFIXES,e)},t.getPrefixMap=function(r){var i={};return a.each(t.ALL_PREFIXES,function(e,t){r[t]&&(i[e]=r[t])}),i}}(jQuery,wikibase.queryService.RdfNamespaces),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.Banner=function(a){"use strict";var n="dismissed";function e(e,t,r,i,a){this._storageKey=this.trackingNamespace+e,this._renderBanner=t,this._onDismiss=r,this._content=a,this._init(i)}return e.prototype._$element=null,e.prototype._storageKey=null,e.prototype._onDismiss=null,e.prototype.trackingNamespace="wikibase.queryService.ui.",e.prototype._init=function(e){var t,r,i;localStorage.getItem(this._storageKey)!==n&&(t=a("<button>").attr({class:"close",type:"button","aria-label":"Dismiss"}).html('<span aria-hidden="true">×</span>').on("click",function(){this.dismiss()}.bind(this)),r=a("<div>").attr("class","banner__text"),i=a("<span>").html(this._content),r.prepend(i),r.prepend('<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>'),(i=a("<div>").attr("class","banner").attr("data-key",this._key)).append(r),i.append(t),this._$element=i,this._renderBanner(this._$element))},e.prototype.dismiss=function(){this._$element.hide(),localStorage.setItem(this._storageKey,n),this._onDismiss&&this._onDismiss()},e}(jQuery,(download,window)),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryHelper=function(u,l,n){"use strict";var t={"http://www.w3.org/2000/01/rdf-schema#label":!0,"http://schema.org/description":!0,"http://www.bigdata.com/queryHints#optimizer":!0,"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":!0},o={formatNoMatches:function(){}};function e(e,t,r){this._api=e||new l.queryService.api.Wikibase,this._selectorBox=r||new l.queryService.ui.queryHelper.SelectorBox(this._api,t),this._query=new l.queryService.ui.queryHelper.SparqlQuery}return e.prototype._api=null,e.prototype._selectorBox=null,e.prototype._changeListener=null,e.prototype._query=null,e.prototype._$element=null,e.prototype._triples=[],e.prototype._isSimpleMode=!1,e.prototype.setQuery=function(e){var t=l.queryService.RdfNamespaces.ALL_PREFIXES;this._query.parse(e,t),this._selectorBox.setQuery(this._query)},e.prototype.getQuery=function(){try{var e=this._query.getQueryString();return(e=this._cleanQueryPrefixes(e).trim()).trim()}catch(e){return null}},e.prototype._cleanQueryPrefixes=function(e){for(var t,r=new RegExp("PREFIX ("+l.queryService.VariableNames.PrefixPattern+"): <(.*)>","gi"),i={},a=e.replace(r,"").replace(/\n+/g,"\n");t=r.exec(e);){var n=t[1],o=t[2].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),o=a.replace(new RegExp("<"+o+"([^/>#]+?)>","gi"),n+":$1");a!==o&&(a=o,l.queryService.RdfNamespaces.STANDARD_PREFIXES[n]||(i[t[0]]=!0))}return a=Object.keys(i).join("\n")+"\n\n"+a.trim()},e.prototype.draw=function(e){var t=l.queryService.ui.queryHelper.QueryTemplate.parse(this._query),i=this,a=this._query.getBindings();if(e&&(this._$element=e),null!==t)try{return this._$element.html(t.getHtml(function(e){return i._getLabel(a[e].expression)},this._selectorBox,function(e,t,r){a[e].expression=a[e].expression.replace(new RegExp(t+"$"),"")+r,i._changeListener&&i._changeListener(i)}))}catch(e){window.console.error(e)}this._triples=this._query.getTriples();for(var r=this._query.getSubQueries();0<r.length;){var n=r.pop();this._triples=this._triples.concat(n.getTriples()),r.concat(n.getSubQueries())}this._isSimpleMode=this._isSimpleQuery(),this._$element.html(this._getHtml())},e.prototype.setChangeListener=function(e){this._changeListener=e},e.prototype._i18nSpan=function(e,t){return u("<span>").attr("data-i18n",e).text(l.queryService.ui.i18n.getMessage(e,t))},e.prototype._getHtml=function(){var r=this,e=u("<div>").attr("class","panel-body-sub"),i=u("<table>").attr("class","query-helper-data").bootstrapTable(o),a=u("<table>").attr("class","query-helper-data").bootstrapTable(o);return u.each(this._triples,function(e,t){r._isNotRelevant(t.triple)||(r._isInShowSection(t.triple)?a:i).append(r._getTripleHtml(t))}),this._createTagCloud(),e.append(this._createSection(i,this._createFindButton(i)),this._createSection(a,this._createShowButton(a)),this._getLimitSection())},e.prototype._createTagCloud=function(){},e.prototype._getLimitSection=function(){var e=u("<div>").attr("class","query-helper-limit-section"),t=u('<a data-type="number">').attr("href","#").attr("id","query-helper-limit").data("value",this._query.getLimit()).append(this._i18nSpan("wdqs-ve-limit","Limit")),r=u("<span>").text(this._query.getLimit()||""),i=this;return this._selectorBox.add(t,null,function(e){r.text((e="0"===e?null:e)||""),i._query.setLimit(e),i._changeListener&&i._changeListener(i)},{trash:function(){return i._query.setLimit(null),t.data("value",""),r.text(""),i._changeListener&&i._changeListener(i),i._createTagCloud(),!0}}),e.append(t.append(" ",r))},e.prototype._createSection=function(e,t){return u("<table>").attr("class","query-helper-section").append(u("<tr>").append(u("<td>").append(t),u("<td>").append(e)))},e.prototype._createTagCloudShow=function(){var a=this,e=u('<div data-entity="property" data-type="tagCloud" class="tagCloud">');return this._selectorBox.add(e,null,function(e,t,r){var e="http://www.wikidata.org/prop/direct/"+e,i=a._query.getBoundVariables().shift()||"?item",t=l.queryService.VariableNames.makeVariableName(t),i=a._query.addTriple(i,e,t,!0);a._query.addVariable(t),a._addLabelVariableAfterItemColumn(e.split("/").pop(),i),a._changeListener&&a._changeListener(a),a.draw()}),e},e.prototype._createTagCloudFilter=function(){var n=this,e=u('<div data-entity="item" data-type="tagCloud" class="tagCloud">');return n._selectorBox.add(e,null,function(e,t,r,i){var e="http://www.wikidata.org/entity/"+e,a=(a=n._query.getBoundVariables().shift())||l.queryService.VariableNames.makeVariableName(t),t="http://www.wikidata.org/prop/direct/"+(r||"P31"),r=n._query.addTriple(a,t,e,!1);n._query.hasVariable(a)||n._query.addVariable(a),n._addLabelVariableAfterItemColumn(t.split("/").pop(),r),n._changeListener&&n._changeListener(n),n.draw()}),e},e.prototype._createFindButton=function(a){var e=u('<a class="btn">').append(this._i18nSpan("wdqs-ve-filter","Filter")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new item"}).attr("id","query-helper-filter").attr("data-type","item").attr("data-auto_open",!0),n=this;return this._selectorBox.add(e,null,function(e,t,r){var e="http://www.wikidata.org/entity/"+e,i=(i=n._query.getBoundVariables().shift())||l.queryService.VariableNames.makeVariableName(t),t="http://www.wikidata.org/prop/direct/"+(r||"P31"),r=n._query.addTriple(i,t,e,!1);n._query.hasVariable(i)||n._query.addVariable(i),n._addLabelVariableAfterItemColumn(t.split("/").pop(),r),a.append(n._getTripleHtml(r)),n._changeListener&&n._changeListener(n),n._createTagCloud()}),e},e.prototype._createShowButton=function(i){var e=u('<a class="btn">').append(this._i18nSpan("wdqs-ve-show","Show")).attr("href","#").prepend('<span class="fa fa-plus" aria-hidden="true"></span>'," ").tooltip({title:"Click to add new property"}).attr("id","query-helper-show").attr("data-type","property").attr("data-auto_open",!0),a=this;return this._selectorBox.add(e,null,function(e,t){var e="http://www.wikidata.org/prop/direct/"+e,r=a._query.getBoundVariables().shift()||"?item",t=l.queryService.VariableNames.makeVariableName(t),r=a._query.addTriple(r,e,t,!0);a._query.addVariable(t),a._addLabelVariableAfterItemColumn(e.split("/").pop(),r),i.append(a._getTripleHtml(r)),a._changeListener&&a._changeListener(a),a._createTagCloud()}),e},e.prototype._addLabelVariableAfterItemColumn=function(e,t){var r=this;this._api.getDataType(e).done(function(e){"wikibase-item"===e&&r._addLabelVariable(t)})},e.prototype._isNotRelevant=function(e){return!!t[e.predicate]||!(!this._isSimpleMode||!this._isInShowSection(e)||!1!==this._query.hasVariable(e.object)||!1!==this._query.hasVariable(e.object+"Label")||!1!==this._query.isWildcardQuery())},e.prototype._isInShowSection=function(e){var t=this._query.getBindings();return!(!this._isVariable(e.subject)||!this._isVariable(e.object)||t[e.subject]||t[e.object])},e.prototype._getTripleHtml=function(r){var i=this,a=u("<tr>"),n=this._query.getBindings();return u.each(r.triple,function(e,t){if(i._isVariable(t)&&n[t]&&"string"==typeof n[t].expression&&(t=n[t].expression),i._isVariable(t))return i._isSimpleMode?void 0:(t=t.replace("?","").replace(/_/g,"_<wbr>"),void a.append(u("<td>").append(t)));t.type&&"path"===t.type?a.append(u("<td>").append(i._getTripleEntityPathHtml(t,r,e))," "):a.append(u("<td>").append(i._getTripleEntityHtml(t,r,e))," ")}),a.append(this._getTripleHtmlToolbar(a,r))},e.prototype._getTripleHtmlToolbar=function(r,i){var a=this,e=u('<a href="#">').addClass("fa fa-trash-o").click(function(){var e=n.compact(i.triple).filter(function(e){return"string"==typeof e&&e.startsWith("?")}),t=e.map(function(e){return e+"Label"});return i.remove(),r.remove(),a._query.cleanupVariables(e.concat(t)),a._changeListener&&a._changeListener(a),a._createTagCloud(),!1}).tooltip({title:l.queryService.ui.i18n.getMessage("wdqs-ve-remove-row-title")}),t=u('<a href="#">').addClass("fa fa-tag").click(function(){return a._addLabelVariable(i),a._changeListener&&a._changeListener(a),!1}).tooltip({title:l.queryService.ui.i18n.getMessage("wdqs-ve-add-label-title")});return u('<td class="toolbar">').append(t,e)},e.prototype._addLabelVariable=function(e){this._query.convertWildcardQueryToUseVariables(),e.triple.object.startsWith("?")?this._query.addVariable(e.triple.object+"Label"):this._query.addVariable(e.triple.subject+"Label"),this._changeListener&&this._changeListener(this)},e.prototype._isVariable=function(e){return"string"==typeof e&&e.startsWith("?")},e.prototype._isSimpleQuery=function(){var r={},i=this;return u.each(this._triples,function(e,t){i._isVariable(t.triple.subject)&&!1===i._isVariable(t.triple.object)&&(r[t.triple.subject]=!0)}),Object.keys(r).length<=1},e.prototype._getTripleEntityPathHtml=function(a,n){var o=this,s=u("<span>");return u.each(a.items,function(e,t){var r,i;t.type&&"path"===t.type?s.append(o._getTripleEntityPathHtml(t,n)):(0<e&&"/"===a.pathType&&(r=l.queryService.ui.i18n.getMessage("wdqs-ve-or","or"),i=l.queryService.ui.i18n.getMessage("wdqs-ve-subtype","subtype"),s.append(" "+r+" "+i+" ")),"*"===a.pathType&&(r=l.queryService.ui.i18n.getMessage("wdqs-ve-any","any"),s.append(" "+r+" ")),i=a.items.reduce(function(e,t,r){return e[r]=t,e},{}),i=u.extend(i,n.triple),(n=u.extend({},n)).triple=i,s.append(o._getTripleEntityHtml(t,n,e)))}),s},e.prototype._getTripleEntityHtml=function(a,n,o){var s=this,l=u("<span>");return this._getLabel(a).done(function(e,t,r,i){e=u("<a>").text(e).attr({"data-id":t,"data-type":i,href:"#"}).appendTo(l);l.tooltip({title:"("+t+") "+r}),u(l).on("show.bs.tooltip",function(){u(".tooltip").is(":visible")&&u(".tooltip").not(this).hide()}),s._selectorBox.add(e,n.triple,function(e){e=a.replace(new RegExp(t+"$"),"")+e;l.replaceWith(s._getTripleEntityHtml(e,n,o)),s._isVariable(n.triple[o])?s._query.getBindings()[n.triple[o]].expression=e:n.triple[o]=e,s._changeListener&&s._changeListener(s),s._createTagCloud()})}).fail(function(){l.text(a)}),l},e.prototype._getLabel=function(e){var r,i=u.Deferred(),e=e.match(/(Q|P)([0-9]+)/);return(e?(r=(r={P:"property",Q:"item"})[e[1]],e=e[0],this._api.searchEntities(e,r).done(function(e){u.each(e.search,function(e,t){return i.resolve(t.label,t.id,t.description,r),!1})}),i):i.reject()).promise()},e}(jQuery,wikibase,_),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SparqlQuery=function(o,t,i){"use strict";function a(e){this._query=e}return a.prototype._query=null,a.prototype._queryComments=null,a.prototype.parse=function(e,t){var t=new i.Parser(t),r=[];this._query=t.parse(e),o.each(e.split("\n"),function(e,t){0===t.indexOf("#")&&r.push(t)}),this._queryComments=r},a.prototype.getQueryString=function(){try{var e=(new i.Generator).stringify(this._query),t=this._queryComments.join("\n").trim();return""!==t?t+"\n"+e:e}catch(e){return null}},a.prototype.getLimit=function(){return this._query.limit||null},a.prototype.setLimit=function(e){return e?this._query.limit=e:delete this._query.limit,this},a.prototype.hasVariable=function(e){return 0!==this._query.variables.length&&0<=this._query.variables.indexOf(e)},a.prototype.isWildcardQuery=function(){return!(!this._query.variables||"*"!==this._query.variables[0])},a.prototype.convertWildcardQueryToUseVariables=function(){var e;this.isWildcardQuery()&&(e=this.getQueryString().match(new RegExp("("+t.queryService.VariableNames.VariablePattern+")","g")),this._query.variables=o.unique(e)||"*")},a.prototype.addVariable=function(e){return e&&e.startsWith("?")&&(0<=this._query.variables.indexOf(e)||this.isWildcardQuery()||this._query.variables.push(e)),this},a.prototype.removeVariable=function(e){e.startsWith("?")&&!this.isWildcardQuery()&&(0<=(e=this._query.variables.indexOf(e))&&this._query.variables.splice(e,1),0===this._query.variables.length&&this._query.variables.push("*"))},a.prototype.cleanupVariables=function(t){var r=this,i=this.getTripleVariables();this._query.variables.filter(function(e){return(!t||-1!==t.indexOf(e))&&-1===i.indexOf(e)}).map(function(e){r.removeVariable(e)})},a.prototype.getTriples=function(e,r){var i=[],a=(e=e||this._query.where,r=r||!1,this);return o.each(e,function(e,t){t.type&&"bgp"===t.type&&(i=i.concat(a._createTriples(t.triples,r))),t.type&&"optional"===t.type&&(i=i.concat(a.getTriples(t.patterns,!0))),t.type&&"union"===t.type&&(i=i.concat(a.getTriples(t.patterns,!1)))}),i},a.prototype.getBindings=function(){var r={};return o.each(this._query.where,function(e,t){t.type&&"bind"===t.type&&(r[t.variable]=t)}),r},a.prototype._createTriples=function(r,i){var a=this,n=[];return o.each(r,function(e,t){n.push({optional:i,query:a,triple:t,remove:function(){r.splice(e,1)}})}),n},a.prototype.getSubQueries=function(){var i=[];return o.each(this._query.where,function(e,t){"group"===t.type&&!function r(e){o.each(e.patterns,function(e,t){switch(t.type){case"query":i.push(new a(t));break;case"group":r(t)}})}(t)}),i},a.prototype.addTriple=function(e,t,r,i){e={type:"bgp",triples:[{subject:e,predicate:t,object:r}]};return i?this._query.where.push({type:"optional",patterns:[e]}):this._query.where.push(e),this._createTriples(e.triples,i)[0]},a.prototype.getTripleVariables=function(){var r={};return o.each(this.getTriples(),function(e,t){"string"==typeof t.triple.subject&&t.triple.subject.startsWith("?")&&(r[t.triple.subject]=!0),"string"==typeof t.triple.predicate&&t.triple.predicate.startsWith("?")&&(r[t.triple.predicate]=!0),"string"==typeof t.triple.object&&t.triple.object.startsWith("?")&&(r[t.triple.object]=!0)}),Object.keys(r)},a.prototype.getBoundVariables=function(){var r={};return o.each(this.getTriples(),function(e,t){t.triple.subject.startsWith("?")&&!t.triple.object.startsWith("?")&&(r[t.triple.subject]=!0),!t.triple.subject.startsWith("?")&&t.triple.object.startsWith("?")&&(r[t.triple.object]=!0)}),Object.keys(r)},a.prototype.getServices=function(){var r=[];return o.each(this._query.where,function(e,t){t&&"service"===t.type&&r.push(t)}),r},a.prototype.removeService=function(r){var i=this;return o.each(this._query.where,function(e,t){"service"===t.type&&t.name===r&&delete i._query.where[e]}),this},a.prototype.getCommentContent=function(e){for(var t,r=0;r<this._queryComments.length;r++)if((t=this._queryComments[r]).startsWith("#"+e))return t.substring(1+e.length);return null},a.prototype.clone=function(){var e=new a;return e.parse(this.getQueryString()),e},a}(jQuery,wikibase,sparqljs),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.SelectorBox=function(l,u){"use strict";var a={item:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i <{PROPERTY_URI}> ?id. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t}\t\t\t\t\tLIMIT 100',genericSuggest:function(){var e,t,r;return 0===this._query.getTriples().length?'SELECT ?id ?label ?description WHERE {\t\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?id wdt:P1424 ?p. }\t\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t\t}\t\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100':(e=this._query.getBoundVariables().shift()||this._query.getTripleVariables().shift(),t=(r=this._query.clone().setLimit(1e3).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString()).match(/.*\bPREFIX\b(.*)/gi).join("\n"),r=r.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\t\tSELECT ?id ?label ?description ?property (?count as ?rank) WITH {\n\t\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\t\tSELECT ?value ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t\t?statement ?ps ?value.\n\t\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p; wikibase:statementProperty ?ps.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tGROUP BY ?value ?property\n\t\t\t\t\t\t\tHAVING(isIRI(?value) && STRSTARTS(STR(?value), STR(wd:Q)))\n\t\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t\t} AS %values WHERE {\n\t\t\t\t\t\t\tINCLUDE %values.\n\t\t\t\t\t\t\tBIND(?value AS ?id).\n\t\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",r).replace("{VARIABLE}",e).replace("{PREFIXES}",t))},search:null,instanceOf:'SELECT ?id ?label ?description WHERE {\t\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t\t{\t\t\t\t\t\t\tSELECT DISTINCT ?id WHERE { ?i wdt:P31 ?id. }\t\t\t\t\t\t\tLIMIT 100\t\t\t\t\t\t}\t\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t\t?id schema:description ?description.\t\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t\t}\t\t\t\t\tLIMIT 100'},property:{suggest:'SELECT ?id ?label ?description WHERE {\t\t\t\thint:Query hint:optimizer "None".\t\t\t\t\t{\t\t\t\t\t\tSELECT DISTINCT ?id WHERE {\t\t\t\t\t\t?i ?prop <{ITEM_URI}>.\t\t\t\t\t\t?id ?x ?prop.\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t}\t\t\t\t\t\tLIMIT 100\t\t\t\t\t}\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}\t\t\t\tLIMIT 100',genericSuggest:function(){var e,t,r;return 0===this._query.getTriples().length?'SELECT ?id ?label ?description (?count as ?rank) WITH {\t\t\t\t\tSELECT ?pred (COUNT(?value) AS ?count) WHERE\t\t\t\t\t{\t\t\t\t\t?subj ?pred ?value .\t\t\t\t\t} GROUP BY ?pred ORDER BY DESC(?count) LIMIT 1000\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id wikibase:claim ?pred.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "en")\t\t\t\t\tFILTER((LANG(?description)) = "en")\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100':(e=this._query.getBoundVariables().shift()||this._query.getTripleVariables().shift(),t=(r=this._query.clone().setLimit(500).removeService("http://wikiba.se/ontology#label").addVariable(e).getQueryString()).match(/.*\bPREFIX\b(.*)/gi).join("\n"),r=r.replace(/.*\bPREFIX\b.*/gi,""),'{PREFIXES}\n\t\t\t\t\tSELECT ?id ?label ?description (?count as ?rank) WITH {\n\t\t\t\t\t\t{QUERY}\n\t\t\t\t\t} AS %query WITH {\n\t\t\t\t\t\tSELECT ({VARIABLE} AS ?item) WHERE {\n\t\t\t\t\t\t\tINCLUDE %query.\n\t\t\t\t\t\t}\n\t\t\t\t\t} AS %item WITH {\n\t\t\t\t\t\tSELECT ?property (COUNT(?statement) AS ?count) WHERE {\n\t\t\t\t\t\t\tINCLUDE %item.\n\t\t\t\t\t\t\t?item ?p ?statement.\n\t\t\t\t\t\t\t?property a wikibase:Property; wikibase:claim ?p.\n\t\t\t\t\t\t}\n\t\t\t\t\t\tGROUP BY ?property\n\t\t\t\t\t\tORDER BY DESC(?count)\n\t\t\t\t\t\tLIMIT 100\n\t\t\t\t\t} AS %properties WHERE {\n\t\t\t\t\t\tINCLUDE %properties.\n\t\t\t\t\t\tBIND(?property AS ?id).\n\t\t\t\t\t\tSERVICE wikibase:label {\n\t\t\t\t\t\t\tbd:serviceParam wikibase:language "[AUTO_LANGUAGE],en".\n\t\t\t\t\t\t\t?id rdfs:label ?label; schema:description ?description.\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tORDER BY DESC(?count)'.replace("{QUERY}",r).replace("{VARIABLE}",e).replace("{PREFIXES}",t))},search:null,seeAlso:'SELECT ?id ?label ?description WHERE {\t\t\t\t\tBIND( <{PROPERTY_URI}> as ?prop).\t\t\t\t\t?props ?x  ?prop.\t\t\t\t\t?props rdf:type wikibase:Property.\t\t\t\t\t?props wdt:P1659 ?id.\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t}'},sparql:{search:'SELECT ?id ?label ?description WITH {\t\t\t\t\t{SPARQL}\t\t\t\t\t} AS %inner\t\t\t\tWHERE {\t\t\t\t\tINCLUDE %inner\t\t\t\t\t?id rdfs:label ?label.\t\t\t\t\t?id schema:description ?description.\t\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t\t\tFILTER(STRSTARTS(LCASE(?label), LCASE("{TERM}")))\t\t\t\t} ORDER BY DESC(?count)\t\t\t\tLIMIT 100',suggest:'SELECT ?id ?label ?description WITH {\t\t\t\t{SPARQL}\t\t\t\t} AS %inner\t\t\tWHERE {\t\t\t\tINCLUDE %inner\t\t\t\t?id rdfs:label ?label.\t\t\t\t?id schema:description ?description.\t\t\t\tFILTER((LANG(?label)) = "{LANGUAGE}")\t\t\t\tFILTER((LANG(?description)) = "{LANGUAGE}")\t\t\t} ORDER BY DESC(?count)\t\t\tLIMIT 100'}};function e(e,t){this._api=e||new u.queryService.api.Wikibase,this._sparqlApi=t||new u.queryService.api.Sparql}return e.prototype._api=null,e.prototype._sparqlApi=null,e.prototype._query=null,e.prototype.setQuery=function(e){this._query=e},e.prototype.add=function(e,t,r,i){switch(e.data("type").toLowerCase()){case"number":this._createInput(e,r,i);break;case"tagcloud":this._createTagCloud(e,t,r,i);break;default:this._createSelect(e,t,r,i)}},e.prototype._createInput=function(t,e,r){var i=l("<input>").attr("type",t.data("type")),a=this._getCloseButton(),r=this._getToolbar(r,t),n=l("<div>").append(a," ",i," ",r);t.clickover({placement:"bottom",global_close:!1,html:!0,sanitize:!1,content:function(){return n}}).click(function(e){i.val(t.data("value")||"")}),i.on("keyup mouseup",function(){e&&e(i.val())})},e.prototype._createTagCloud=function(e,t,r,i){var a=this,n=e.data("entity"),o=e.data("sparql"),s=[];s=[],a._searchEntitiesSparql(null,n,t,o).then(function(e){e.forEach(function(t){s.push({text:t.text,weight:t.data.rank||(9<Math.round(10*Math.random())?5:Math.round(3*Math.random())),link:"#",html:{title:t.data.description+(t.data.rank?" ("+t.data.rank+")":""),"data-id":t.id},handlers:{click:function(e){return t.data.propertyId?r(t.id,t.text,t.data.propertyId):a._suggestPropertyId(t.id).always(function(e){r(t.id,t.text,e)}),!1}}})})}).then(function(){0===s.length?e.hide():(e.show(),e.jQCloud(s,{delayedMode:!0,autoResize:!0}))})},e.prototype._createSelect=function(a,t,n,e){var o=this,s=this._getSelectBox(a),r=this._getCloseButton(),e=this._getToolbar(e,a),i=l("<div>").append(r," ",s," ",e);0===a.children().length?this._createSelectInline(a,t,n):(a.clickover({placement:"bottom",global_close:!1,html:!0,sanitize:!1,content:function(){return i}}).click(function(e){return s.toggleClass("open"),s.data("select2")||l.proxy(o._renderSelect2(s,a,t),o),s.hasClass("open")&&a.data("auto_open")&&s.data("select2").open(),!1}),s.change(function(e){var t,r,i;n&&(t=s.val(),r=s.find("option:selected").text(),(i=(i=a.data("items"))&&i[t]&&i[t].propertyId||null)?n(t,r,i):o._suggestPropertyId(t).always(function(e){n(t,r,e)})),a.click(),s.html("")}))},e.prototype._suggestPropertyId=function(e){var t=l.Deferred(),e="SELECT ?id (COUNT(?id) AS ?count) WHERE { { SELECT ?id WHERE {\t\t\t\t\t\t\t?i ?prop wd:{ITEM_ID}.\t\t\t\t\t\t\t?id wikibase:directClaim ?prop.\t\t\t\t\t\t\t?id rdf:type wikibase:Property.\t\t\t\t\t\t\t}\t\t\t\t\t\t\tLIMIT 10000 } } GROUP BY ?id ORDER BY DESC(?count) LIMIT 1".replace("{ITEM_ID}",e);return this._sparqlApi.query(e,2e3).done(function(e){try{t.resolve(e.results.bindings[0].id.value.split("/").pop())}catch(e){t.reject()}}).fail(function(){t.reject()}),t.promise()},e.prototype._createSelectInline=function(i,e,a){var n=this._getSelectBox(i);i.replaceWith(n),this._renderSelect2(n,i,e),n.change(function(e){var t,r;a&&(t=n.val(),r=(r=i.data("items"))&&r[t]&&r[t].propertyId||null,a(t,n.find("option:selected").text(),r))})},e.prototype._getSelectBox=function(e){var t=e.data("id"),e=e.text(),r=l("<select>");return t&&r.append(l("<option>").attr("value",t).text(e)),r},e.prototype._getCloseButton=function(){return l('<a href="#" data-dismiss="clickover">').append('<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>')},e.prototype._getToolbar=function(e,i){var a=l("<span>");return l.each(e,function(e,t){var r=l("<a>").attr("href","#");r.prepend('<span class="glyphicon glyphicon-'+e+'" aria-hidden="true"></span>'," "),r.click(function(){return t()&&i.click(),!1}),a.append(r," ")}),a},e.prototype._createLookupService=function(i,a){var n=this,o=i.data("type"),s=i.data("sparql");return function(e,r,t){l.when(n._searchEntitiesSparql(e.data.term,o,a,s),n._searchEntities(e.data.term,o)).done(function(e,t){n._addItemMetaData(i,e.concat(t)),0<e.length&&(e=[{text:u.queryService.ui.i18n.getMessage("wdqs-ve-sb-suggestions","Suggestions"),children:e}]),0<t.length&&0<e.length&&(t=[{text:u.queryService.ui.i18n.getMessage("wdqs-ve-sb-other","Other"),children:t}]),r({results:e.concat(t)})})}},e.prototype._addItemMetaData=function(e,t){var r={};t.forEach(function(e){r[e.data.id]||(r[e.data.id]={}),r[e.data.id].text=e.text,e.data.propertyId&&(r[e.data.id].propertyId=e.data.propertyId)}),e.data("items",r)},e.prototype._getSparqlTemplate=function(e,t,r,i){e=this._getSparqlTemplateDefinition(e,t,r,i),t="function"==typeof e?e.apply(this):e;return t=i?t.replace("{SPARQL}",i):t},e.prototype._getSparqlTemplateDefinition=function(e,t,r,i){if(i)return e?a.sparql.search:a.sparql.suggest;i=a[t];if(e&&""!==e.trim())return r?i.search:null;if("property"===t){if(!r)return i.genericSuggest;if(0===r.object.indexOf("?"))return i.seeAlso}else if(!r)return i.genericSuggest;return i.suggest},e.prototype._searchEntitiesSparqlCreateQuery=function(e,t,r,i){t=this._getSparqlTemplate(e,t,r,i);return t&&(r&&(t=t.replace("{PROPERTY_URI}",function e(t){return"string"==typeof t?t:e(t.items[0])}(r.predicate)).replace("{ITEM_URI}",r.object)),t=(t=e?t.replace("{TERM}",e):t).replace(/\{LANGUAGE\}/g,l.i18n&&l.i18n().locale||"en")),t},e.prototype._searchEntitiesSparql=function(e,t,r,i){var a=l.Deferred(),e=this._searchEntitiesSparqlCreateQuery(e,t,r,i);return(e?(this._sparqlApi.query(e,4e3).done(function(e){e=e.results.bindings.map(function(e){var t=e.id.value.split("/").pop(),r=e.property&&e.property.value.split("/").pop()||null;return{id:t,text:e.label.value,data:{id:t,propertyId:r,description:e.description&&e.description.value||"",rank:e.rank&&e.rank.value||null}}});a.resolve(e)}).always(function(){a.resolve([])}),a):a.resolve([])).promise()},e.prototype._searchEntities=function(e,t){var r=l.Deferred();return(e&&""!==e.trim()?(this._api.searchEntities(e,t).done(function(e){e=e.search.map(function(e){return{id:e.id,text:e.label,data:e}});r.resolve(e)}),r):r.resolve([])).promise()},e.prototype._renderSelect2=function(e,t,r){t=this._createLookupService(t,r);e.select2({width:"auto",templateResult:function(e,t){return e.data?l("<span>").append(l("<b>").text(e.text+" ("+e.data.id+")")).add(l("<br>")).add(l("<small>").text(e.data.description)):e.text},ajax:{delay:250,transport:t},cache:!0})},e}(jQuery,wikibase),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.queryHelper=wikibase.queryService.ui.queryHelper||{},wikibase.queryService.ui.queryHelper.QueryTemplate=function(p,l){"use strict";function r(){}return r.prototype._definition={},r.prototype._template=null,r.prototype._variables=[],r.parse=function(e){var t,e=e.getCommentContent("TEMPLATE=");if(!e)return null;try{t=JSON.parse(e)}catch(e){return null}return(e=new r)._definition=t,e._fragments=r._getQueryTemplateFragments(t),e},r._getQueryTemplateText=function(e,t,r,i){var a,n,o,s;if(-1===["string","object"].indexOf(typeof e.template))throw new Error("unsupported template type, should be single string or map from language code to string");if("string"==typeof e.template)return e.template;if(t in(a=e.template))return a[t];for(o in n=r&&r[t]||{})if((s=n[o])in a)return a[s];if((s=i||"en")in a)return a[s];for(o in a)return a[o];return""},r._getQueryTemplateFragments=function(e){var i,a,t=p.i18n&&p.i18n().locale||"en",r=p.i18n&&p.i18n.fallbacks,n=p.i18n&&p.i18n().options.fallbackLocale,t=this._getQueryTemplateText(e,t,r,n),o=[t];if(t.match(/\0/))throw new Error("query template must not contain null bytes");function s(e){var t=e.replace(new RegExp("\\"+i,"g"),"\0").split("\0");a.push(t[0]);for(var r=1;r<t.length;r++)a.push(i),a.push(t[r])}for(i in e.variables){if(!i.match(new RegExp(l.queryService.VariableNames.VariablePattern)))throw new Error("invalid variable name in query template");a=[],o.forEach(s),o=a}return o},r._buildTemplate=function(e,t){var r=p("<span>");r.append(document.createTextNode(e[0]));for(var i=1;i<e.length;i+=2){var a=e[i],n=p("<span>").text(a);a in t||(t[a]=[]),t[a].push(n),r.append(n),r.append(document.createTextNode(e[i+1]))}return r},r.prototype.getHtml=function(e,s,l){var u;return null===this._template&&(this._template=r._buildTemplate(this._fragments,this._variables),p.each((u=this)._definition.variables,function(n,o){e(n).done(function(r,i,e,a){p.each(u._variables[n],function(e,t){t.text("");t=p("<a>").text(r).attr({"data-id":i,"data-type":a,href:"#"}).appendTo(t);o.query&&t.attr("data-sparql",o.query),s.add(t,null,function(e,t){for(var r in u._variables[n])u._variables[n][r].find('a[data-id="'+i+'"]').attr("data-id",e).text(t),l(n,i,e),i=e})})})})),this._template},r}(jQuery,wikibase),(wikibase=window.wikibase||{}).queryService=wikibase.queryService||{},wikibase.queryService.ui=wikibase.queryService.ui||{},wikibase.queryService.ui.toolbar=wikibase.queryService.toolbar||{},wikibase.queryService.ui.toolbar.Actionbar=function(n){"use strict";function e(e){this._$element=e}return e.prototype._$element=null,e.prototype.show=function(e,t,r,i){var a=e;n.i18n&&(a=n.i18n(e)),""!==t&&(a=a+": "+t),this._$element.find(".message").html(""),r=r||"info",void 0===i||!1===i?this._$element.find(".message").append(this._getBar(a,r)):this._$element.find(".message").append(this._getProgressbar(a,r,i)),this._$element.show()},e.prototype._getProgressbar=function(e,t,r){return n('<div class="progress"><div class="progress-bar progress-bar-'+t+' progress-bar-striped active" role="progressbar" style="width: '+r+'%">'+e+"</div></div>")},e.prototype._getBar=function(e,t){return n('<div class="label label-'+t+'"/>').text(e)},e.prototype.hide=function(){this._$element.hide()},e}(jQuery),function(d,e){"use strict";d.when(d.ready,e.getConfig()).then(function(e,t){var r;var i=Cookies.get("lang")?Cookies.get("lang"):t.language,a=new wikibase.queryService.api.Wikibase(t.api.wikibase.uri,i),n=new wikibase.queryService.api.Sparql(t.api.sparql.uri,i),o=new wikibase.queryService.api.QuerySamples(i,t.api.examples),s=new wikibase.queryService.api.UrlShortener(t.api.urlShortener),l=new wikibase.queryService.ui.ResultView(n,o,a,null,s,null,t.api["query-builder"].server),u=decodeURIComponent(window.location.hash.substr(1)),p=new wikibase.queryService.ui.queryHelper.QueryHelper(a,n),c=d("<div>");l.trackingNamespace="wikibase.queryService.ui.embed.",d(".brand img").attr("src",t.brand.logo),d(".brand > span").text(t.brand.title),document.title=t.brand.title,d.i18n().locale=i,d.when(t.i18nLoad(i)).done(function(){d("body").i18n(),d("html").attr({lang:i,dir:d.uls.data.getDir(i)}),l.draw(u).then(function(){d(".logo").hide()}),function(e,t,r,i){e.setChangeListener(_.debounce(function(e){i(e.getQuery())},1500));try{e.setQuery(t),e.draw(r)}catch(e){return}/^#TEMPLATE=/m.test(t)&&setTimeout(function(){d(".edit").click()},500)}(p,u,c,function(e){l.draw(e),window.location.hash="#"+encodeURIComponent(e),d(".edit-link").attr("href",t.location.index+window.location.hash)}),d(".edit-link").attr("href",t.location.index+window.location.hash)}),d("#display-button").closest(".navbar").addClass("dropup"),d("#expand-type-switch").change(function(){d(this).prop("checked")?d(".expand-type").attr("title",d.i18n("wdqs-embed-explorer-button-incoming")):d(".expand-type").attr("title",d.i18n("wdqs-embed-explorer-button-outgoing"))}),d("a.result-browser").click(function(e){"Graph"!==d(this).text()?d(".expand-type").hide():d(".expand-type").show()}),d("body").mousemove(function(e){clearTimeout(r),d(".toolbar-right").addClass("toolbar-visible"),d(".header-toolbar").addClass("toolbar-visible"),r=window.setTimeout(function(){d(".toolbar-right").removeClass("toolbar-visible"),d(".header-toolbar").removeClass("toolbar-visible")},1e3)}),d(".header-toolbar").hover(function(){d(".header-toolbar").addClass("hovered"),d(".toolbar-label").css("display","block")},function(){d(".toolbar-label").css("display","none"),d(".header-toolbar").removeClass("hovered")}),d(window).on("hashchange",function(e){d(".edit-link").attr("href",t.location.index+window.location.hash),u=decodeURIComponent(window.location.hash.substr(1)),p.setQuery(u),p.draw(c)}),d(".edit").on("click",function(e){e.preventDefault(),d(".toolbar-right").toggleClass("hovered")}).popover({placement:"bottom",html:!0,content:c}),d(".download-dropdown").on("show.bs.dropdown",function(){d(".toolbar-right").toggleClass("hovered")}),d(".download-dropdown").on("hide.bs.dropdown",function(){d(".toolbar-right").toggleClass("hovered")})})}(jQuery,CONFIG);